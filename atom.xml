<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å¤§æ¶›å­</title>
  
  <subtitle>ç®€å•ã€æè‡´ã€ä¸å¤±é£è¶£</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yangtao.site/"/>
  <updated>2020-03-18T04:09:39.746Z</updated>
  <id>http://yangtao.site/</id>
  
  <author>
    <name>æ¨æ¶›</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hiï¼Œå¾ˆé«˜å…´è§åˆ°ä½ ~</title>
    <link href="http://yangtao.site/2048/10/24/hello-world/"/>
    <id>http://yangtao.site/2048/10/24/hello-world/</id>
    <published>2048-10-24T05:14:15.000Z</published>
    <updated>2020-03-18T04:09:39.746Z</updated>
    
    <content type="html"><![CDATA[<p>æ¬¢è¿<a href="/2048/10/24/hello-world/">åœ¨æ­¤</a>ç•™è¨€ï¼Œæˆ–è€…å»<a href="/friends/">å‹é“¾</a>çœ‹çœ‹å¤§å®¶ ~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ¬¢è¿&lt;a href=&quot;/2048/10/24/hello-world/&quot;&gt;åœ¨æ­¤&lt;/a&gt;ç•™è¨€ï¼Œæˆ–è€…å»&lt;a href=&quot;/friends/&quot;&gt;å‹é“¾&lt;/a&gt;çœ‹çœ‹å¤§å®¶ ~&lt;/p&gt;

      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æµè§ˆå™¨æ˜¯æ€ä¹ˆç¼“å­˜èµ„æºçš„</title>
    <link href="http://yangtao.site/2020/03/27/web-cache/"/>
    <id>http://yangtao.site/2020/03/27/web-cache/</id>
    <published>2020-03-27T12:24:41.000Z</published>
    <updated>2020-03-27T12:29:14.430Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å¯¹æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶æ¥åšä¸ªç®€è¦çš„æ€»ç»“ï¼šé¦–å…ˆé€šè¿‡ <code>Cache-Control</code> éªŒè¯å¼ºç¼“å­˜æ˜¯å¦å¯ç”¨ï¼›å¦‚æœå¼ºç¼“å­˜å¯ç”¨ï¼Œç›´æ¥ä½¿ç”¨ï¼›å¦åˆ™è¿›å…¥åå•†ç¼“å­˜ï¼Œå³å‘é€ HTTP è¯·æ±‚ï¼ŒæœåŠ¡å™¨é€šè¿‡è¯·æ±‚å¤´ä¸­çš„<code>If-Modified-Since</code>æˆ–è€…<code>If-None-Match</code>è¿™äº›æ¡ä»¶è¯·æ±‚å­—æ®µæ£€æŸ¥èµ„æºæ˜¯å¦æ›´æ–°ã€‚è‹¥èµ„æºæ›´æ–°ï¼Œè¿”å›èµ„æºå’Œ<strong>200 çŠ¶æ€ç </strong>ï¼›å¦åˆ™ï¼Œè¿”å›<strong>304</strong>ï¼Œå‘Šè¯‰æµè§ˆå™¨ç›´æ¥ä»ç¼“å­˜è·å–èµ„æº</p></blockquote><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æµè§ˆå™¨ç¼“å­˜ï¼ˆBrower Cachingï¼‰æ˜¯æµè§ˆå™¨åœ¨æœ¬åœ°ç£ç›˜å¯¹ç”¨æˆ·æœ€è¿‘è¯·æ±‚è¿‡çš„æ–‡æ¡£è¿›è¡Œå­˜å‚¨ï¼Œå½“è®¿é—®è€…å†æ¬¡è®¿é—®åŒä¸€é¡µé¢æ—¶ï¼Œæµè§ˆå™¨å°±å¯ä»¥ç›´æ¥ä»æœ¬åœ°ç£ç›˜åŠ è½½æ–‡æ¡£ã€‚è¿™æ ·åšçš„å¥½å¤„æœ‰ï¼š<strong>å‡å°‘å†—ä½™æ•°æ®ä¼ è¾“ã€å‡å°‘æœåŠ¡å™¨è´Ÿæ‹…ã€åŠ å¿«å®¢æˆ·ç«¯åŠ è½½ç½‘é¡µçš„é€Ÿåº¦</strong>ã€‚</p><p>æµè§ˆå™¨çš„ç¼“å­˜è§„åˆ™åˆ†ä¸ºä¸¤å¤§å—ï¼š<strong>å¼ºåˆ¶ç¼“å­˜</strong>å’Œ<strong>åå•†ç¼“å­˜</strong>ã€‚å¯¹äºæŸä¸ªæ–‡ä»¶æ¥è¯´ï¼Œå…·ä½“æ˜¯é‡‡ç”¨å“ªç§ç¼“å­˜æ–¹å¼ï¼Œç”± HTTP Response Headers è®¾ç½®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ meta æ ‡ç­¾ï¼Œä½†æ˜¯ç°åœ¨è¶Šæ¥è¶Šå¤šæµè§ˆå™¨å¿½ç•¥è®¾ç½®ç¼“å­˜çš„ meta æ ‡ç­¾ï¼Œæ‰€ä»¥è¿˜æ˜¯æ¨èé€šè¿‡ HTTP Response Headers è®¾ç½®ã€‚</p><h2 id="å¼ºåˆ¶ç¼“å­˜"><a href="#å¼ºåˆ¶ç¼“å­˜" class="headerlink" title="å¼ºåˆ¶ç¼“å­˜"></a>å¼ºåˆ¶ç¼“å­˜</h2><p>é¦–å…ˆå®¢æˆ·ç«¯ä¼šæ£€æŸ¥æœ¬åœ°ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ‰€è¦è¯·æ±‚çš„æ•°æ®ï¼Œå¦‚æœæœ‰ï¼Œå°±ç›´æ¥ä»ç¼“å­˜ä¸­è·å–æ•°æ®ï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±ä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚</p><p>HTTP Response Headers ä¸­ <code>Cache-Control</code> å’Œ <code>Expires</code> å­—æ®µéƒ½è¡¨ç¤ºå¯¹æœ¬èµ„æºå¯åŠ¨å¼ºåˆ¶ç¼“å­˜ï¼Œå…¶ä¸­ Cache-Control æ˜¯ http1.1 æ ‡å‡†ä¸­çš„å­—æ®µï¼Œè€Œ Expires æ˜¯ http1.0 çš„å­—æ®µï¼ŒCache-Control ä¼˜å…ˆçº§æ›´é«˜ï¼Œä½¿ç”¨æ›´å¹¿æ³›ã€‚</p><h3 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h3><p><strong>Expires</strong> å³è¿‡æœŸæ—¶é—´ï¼Œå­˜åœ¨äºæœåŠ¡ç«¯è¿”å›çš„å“åº”å¤´ä¸­ï¼Œå‘Šè¯‰æµè§ˆå™¨åœ¨è¿™ä¸ªè¿‡æœŸæ—¶é—´ä¹‹å‰å¯ä»¥ç›´æ¥ä»ç¼“å­˜é‡Œé¢è·å–æ•°æ®ï¼Œæ— éœ€å†æ¬¡è¯·æ±‚ï¼Œå¦‚ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Expires</span>: Wed, 22 Nov 2019 08:41:00 GMT</span><br></pre></td></tr></table></figure><h3 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h3><p><strong>Cache-Control</strong> çš„å€¼çš„å•ä½ä¸ºç§’ï¼Œå…³é”®å­— <code>max-age</code> è¡¨ç¤ºå¯ä»¥è¢«ç¼“å­˜å¤šé•¿æ—¶é—´ã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">cache-control</span>: max-age=36029314</span><br></pre></td></tr></table></figure><p>ç™¾åº¦é¦–é¡µåŠ è½½çš„ä¸€ä¸ªèµ„æºè¿”å›å¤´ä¸­å‡ºç°äº† Cache-Control å­—æ®µï¼Œå½“ Cache-Control å€¼è®¾ä¸º <code>max-age=300</code> æ—¶ï¼Œåˆ™ä»£è¡¨åœ¨è¿™ä¸ªè¯·æ±‚æ­£ç¡®è¿”å›æ—¶é—´ï¼ˆæµè§ˆå™¨ä¹Ÿä¼šè®°å½•ä¸‹æ¥ï¼‰çš„ 5 åˆ†é’Ÿå†…å†æ¬¡åŠ è½½èµ„æºï¼Œå°±ä¼šå‘½ä¸­å¼ºç¼“å­˜ã€‚</p><p>å¸¸ç”¨çš„è®¾ç½®å€¼ï¼š</p><ul><li><code>no-cache</code>ï¼š ä¸ä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚éœ€è¦ä½¿ç”¨ç¼“å­˜åå•†ï¼Œå…ˆä¸æœåŠ¡å™¨ç¡®è®¤è¿”å›çš„å“åº”æ˜¯å¦è¢«æ›´æ”¹ï¼Œå¦‚æœä¹‹å‰çš„å“åº”ä¸­å­˜åœ¨ ETagï¼Œé‚£ä¹ˆè¯·æ±‚çš„æ—¶å€™ä¼šä¸æœåŠ¡ç«¯éªŒè¯ï¼Œå¦‚æœèµ„æºæœªè¢«æ›´æ”¹ï¼Œåˆ™å¯ä»¥é¿å…é‡æ–°ä¸‹è½½ã€‚</li><li><code>no-store</code>ï¼š ç›´æ¥ç¦æ­¢æµè§ˆå™¨ç¼“å­˜æ•°æ®ï¼Œæ¯æ¬¡ç”¨æˆ·è¯·æ±‚è¯¥èµ„æºï¼Œéƒ½ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯æ¬¡éƒ½ä¼šä¸‹è½½å®Œæ•´çš„èµ„æºã€‚</li><li><code>public</code>ï¼š å¯ä»¥è¢«æ‰€æœ‰çš„ç”¨æˆ·ç¼“å­˜ï¼ŒåŒ…æ‹¬ç»ˆç«¯ç”¨æˆ·å’Œ CDN ç­‰ä¸­é—´ä»£ç†æœåŠ¡å™¨ã€‚</li><li><code>private</code>ï¼š åªèƒ½è¢«ç»ˆç«¯ç”¨æˆ·çš„æµè§ˆå™¨ç¼“å­˜ï¼Œä¸å…è®¸ CDN ç­‰ä¸­ç»§ç¼“å­˜æœåŠ¡å™¨å¯¹å…¶ç¼“å­˜ã€‚</li><li><code>s-maxage</code>ï¼šè¿™å’Œ max-age é•¿å¾—æ¯”è¾ƒåƒï¼Œä½†æ˜¯åŒºåˆ«åœ¨äº s-maxage æ˜¯é’ˆå¯¹ä»£ç†æœåŠ¡å™¨çš„ç¼“å­˜æ—¶é—´ã€‚</li><li><code>must-revalidate</code>ï¼šæ˜¯ç¼“å­˜å°±ä¼šæœ‰è¿‡æœŸçš„æ—¶å€™ï¼ŒåŠ ä¸Šè¿™ä¸ªå­—æ®µä¸€æ—¦ç¼“å­˜è¿‡æœŸï¼Œå°±å¿…é¡»å›åˆ°æºæœåŠ¡å™¨éªŒè¯ã€‚</li></ul><p><strong>æ³¨æ„</strong>ï¼šå½“ Expires å’Œ Cache-Control åŒæ—¶å­˜åœ¨çš„æ—¶å€™ï¼ŒCache-Control ä¼šä¼˜å…ˆè€ƒè™‘ã€‚</p><p>å½“ç„¶ï¼Œè¿˜å­˜åœ¨ä¸€ç§æƒ…å†µï¼Œå½“èµ„æºç¼“å­˜æ—¶é—´è¶…æ—¶äº†ï¼Œä¹Ÿå°±æ˜¯å¼ºç¼“å­˜å¤±æ•ˆäº†ï¼Œæ¥ä¸‹æ¥æ€ä¹ˆåŠï¼Ÿæ²¡é”™ï¼Œè¿™æ ·å°±è¿›å…¥åˆ°ç¬¬äºŒçº§å±éšœâ€”â€”åå•†ç¼“å­˜äº†ã€‚</p><h2 id="åå•†ç¼“å­˜"><a href="#åå•†ç¼“å­˜" class="headerlink" title="åå•†ç¼“å­˜"></a>åå•†ç¼“å­˜</h2><p>å¼ºç¼“å­˜å¤±æ•ˆä¹‹åï¼Œæµè§ˆå™¨åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ç›¸åº”çš„ç¼“å­˜ tag æ¥å‘æœåŠ¡å™¨å‘è¯·æ±‚ï¼Œç”±æœåŠ¡å™¨æ ¹æ®è¿™ä¸ª tagï¼Œæ¥å†³å®šæ˜¯å¦ä½¿ç”¨ç¼“å­˜ï¼Œè¿™å°±æ˜¯åå•†ç¼“å­˜ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œè¿™æ ·çš„ç¼“å­˜ tag åˆ†ä¸ºä¸¤ç§: <strong>Last-Modified</strong> å’Œ <strong>ETag</strong>ã€‚è¿™ä¸¤è€…å„æœ‰ä¼˜åŠ£ï¼Œå¹¶ä¸å­˜åœ¨è°å¯¹è°æœ‰ç»å¯¹çš„ä¼˜åŠ¿ï¼Œè·Ÿä¸Šé¢å¼ºç¼“å­˜çš„ä¸¤ä¸ª tag ä¸ä¸€æ ·ã€‚</p><h3 id="Last-Modified"><a href="#Last-Modified" class="headerlink" title="Last-Modified"></a>Last-Modified</h3><p>èµ„æºè¢«æœåŠ¡å™¨è¿”å›æ—¶ï¼ŒHTTP Response Headers ä¸­çš„ <strong>Last-Modified</strong> è¿”å›å¤´æ ‡è¯†äº†æ­¤èµ„æºåœ¨æœåŠ¡å™¨ä¸Šçš„æœ€åä¿®æ”¹æ—¶é—´ã€‚</p><p>æµè§ˆå™¨å†æ¬¡è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼Œä¼šå°†ä¸Šæ¬¡ <strong>Last-Modified</strong> çš„å€¼ä½œä¸º <strong>if-Modified-Since</strong> å¤´çš„å€¼å‘é€ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼ŒæŸ¥çœ‹æœ€åä¿®æ”¹æ—¶é—´ä»¥åèµ„æºæ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼š</p><ul><li>æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ï¼Œå°±è¿”å› <strong>304</strong>ï¼Œä»ç¼“å­˜è¯»å–</li><li>ä¿®æ”¹è¿‡ï¼Œè¿”å›çŠ¶æ€ <strong>200</strong> ä»¥åŠæ•´ä¸ªèµ„æº</li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">last-modified</span>: Wed, 13 Nov 2019 15:16:37 GMT</span><br></pre></td></tr></table></figure><h3 id="Etag"><a href="#Etag" class="headerlink" title="Etag"></a>Etag</h3><p><strong>ETag</strong> æ˜¯æœåŠ¡å™¨æ ¹æ®å½“å‰æ–‡ä»¶çš„å†…å®¹ï¼Œç»™æ–‡ä»¶ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ï¼Œåªè¦é‡Œé¢çš„å†…å®¹æœ‰æ”¹åŠ¨ï¼Œè¿™ä¸ªå€¼å°±ä¼šå˜ã€‚æœåŠ¡å™¨é€šè¿‡å“åº”å¤´æŠŠè¿™ä¸ªå€¼ç»™æµè§ˆå™¨ã€‚</p><p>æµè§ˆå™¨æ¥æ”¶åˆ° ETag çš„å€¼ï¼Œä¼šåœ¨ä¸‹æ¬¡è¯·æ±‚æ—¶ï¼Œå°†è¿™ä¸ªå€¼ä½œä¸º<strong>If-None-Match</strong>è¿™ä¸ªå­—æ®µçš„å†…å®¹ï¼Œå¹¶æ”¾åˆ°è¯·æ±‚å¤´ä¸­ï¼Œç„¶åå‘ç»™æœåŠ¡å™¨ã€‚</p><p>æœåŠ¡å™¨æ¥æ”¶åˆ° If-None-Match åï¼Œä¼šè·ŸæœåŠ¡å™¨ä¸Šè¯¥èµ„æºçš„ ETag è¿›è¡Œæ¯”å¯¹ï¼š</p><ul><li>ä¸¤è€…ä¸ä¸€æ ·ï¼Œè¯´æ˜è¦æ›´æ–°äº†ã€‚è¿”å›æ–°çš„èµ„æºï¼Œè·Ÿå¸¸è§„çš„ HTTP è¯·æ±‚å“åº”çš„æµç¨‹ä¸€æ ·</li><li>å¦åˆ™è¿”å› 304ï¼Œå‘Šè¯‰æµè§ˆå™¨ç›´æ¥ç”¨ç¼“å­˜</li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">etag</span>: W/"36BE6ECF0746FFAC5024A69C27141E08"</span><br></pre></td></tr></table></figure><h3 id="ä¸¤è€…å¯¹æ¯”"><a href="#ä¸¤è€…å¯¹æ¯”" class="headerlink" title="ä¸¤è€…å¯¹æ¯”"></a>ä¸¤è€…å¯¹æ¯”</h3><p><strong>ç²¾åº¦ä¸Š</strong>Etag è¦ä¼˜äº Last-Modifiedã€‚Last-Modified çš„æ—¶é—´å•ä½æ˜¯ç§’ï¼Œå¦‚æœæŸä¸ªæ–‡ä»¶åœ¨ 1 ç§’å†…æ”¹å˜äº†å¤šæ¬¡ï¼Œé‚£ä¹ˆä»–ä»¬çš„ Last-Modified å…¶å®å¹¶æ²¡æœ‰ä½“ç°å‡ºæ¥ä¿®æ”¹ï¼Œä½†æ˜¯ Etag æ¯æ¬¡éƒ½ä¼šæ”¹å˜ç¡®ä¿äº†ç²¾åº¦ã€‚</p><p><strong>æ€§èƒ½ä¸Š</strong>ï¼ŒLast-Modified è¦ä¼˜äº Etagï¼Œæ¯•ç«Ÿ Last-Modified åªéœ€è¦è®°å½•æ—¶é—´ï¼Œè€Œ Etag éœ€è¦æœåŠ¡å™¨é€šè¿‡ç®—æ³•æ¥è®¡ç®—å‡ºä¸€ä¸ª hash å€¼ã€‚</p><p><strong>ä¼˜å…ˆçº§ä¸Š</strong>ï¼ŒæœåŠ¡å™¨æ ¡éªŒä¼˜å…ˆè€ƒè™‘ Etagã€‚</p><h2 id="æµè§ˆå™¨ç¼“å­˜"><a href="#æµè§ˆå™¨ç¼“å­˜" class="headerlink" title="æµè§ˆå™¨ç¼“å­˜"></a>æµè§ˆå™¨ç¼“å­˜</h2><p>æµè§ˆå™¨ç¼“å­˜è¿™ä¸€å—ï¼Œæœ€é‡è¦çš„æ˜¯èƒ½åŒºåˆ†å¼€<strong>å¼ºåˆ¶ç¼“å­˜</strong>å’Œ<strong>åå•†ç¼“å­˜</strong>ï¼š</p><ul><li>å®Œå…¨ä¸å‘æœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ˜¯å¼ºåˆ¶ç¼“å­˜</li><li>æœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ˜¯åå•†ç¼“å­˜ï¼Œæ¶‰åŠåˆ° 304 çš„éƒ½æ˜¯åå•†ç¼“å­˜</li></ul><p>æ€»ç»“ä¸€ä¸‹æµè§ˆå™¨ç¼“å­˜çš„å…¨è¿‡ç¨‹ï¼š</p><p>æµè§ˆå™¨ç¬¬ä¸€æ¬¡åŠ è½½èµ„æºï¼ŒæœåŠ¡å™¨è¿”å› 200ï¼Œæµè§ˆå™¨ä»æœåŠ¡å™¨ä¸‹è½½èµ„æºæ–‡ä»¶ï¼Œå¹¶ç¼“å­˜ä½èµ„æºæ–‡ä»¶ä¸ response header ä»¥ä¾›ä¸‹æ¬¡åŠ è½½æ—¶å¯¹æ¯”ä½¿ç”¨ï¼›</p><p>ä¸‹ä¸€æ¬¡åŠ è½½èµ„æºæ—¶ï¼Œç”±äºå¼ºåˆ¶ç¼“å­˜ä¼˜å…ˆçº§è¾ƒé«˜ï¼Œå…ˆæ¯”è¾ƒå½“å‰æ—¶é—´ä¸ä¸Šä¸€æ¬¡è¿”å› 200 æ—¶çš„æ—¶é—´å·®ï¼Œå¦‚æœæ²¡æœ‰è¶…è¿‡ cache-control è®¾ç½®çš„ max-ageï¼Œåˆ™æ²¡æœ‰è¿‡æœŸï¼Œå¹¶å‘½ä¸­<strong>å¼ºç¼“å­˜</strong>ï¼Œç›´æ¥ä»æœ¬åœ°è¯»å–èµ„æºã€‚å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ HTTP1.1ï¼Œåˆ™ä½¿ç”¨ expires å¤´åˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼›</p><p>å¦‚æœèµ„æºå·²è¿‡æœŸï¼Œåˆ™è¡¨æ˜å¼ºåˆ¶ç¼“å­˜æ²¡æœ‰è¢«å‘½ä¸­ï¼Œåˆ™å¼€å§‹<strong>åå•†ç¼“å­˜</strong>ï¼Œå‘æœåŠ¡å™¨å‘é€å¸¦æœ‰ <code>If-None-Match</code> å’Œ <code>If-Modified-Since</code> çš„è¯·æ±‚ï¼›</p><p>æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œä¼˜å…ˆæ ¹æ® Etag çš„å€¼åˆ¤æ–­è¢«è¯·æ±‚çš„æ–‡ä»¶æœ‰æ²¡æœ‰åšä¿®æ”¹ï¼ŒEtag å€¼ä¸€è‡´åˆ™æ²¡æœ‰ä¿®æ”¹ï¼Œå‘½ä¸­åå•†ç¼“å­˜ï¼Œè¿”å› <strong>304</strong>ï¼›å¦‚æœä¸ä¸€è‡´åˆ™æœ‰æ”¹åŠ¨ï¼Œç›´æ¥è¿”å›æ–°çš„èµ„æºæ–‡ä»¶å¸¦ä¸Šæ–°çš„ Etag å€¼å¹¶è¿”å› <strong>200</strong>ï¼›</p><p>å¦‚æœæœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚æ²¡æœ‰ Etag å€¼ï¼Œåˆ™å°† <code>If-Modified-Since</code> å’Œè¢«è¯·æ±‚æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´åšæ¯”å¯¹ï¼Œä¸€è‡´åˆ™å‘½ä¸­åå•†ç¼“å­˜ï¼Œè¿”å› 304ï¼›ä¸ä¸€è‡´åˆ™è¿”å›æ–°çš„ <code>last-modified</code> å’Œæ–‡ä»¶å¹¶è¿”å› 200ã€‚</p><h2 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h2><h3 id="ç‚¹å‡»åˆ·æ–°æŒ‰é’®æˆ–è€…æŒ‰-F5"><a href="#ç‚¹å‡»åˆ·æ–°æŒ‰é’®æˆ–è€…æŒ‰-F5" class="headerlink" title="ç‚¹å‡»åˆ·æ–°æŒ‰é’®æˆ–è€…æŒ‰ F5"></a>ç‚¹å‡»åˆ·æ–°æŒ‰é’®æˆ–è€…æŒ‰ F5</h3><p>æµè§ˆå™¨ç›´æ¥å¯¹æœ¬åœ°çš„ç¼“å­˜æ–‡ä»¶è¿‡æœŸï¼Œä½†æ˜¯ä¼šå¸¦ä¸Š<code>If-Modifed-Since</code>ï¼Œ<code>If-None-Match</code>ï¼Œè¿™å°±æ„å‘³ç€æœåŠ¡å™¨ä¼šå¯¹æ–‡ä»¶æ£€æŸ¥æ–°é²œåº¦ï¼Œè¿”å›ç»“æœå¯èƒ½æ˜¯ 304ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ 200ã€‚</p><h3 id="ç”¨æˆ·æŒ‰-Ctrl-F5"><a href="#ç”¨æˆ·æŒ‰-Ctrl-F5" class="headerlink" title="ç”¨æˆ·æŒ‰ Ctrl+F5"></a>ç”¨æˆ·æŒ‰ Ctrl+F5</h3><p>æµè§ˆå™¨ä¸ä»…ä¼šå¯¹æœ¬åœ°æ–‡ä»¶è¿‡æœŸï¼Œè€Œä¸”ä¸ä¼šå¸¦ä¸Š <code>If-Modifed-Since</code>ï¼Œ<code>If-None-Match</code>ï¼Œç›¸å½“äºä¹‹å‰ä»æ¥æ²¡æœ‰è¯·æ±‚è¿‡ï¼Œè¿”å›ç»“æœæ˜¯ 200ã€‚</p><h3 id="åœ°å€æ å›è½¦"><a href="#åœ°å€æ å›è½¦" class="headerlink" title="åœ°å€æ å›è½¦"></a>åœ°å€æ å›è½¦</h3><p>æµè§ˆå™¨å‘èµ·è¯·æ±‚ï¼ŒæŒ‰ç…§æ­£å¸¸æµç¨‹ï¼Œæœ¬åœ°æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œç„¶åæœåŠ¡å™¨æ£€æŸ¥æ–°é²œåº¦ï¼Œæœ€åè¿”å›å†…å®¹ã€‚</p><p>æœ€åè¿˜å¯ä»¥æåˆ°ï¼Œä½ æ³¨æ„åˆ°å¾ˆå¤šç½‘ç«™çš„èµ„æºåé¢éƒ½åŠ äº†ç‰ˆæœ¬å·ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ï¼šæ¯æ¬¡å‡çº§äº† JS æˆ– CSS æ–‡ä»¶åï¼Œä¸ºäº†é˜²æ­¢æµè§ˆå™¨è¿›è¡Œç¼“å­˜ï¼Œå¼ºåˆ¶æ”¹å˜ç‰ˆæœ¬å·ï¼Œå®¢æˆ·ç«¯æµè§ˆå™¨å°±ä¼šé‡æ–°ä¸‹è½½æ–°çš„ JS æˆ– CSS æ–‡ä»¶ ï¼Œä»¥ä¿è¯ç”¨æˆ·èƒ½å¤ŸåŠæ—¶è·å¾—ç½‘ç«™çš„æœ€æ–°æ›´æ–°ã€‚</p><h3 id="ç¼“å­˜çš„èµ„æºéƒ½å­˜åœ¨å“ªé‡Œ"><a href="#ç¼“å­˜çš„èµ„æºéƒ½å­˜åœ¨å“ªé‡Œ" class="headerlink" title="ç¼“å­˜çš„èµ„æºéƒ½å­˜åœ¨å“ªé‡Œ"></a>ç¼“å­˜çš„èµ„æºéƒ½å­˜åœ¨å“ªé‡Œ</h3><p>æŒ‰ä¼˜å…ˆçº§ä»é«˜åˆ°ä½åˆ†åˆ«æ˜¯ï¼š</p><ul><li><p><strong>Service Worker</strong>ï¼šè¿è¡Œåœ¨ JavaScript ä¸»çº¿ç¨‹ä¹‹å¤–ï¼Œè™½ç„¶ç”±äºè„±ç¦»äº†æµè§ˆå™¨çª—ä½“æ— æ³•ç›´æ¥è®¿é—® DOMï¼Œä½†æ˜¯å®ƒå¯ä»¥å®Œæˆç¦»çº¿ç¼“å­˜ã€æ¶ˆæ¯æ¨é€ã€ç½‘ç»œä»£ç†ç­‰åŠŸèƒ½ã€‚</p></li><li><p><strong>Memory Cache</strong>ï¼šå°±æ˜¯å†…å­˜ç¼“å­˜ï¼Œå®ƒçš„æ•ˆç‡æœ€å¿«ï¼Œä½†æ˜¯å­˜æ´»æ—¶é—´æœ€çŸ­ï¼Œä½ ä¸€å…³æ‰æµè§ˆå™¨ Memory Cache é‡Œçš„æ–‡ä»¶å°±è¢«æ¸…ç©ºäº†ã€‚</p></li><li><p><strong>Disk Cacheï¼šCache</strong> èµ„æºè¢«å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šï¼Œå­˜æ´»æ—¶é—´æ¯” Memory Cache è¦æŒä¹…å¾ˆå¤šã€‚</p></li><li><p><strong>Push Cache</strong>ï¼šå³æ¨é€ç¼“å­˜ï¼Œè¿™æ˜¯æµè§ˆå™¨ç¼“å­˜çš„æœ€åä¸€é“é˜²çº¿ã€‚å®ƒæ˜¯ HTTP/2 ä¸­çš„å†…å®¹ï¼Œè™½ç„¶ç°åœ¨åº”ç”¨çš„å¹¶ä¸å¹¿æ³›ï¼Œä½†éšç€ HTTP/2 çš„æ¨å¹¿ï¼Œå®ƒçš„åº”ç”¨è¶Šæ¥è¶Šå¹¿æ³›ã€‚</p></li></ul><h2 id="Node-æ¼”ç¤º"><a href="#Node-æ¼”ç¤º" class="headerlink" title="Node æ¼”ç¤º"></a>Node æ¼”ç¤º</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">const</span> md5 = <span class="built_in">require</span>(<span class="string">"md5"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> html = fs.readFileSync(<span class="string">"index.html"</span>, <span class="string">"utf-8"</span>);</span><br><span class="line">  <span class="keyword">const</span> script = fs.readFileSync(<span class="string">"script.js"</span>, <span class="string">"utf-8"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">"/"</span>) &#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">      <span class="string">"Content-Type"</span>: <span class="string">"text/html"</span></span><br><span class="line">    &#125;);</span><br><span class="line">    res.write(html);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">"/script.js"</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> etag = md5(script);</span><br><span class="line">    <span class="keyword">const</span> lastMidified = lastUpdatedDate(<span class="string">"./script.js"</span>);</span><br><span class="line">    <span class="keyword">const</span> ifNoneMatch = req.headers[<span class="string">"if-none-match"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> statusCode = ifNoneMatch === etag ? <span class="number">304</span> : <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">    res.writeHead(statusCode, &#123;</span><br><span class="line">      <span class="string">"Content-Type"</span>: <span class="string">"text/javascript"</span>,</span><br><span class="line">      <span class="string">"Cache-Control"</span>: <span class="string">"no-cache"</span>,</span><br><span class="line">      <span class="string">"Last-Modified"</span>: lastMidified,</span><br><span class="line">      Etag: etag</span><br><span class="line">    &#125;);</span><br><span class="line">    res.write(script);</span><br><span class="line">  &#125;</span><br><span class="line">  res.end();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lastUpdatedDate</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; mtime &#125; = fs.statSync(file);</span><br><span class="line">  <span class="keyword">return</span> mtime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http.createServer(handle).listen(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://www.imooc.com/read/68/article/1558" target="_blank" rel="noopener">æµè§ˆå™¨æ˜¯æ€ä¹ˆç¼“å­˜èµ„æºçš„</a></li><li><a href="http://47.98.159.95/my_blog/perform/001.html#%E5%BC%BA%E7%BC%93%E5%AD%98" target="_blank" rel="noopener">èƒ½ä¸èƒ½è¯´ä¸€è¯´å‰ç«¯ç¼“å­˜</a></li><li><a href="https://www.jianshu.com/p/4667d0425878" target="_blank" rel="noopener">æµè§ˆå™¨ç¼“å­˜ cache-control etag</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;å¯¹æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶æ¥åšä¸ªç®€è¦çš„æ€»ç»“ï¼šé¦–å…ˆé€šè¿‡ &lt;code&gt;Cache-Control&lt;/code&gt; éªŒè¯å¼ºç¼“å­˜æ˜¯å¦å¯ç”¨ï¼›å¦‚æœå¼ºç¼“å­˜å¯ç”¨ï¼Œç›´æ¥ä½¿ç”¨ï¼›å¦åˆ™è¿›å…¥åå•†ç¼“å­˜ï¼Œå³å‘é€ HTTP è¯·æ±‚ï¼ŒæœåŠ¡å™¨é€šè¿‡è¯·æ±‚å¤´ä¸­çš„&lt;code&gt;If-Modified-Since&lt;/code&gt;æˆ–è€…&lt;code&gt;If-None-Match&lt;/code&gt;è¿™äº›æ¡ä»¶è¯·æ±‚å­—æ®µæ£€æŸ¥èµ„æºæ˜¯å¦æ›´æ–°ã€‚è‹¥èµ„æºæ›´æ–°ï¼Œè¿”å›èµ„æºå’Œ&lt;strong&gt;200 çŠ¶æ€ç &lt;/strong&gt;ï¼›å¦åˆ™ï¼Œè¿”å›&lt;strong&gt;304&lt;/strong&gt;ï¼Œå‘Šè¯‰æµè§ˆå™¨ç›´æ¥ä»ç¼“å­˜è·å–èµ„æº&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="ç½‘ç»œçŸ¥è¯†" scheme="http://yangtao.site/categories/%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/"/>
    
    
      <category term="http" scheme="http://yangtao.site/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>5 ä¸ªæœ‰è¶£çš„ Node.js åº“,å¸¦ä½ èµ°è¿› å½©è‰² Node.js ä¸–ç•Œ</title>
    <link href="http://yangtao.site/2020/03/26/node-5-util/"/>
    <id>http://yangtao.site/2020/03/26/node-5-util/</id>
    <published>2020-03-26T14:20:41.000Z</published>
    <updated>2020-03-26T14:23:51.527Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ğŸ“¦ 5 ä¸ªæœ‰è¶£çš„ Node.js åº“,å¸¦ä½ èµ°è¿› å½©è‰² Node.js ä¸–ç•Œ ğŸ‰ ğŸ‰ ğŸ‰</p></blockquote><a id="more"></a><h2 id="1ã€Chalk"><a href="#1ã€Chalk" class="headerlink" title="1ã€Chalk"></a>1ã€Chalk</h2><p>Githubï¼š<a href="https://github.com/chalk/chalk" target="_blank" rel="noopener">chalk</a></p><p>è¿™æ˜¯ä¸€ä¸ªèƒ½ç»™ä½ çš„ log æŸ“è‰²çš„åº“,è®©ä½ çš„ä»£ç é“èµ·æ¥ !!</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">"chalk"</span>);</span><br><span class="line"><span class="keyword">const</span> log = <span class="built_in">console</span>.log;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Combine styled and normal strings</span></span><br><span class="line">log(chalk.blue(<span class="string">"Hello"</span>) + <span class="string">" World"</span> + chalk.red(<span class="string">"!"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Compose multiple styles using the chainable API</span></span><br><span class="line">log(chalk.blue.bgRed.bold(<span class="string">"Hello world!"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pass in multiple arguments</span></span><br><span class="line">log(chalk.blue(<span class="string">"Hello"</span>, <span class="string">"World!"</span>, <span class="string">"Foo"</span>, <span class="string">"bar"</span>, <span class="string">"biz"</span>, <span class="string">"baz"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Nest styles</span></span><br><span class="line">log(chalk.red(<span class="string">"Hello"</span>, chalk.underline.bgBlue(<span class="string">"world"</span>) + <span class="string">"!"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Nest styles of the same type even (color, underline, background)</span></span><br><span class="line">log(</span><br><span class="line">  chalk.green(</span><br><span class="line">    <span class="string">"I am a green line "</span> +</span><br><span class="line">      chalk.blue.underline.bold(<span class="string">"with a blue substring"</span>) +</span><br><span class="line">      <span class="string">" that becomes green again!"</span></span><br><span class="line">  )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES2015 template literal</span></span><br><span class="line">log(<span class="string">`</span></span><br><span class="line"><span class="string">CPU: <span class="subst">$&#123;chalk.red(<span class="string">"90%"</span>)&#125;</span></span></span><br><span class="line"><span class="string">RAM: <span class="subst">$&#123;chalk.green(<span class="string">"40%"</span>)&#125;</span></span></span><br><span class="line"><span class="string">DISK: <span class="subst">$&#123;chalk.yellow(<span class="string">"70%"</span>)&#125;</span></span></span><br><span class="line"><span class="string">`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES2015 tagged template literal</span></span><br><span class="line">log(chalk<span class="string">`</span></span><br><span class="line"><span class="string">CPU: &#123;red <span class="subst">$&#123;cpu.totalPercent&#125;</span>%&#125;</span></span><br><span class="line"><span class="string">RAM: &#123;green <span class="subst">$&#123;(ram.used <span class="regexp">/ ram.total) * 100&#125;%&#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">DISK: &#123;rgb(255,131,0) $&#123;(disk.used /</span> disk.total) * <span class="number">100</span>&#125;</span>%&#125;</span></span><br><span class="line"><span class="string">`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use RGB colors in terminal emulators that support it.</span></span><br><span class="line">log(chalk.keyword(<span class="string">"orange"</span>)(<span class="string">"Yay for orange colored text!"</span>));</span><br><span class="line">log(chalk.rgb(<span class="number">123</span>, <span class="number">45</span>, <span class="number">67</span>).underline(<span class="string">"Underlined reddish color"</span>));</span><br><span class="line">log(chalk.hex(<span class="string">"#DEADED"</span>).bold(<span class="string">"Bold gray!"</span>));</span><br></pre></td></tr></table></figure><h2 id="2ã€Inquirer-js"><a href="#2ã€Inquirer-js" class="headerlink" title="2ã€Inquirer.js"></a>2ã€Inquirer.js</h2><p>Githubï¼š<a href="https://github.com/SBoudrias/Inquirer.js" target="_blank" rel="noopener">Inquirer.js</a></p><p>ä¸€ä¸ªéå¸¸å¥½çœ‹çš„äº¤äº’å¼å‘½ä»¤è¡Œç”¨æˆ·ç•Œé¢,ç”¨å®ƒæ¥å®šåˆ¶ä½ çš„ CLI å§ ï¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> inquirer = <span class="built_in">require</span>(<span class="string">"inquirer"</span>);</span><br><span class="line">inquirer</span><br><span class="line">  .prompt([</span><br><span class="line">    <span class="comment">/* Pass your questions in here */</span></span><br><span class="line">  ])</span><br><span class="line">  .then(<span class="function"><span class="params">answers</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Use user feedback for... whatever!!</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error.isTtyError) &#123;</span><br><span class="line">      <span class="comment">// Prompt couldn't be rendered in the current environment</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// Something else when wrong</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>Checkbox list examplesï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> inquirer = <span class="built_in">require</span>(<span class="string">"inquirer"</span>);</span><br><span class="line"></span><br><span class="line">inquirer</span><br><span class="line">  .prompt([</span><br><span class="line">    &#123;</span><br><span class="line">      type: <span class="string">"checkbox"</span>,</span><br><span class="line">      message: <span class="string">"Select toppings"</span>,</span><br><span class="line">      name: <span class="string">"toppings"</span>,</span><br><span class="line">      choices: [</span><br><span class="line">        <span class="keyword">new</span> inquirer.Separator(<span class="string">" = The Meats = "</span>),</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">"Pepperoni"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">"Ham"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">"Ground Meat"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">"Bacon"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">new</span> inquirer.Separator(<span class="string">" = The Cheeses = "</span>),</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">"Mozzarella"</span>,</span><br><span class="line">          checked: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">"Cheddar"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">"Parmesan"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">new</span> inquirer.Separator(<span class="string">" = The usual ="</span>),</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">"Mushroom"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">"Tomato"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">new</span> inquirer.Separator(<span class="string">" = The extras = "</span>),</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">"Pineapple"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">"Olives"</span>,</span><br><span class="line">          disabled: <span class="string">"out of stock"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">"Extra cheese"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      validate: <span class="function"><span class="keyword">function</span>(<span class="params">answer</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (answer.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">"You must choose at least one topping."</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ])</span><br><span class="line">  .then(<span class="function"><span class="params">answers</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(answers, <span class="literal">null</span>, <span class="string">"  "</span>));</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">? Select toppings (Press &lt;space&gt; to select, &lt;a&gt; to toggle</span><br><span class="line"> all, &lt;i&gt; to invert selection)</span><br><span class="line">  = The Meats =</span><br><span class="line">â¯â—¯ Pepperoni</span><br><span class="line"> â—¯ Ham</span><br><span class="line"> â—¯ Ground Meat</span><br><span class="line"> â—¯ Bacon</span><br><span class="line">  = The Cheeses =</span><br><span class="line"> â—‰ Mozzarella</span><br><span class="line">(Move up and down to reveal more choices)</span><br></pre></td></tr></table></figure><h2 id="3ã€Ora"><a href="#3ã€Ora" class="headerlink" title="3ã€Ora"></a>3ã€Ora</h2><p>Githubï¼š<a href="https://github.com/sindresorhus/ora" target="_blank" rel="noopener">ora</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ora = <span class="built_in">require</span>(<span class="string">"ora"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> spinner = ora(<span class="string">"Loading unicorns"</span>).start();</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  spinner.color = <span class="string">"cyan"</span>;</span><br><span class="line">  spinner.text = <span class="string">"Loading rainbows"</span>;</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  spinner.text = <span class="string">"Loading success"</span>;</span><br><span class="line">  spinner.succeed();</span><br><span class="line">  <span class="comment">// spinner.fail();</span></span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼ˆicon æ˜¯æœ‰å¯¹åº”é¢œè‰²çš„ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â § Loading rainbows</span><br><span class="line">âœ” Loading success</span><br></pre></td></tr></table></figure><h2 id="4ã€figlet-js"><a href="#4ã€figlet-js" class="headerlink" title="4ã€figlet.js"></a>4ã€figlet.js</h2><p>Githubï¼š<a href="https://github.com/patorjk/figlet.js" target="_blank" rel="noopener">figlet.js</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> figlet = <span class="built_in">require</span>(<span class="string">"figlet"</span>);</span><br><span class="line"></span><br><span class="line">figlet(<span class="string">"Hello World!!"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Something went wrong..."</span>);</span><br><span class="line">    <span class="built_in">console</span>.dir(err);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç„¶åè¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> _   _      _ _        __        __         _     _ _ _</span><br><span class="line">| | | | ___| | | ___   \ \      / /__  _ __| | __| | | |</span><br><span class="line">| |_| |/ _ \ | |/ _ \   \ \ /\ / / _ \| '__| |/ _` | | |</span><br><span class="line">|  _  |  __/ | | (_) |   \ V  V / (_) | |  | | (_| |_|_|</span><br><span class="line">|_| |_|\___|_|_|\___/     \_/\_/ \___/|_|  |_|\__,_(_|_)</span><br></pre></td></tr></table></figure><h2 id="5ã€boxen"><a href="#5ã€boxen" class="headerlink" title="5ã€boxen"></a>5ã€boxen</h2><p>Githubï¼š<a href="https://github.com/sindresorhus/boxen" target="_blank" rel="noopener">boxen</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> boxen = <span class="built_in">require</span>(<span class="string">"boxen"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(boxen(<span class="string">"Hello World"</span>, &#123; <span class="attr">padding</span>: <span class="number">1</span>, <span class="attr">borderColor</span>: <span class="string">"yellow"</span> &#125;));</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  boxen(<span class="string">"I LOVE YOU"</span>, &#123;</span><br><span class="line">    padding: <span class="number">1</span>,</span><br><span class="line">    margin: <span class="number">1</span>,</span><br><span class="line">    borderStyle: <span class="string">"classic"</span>,</span><br><span class="line">    borderColor: <span class="string">"red"</span>,</span><br><span class="line">    backgroundColor: <span class="string">"magenta"</span></span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºæ•ˆæœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                 â”‚</span><br><span class="line">â”‚   Hello World   â”‚</span><br><span class="line">â”‚                 â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"></span><br><span class="line">   +----------------+</span><br><span class="line">   |                |</span><br><span class="line">   |   I LOVE YOU   |</span><br><span class="line">   |                |</span><br><span class="line">   +----------------+</span><br></pre></td></tr></table></figure><h2 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h2><ul><li><a href="https://juejin.im/post/5de4b6caf265da05fc66d9af" target="_blank" rel="noopener">ğŸ“¦ 5 ä¸ªæœ‰è¶£çš„ Node.js åº“,å¸¦ä½ èµ°è¿› å½©è‰² Node.js ä¸–ç•Œ ğŸ‰</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ğŸ“¦ 5 ä¸ªæœ‰è¶£çš„ Node.js åº“,å¸¦ä½ èµ°è¿› å½©è‰² Node.js ä¸–ç•Œ ğŸ‰ ğŸ‰ ğŸ‰&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Nodejs" scheme="http://yangtao.site/categories/Nodejs/"/>
    
    
      <category term="Nodejs" scheme="http://yangtao.site/tags/Nodejs/"/>
    
  </entry>
  
  <entry>
    <title>è·¨åŸŸèµ„æºå…±äº« CORS</title>
    <link href="http://yangtao.site/2020/03/25/cross-cors/"/>
    <id>http://yangtao.site/2020/03/25/cross-cors/</id>
    <published>2020-03-25T06:43:47.000Z</published>
    <updated>2020-03-27T08:30:19.059Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è·¨åŸŸèµ„æºå…±äº«(CORS) æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒä½¿ç”¨é¢å¤–çš„ HTTP å¤´æ¥å‘Šè¯‰æµè§ˆå™¨ è®©è¿è¡Œåœ¨ä¸€ä¸ª origin (domain) ä¸Šçš„ Web åº”ç”¨è¢«å‡†è®¸è®¿é—®æ¥è‡ªä¸åŒæºæœåŠ¡å™¨ä¸Šçš„æŒ‡å®šçš„èµ„æºã€‚ â€” MDN</p></blockquote><a id="more"></a><h2 id="ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦-CORS"><a href="#ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦-CORS" class="headerlink" title="ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦ CORS"></a>ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦ CORS</h2><p>å…è®¸åœ¨ä¸‹åˆ—åœºæ™¯ä¸­ä½¿ç”¨è·¨åŸŸ HTTP è¯·æ±‚ï¼š</p><ul><li>ç”± <code>XMLHttpRequest</code> æˆ– <code>Fetch</code> å‘èµ·çš„è·¨åŸŸ HTTP è¯·æ±‚</li><li>Web å­—ä½“ (CSS ä¸­é€šè¿‡ <code>@font-face</code> ä½¿ç”¨è·¨åŸŸå­—ä½“èµ„æº)</li><li><code>WebGL</code> è´´å›¾</li><li>ä½¿ç”¨ drawImage å°† Images/video ç”»é¢ç»˜åˆ¶åˆ° <code>canvas</code></li></ul><h2 id="ä¸¤ç§è¯·æ±‚"><a href="#ä¸¤ç§è¯·æ±‚" class="headerlink" title="ä¸¤ç§è¯·æ±‚"></a>ä¸¤ç§è¯·æ±‚</h2><p>æµè§ˆå™¨å°† CORS è¯·æ±‚åˆ†æˆä¸¤ç±»ï¼š<strong>ç®€å•è¯·æ±‚</strong>ï¼ˆsimple requestï¼‰å’Œ<strong>éç®€å•è¯·æ±‚</strong>ï¼ˆnot-so-simple requestï¼‰ã€‚</p><p>åªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ï¼ˆä¸ä¼šè§¦å‘ CORS é¢„æ£€è¯·æ±‚ï¼‰ã€‚</p><ul><li><p>è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š<code>HEAD</code>ã€<code>GET</code>ã€<code>POST</code></p></li><li><p>HTTP çš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š</p><ul><li>Accept</li><li>Accept-Language</li><li>Content-Language</li><li>Last-Event-ID</li><li>Content-Typeï¼ˆåªé™äºä¸‰ä¸ªå€¼ï¼‰<ul><li><code>application/x-www-form-urlencoded</code></li><li><code>multipart/form-data</code></li><li><code>text/plain</code></li></ul></li></ul></li></ul><p>å‡¡æ˜¯ä¸åŒæ—¶æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå°±å±äºéç®€å•è¯·æ±‚ã€‚</p><h2 id="CORS-å¦‚ä½•å·¥ä½œ"><a href="#CORS-å¦‚ä½•å·¥ä½œ" class="headerlink" title="CORS å¦‚ä½•å·¥ä½œ"></a>CORS å¦‚ä½•å·¥ä½œ</h2><p>é¦–å…ˆï¼Œæµè§ˆå™¨åˆ¤æ–­è¯·æ±‚æ˜¯ç®€å•è¯·æ±‚è¿˜æ˜¯å¤æ‚è¯·æ±‚ï¼ˆéç®€å•è¯·æ±‚ï¼‰ã€‚</p><p>å¦‚æœæ˜¯å¤æ‚è¯·æ±‚ï¼Œé‚£ä¹ˆåœ¨è¿›è¡ŒçœŸæ­£çš„è¯·æ±‚ä¹‹å‰ï¼Œæµè§ˆå™¨ä¼šå…ˆä½¿ç”¨ OPTIONS æ–¹æ³•å‘é€ä¸€ä¸ª<strong>é¢„æ£€è¯·æ±‚</strong> (preflight request)ï¼ŒOPTIONS æ˜¯ <code>HTTP/1.1</code> åè®®ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œç”¨ä»¥ä»æœåŠ¡å™¨è·å–æ›´å¤šä¿¡æ¯ã€‚</p><p>è¯¥æ–¹æ³•ä¸ä¼šå¯¹æœåŠ¡å™¨èµ„æºäº§ç”Ÿå½±å“ï¼Œé¢„æ£€è¯·æ±‚ä¸­åŒæ—¶æºå¸¦äº†ä¸‹é¢ä¸¤ä¸ªé¦–éƒ¨å­—æ®µï¼š</p><ul><li><code>Access-Control-Request-Method</code>: è¿™ä¸ªå­—æ®µè¡¨æ˜äº†è¯·æ±‚çš„æ–¹æ³•ï¼›</li><li><code>Access-Control-Request-Headers</code>: è¿™ä¸ªå­—æ®µè¡¨æ˜äº†è¿™ä¸ªè¯·æ±‚çš„ Headersï¼›</li><li><code>Origin</code>: è¿™ä¸ªå­—æ®µè¡¨æ˜äº†è¯·æ±‚å‘å‡ºçš„åŸŸã€‚</li></ul><p>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œä¼šä»¥ <code>Access-Control-* response headers</code> çš„å½¢å¼å¯¹å®¢æˆ·ç«¯è¿›è¡Œå›å¤ï¼š</p><ul><li><code>Access-Control-Allow-Origin</code>: èƒ½å¤Ÿè¢«å…è®¸å‘å‡ºè¿™ä¸ªè¯·æ±‚çš„åŸŸåï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>*</code>æ¥è¡¨æ˜å…è®¸æ‰€æœ‰åŸŸåï¼›</li><li><code>Access-Control-Allow-Methods</code>: ç”¨é€—å·åˆ†éš”çš„è¢«å…è®¸çš„è¯·æ±‚æ–¹æ³•çš„åˆ—è¡¨ï¼›</li><li><code>Access-Control-Allow-Headers</code>: ç”¨é€—å·åˆ†éš”çš„è¢«å…è®¸çš„è¯·æ±‚å¤´éƒ¨å­—æ®µçš„åˆ—è¡¨ï¼›</li><li><code>Access-Control-Max-Age</code>: è¿™ä¸ª<strong>é¢„æ£€è¯·æ±‚èƒ½è¢«ç¼“å­˜çš„æœ€é•¿æ—¶é—´</strong>ï¼Œåœ¨ç¼“å­˜æ—¶é—´å†…ï¼ŒåŒä¸€ä¸ªè¯·æ±‚ä¸ä¼šå†æ¬¡å‘å‡ºé¢„æ£€è¯·æ±‚ã€‚</li></ul><h2 id="ç®€å•è¯·æ±‚"><a href="#ç®€å•è¯·æ±‚" class="headerlink" title="ç®€å•è¯·æ±‚"></a>ç®€å•è¯·æ±‚</h2><p>å¯¹äºç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨ç›´æ¥å‘å‡º CORS è¯·æ±‚ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œè‡ªåŠ¨å¢åŠ ä¸€ä¸ª Origin å­—æ®µï¼Œç”¨æ¥è¯´æ˜è¯·æ±‚æ¥è‡ªå“ªä¸ªæºã€‚æœåŠ¡å™¨æ‹¿åˆ°è¯·æ±‚ä¹‹åï¼Œåœ¨å›åº”æ—¶å¯¹åº”åœ°æ·»åŠ <code>Access-Control-Allow-Origin</code>å­—æ®µï¼Œå¦‚æœ Origin ä¸åœ¨è¿™ä¸ªå­—æ®µçš„èŒƒå›´ä¸­ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šå°†å“åº”æ‹¦æˆªã€‚</p><p><strong>Access-Control-Allow-Credentials</strong>ã€‚è¿™ä¸ªå­—æ®µæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€ Cookieï¼Œå¯¹äºè·¨åŸŸè¯·æ±‚ï¼Œæµè§ˆå™¨å¯¹è¿™ä¸ªå­—æ®µé»˜è®¤å€¼è®¾ä¸º falseï¼Œè€Œå¦‚æœéœ€è¦æ‹¿åˆ°æµè§ˆå™¨çš„ Cookieï¼Œéœ€è¦æ·»åŠ è¿™ä¸ªå“åº”å¤´å¹¶è®¾ä¸º true, å¹¶ä¸”åœ¨å‰ç«¯ä¹Ÿéœ€è¦è®¾ç½®<code>withCredentials</code>å±æ€§ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.withCredentials = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><p><strong>Access-Control-Expose-Headers</strong>ã€‚è¿™ä¸ªå­—æ®µæ˜¯ç»™ <code>XMLHttpRequest</code> å¯¹è±¡èµ‹èƒ½ï¼Œè®©å®ƒä¸ä»…å¯ä»¥æ‹¿åˆ°åŸºæœ¬çš„ 6 ä¸ªå“åº”å¤´å­—æ®µï¼ˆåŒ…æ‹¬<code>Cache-Controlã€Content-Languageã€Content-Typeã€Expiresã€Last-Modifiedå’ŒPragma</code>ï¼‰, è¿˜èƒ½æ‹¿åˆ°è¿™ä¸ªå­—æ®µå£°æ˜çš„å“åº”å¤´å­—æ®µã€‚æ¯”å¦‚è¿™æ ·è®¾ç½®:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Access-Control-Expose-Headers</span>: aaa</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåœ¨å‰ç«¯å¯ä»¥é€šè¿‡ <code>XMLHttpRequest.getResponseHeader(&#39;aaa&#39;)</code> æ‹¿åˆ° aaa è¿™ä¸ªå­—æ®µçš„å€¼ã€‚</p><h3 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h3><p>æ¯”å¦‚ä¸‹é¢å¼€å¯ä¸€ä¸ªç«¯å£ä¸º 8001 çš„æœåŠ¡ï¼Œå»è¯·æ±‚ç«¯å£ä¸º 8000 çš„æ•°æ®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="string">"http://127.0.0.1:8000"</span>;</span><br><span class="line"><span class="keyword">const</span> data = &#123; <span class="attr">username</span>: <span class="string">"example"</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> myHeaders = <span class="keyword">new</span> Headers(&#123;</span><br><span class="line">  <span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fetch(url, &#123;</span><br><span class="line">  method: <span class="string">"POST"</span>,</span><br><span class="line">  headers: myHeaders,</span><br><span class="line">  body: <span class="built_in">JSON</span>.stringify(data),</span><br><span class="line">  mode: <span class="string">"cors"</span></span><br><span class="line">&#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.parse(res.postData)); <span class="comment">//&#123;username: "example"&#125;</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>ç«¯å£ä¸º 8000 çš„æœåŠ¡ç«¯è®¾ç½®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span>,</span><br><span class="line">    <span class="string">"Access-Control-Allow-Origin"</span>: <span class="string">"*"</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">let</span> resData = &#123;&#125;;</span><br><span class="line">  <span class="keyword">let</span> postData = [];</span><br><span class="line">  req.on(<span class="string">"data"</span>, chunk =&gt; &#123;</span><br><span class="line">    postData.push(chunk);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  req.on(<span class="string">"end"</span>, () =&gt; &#123;</span><br><span class="line">    resData.postData = Buffer.concat(postData).toString();</span><br><span class="line">    res.end(<span class="built_in">JSON</span>.stringify(resData));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure><h2 id="éç®€å•è¯·æ±‚"><a href="#éç®€å•è¯·æ±‚" class="headerlink" title="éç®€å•è¯·æ±‚"></a>éç®€å•è¯·æ±‚</h2><p>éç®€å•è¯·æ±‚ç›¸å¯¹è€Œè¨€ä¼šæœ‰äº›ä¸åŒï¼Œä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢: <strong>é¢„æ£€è¯·æ±‚</strong>å’Œ<strong>å“åº”å­—æ®µ</strong>ã€‚</p><h3 id="é¢„æ£€è¯·æ±‚"><a href="#é¢„æ£€è¯·æ±‚" class="headerlink" title="é¢„æ£€è¯·æ±‚"></a>é¢„æ£€è¯·æ±‚</h3><p>æ¯”å¦‚ä½¿ç”¨ PUT è¯·æ±‚æ–¹æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="string">"http://127.0.0.1:8000"</span>;</span><br><span class="line"><span class="keyword">const</span> data = &#123; <span class="attr">username</span>: <span class="string">"example"</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myHeaders = <span class="keyword">new</span> Headers(&#123;</span><br><span class="line">  <span class="string">"X-Custom-Header"</span>: <span class="string">"xxx"</span></span><br><span class="line">&#125;);</span><br><span class="line">fetch(url, &#123;</span><br><span class="line">  method: <span class="string">"PUT"</span>,   <span class="comment">// æ”¹æˆ PUT</span></span><br><span class="line">  headers: myHeaders,</span><br><span class="line">  body: <span class="built_in">JSON</span>.stringify(data),</span><br><span class="line">  mode: <span class="string">"cors"</span></span><br><span class="line">&#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.parse(res.postData)); <span class="comment">//&#123;username: "example"&#125;</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>Node éƒ¨åˆ†ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">  <span class="string">"Content-Type"</span>: <span class="string">"text/json"</span>,</span><br><span class="line">  <span class="string">"Access-Control-Allow-Origin"</span>: <span class="string">"*"</span>,</span><br><span class="line">  <span class="string">"Access-Control-Allow-Methods"</span>: <span class="string">"PUT, POST, GET"</span>,</span><br><span class="line">  <span class="string">"Access-Control-Allow-Headers"</span>: <span class="string">"X-Custom-Header"</span>,</span><br><span class="line">  <span class="string">"Access-Control-Max-Age"</span>: <span class="number">2000</span>,</span><br><span class="line">  <span class="string">"Access-Control-Allow-Credentials"</span>: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å½“è¿™æ®µä»£ç æ‰§è¡Œåï¼Œé¦–å…ˆä¼šå‘é€<strong>é¢„æ£€è¯·æ±‚</strong>ã€‚è¿™ä¸ªé¢„æ£€è¯·æ±‚çš„è¯·æ±‚è¡Œå’Œè¯·æ±‚ä½“æ˜¯ä¸‹é¢è¿™ä¸ªæ ¼å¼:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">OPTIONS</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1:8000</span><br><span class="line"><span class="attribute">Access-Control-Request-Method</span>: PUT</span><br><span class="line"><span class="attribute">Access-Control-Request-Headers</span>: x-custom-header</span><br><span class="line"><span class="attribute">Origin</span>: http://127.0.0.1:8001</span><br></pre></td></tr></table></figure><p>é¢„æ£€è¯·æ±‚çš„æ–¹æ³•æ˜¯<code>OPTIONS</code>ï¼ŒåŒæ—¶ä¼šåŠ ä¸Š Origin æºåœ°å€å’Œ Host ç›®æ ‡åœ°å€ï¼Œè¿™å¾ˆç®€å•ã€‚åŒæ—¶ä¹Ÿä¼šåŠ ä¸Šä¸¤ä¸ªå…³é”®çš„å­—æ®µ:</p><ul><li><code>Access-Control-Request-Method</code>, åˆ—å‡º CORS è¯·æ±‚ç”¨åˆ°å“ªä¸ª HTTP æ–¹æ³•</li><li><code>Access-Control-Request-Headers</code>ï¼ŒæŒ‡å®š CORS è¯·æ±‚å°†è¦åŠ ä¸Šä»€ä¹ˆè¯·æ±‚å¤´</li></ul><p>è¿™æ˜¯é¢„æ£€è¯·æ±‚ã€‚æ¥ä¸‹æ¥æ˜¯<strong>å“åº”å­—æ®µ</strong>ã€‚</p><p>å“åº”å­—æ®µä¹Ÿåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯å¯¹äº<strong>é¢„æ£€è¯·æ±‚çš„å“åº”</strong>ï¼Œä¸€éƒ¨åˆ†æ˜¯å¯¹äº<strong>CORS è¯·æ±‚çš„å“åº”</strong>ã€‚</p><p><strong>é¢„æ£€è¯·æ±‚çš„å“åº”</strong>ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span>: text/json</span><br><span class="line"><span class="attribute">Access-Control-Allow-Origin</span>: *</span><br><span class="line"><span class="attribute">Access-Control-Allow-Methods</span>: PUT, POST, GET</span><br><span class="line"><span class="attribute">Access-Control-Allow-Headers</span>: X-Custom-Header</span><br><span class="line"><span class="attribute">Access-Control-Max-Age</span>: 2000</span><br><span class="line"><span class="attribute">Access-Control-Allow-Credentials</span>: true</span><br><span class="line"><span class="attribute">Date</span>: Fri, 27 Mar 2020 08:16:58 GMT</span><br><span class="line"><span class="attribute">Connection</span>: keep-alive</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked</span><br></pre></td></tr></table></figure><p>åœ¨é¢„æ£€è¯·æ±‚çš„å“åº”è¿”å›åï¼Œå¦‚æœè¯·æ±‚ä¸æ»¡è¶³å“åº”å¤´çš„æ¡ä»¶ï¼Œåˆ™è§¦å‘<code>XMLHttpRequest</code>çš„<code>onerror</code>æ–¹æ³•ï¼Œå½“ç„¶åé¢çœŸæ­£çš„ CORS è¯·æ±‚ä¹Ÿä¸ä¼šå‘å‡ºå»äº†ã€‚</p><p><strong>CORS è¯·æ±‚çš„å“åº”</strong>ï¼šç°åœ¨å®ƒå’Œç®€å•è¯·æ±‚çš„æƒ…å†µæ˜¯ä¸€æ ·çš„ã€‚æµè§ˆå™¨è‡ªåŠ¨åŠ ä¸Š Origin å­—æ®µï¼ŒæœåŠ¡ç«¯å“åº”å¤´è¿”å› <code>Access-Control-Allow-Origin</code>ã€‚åœ¨è®¾ç½®çš„<code>Access-Control-Max-Age: 2000</code>é‡Œæ˜¯ä¸ä¼šå†æ¬¡å‘é€é¢„æ£€è¯·æ±‚çš„ï¼Œé™¤éæ—¶é—´è¿‡æœŸã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://juejin.im/post/5e76bd516fb9a07cce750746#heading-67" target="_blank" rel="noopener">ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿæµè§ˆå™¨å¦‚ä½•æ‹¦æˆªå“åº”ï¼Ÿå¦‚ä½•è§£å†³</a></li><li>é˜®ä¸€å³° <a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener">è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£</a></li><li>MDN <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener">HTTP è®¿é—®æ§åˆ¶ï¼ˆCORSï¼‰</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch" target="_blank" rel="noopener">ä½¿ç”¨ Fetch</a></li><li><a href="https://coding.imooc.com/learn/list/225.html" target="_blank" rel="noopener">HTTPåè®®åŸç†+å®è·µWebå¼€å‘å·¥ç¨‹å¸ˆå¿…å­¦</a> - æ…•è¯¾ç½‘ä»˜è´¹è¯¾ç¨‹</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;è·¨åŸŸèµ„æºå…±äº«(CORS) æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒä½¿ç”¨é¢å¤–çš„ HTTP å¤´æ¥å‘Šè¯‰æµè§ˆå™¨ è®©è¿è¡Œåœ¨ä¸€ä¸ª origin (domain) ä¸Šçš„ Web åº”ç”¨è¢«å‡†è®¸è®¿é—®æ¥è‡ªä¸åŒæºæœåŠ¡å™¨ä¸Šçš„æŒ‡å®šçš„èµ„æºã€‚ â€” MDN&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="ç½‘ç»œçŸ¥è¯†" scheme="http://yangtao.site/categories/%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/"/>
    
    
      <category term="http" scheme="http://yangtao.site/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>è·¨åŸŸè§£å†³æ–¹æ¡ˆ JSONP</title>
    <link href="http://yangtao.site/2020/03/25/cross-jsonp/"/>
    <id>http://yangtao.site/2020/03/25/cross-jsonp/</id>
    <published>2020-03-25T03:07:14.000Z</published>
    <updated>2020-03-27T07:39:12.082Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>JSONP è¯·æ±‚æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨äº† â€œAjax è¯·æ±‚ä¼šå—åˆ°åŒæºç­–ç•¥é™åˆ¶ï¼Œè€Œ script æ ‡ç­¾è¯·æ±‚ä¸ä¼šâ€ è¿™ä¸€ç‚¹æ¥ç»•è¿‡åŒæºç­–ç•¥ã€‚</p></blockquote><a id="more"></a><h2 id="åŒæºç­–ç•¥"><a href="#åŒæºç­–ç•¥" class="headerlink" title="åŒæºç­–ç•¥"></a>åŒæºç­–ç•¥</h2><p>ä»€ä¹ˆæ˜¯åŒæºç­–ç•¥ï¼Œå…¶ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>åŒæºç­–ç•¥æŒ‡çš„æ˜¯ï¼šåè®®+åŸŸå+ç«¯å£ä¸‰è€…çš†ç›¸åŒï¼Œå¯ä»¥è§†ä¸ºåœ¨åŒä¸€ä¸ªåŸŸï¼Œå¦åˆ™ä¸ºä¸åŒåŸŸã€‚åŒæºç­–ç•¥é™åˆ¶äº†ä»åŒä¸€ä¸ªæºåŠ è½½çš„æ–‡æ¡£æˆ–è„šæœ¬å¦‚ä½•ä¸æ¥è‡ªå¦ä¸€ä¸ªæºçš„èµ„æºè¿›è¡Œäº¤äº’ã€‚</p><p>ä½œç”¨æ˜¯ä¸€ä¸ªç”¨äºéš”ç¦»æ½œåœ¨æ¶æ„æ–‡ä»¶çš„é‡è¦å®‰å…¨æœºåˆ¶ã€‚</p><p>æ‰€é™åˆ¶çš„è·¨åŸŸäº¤äº’åŒ…æ‹¬ï¼š</p><ul><li>Cookieã€LocalStorageã€IndexdDB ç­‰å­˜å‚¨å†…å®¹ï¼›</li><li>DOM èŠ‚ç‚¹ï¼›</li><li>Ajax è¯·æ±‚ã€‚</li></ul><h2 id="Ajax-ä¸ºä»€ä¹ˆä¸èƒ½è·¨åŸŸ"><a href="#Ajax-ä¸ºä»€ä¹ˆä¸èƒ½è·¨åŸŸ" class="headerlink" title="Ajax ä¸ºä»€ä¹ˆä¸èƒ½è·¨åŸŸ"></a>Ajax ä¸ºä»€ä¹ˆä¸èƒ½è·¨åŸŸ</h2><p>Ajax å…¶å®å°±æ˜¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª GET æˆ– POST è¯·æ±‚ï¼Œç„¶åå–å¾—æœåŠ¡å™¨å“åº”ç»“æœï¼Œè¿”å›å®¢æˆ·ç«¯ã€‚Ajax è·¨åŸŸè¯·æ±‚ï¼Œåœ¨æœåŠ¡å™¨ç«¯ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ï¼Œåªæ˜¯æœåŠ¡ç«¯å“åº”æ•°æ®è¿”å›ç»™æµè§ˆå™¨çš„æ—¶å€™ï¼Œæµè§ˆå™¨æ ¹æ®å“åº”å¤´çš„<code>Access-Control-Allow-Origin</code>å­—æ®µçš„å€¼æ¥åˆ¤æ–­æ˜¯å¦æœ‰æƒé™è·å–æ•°æ®ã€‚å› æ­¤ï¼ŒæœåŠ¡ç«¯å¦‚æœæ²¡æœ‰è®¾ç½®è·¨åŸŸå­—æ®µè®¾ç½®ï¼Œè·¨åŸŸæ˜¯æ²¡æœ‰æƒé™è®¿é—®ï¼Œæ•°æ®è¢«æµè§ˆå™¨ç»™æ‹¦æˆªäº†ã€‚</p><p>æ‰€ä»¥ï¼Œè¦è§£å†³çš„é—®é¢˜æ˜¯ï¼š<strong>å¦‚ä½•ä»å®¢æˆ·ç«¯æ‹¿åˆ°è¿”å›çš„æ•°æ®</strong>ï¼Ÿ</p><p>å…¶å®ï¼Œåœ¨åŒæºç­–ç•¥çš„åŸºç¡€ä¸Šï¼Œé€‰æ‹©æ€§åœ°ä¸ºåŒæºç­–ç•¥å¼€æ”¾äº†ä¸€äº›åé—¨ã€‚ä¾‹å¦‚ imgã€scriptã€style ç­‰æ ‡ç­¾ï¼Œéƒ½å…è®¸è·¨åŸŸå¼•ç”¨èµ„æºã€‚</p><p>æ‰€ä»¥ï¼Œ JSONP æ¥äº†ã€‚</p><h2 id="JSONP-å®ç°"><a href="#JSONP-å®ç°" class="headerlink" title="JSONP å®ç°"></a>JSONP å®ç°</h2><p>JSONP(JSON with Paddingï¼ˆå¡«å……ï¼‰)æ˜¯ JSON çš„ä¸€ç§â€œä½¿ç”¨æ¨¡å¼â€ï¼Œæœ¬è´¨ä¸æ˜¯ Ajax è¯·æ±‚ï¼Œæ˜¯ script æ ‡ç­¾è¯·æ±‚ã€‚JSONP è¯·æ±‚æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨äº† â€œAjax è¯·æ±‚ä¼šå—åˆ°åŒæºç­–ç•¥é™åˆ¶ï¼Œè€Œ script æ ‡ç­¾è¯·æ±‚ä¸ä¼šâ€ è¿™ä¸€ç‚¹æ¥ç»•è¿‡åŒæºç­–ç•¥ã€‚</p><p>ç®€å• JSONP å®ç°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Jsonp</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(req) &#123;</span><br><span class="line">    <span class="keyword">this</span>.url = req.url;</span><br><span class="line">    <span class="keyword">this</span>.callbackName = req.callbackName;</span><br><span class="line">  &#125;</span><br><span class="line">  create() &#123;</span><br><span class="line">    <span class="keyword">const</span> script = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>);</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.url&#125;</span>?callback=<span class="subst">$&#123;<span class="keyword">this</span>.callbackName&#125;</span>`</span>;</span><br><span class="line">    script.src = url;</span><br><span class="line">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">"head"</span>)[<span class="number">0</span>].appendChild(script);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Jsonp(&#123;</span><br><span class="line">  url: <span class="string">"http://127.0.0.1:8000/"</span>,</span><br><span class="line">  callbackName: <span class="string">"getMsg"</span></span><br><span class="line">&#125;).create();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMsg</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  data = <span class="built_in">JSON</span>.parse(data);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`My name is <span class="subst">$&#123;data.name&#125;</span>, and <span class="subst">$&#123;data.age&#125;</span> years old.`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç«¯ï¼ˆNodeï¼‰:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">"querystring"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url = req.url;</span><br><span class="line">  <span class="keyword">const</span> query = querystring.parse(url.split(<span class="string">"?"</span>)[<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">const</span> &#123; callback &#125; = query;</span><br><span class="line">  <span class="keyword">const</span> data = &#123;</span><br><span class="line">    name: <span class="string">"Yang Min"</span>,</span><br><span class="line">    age: <span class="string">"8"</span></span><br><span class="line">  &#125;;</span><br><span class="line">  res.end(<span class="string">`<span class="subst">$&#123;callback&#125;</span>('<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(data)&#125;</span>')`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure><p>å‰ç«¯åˆ©ç”¨ <code>http-server -p 8001 .</code>ï¼Œå¼€å¯ä¸€ä¸ªæœåŠ¡ï¼Œç„¶å Node ä¹Ÿå¼€å¯ä¸€ä¸ªç«¯å£ä¸º 8000 çš„æœåŠ¡ï¼Œè¿è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">My name is Yang Min, and 8 years old.</span><br></pre></td></tr></table></figure><h3 id="ä¸€ä¸ª-JSONP-çš„æ­¥éª¤å®è´¨"><a href="#ä¸€ä¸ª-JSONP-çš„æ­¥éª¤å®è´¨" class="headerlink" title="ä¸€ä¸ª JSONP çš„æ­¥éª¤å®è´¨"></a>ä¸€ä¸ª JSONP çš„æ­¥éª¤å®è´¨</h3><p>å®¢æˆ·ç«¯å‘é€ script è¯·æ±‚ï¼Œå‚æ•°ä¸­å¸¦ç€å¤„ç†è¿”å›æ•°æ®çš„å›è°ƒå‡½æ•°çš„åå­— (é€šå¸¸æ˜¯ callback)ï¼Œå¦‚è¯·æ±‚ script çš„ url æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8000/?callback=getMsg</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œä»¥å›è°ƒå‡½æ•°åå’Œè¿”å›æ•°æ®ç»„æˆç«‹å³æ‰§è¡Œå‡½æ•°çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ï¼šå…¶ä¸­ callback çš„å€¼æ˜¯å®¢æˆ·ç«¯å‘æ¥çš„å›è°ƒå‡½æ•°çš„åå­—ï¼Œå‡è®¾å›è°ƒå‡½æ•°çš„åå­—æ˜¯ getMsgï¼Œè¿”å›è„šæœ¬çš„å†…å®¹å°±æ˜¯ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getMsg(<span class="string">"&#123;name: 'Yang Min', age: '8'&#125;"</span>);</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯æ”¶åˆ° JavaScript è„šæœ¬å†…å®¹åï¼Œç«‹å³æ‰§è¡Œè„šæœ¬ï¼Œè¿™æ ·å°±å®ç°äº†è·å–è·¨åŸŸæœåŠ¡å™¨æ•°æ®çš„ç›®çš„ã€‚</p><p>å¾ˆæ˜æ˜¾ï¼Œç”±äº JSONP æŠ€æœ¯æœ¬è´¨ä¸Šåˆ©ç”¨äº† script è„šæœ¬è¯·æ±‚ï¼Œæ‰€ä»¥åªèƒ½å®ç° GET è·¨åŸŸè¯·æ±‚ï¼Œè¿™ä¹Ÿæ˜¯ JSONP è·¨åŸŸçš„æœ€å¤§é™åˆ¶ã€‚</p><p>ç”±äº server äº§ç”Ÿçš„å“åº”ä¸º json æ•°æ®çš„åŒ…è£…ï¼ˆæ•…ç§°ä¹‹ä¸º jsonpï¼Œå³ json paddingï¼‰ï¼Œå½¢å¦‚ï¼š<code>getMsg(&quot;{name: &#39;Yang Min&#39;, age: &#39;8&#39;}&quot;)</code></p><h2 id="JSONP-å°è£…"><a href="#JSONP-å°è£…" class="headerlink" title="JSONP å°è£…"></a>JSONP å°è£…</h2><p>å®¢æˆ·ç«¯ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jsonp = <span class="function">(<span class="params">&#123; url, params, callbackName &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> generateURL = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> dataStr = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> params) &#123;</span><br><span class="line">      dataStr += <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;params[key]&#125;</span>&amp;`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    dataStr += <span class="string">`callback=<span class="subst">$&#123;callbackName&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;url&#125;</span>?<span class="subst">$&#123;dataStr&#125;</span>`</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å›è°ƒå‡½æ•°åç§°</span></span><br><span class="line">    callbackName =</span><br><span class="line">      callbackName ||</span><br><span class="line">      <span class="string">"cb"</span> +</span><br><span class="line">        <span class="built_in">Math</span>.random()</span><br><span class="line">          .toString()</span><br><span class="line">          .replace(<span class="string">"."</span>, <span class="string">""</span>);</span><br><span class="line">    <span class="keyword">let</span> scriptEle = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>);</span><br><span class="line">    scriptEle.src = generateURL();</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(scriptEle);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»‘å®šåˆ° window ä¸Šï¼Œä¸ºäº†åé¢è°ƒç”¨</span></span><br><span class="line">    <span class="built_in">window</span>[callbackName] = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      resolve(data);</span><br><span class="line">      <span class="comment">// script æ‰§è¡Œå®Œäº†ï¼Œæˆä¸ºæ— ç”¨å…ƒç´ ï¼Œéœ€è¦æ¸…é™¤</span></span><br><span class="line">      <span class="built_in">document</span>.body.removeChild(scriptEle);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">jsonp(&#123;</span><br><span class="line">  url: <span class="string">"http://127.0.0.1:8000/"</span>,</span><br><span class="line">  params: &#123;</span><br><span class="line">    name: <span class="string">"Yang Min"</span>,</span><br><span class="line">    age: <span class="string">"8"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  callbackName: <span class="string">"getData"</span></span><br><span class="line">&#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">JSON</span>.parse(data))</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data); <span class="comment">// &#123;name: "Yang Min", age: "8"&#125;</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>Node ç«¯ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">"querystring"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url = req.url;</span><br><span class="line">  <span class="keyword">const</span> query = querystring.parse(url.split(<span class="string">"?"</span>)[<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">const</span> &#123; name, age, callback &#125; = query;</span><br><span class="line">  <span class="keyword">const</span> data = &#123;</span><br><span class="line">    name,</span><br><span class="line">    age</span><br><span class="line">  &#125;</span><br><span class="line">  res.end(<span class="string">`<span class="subst">$&#123;callback&#125;</span>('<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(data)&#125;</span>')`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure><h2 id="jQuery-ä¸­çš„-JSONP"><a href="#jQuery-ä¸­çš„-JSONP" class="headerlink" title="jQuery ä¸­çš„ JSONP"></a>jQuery ä¸­çš„ JSONP</h2><p>Node éƒ¨åˆ†ä¸å˜ï¼Œä½¿ç”¨ jQuery(3.4.1) å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAjaxData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $.ajax(&#123;</span><br><span class="line">    type: <span class="string">"get"</span>,</span><br><span class="line">    <span class="keyword">async</span>: <span class="literal">false</span>,</span><br><span class="line">    url: <span class="string">"http://127.0.0.1:8000/"</span>,</span><br><span class="line">    dataType: <span class="string">"jsonp"</span>, <span class="comment">//ç”± JSON æ”¹ä¸º JSONP</span></span><br><span class="line">    jsonp: <span class="string">"callback"</span>, <span class="comment">//ä¼ é€’ç»™è¯·æ±‚å¤„ç†ç¨‹åºæˆ–é¡µé¢çš„ï¼Œæ ‡è¯†jsonpå›è°ƒå‡½æ•°å(ä¸€èˆ¬ä¸º:callback)</span></span><br><span class="line">    jsonpCallback: <span class="string">"getData"</span>, <span class="comment">//callbackçš„functionåç§°ï¼ŒæˆåŠŸå°±ä¼šç›´æ¥èµ° success æ–¹æ³•</span></span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">      data = <span class="built_in">JSON</span>.parse(data);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`My name is <span class="subst">$&#123;data.name&#125;</span>, and <span class="subst">$&#123;data.age&#125;</span> years old.`</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    error: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"Error"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">getAjaxData();</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å»¶è¿Ÿå¯¹è±¡é‡æ–°å†™ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAjaxData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> def = $.ajax(&#123;</span><br><span class="line">    type: <span class="string">"get"</span>,</span><br><span class="line">    <span class="keyword">async</span>: <span class="literal">false</span>,</span><br><span class="line">    url: <span class="string">"http://127.0.0.1:8000/"</span>,</span><br><span class="line">    dataType: <span class="string">"jsonp"</span>,</span><br><span class="line">    jsonp: <span class="string">"callback"</span>,</span><br><span class="line">    jsonpCallback: <span class="string">"getData"</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  def</span><br><span class="line">    .done(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      data = <span class="built_in">JSON</span>.parse(data);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`My name is <span class="subst">$&#123;data.name&#125;</span>, and <span class="subst">$&#123;data.age&#125;</span> years old.`</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .fail(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="JSONP-ç¼ºç‚¹"><a href="#JSONP-ç¼ºç‚¹" class="headerlink" title="JSONP ç¼ºç‚¹"></a>JSONP ç¼ºç‚¹</h2><ul><li>åªæ”¯æŒ GET è¯·æ±‚</li><li>åªæ”¯æŒè·¨åŸŸ HTTP è¯·æ±‚è¿™ç§æƒ…å†µï¼Œä¸èƒ½è§£å†³ä¸åŒåŸŸçš„ä¸¤ä¸ªé¡µé¢ä¹‹é—´å¦‚ä½•è¿›è¡Œ JavaScript è°ƒç”¨çš„é—®é¢˜</li><li>è°ƒç”¨å¤±è´¥çš„æ—¶å€™ä¸ä¼šè¿”å›å„ç§ HTTP çŠ¶æ€ç ã€‚</li><li>å®‰å…¨æ€§ï¼Œä¸‡ä¸€å‡å¦‚æä¾› JSONP çš„æœåŠ¡å­˜åœ¨é¡µé¢æ³¨å…¥æ¼æ´ï¼Œå³å®ƒè¿”å›çš„ javascript çš„å†…å®¹è¢«äººæ§åˆ¶çš„ã€‚</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://juejin.im/post/5e76bd516fb9a07cce750746#heading-67" target="_blank" rel="noopener">ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿæµè§ˆå™¨å¦‚ä½•æ‹¦æˆªå“åº”ï¼Ÿå¦‚ä½•è§£å†³</a></li><li><a href="https://segmentfault.com/a/1190000009773724" target="_blank" rel="noopener">jsonp è·¨åŸŸåŸç†åˆ†æ</a> - åˆ†æäº† Ajax å’Œ jsonp ä¹‹é—´çš„å…³ç³»</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;JSONP è¯·æ±‚æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨äº† â€œAjax è¯·æ±‚ä¼šå—åˆ°åŒæºç­–ç•¥é™åˆ¶ï¼Œè€Œ script æ ‡ç­¾è¯·æ±‚ä¸ä¼šâ€ è¿™ä¸€ç‚¹æ¥ç»•è¿‡åŒæºç­–ç•¥ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="ç½‘ç»œçŸ¥è¯†" scheme="http://yangtao.site/categories/%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/"/>
    
    
      <category term="http" scheme="http://yangtao.site/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>Node ä¸­é—´ä»¶åŸç†</title>
    <link href="http://yangtao.site/2020/03/20/node-middleware/"/>
    <id>http://yangtao.site/2020/03/20/node-middleware/</id>
    <published>2020-03-20T09:59:34.000Z</published>
    <updated>2020-03-20T10:06:45.464Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Koa å’Œ Express çš„è®¾è®¡é£æ ¼éå¸¸ç±»ä¼¼ï¼Œåº•å±‚ä¹Ÿéƒ½æ˜¯å…±ç”¨çš„åŒä¸€å¥— HTTP åŸºç¡€åº“ï¼Œä½†æ˜¯æœ‰å‡ ä¸ªæ˜¾è‘—çš„åŒºåˆ«ï¼Œé™¤äº†ä¸Šé¢æåˆ°çš„é»˜è®¤å¼‚æ­¥è§£å†³æ–¹æ¡ˆä¹‹å¤–ï¼Œä¸»è¦çš„ç‰¹ç‚¹è¿˜æœ‰ä¸‹é¢å‡ ä¸ªã€‚</p></blockquote><a id="more"></a><h2 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h2><p>Koa çš„ä¸­é—´ä»¶å’Œ Express ä¸åŒï¼ŒKoa é€‰æ‹©äº†æ´‹è‘±åœˆæ¨¡å‹ã€‚</p><p><img src="https://ae01.alicdn.com/kf/H6d60d151712d4e1e8dfc887f5839c7ecz.png" alt="ä¸­é—´ä»¶æ´‹è‘±å›¾"></p><p>æ‰€æœ‰çš„è¯·æ±‚ç»è¿‡ä¸€ä¸ªä¸­é—´ä»¶çš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œå¯¹æ¯” Express å½¢å¼çš„ä¸­é—´ä»¶ï¼ŒKoa çš„æ¨¡å‹å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°åç½®å¤„ç†é€»è¾‘ï¼Œå¯¹æ¯” Koa å’Œ Express çš„ Compress ä¸­é—´ä»¶å°±å¯ä»¥æ˜æ˜¾çš„æ„Ÿå—åˆ° Koa ä¸­é—´ä»¶æ¨¡å‹çš„ä¼˜åŠ¿ã€‚</p><h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><p>å’Œ Express åªæœ‰ Request å’Œ Response ä¸¤ä¸ªå¯¹è±¡ä¸åŒï¼ŒKoa å¢åŠ äº†ä¸€ä¸ª Context çš„å¯¹è±¡ï¼Œä½œä¸ºè¿™æ¬¡è¯·æ±‚çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆåœ¨ Koa 1 ä¸­ä¸ºä¸­é—´ä»¶çš„ thisï¼Œåœ¨ Koa 2 ä¸­ä½œä¸ºä¸­é—´ä»¶çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ï¼‰ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°†ä¸€æ¬¡è¯·æ±‚ç›¸å…³çš„ä¸Šä¸‹æ–‡éƒ½æŒ‚è½½åˆ°è¿™ä¸ªå¯¹è±¡ä¸Šã€‚ç±»ä¼¼ traceId è¿™ç§éœ€è¦è´¯ç©¿æ•´ä¸ªè¯·æ±‚ï¼ˆåœ¨åç»­ä»»ä½•ä¸€ä¸ªåœ°æ–¹è¿›è¡Œå…¶ä»–è°ƒç”¨éƒ½éœ€è¦ç”¨åˆ°ï¼‰çš„å±æ€§å°±å¯ä»¥æŒ‚è½½ä¸Šå»ã€‚ç›¸è¾ƒäº request å’Œ response è€Œè¨€æ›´åŠ ç¬¦åˆè¯­ä¹‰ã€‚</p><p>åŒæ—¶ Context ä¸Šä¹ŸæŒ‚è½½äº† Request å’Œ Response ä¸¤ä¸ªå¯¹è±¡ã€‚å’Œ Express ç±»ä¼¼ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡éƒ½æä¾›äº†å¤§é‡çš„ä¾¿æ·æ–¹æ³•è¾…åŠ©å¼€å‘ï¼Œä¾‹å¦‚</p><ul><li>get request.query</li><li>get request.hostname</li><li>set response.body</li><li>set response.status</li></ul><h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h2><p>é€šè¿‡åŒæ­¥æ–¹å¼ç¼–å†™å¼‚æ­¥ä»£ç å¸¦æ¥çš„å¦å¤–ä¸€ä¸ªéå¸¸å¤§çš„å¥½å¤„å°±æ˜¯å¼‚å¸¸å¤„ç†éå¸¸è‡ªç„¶ï¼Œä½¿ç”¨ <code>try catch</code> å°±å¯ä»¥å°†æŒ‰ç…§è§„èŒƒç¼–å†™çš„ä»£ç ä¸­çš„æ‰€æœ‰é”™è¯¯éƒ½æ•è·åˆ°ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥å¾ˆä¾¿æ·çš„ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„é”™è¯¯å¤„ç†ä¸­é—´ä»¶ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">onerror</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> next();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    ctx.app.emit(<span class="string">"error"</span>, err);</span><br><span class="line">    ctx.body = <span class="string">"server error"</span>;</span><br><span class="line">    ctx.status = err.status || <span class="number">500</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªéœ€è¦å°†è¿™ä¸ªä¸­é—´ä»¶æ”¾åœ¨å…¶ä»–ä¸­é—´ä»¶ä¹‹å‰ï¼Œå°±å¯ä»¥æ•è·å®ƒä»¬æ‰€æœ‰çš„åŒæ­¥æˆ–è€…å¼‚æ­¥ä»£ç ä¸­æŠ›å‡ºçš„å¼‚å¸¸äº†ã€‚</p><p>æ³¨ï¼šä»¥ä¸Šæ‰€æœ‰çš†æ¥è‡ª<a href="https://eggjs.org/zh-cn/intro/egg-and-koa.html" target="_blank" rel="noopener">Egg.js ä¸ Koa</a></p><h2 id="ä¸­é—´ä»¶æ¨¡æ‹Ÿ"><a href="#ä¸­é—´ä»¶æ¨¡æ‹Ÿ" class="headerlink" title="ä¸­é—´ä»¶æ¨¡æ‹Ÿ"></a>ä¸­é—´ä»¶æ¨¡æ‹Ÿ</h2><h3 id="Express"><a href="#Express" class="headerlink" title="Express"></a>Express</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">const</span> slice = <span class="built_in">Array</span>.prototype.slice;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LikeExpress</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="comment">// å­˜æ”¾ä¸­é—´ä»¶çš„åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">this</span>.routes = &#123;</span><br><span class="line">      all: [], <span class="comment">// app.use(...)</span></span><br><span class="line">      get: [], <span class="comment">// app.get(...)</span></span><br><span class="line">      post: [] <span class="comment">// app.post(...)</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  register(path) &#123;</span><br><span class="line">    <span class="keyword">const</span> info = &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> path === <span class="string">"string"</span>) &#123;</span><br><span class="line">      info.path = path;</span><br><span class="line">      <span class="comment">// ä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹ï¼Œè½¬æ¢ä¸ºæ•°ç»„ï¼Œå­˜å…¥ stack</span></span><br><span class="line">      info.stack = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      info.path = <span class="string">"/"</span>;</span><br><span class="line">      <span class="comment">// ä»ç¬¬ä¸€ä¸ªå‚æ•°å¼€å§‹ï¼Œè½¬æ¢ä¸ºæ•°ç»„ï¼Œå­˜å…¥ stack</span></span><br><span class="line">      info.stack = slice.call(<span class="built_in">arguments</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> info;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  use() &#123;</span><br><span class="line">    <span class="keyword">const</span> info = <span class="keyword">this</span>.register.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">this</span>.routes.all.push(info);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  get() &#123;</span><br><span class="line">    <span class="keyword">const</span> info = <span class="keyword">this</span>.register.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">this</span>.routes.get.push(info);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  post() &#123;</span><br><span class="line">    <span class="keyword">const</span> info = <span class="keyword">this</span>.register.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">this</span>.routes.post.push(info);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  match(method, url) &#123;</span><br><span class="line">    <span class="keyword">let</span> stack = [];</span><br><span class="line">    <span class="keyword">if</span> (url === <span class="string">"/favicon.ico"</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> stack;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å– routes</span></span><br><span class="line">    <span class="keyword">let</span> curRoutes = [];</span><br><span class="line">    curRoutes = curRoutes.concat(<span class="keyword">this</span>.routes.all);</span><br><span class="line">    curRoutes = curRoutes.concat(<span class="keyword">this</span>.routes[method]);</span><br><span class="line"></span><br><span class="line">    curRoutes.forEach(<span class="function"><span class="params">routeInfo</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (url.indexOf(routeInfo.path) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// url === '/api/get-cookie' ä¸” routeInfo.path === '/'</span></span><br><span class="line">        <span class="comment">// url === '/api/get-cookie' ä¸” routeInfo.path === '/api'</span></span><br><span class="line">        <span class="comment">// url === '/api/get-cookie' ä¸” routeInfo.path === '/api/get-cookie'</span></span><br><span class="line">        stack = stack.concat(routeInfo.stack);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> stack;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¸å¿ƒçš„ next æœºåˆ¶</span></span><br><span class="line">  handle(req, res, stack) &#123;</span><br><span class="line">    <span class="keyword">const</span> next = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// æ‹¿åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„ä¸­é—´ä»¶</span></span><br><span class="line">      <span class="keyword">const</span> middleware = stack.shift();</span><br><span class="line">      <span class="keyword">if</span> (middleware) &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œä¸­é—´ä»¶å‡½æ•°</span></span><br><span class="line">        middleware(req, res, next);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  callback() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">      res.json = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        res.setHeader(<span class="string">"Content-type"</span>, <span class="string">"application/json"</span>);</span><br><span class="line">        res.end(<span class="built_in">JSON</span>.stringify(data));</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">const</span> url = req.url;</span><br><span class="line">      <span class="keyword">const</span> method = req.method.toLowerCase();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> resultList = <span class="keyword">this</span>.match(method, url);</span><br><span class="line">      <span class="keyword">this</span>.handle(req, res, resultList);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  listen(...args) &#123;</span><br><span class="line">    <span class="keyword">const</span> server = http.createServer(<span class="keyword">this</span>.callback());</span><br><span class="line">    server.listen(...args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å·¥å‚å‡½æ•°</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> LikeExpress();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Koa"><a href="#Koa" class="headerlink" title="Koa"></a>Koa</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»„åˆä¸­é—´ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">middlewareList</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">ctx</span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> fn = middlewareList[i];</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(</span><br><span class="line">          fn(ctx, dispatch.bind(<span class="literal">null</span>, i + <span class="number">1</span>)) <span class="comment">// promise</span></span><br><span class="line">        );</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dispatch(<span class="number">0</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LikeKoa2</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.middlewareList = [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  use(fn) &#123;</span><br><span class="line">    <span class="keyword">this</span>.middlewareList.push(fn);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  createContext(req, res) &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = &#123;</span><br><span class="line">      req,</span><br><span class="line">      res</span><br><span class="line">    &#125;;</span><br><span class="line">    ctx.query = req.query;</span><br><span class="line">    <span class="keyword">return</span> ctx;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleRequest(ctx, fn) &#123;</span><br><span class="line">    <span class="keyword">return</span> fn(ctx);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  callback() &#123;</span><br><span class="line">    <span class="keyword">const</span> fn = compose(<span class="keyword">this</span>.middlewareList);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> ctx = <span class="keyword">this</span>.createContext(req, res);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.handleRequest(ctx, fn);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  listen(...args) &#123;</span><br><span class="line">    <span class="keyword">const</span> server = http.createServer(<span class="keyword">this</span>.callback());</span><br><span class="line">    server.listen(...args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = LikeKoa2;</span><br></pre></td></tr></table></figure><h2 id="é¡¹ç›®å®è·µ"><a href="#é¡¹ç›®å®è·µ" class="headerlink" title="é¡¹ç›®å®è·µ"></a>é¡¹ç›®å®è·µ</h2><p><a href="https://github.com/yangtao2o/node-blog-express-koa2" target="_blank" rel="noopener">Node.js ä»é›¶å¼€å‘ web serveråšå®¢é¡¹ç›®ï¼Œå¹¶ä½¿ç”¨expressã€koa2é‡æ„</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Koa å’Œ Express çš„è®¾è®¡é£æ ¼éå¸¸ç±»ä¼¼ï¼Œåº•å±‚ä¹Ÿéƒ½æ˜¯å…±ç”¨çš„åŒä¸€å¥— HTTP åŸºç¡€åº“ï¼Œä½†æ˜¯æœ‰å‡ ä¸ªæ˜¾è‘—çš„åŒºåˆ«ï¼Œé™¤äº†ä¸Šé¢æåˆ°çš„é»˜è®¤å¼‚æ­¥è§£å†³æ–¹æ¡ˆä¹‹å¤–ï¼Œä¸»è¦çš„ç‰¹ç‚¹è¿˜æœ‰ä¸‹é¢å‡ ä¸ªã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Nodejs" scheme="http://yangtao.site/categories/Nodejs/"/>
    
    
      <category term="Nodejs" scheme="http://yangtao.site/tags/Nodejs/"/>
    
  </entry>
  
  <entry>
    <title>Cookieã€Sessionã€LocalStorageã€SessionStorage</title>
    <link href="http://yangtao.site/2020/03/20/cookie-session/"/>
    <id>http://yangtao.site/2020/03/20/cookie-session/</id>
    <published>2020-03-20T04:08:07.000Z</published>
    <updated>2020-03-20T09:05:47.118Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Session æ˜¯åœ¨æœåŠ¡ç«¯ä¿å­˜çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç”¨æ¥è·Ÿè¸ªç”¨æˆ·çš„çŠ¶æ€ï¼Œè¿™ä¸ªæ•°æ®å¯ä»¥ä¿å­˜åœ¨é›†ç¾¤ã€æ•°æ®åº“ã€æ–‡ä»¶ä¸­ï¼›<br>Cookie æ˜¯å®¢æˆ·ç«¯ä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨æ¥è®°å½•ç”¨æˆ·çš„ä¸€äº›ä¿¡æ¯ï¼Œä¹Ÿæ˜¯å®ç° Session çš„ä¸€ç§æ–¹å¼ï¼›<br>LocalStorage æ˜¯ Web Storage API çš„ä¸€ç§ç±»å‹ï¼Œèƒ½åœ¨æµè§ˆå™¨ç«¯å­˜å‚¨é”®å€¼å¯¹æ•°æ®ï¼›<br>SessionStorage åªå­˜å‚¨å½“å‰ä¼šè¯é¡µ(tab é¡µ)çš„æ•°æ®ï¼Œä¸€æ—¦ç”¨æˆ·å…³é—­å½“å‰é¡µæˆ–è€…æµè§ˆå™¨ï¼Œæ•°æ®å°±è‡ªåŠ¨è¢«æ¸…é™¤æ‰äº†ã€‚</p></blockquote><a id="more"></a><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>åœ¨ç½‘ç«™ä¸­ï¼Œhttp è¯·æ±‚æ˜¯æ— çŠ¶æ€çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å³ä½¿ç¬¬ä¸€æ¬¡å’ŒæœåŠ¡å™¨è¿æ¥åå¹¶ä¸”ç™»å½•æˆåŠŸåï¼Œç¬¬äºŒæ¬¡è¯·æ±‚æœåŠ¡å™¨ä¾ç„¶ä¸èƒ½çŸ¥é“å½“å‰è¯·æ±‚æ˜¯å“ªä¸ªç”¨æˆ·ã€‚</p><p>cookie çš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€æ¬¡ç™»å½•åæœåŠ¡å™¨è¿”å›ä¸€äº›æ•°æ®ï¼ˆcookieï¼‰ç»™æµè§ˆå™¨ï¼Œç„¶åæµè§ˆå™¨ä¿å­˜åœ¨æœ¬åœ°ï¼Œå½“è¯¥ç”¨æˆ·å‘é€ç¬¬äºŒæ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨çš„æŠŠä¸Šæ¬¡è¯·æ±‚å­˜å‚¨çš„ cookie æ•°æ®è‡ªåŠ¨çš„æºå¸¦ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨é€šè¿‡æµè§ˆå™¨æºå¸¦çš„æ•°æ®å°±èƒ½åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å“ªä¸ªäº†ã€‚</p><p>cookie å­˜å‚¨çš„æ•°æ®é‡æœ‰é™ï¼Œä¸åŒçš„æµè§ˆå™¨æœ‰ä¸åŒçš„å­˜å‚¨å¤§å°ï¼Œä½†ä¸€èˆ¬ä¸è¶…è¿‡ 4KBã€‚å› æ­¤ä½¿ç”¨ cookie åªèƒ½å­˜å‚¨ä¸€äº›å°é‡çš„æ•°æ®ã€‚</p><p><strong>Cookie çš„ä¼˜ç‚¹ï¼š</strong></p><ul><li>èƒ½ç”¨äºå’ŒæœåŠ¡ç«¯é€šä¿¡</li><li>å½“ cookie å¿«è¦è‡ªåŠ¨è¿‡æœŸæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°è®¾ç½®è€Œä¸æ˜¯åˆ é™¤</li></ul><p><strong>Cookie ç¼ºç‚¹ï¼š</strong></p><ul><li>å¢åŠ äº†æ–‡æ¡£ä¼ è¾“çš„è´Ÿè½½</li><li>åªèƒ½å­˜å‚¨å°‘é‡çš„æ•°æ®</li><li>åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²</li><li>æ½œåœ¨çš„ å®‰å…¨é—®é¢˜ï¼ˆé€šè¿‡æœåŠ¡ç«¯è®¾ç½® httpOnlyï¼‰</li></ul><p>è§£å†³åŠæ³•ï¼šWeb Storage API (Local and Session Storage)ã€‚</p><p>åˆ›å»ºï¼Œè¯»å–ï¼Œæ›´æ–°å’Œåˆ é™¤ Cookieï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯»å–</span></span><br><span class="line"><span class="built_in">document</span>.cookie;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®æ”¹/æ›´æ–°</span></span><br><span class="line"><span class="built_in">document</span>.cookie = <span class="string">"testname=Yangtao"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤ï¼Œè®¾ç½®expiresçš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="built_in">document</span>.cookie = <span class="string">"testname=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"</span>;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯è®¾ç½®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> getAndSetCookie = &#123;</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.checkCookie();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// è®¾ç½®cookieï¼ŒåŒä¸€åŸŸåéƒ½å¯è·å–</span></span><br><span class="line">    setCookie: <span class="function"><span class="keyword">function</span>(<span class="params">name, value, exdays</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> exdays = exdays || <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">      d.setTime(d.getTime() + exdays * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">      <span class="built_in">document</span>.cookie =</span><br><span class="line">        name + <span class="string">"="</span> + <span class="built_in">escape</span>(value) + <span class="string">";path=/;expires="</span> + d.toGMTString();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// è¯»å–cookiesï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨è®¾ç½®çš„name</span></span><br><span class="line">    getCookie: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> name = name + <span class="string">"="</span>;</span><br><span class="line">      <span class="keyword">var</span> ca = <span class="built_in">document</span>.cookie.split(<span class="string">";"</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; ca.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> c = ca[i].trim();</span><br><span class="line">        <span class="keyword">if</span> (c.indexOf(name) == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> c.substring(name.length, c.length);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    checkCookie: <span class="function"><span class="keyword">function</span>(<span class="params">pc</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> user = <span class="keyword">this</span>.getCookie(<span class="string">"msgCookie"</span>);</span><br><span class="line">      <span class="keyword">if</span> (user == <span class="string">""</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.setCookie(<span class="string">"msgCookie"</span>, <span class="string">"msgCookie"</span>, <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// init</span></span><br><span class="line">  getAndSetCookie.init();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>Node è®¾ç½®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å– cookie è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="keyword">const</span> getCookieExpires = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">d.setTime(d.getTime() + <span class="number">24</span> _ <span class="number">60</span> _ <span class="number">60</span> \* <span class="number">1000</span>);</span><br><span class="line"><span class="keyword">return</span> d.toGMTString();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®</span></span><br><span class="line">res.setHeader(</span><br><span class="line"><span class="string">"Set-Cookie"</span>,</span><br><span class="line"><span class="string">`username=<span class="subst">$&#123;data.username&#125;</span>; path=/; httpOnly; expires=<span class="subst">$&#123;getCookieExpires()&#125;</span>`</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æ cookie</span></span><br><span class="line">req.cookie = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> cookieStr = req.headers.cookie || <span class="string">""</span>; <span class="comment">// "k1=v1; k2=v2; k3=v3"</span></span><br><span class="line">cookieStr.split(<span class="string">";"</span>).forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!item) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> str = item.split(<span class="string">"="</span>);</span><br><span class="line">  <span class="keyword">const</span> key = str[<span class="number">0</span>].trim();</span><br><span class="line">  <span class="keyword">const</span> val = str[<span class="number">1</span>].trim();</span><br><span class="line"></span><br><span class="line">  req.cookie[key] = val;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p>session å’Œ cookie çš„ä½œç”¨æœ‰ç‚¹ç±»ä¼¼ï¼Œéƒ½æ˜¯ä¸ºäº†å­˜å‚¨ç”¨æˆ·ç›¸å…³çš„ä¿¡æ¯ã€‚ä¸åŒçš„æ˜¯ï¼Œcookie æ˜¯å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ï¼Œè€Œ session å­˜å‚¨åœ¨æœåŠ¡å™¨ã€‚</p><p>å­˜å‚¨åœ¨æœåŠ¡å™¨çš„æ•°æ®ä¼šæ›´åŠ çš„å®‰å…¨ï¼Œä¸å®¹æ˜“è¢«çªƒå–ã€‚ä½†å­˜å‚¨åœ¨æœåŠ¡å™¨ä¹Ÿæœ‰ä¸€å®šçš„å¼Šç«¯ï¼Œå°±æ˜¯ä¼šå ç”¨æœåŠ¡å™¨çš„èµ„æºï¼Œæ‰€ä»¥å°±ç”¨åˆ°äº† redisã€‚</p><p><strong>Session çš„é—®é¢˜ï¼š</strong></p><ul><li>session æ˜¯ä¸€ä¸ªå˜é‡å­˜åœ¨ nodejs è¿›ç¨‹å†…å­˜ä¸­</li><li>è¿›ç¨‹å†…å­˜æœ‰é™ï¼Œè®¿é—®é‡è¿‡å¤§ï¼Œå†…å­˜å®¹æ˜“æš´å¢</li><li>çº¿ä¸Šå¤šä¸ºå¤šè¿›ç¨‹ï¼Œè¿›ç¨‹é—´å†…å­˜æ— æ³•å…±äº«</li><li>å¯ä»¥å€ŸåŠ© redis è§£å†³</li></ul><h2 id="Cookie-Session"><a href="#Cookie-Session" class="headerlink" title="Cookie+Session"></a>Cookie+Session</h2><p>cookie å’Œ session çš„ä½¿ç”¨å·²ç»å‡ºç°äº†ä¸€äº›éå¸¸æˆç†Ÿçš„æ–¹æ¡ˆã€‚åœ¨å¦‚ä»Šçš„å¸‚åœºæˆ–è€…ä¼ä¸šé‡Œï¼Œä¸€èˆ¬æœ‰ä¸¤ç§å­˜å‚¨æ–¹å¼ï¼š</p><p><strong>1ã€å­˜å‚¨åœ¨æœåŠ¡ç«¯</strong></p><p>é€šè¿‡ cookie å­˜å‚¨ä¸€ä¸ª session_idï¼Œç„¶åå…·ä½“çš„æ•°æ®åˆ™æ˜¯ä¿å­˜åœ¨ session ä¸­ã€‚å¦‚æœç”¨æˆ·å·²ç»ç™»å½•ï¼Œåˆ™æœåŠ¡å™¨ä¼šåœ¨ cookie ä¸­ä¿å­˜ä¸€ä¸ª session_idï¼Œä¸‹æ¬¡å†æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œä¼šæŠŠè¯¥ session_id æºå¸¦ä¸Šæ¥ï¼ŒæœåŠ¡å™¨æ ¹æ® session_id åœ¨ session åº“ä¸­è·å–ç”¨æˆ·çš„ session æ•°æ®ã€‚å°±èƒ½çŸ¥é“è¯¥ç”¨æˆ·åˆ°åº•æ˜¯è°ï¼Œä»¥åŠä¹‹å‰ä¿å­˜çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ã€‚è¿™ç§ä¸“ä¸šæœ¯è¯­å«åš <code>server side session</code>ã€‚</p><p><strong>2ã€å°† session æ•°æ®åŠ å¯†ï¼Œç„¶åå­˜å‚¨åœ¨ cookie ä¸­</strong></p><p>è¿™ç§ä¸“ä¸šæœ¯è¯­å«åš <code>client side session</code>ã€‚</p><p><strong>æ€»ç»“ï¼š</strong></p><ul><li>å­˜å‚¨åœ¨æµè§ˆå™¨çš„ä¸€æ®µå­—ç¬¦ä¸²</li><li>è·¨åŸŸä¸å…±äº«</li><li>å¯ä»¥å­˜å‚¨ç»“æ„åŒ–æ•°æ®ï¼Œæ ¼å¼ä¸ºï¼šâ€k1=v1; k2=v2; k3=v3â€</li><li>æµè§ˆå™¨å¯ä»¥ä½¿ç”¨ JavaScript ä¿®æ”¹ cookieï¼ˆæœ‰é™åˆ¶ï¼‰</li><li>æ¯æ¬¡å‘é€ http è¯·æ±‚ï¼Œéƒ½å°†è¯·æ±‚åŸŸçš„ cookie ä¸€èµ·å‘ç»™ server</li><li>server å¯ä»¥ä¿®æ”¹ cookieï¼Œå¹¶è¿”ç»™æµè§ˆå™¨</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SESSION_DATA = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> needSetCookie = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serverHandle = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è§£æ session</span></span><br><span class="line">  <span class="keyword">let</span> userId = req.cookie.userid;</span><br><span class="line">  <span class="keyword">if</span> (userId) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!SESSION_DATA[userId]) &#123;</span><br><span class="line">      SESSION_DATA[userId] = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    needSetCookie = <span class="literal">true</span>;</span><br><span class="line">    userId = <span class="string">`<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>_<span class="subst">$&#123;<span class="built_in">Math</span>.random()&#125;</span>`</span>;</span><br><span class="line">    SESSION_DATA[userId] = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  req.session = SESSION_DATA[userId];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ“ä½œ cookie</span></span><br><span class="line">  <span class="keyword">if</span> (needSetCookie) &#123;</span><br><span class="line">    res.setHeader(</span><br><span class="line">      <span class="string">"Set-Cookie"</span>,</span><br><span class="line">      <span class="string">`userid=<span class="subst">$&#123;userId&#125;</span>; path=/; httpOnly; expires=<span class="subst">$&#123;getCookieExpires()&#125;</span>`</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–usernameå¹¶èµ‹å€¼</span></span><br><span class="line">  <span class="keyword">if</span> (data.username) &#123;</span><br><span class="line">    req.session.username = data.username;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SuccessModel();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç„¶åè¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (req.session.username) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(</span><br><span class="line">      <span class="keyword">new</span> SuccessModel(&#123;</span><br><span class="line">        session: req.session</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>è¯¦ç»†å†…å®¹ï¼š</strong><a href="https://github.com/yangtao2o/node-blog-express-koa2/blob/master/docs/signin.md" target="_blank" rel="noopener">ç™»å½•</a></p><h2 id="LocalStorage"><a href="#LocalStorage" class="headerlink" title="LocalStorage"></a>LocalStorage</h2><p>Local Storage æ˜¯ Web Storage API çš„ä¸€ç§ç±»å‹ï¼Œèƒ½åœ¨æµè§ˆå™¨ç«¯å­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚</p><p>Local Storage å› æä¾›äº†æ›´ç›´è§‚å’Œå®‰å…¨çš„ API æ¥å­˜å‚¨ç®€å•çš„æ•°æ®ï¼Œè¢«è§†ä¸ºæ›¿ä»£ Cookies çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ä»æŠ€æœ¯ä¸Šè¯´ï¼Œå°½ç®¡ Local Storage åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å®ƒä¹Ÿæ˜¯å¯ä»¥å­˜å‚¨å­—ç¬¦ä¸²åŒ–çš„ JSON æ•°æ®ã€‚è¿™å°±æ„å‘³ç€ï¼ŒLocal Storage èƒ½æ¯” Cookies å­˜å‚¨æ›´å¤æ‚çš„æ•°æ®ã€‚</p><p>åˆ›å»ºï¼Œè¯»å–ï¼Œæ›´æ–°å’Œåˆ é™¤ Local Storageï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create</span></span><br><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">name</span>: <span class="string">"Bob"</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;;</span><br><span class="line">localStorage.setItem(<span class="string">"user"</span>, <span class="built_in">JSON</span>.stringify(user));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Read (Single)</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.parse(localStorage.getItem(<span class="string">"user"</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update</span></span><br><span class="line"><span class="keyword">const</span> updatedUser = &#123; <span class="attr">name</span>: <span class="string">"Bob"</span>, <span class="attr">age</span>: <span class="number">24</span> &#125;;</span><br><span class="line"></span><br><span class="line">localStorage.setItem(<span class="string">"user"</span>, <span class="built_in">JSON</span>.stringify(updatedUser));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete</span></span><br><span class="line">localStorage.removeItem(<span class="string">"user"</span>);</span><br></pre></td></tr></table></figure><p><strong>Local Storage çš„ä¼˜ç‚¹ï¼š</strong>ç›¸æ¯”äº Cookieï¼Œå…¶æä¾›äº†æ›´ç›´è§‚åœ°æ¥å£æ¥å­˜å‚¨æ•°æ®æ›´å®‰å…¨,èƒ½å­˜å‚¨æ›´å¤šæ•°æ®ã€‚</p><p><strong>Local Storage çš„ç¼ºç‚¹ï¼š</strong>åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²æ•°æ®ï¼Œæµè§ˆå™¨æ”¯æŒ<code>IE8+/Edge/Firefox 2+/Chrome/Safari 4+/Opera 11.5+(caniuse)</code></p><h2 id="SessionStorage"><a href="#SessionStorage" class="headerlink" title="SessionStorage"></a>SessionStorage</h2><p>Session Storage å’Œ Local Storage éå¸¸ç±»ä¼¼ï¼ŒåŒºåˆ«æ˜¯ Session Storage åªå­˜å‚¨å½“å‰ä¼šè¯é¡µ(tab é¡µ)çš„æ•°æ®ï¼Œä¸€æ—¦ç”¨æˆ·å…³é—­å½“å‰é¡µæˆ–è€…æµè§ˆå™¨ï¼Œæ•°æ®å°±è‡ªåŠ¨è¢«æ¸…é™¤æ‰äº†ã€‚</p><p>åˆ›å»ºï¼Œè¯»å–ï¼Œæ›´æ–°å’Œåˆ é™¤ Session Storageï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create</span></span><br><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">name</span>: <span class="string">'Bob'</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;sessionStorage.setItem(<span class="string">'user'</span>, <span class="built_in">JSON</span>.stringify(user))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Read (Single)</span></span><br><span class="line"><span class="built_in">console</span>.log( <span class="built_in">JSON</span>.parse(sessionStorage.getItem(<span class="string">'user'</span>)) )</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update</span></span><br><span class="line"><span class="keyword">const</span> updatedUser = &#123; <span class="attr">name</span>: <span class="string">'Bob'</span>, <span class="attr">age</span>: <span class="number">24</span> &#125;</span><br><span class="line"></span><br><span class="line">sessionStorage.setItem(<span class="string">'user'</span>, <span class="built_in">JSON</span>.stringify(updatedUser))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete</span></span><br><span class="line">sessionStorage.removeItem(<span class="string">'user'</span>)</span><br></pre></td></tr></table></figure><p>sessionStorageã€localStorageã€cookie éƒ½æ˜¯åœ¨æµè§ˆå™¨ç«¯å­˜å‚¨çš„æ•°æ®ã€‚</p><p>å…¶ä¸­ï¼ŒsessionStorage çš„æ¦‚å¿µå¾ˆç‰¹åˆ«ï¼Œå¼•å…¥äº†ä¸€ä¸ªâ€œæµè§ˆå™¨çª—å£â€çš„æ¦‚å¿µï¼ŒsessionStorage æ˜¯åœ¨åŒæºçš„åŒçª—å£ä¸­ï¼Œå§‹ç»ˆå­˜åœ¨çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦è¿™ä¸ªæµè§ˆå™¨çª—å£æ²¡æœ‰å…³é—­ï¼Œå³ä½¿åˆ·æ–°é¡µé¢æˆ–è¿›å…¥åŒæºå¦ä¸€ä¸ªé¡µé¢ï¼Œæ•°æ®ä»ç„¶å­˜åœ¨ï¼Œå…³é—­çª—å£å sessionStorage å°±ä¼šè¢«é”€æ¯ï¼ŒåŒæ—¶â€œç‹¬ç«‹â€æ‰“å¼€çš„ä¸åŒçª—å£ï¼Œå³ä½¿åŒä¸€é¡µé¢ï¼ŒsessionStorage å¯¹è±¡ä¹Ÿæ˜¯ä¸åŒçš„ã€‚</p><h2 id="å®¢æˆ·ç«¯å­˜å‚¨æ–¹å¼å¼‚åŒ"><a href="#å®¢æˆ·ç«¯å­˜å‚¨æ–¹å¼å¼‚åŒ" class="headerlink" title="å®¢æˆ·ç«¯å­˜å‚¨æ–¹å¼å¼‚åŒ"></a>å®¢æˆ·ç«¯å­˜å‚¨æ–¹å¼å¼‚åŒ</h2><p><strong>cookieï¼ŒsessionStorage å’Œ localStorage çš„åŒºåˆ«ï¼Ÿ</strong></p><ul><li>cookie æ˜¯ç½‘ç«™ä¸ºäº†æ ‡ç¤ºç”¨æˆ·èº«ä»½è€Œå‚¨å­˜åœ¨ç”¨æˆ·æœ¬åœ°ç»ˆç«¯ï¼ˆClient Sideï¼‰ä¸Š çš„æ•°æ®ï¼ˆé€šå¸¸ç»è¿‡åŠ å¯†ï¼‰- cookie æ•°æ®å§‹ç»ˆåœ¨åŒæºçš„ http è¯·æ±‚ä¸­æºå¸¦ï¼ˆå³ä½¿ä¸éœ€è¦ï¼‰ï¼Œè®°ä¼šåœ¨æµ è§ˆå™¨å’ŒæœåŠ¡å™¨é—´æ¥å›ä¼ é€’</li><li>sessionStorage å’Œ localStorage ä¸ä¼šè‡ªåŠ¨æŠŠæ•°æ®å‘ç»™æœåŠ¡å™¨ï¼Œä»…åœ¨æœ¬åœ° ä¿å­˜</li></ul><p><strong>å­˜å‚¨å¤§å°ï¼š</strong></p><ul><li>cookie æ•°æ®å¤§å°ä¸èƒ½è¶…è¿‡ 4k</li><li>sessionStorage å’Œ localStorage è™½ç„¶ä¹Ÿæœ‰å­˜å‚¨å¤§å°çš„é™åˆ¶ï¼Œä½†æ¯” cookie å¤§å¾—å¤šï¼Œå¯ä»¥è¾¾åˆ° 5M æˆ–æ›´å¤§</li></ul><p><strong>æœ‰æ•ˆæœŸï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰ï¼š</strong></p><ul><li>localStorage: å­˜å‚¨æŒä¹…æ•°æ®ï¼Œæµè§ˆå™¨å…³é—­åæ•°æ®ä¸ä¸¢å¤±ï¼Œé™¤éä¸»åŠ¨åˆ é™¤æ•°æ®</li><li>sessionStorage: æ•°æ®åœ¨å½“å‰æµè§ˆå™¨çª—å£å…³é—­åè‡ªåŠ¨åˆ é™¤</li><li>cookie: è®¾ç½®çš„ cookie è¿‡æœŸæ—¶é—´ä¹‹å‰ä¸€ç›´æœ‰æ•ˆï¼Œå³ä½¿çª—å£æˆ–æµè§ˆå™¨å…³é—­</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li>è‡ªå·±åšå®¢é¡¹ç›®ä¸­<a href="https://github.com/yangtao2o/node-blog-express-koa2/blob/master/docs/signin.md" target="_blank" rel="noopener">ä»€ä¹ˆæ˜¯ cookie</a></li><li><a href="https://www.zhihu.com/question/19786827" target="_blank" rel="noopener">COOKIE å’Œ SESSION æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><li><a href="https://baijiahao.baidu.com/s?id=1652697788741886713&amp;wfr=spider&amp;for=pc" target="_blank" rel="noopener">æµ…è°ˆ cookieï¼ŒsessionStorageï¼ŒlocalStorage</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Session æ˜¯åœ¨æœåŠ¡ç«¯ä¿å­˜çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç”¨æ¥è·Ÿè¸ªç”¨æˆ·çš„çŠ¶æ€ï¼Œè¿™ä¸ªæ•°æ®å¯ä»¥ä¿å­˜åœ¨é›†ç¾¤ã€æ•°æ®åº“ã€æ–‡ä»¶ä¸­ï¼›&lt;br&gt;Cookie æ˜¯å®¢æˆ·ç«¯ä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨æ¥è®°å½•ç”¨æˆ·çš„ä¸€äº›ä¿¡æ¯ï¼Œä¹Ÿæ˜¯å®ç° Session çš„ä¸€ç§æ–¹å¼ï¼›&lt;br&gt;LocalStorage æ˜¯ Web Storage API çš„ä¸€ç§ç±»å‹ï¼Œèƒ½åœ¨æµè§ˆå™¨ç«¯å­˜å‚¨é”®å€¼å¯¹æ•°æ®ï¼›&lt;br&gt;SessionStorage åªå­˜å‚¨å½“å‰ä¼šè¯é¡µ(tab é¡µ)çš„æ•°æ®ï¼Œä¸€æ—¦ç”¨æˆ·å…³é—­å½“å‰é¡µæˆ–è€…æµè§ˆå™¨ï¼Œæ•°æ®å°±è‡ªåŠ¨è¢«æ¸…é™¤æ‰äº†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="ç½‘ç»œçŸ¥è¯†" scheme="http://yangtao.site/categories/%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/"/>
    
    
      <category term="http" scheme="http://yangtao.site/tags/http/"/>
    
      <category term="web" scheme="http://yangtao.site/tags/web/"/>
    
      <category term="cookie" scheme="http://yangtao.site/tags/cookie/"/>
    
  </entry>
  
  <entry>
    <title>Understanding JavaScript Bind ()</title>
    <link href="http://yangtao.site/2020/03/16/js-bind/"/>
    <id>http://yangtao.site/2020/03/16/js-bind/</id>
    <published>2020-03-16T09:09:08.000Z</published>
    <updated>2020-03-16T11:04:08.368Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å¦‚ä½•å°†â€œthisâ€çš„ä¸Šä¸‹æ–‡ä¿ç•™åœ¨å¦ä¸€ä¸ªå‡½æ•°ä¸­ï¼Ÿæˆ‘ä»¬å¯èƒ½ä¼šéœ€è¦ä½¿ç”¨<code>Function.prototype.bind()</code>ã€‚èµ„æ–™åœ°å€ï¼š<a href="https://www.smashingmagazine.com/2014/01/understanding-javascript-function-prototype-bind/" target="_blank" rel="noopener">Understanding JavaScript Bind ()</a></p></blockquote><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;å¦‚ä½•å°†â€œthisâ€çš„ä¸Šä¸‹æ–‡ä¿ç•™åœ¨å¦ä¸€ä¸ªå‡½æ•°ä¸­ï¼Ÿæˆ‘ä»¬å¯èƒ½ä¼šéœ€è¦ä½¿ç”¨&lt;code&gt;Function.prototype.bind()&lt;/code&gt;ã€‚èµ„æ–™åœ°å€ï¼š&lt;a href=&quot;https://www.smashingmagazine.com/2014/01/understanding-javascript-function-prototype-bind/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Understanding JavaScript Bind ()&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://yangtao.site/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="http://yangtao.site/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>React è®¾è®¡æ€æƒ³ã€è½¬è½½ã€‘</title>
    <link href="http://yangtao.site/2020/03/16/react-design-ideass/"/>
    <id>http://yangtao.site/2020/03/16/react-design-ideass/</id>
    <published>2020-03-16T03:24:11.000Z</published>
    <updated>2020-03-16T03:28:38.441Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¯‘è€…åºï¼šæœ¬æ–‡æ˜¯ React æ ¸å¿ƒå¼€å‘è€…ã€æœ‰ React API ç»ˆç»“è€…ä¹‹ç§°çš„ Sebastian MarkbÃ¥ge æ’°å†™ï¼Œé˜è¿°äº†ä»–è®¾è®¡ React çš„åˆè¡·ã€‚é˜…è¯»æ­¤æ–‡ï¼Œä½ èƒ½ç«™åœ¨æ›´é«˜çš„é«˜åº¦æ€è€ƒ React çš„è¿‡å»ã€ç°åœ¨å’Œæœªæ¥ã€‚<br>åŸæ–‡åœ°å€ï¼š<a href="https://github.com/reactjs/react-basic" target="_blank" rel="noopener">https://github.com/reactjs/react-basic</a></p></blockquote><a id="more"></a><p>æˆ‘å†™æ­¤æ–‡æ˜¯æƒ³æ­£å¼åœ°é˜è¿°æˆ‘å¿ƒä¸­ React çš„<a href="http://baike.baidu.com/view/2333986.htm" target="_blank" rel="noopener">å¿ƒæ™ºæ¨¡å‹</a>ã€‚ç›®çš„æ˜¯è§£é‡Šä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼šè¿™æ ·è®¾è®¡ Reactï¼ŒåŒæ—¶ä½ ä¹Ÿå¯ä»¥æ ¹æ®è¿™äº›è®ºç‚¹åæ¨å‡º Reactã€‚</p><p>ä¸å¯å¦è®¤ï¼Œæ­¤æ–‡ä¸­çš„éƒ¨åˆ†è®ºæ®æˆ–å‰æå°šå­˜äº‰è®®ï¼Œè€Œä¸”éƒ¨åˆ†ç¤ºä¾‹çš„è®¾è®¡å¯èƒ½å­˜åœ¨ bug æˆ–ç–å¿½ã€‚è¿™åªæ˜¯æ­£å¼ç¡®å®šå®ƒçš„æœ€åˆé˜¶æ®µã€‚å¦‚æœä½ æœ‰æ›´å¥½çš„å®Œå–„å®ƒçš„æƒ³æ³•å¯ä»¥éšæ—¶æäº¤ pull requestã€‚æœ¬æ–‡ä¸ä¼šä»‹ç»æ¡†æ¶ç»†èŠ‚ä¸­çš„å¥‡æŠ€æ·«å·§ï¼Œç›¸ä¿¡è¿™æ ·èƒ½æçº²æŒˆé¢†ï¼Œè®©ä½ çœ‹æ¸… React ç”±ç®€å•åˆ°å¤æ‚çš„è®¾è®¡è¿‡ç¨‹ã€‚</p><p>React.js çš„çœŸå®å®ç°ä¸­å……æ»¡äº†å…·ä½“é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œæ¸è¿›å¼çš„è§£æ³•ï¼Œç®—æ³•ä¼˜åŒ–ï¼Œå†å²é—ç•™ä»£ç ï¼Œdebug å·¥å…·ä»¥åŠå…¶ä»–ä¸€äº›å¯ä»¥è®©å®ƒçœŸçš„å…·æœ‰é«˜å¯ç”¨æ€§çš„å†…å®¹ã€‚è¿™äº›ä»£ç å¯èƒ½å¹¶ä¸ç¨³å®šï¼Œå› ä¸ºæœªæ¥æµè§ˆå™¨çš„å˜åŒ–å’ŒåŠŸèƒ½æƒé‡çš„å˜åŒ–éšæ—¶é¢ä¸´æ”¹å˜ã€‚æ‰€ä»¥å…·ä½“çš„ä»£ç å¾ˆéš¾å½»åº•è§£é‡Šæ¸…æ¥šã€‚</p><p>æˆ‘åå‘äºé€‰æ‹©ä¸€ç§æˆ‘èƒ½å®Œå…¨ hold ä½çš„ç®€æ´çš„å¿ƒæ™ºæ¨¡å‹æ¥ä½œä»‹ç»ã€‚</p><h2 id="å˜æ¢ï¼ˆTransformationï¼‰"><a href="#å˜æ¢ï¼ˆTransformationï¼‰" class="headerlink" title="å˜æ¢ï¼ˆTransformationï¼‰"></a>å˜æ¢ï¼ˆTransformationï¼‰</h2><p>è®¾è®¡ React çš„æ ¸å¿ƒå‰ææ˜¯è®¤ä¸º UI åªæ˜¯æŠŠæ•°æ®é€šè¿‡æ˜ å°„å…³ç³»å˜æ¢æˆå¦ä¸€ç§å½¢å¼çš„æ•°æ®ã€‚åŒæ ·çš„è¾“å…¥å¿…ä¼šæœ‰åŒæ ·çš„è¾“å‡ºã€‚è¿™æ°å¥½å°±æ˜¯çº¯å‡½æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NameBox</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">fontWeight</span>: <span class="string">"bold"</span>, <span class="attr">labelContent</span>: name &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&apos;Sebastian MarkbÃ¥ge&apos; -&gt;</span><br><span class="line">&#123; fontWeight: &apos;bold&apos;, labelContent: &apos;Sebastian MarkbÃ¥ge&apos; &#125;;</span><br></pre></td></tr></table></figure><h2 id="æŠ½è±¡ï¼ˆAbstractionï¼‰"><a href="#æŠ½è±¡ï¼ˆAbstractionï¼‰" class="headerlink" title="æŠ½è±¡ï¼ˆAbstractionï¼‰"></a>æŠ½è±¡ï¼ˆAbstractionï¼‰</h2><p>ä½ ä¸å¯èƒ½ä»…ç”¨ä¸€ä¸ªå‡½æ•°å°±èƒ½å®ç°å¤æ‚çš„ UIã€‚é‡è¦çš„æ˜¯ï¼Œä½ éœ€è¦æŠŠ UI æŠ½è±¡æˆå¤šä¸ªéšè—å†…éƒ¨ç»†èŠ‚ï¼Œåˆå¯å¤ç”¨çš„å‡½æ•°ã€‚é€šè¿‡åœ¨ä¸€ä¸ªå‡½æ•°ä¸­è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°æ¥å®ç°å¤æ‚çš„ UIï¼Œè¿™å°±æ˜¯æŠ½è±¡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyUserBox</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    borderStyle: <span class="string">"1px solid blue"</span>,</span><br><span class="line">    childContent: [<span class="string">"Name: "</span>, NameBox(user.firstName + <span class="string">" "</span> + user.lastName)]</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123; firstName: &apos;Sebastian&apos;, lastName: &apos;MarkbÃ¥ge&apos; &#125; -&gt;</span><br><span class="line">&#123;</span><br><span class="line">  borderStyle: &apos;1px solid blue&apos;,</span><br><span class="line">  childContent: [</span><br><span class="line">    &apos;Name: &apos;,</span><br><span class="line">    &#123; fontWeight: &apos;bold&apos;, labelContent: &apos;Sebastian MarkbÃ¥ge&apos; &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="ç»„åˆï¼ˆCompositionï¼‰"><a href="#ç»„åˆï¼ˆCompositionï¼‰" class="headerlink" title="ç»„åˆï¼ˆCompositionï¼‰"></a>ç»„åˆï¼ˆCompositionï¼‰</h2><p>ä¸ºäº†çœŸæ­£è¾¾åˆ°é‡ç”¨çš„ç‰¹æ€§ï¼Œåªé‡ç”¨å¶å­ç„¶åæ¯æ¬¡éƒ½ä¸ºä»–ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨æ˜¯ä¸å¤Ÿçš„ã€‚ä½ è¿˜éœ€è¦å¯ä»¥åŒ…å«å…¶ä»–æŠ½è±¡çš„å®¹å™¨å†æ¬¡è¿›è¡Œç»„åˆã€‚æˆ‘ç†è§£çš„â€œç»„åˆâ€å°±æ˜¯å°†ä¸¤ä¸ªæˆ–è€…å¤šä¸ªä¸åŒçš„æŠ½è±¡åˆå¹¶ä¸ºä¸€ä¸ªã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBox</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    borderStyle: <span class="string">"1px solid blue"</span>,</span><br><span class="line">    children: children</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserBox</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox([<span class="string">"Name: "</span>, NameBox(user.firstName + <span class="string">" "</span> + user.lastName)]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çŠ¶æ€ï¼ˆStateï¼‰"><a href="#çŠ¶æ€ï¼ˆStateï¼‰" class="headerlink" title="çŠ¶æ€ï¼ˆStateï¼‰"></a>çŠ¶æ€ï¼ˆStateï¼‰</h2><p>UI ä¸å•å•æ˜¯å¯¹æœåŠ¡å™¨ç«¯æˆ–ä¸šåŠ¡é€»è¾‘çŠ¶æ€çš„å¤åˆ¶ã€‚å®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šçŠ¶æ€æ˜¯é’ˆå¯¹å…·ä½“çš„æ¸²æŸ“ç›®æ ‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä¸€ä¸ª text field ä¸­æ‰“å­—ã€‚å®ƒä¸ä¸€å®šè¦å¤åˆ¶åˆ°å…¶ä»–é¡µé¢æˆ–è€…ä½ çš„æ‰‹æœºè®¾å¤‡ã€‚æ»šåŠ¨ä½ç½®è¿™ä¸ªçŠ¶æ€æ˜¯ä¸€ä¸ªå…¸å‹çš„ä½ å‡ ä¹ä¸ä¼šå¤åˆ¶åˆ°å¤šä¸ªæ¸²æŸ“ç›®æ ‡çš„ã€‚</p><p>æˆ‘ä»¬å€¾å‘äºä½¿ç”¨ä¸å¯å˜çš„æ•°æ®æ¨¡å‹ã€‚æˆ‘ä»¬æŠŠå¯ä»¥æ”¹å˜ state çš„å‡½æ•°ä¸²è”èµ·æ¥ä½œä¸ºåŸç‚¹æ”¾ç½®åœ¨é¡¶å±‚ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyNameBox</span>(<span class="params">user, likes, onClick</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox([</span><br><span class="line">    <span class="string">"Name: "</span>,</span><br><span class="line">    NameBox(user.firstName + <span class="string">" "</span> + user.lastName),</span><br><span class="line">    <span class="string">"Likes: "</span>,</span><br><span class="line">    LikeBox(likes),</span><br><span class="line">    LikeButton(onClick)</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç°ç»†èŠ‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> likes = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addOneMoreLike</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  likes++;</span><br><span class="line">  rerender();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">FancyNameBox(</span><br><span class="line">  &#123; <span class="attr">firstName</span>: <span class="string">"Sebastian"</span>, <span class="attr">lastName</span>: <span class="string">"MarkbÃ¥ge"</span> &#125;,</span><br><span class="line">  likes,</span><br><span class="line">  addOneMoreLike</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><em>æ³¨æ„ï¼šæœ¬ä¾‹æ›´æ–°çŠ¶æ€æ—¶ä¼šå¸¦æ¥å‰¯ä½œç”¨ï¼ˆaddOneMoreLike å‡½æ•°ä¸­ï¼‰ã€‚æˆ‘å®é™…çš„æƒ³æ³•æ˜¯å½“ä¸€ä¸ªâ€œupdateâ€ä¼ å…¥æ—¶æˆ‘ä»¬è¿”å›ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„çŠ¶æ€ï¼Œä½†é‚£æ ·ä¼šæ¯”è¾ƒå¤æ‚ã€‚æ­¤ç¤ºä¾‹å¾…æ›´æ–°</em></p><h2 id="Memoization"><a href="#Memoization" class="headerlink" title="Memoization"></a>Memoization</h2><p>å¯¹äºçº¯å‡½æ•°ï¼Œä½¿ç”¨ç›¸åŒçš„å‚æ•°ä¸€æ¬¡æ¬¡è°ƒç”¨æœªå…å¤ªæµªè´¹èµ„æºã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°çš„ memorized ç‰ˆæœ¬ï¼Œç”¨æ¥è¿½è¸ªæœ€åä¸€ä¸ªå‚æ•°å’Œç»“æœã€‚è¿™æ ·å¦‚æœæˆ‘ä»¬ç»§ç»­ä½¿ç”¨åŒæ ·çš„å€¼ï¼Œå°±ä¸éœ€è¦åå¤æ‰§è¡Œå®ƒäº†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">memoize</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cachedArg;</span><br><span class="line">  <span class="keyword">var</span> cachedResult;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cachedArg === arg) &#123;</span><br><span class="line">      <span class="keyword">return</span> cachedResult;</span><br><span class="line">    &#125;</span><br><span class="line">    cachedArg = arg;</span><br><span class="line">    cachedResult = fn(arg);</span><br><span class="line">    <span class="keyword">return</span> cachedResult;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> MemoizedNameBox = memoize(NameBox);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NameAndAgeBox</span>(<span class="params">user, currentTime</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox([</span><br><span class="line">    <span class="string">"Name: "</span>,</span><br><span class="line">    MemoizedNameBox(user.firstName + <span class="string">" "</span> + user.lastName),</span><br><span class="line">    <span class="string">"Age in milliseconds: "</span>,</span><br><span class="line">    currentTime - user.dateOfBirth</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ—è¡¨ï¼ˆListsï¼‰"><a href="#åˆ—è¡¨ï¼ˆListsï¼‰" class="headerlink" title="åˆ—è¡¨ï¼ˆListsï¼‰"></a>åˆ—è¡¨ï¼ˆListsï¼‰</h2><p>å¤§éƒ¨åˆ† UI éƒ½æ˜¯å±•ç¤ºåˆ—è¡¨æ•°æ®ä¸­ä¸åŒ item çš„åˆ—è¡¨ç»“æ„ã€‚è¿™æ˜¯ä¸€ä¸ªå¤©ç„¶çš„å±‚çº§ã€‚</p><p>ä¸ºäº†ç®¡ç†åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ª item çš„ state ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›é€ ä¸€ä¸ª Map å®¹çº³å…·ä½“ item çš„ stateã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserList</span>(<span class="params">users, likesPerUser, updateUserLikes</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> users.map(<span class="function"><span class="params">user</span> =&gt;</span></span><br><span class="line">    FancyNameBox(user, likesPerUser.get(user.id), () =&gt;</span><br><span class="line">      updateUserLikes(user.id, likesPerUser.get(user.id) + <span class="number">1</span>)</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> likesPerUser = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateUserLikes</span>(<span class="params">id, likeCount</span>) </span>&#123;</span><br><span class="line">  likesPerUser.set(id, likeCount);</span><br><span class="line">  rerender();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">UserList(data.users, likesPerUser, updateUserLikes);</span><br></pre></td></tr></table></figure><p><em>æ³¨æ„ï¼šç°åœ¨æˆ‘ä»¬å‘ FancyNameBox ä¼ äº†å¤šä¸ªä¸åŒçš„å‚æ•°ã€‚è¿™æ‰“ç ´äº†æˆ‘ä»¬çš„ memoization å› ä¸ºæˆ‘ä»¬æ¯æ¬¡åªèƒ½å­˜å‚¨ä¸€ä¸ªå€¼ã€‚æ›´å¤šç›¸å…³å†…å®¹åœ¨ä¸‹é¢ã€‚</em></p><h2 id="è¿ç»­æ€§ï¼ˆContinuationsï¼‰"><a href="#è¿ç»­æ€§ï¼ˆContinuationsï¼‰" class="headerlink" title="è¿ç»­æ€§ï¼ˆContinuationsï¼‰"></a>è¿ç»­æ€§ï¼ˆContinuationsï¼‰</h2><p>ä¸å¹¸çš„æ˜¯ï¼Œè‡ªä» UI ä¸­æœ‰å¤ªå¤šçš„åˆ—è¡¨ï¼Œæ˜ç¡®çš„ç®¡ç†å°±éœ€è¦å¤§é‡çš„é‡å¤æ€§æ ·æ¿ä»£ç ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¨è¿Ÿä¸€äº›å‡½æ•°çš„æ‰§è¡Œï¼Œè¿›è€ŒæŠŠä¸€äº›æ¨¡æ¿ç§»å‡ºä¸šåŠ¡é€»è¾‘ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨â€œæŸ¯é‡ŒåŒ–â€ï¼ˆJavaScript ä¸­çš„ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" target="_blank" rel="noopener"><code>bind</code></a>ï¼‰ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ä»æ ¸å¿ƒçš„å‡½æ•°å¤–é¢ä¼ é€’ stateï¼Œè¿™æ ·å°±æ²¡æœ‰æ ·æ¿ä»£ç äº†ã€‚</p><p>ä¸‹é¢è¿™æ ·å¹¶æ²¡æœ‰å‡å°‘æ ·æ¿ä»£ç ï¼Œä½†è‡³å°‘æŠŠå®ƒä»å…³é”®ä¸šåŠ¡é€»è¾‘ä¸­å‰¥ç¦»ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyUserList</span>(<span class="params">users</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox(UserList.bind(<span class="literal">null</span>, users));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> box = FancyUserList(data.users);</span><br><span class="line"><span class="keyword">const</span> resolvedChildren = box.children(likesPerUser, updateUserLikes);</span><br><span class="line"><span class="keyword">const</span> resolvedBox = &#123;</span><br><span class="line">  ...box,</span><br><span class="line">  children: resolvedChildren</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="State-Map"><a href="#State-Map" class="headerlink" title="State Map"></a>State Map</h2><p>ä¹‹å‰æˆ‘ä»¬çŸ¥é“å¯ä»¥ä½¿ç”¨ç»„åˆé¿å…é‡å¤æ‰§è¡Œç›¸åŒçš„ä¸œè¥¿è¿™æ ·ä¸€ç§é‡å¤æ¨¡å¼ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ‰§è¡Œå’Œä¼ é€’ state é€»è¾‘æŒªåŠ¨åˆ°è¢«å¤ç”¨å¾ˆå¤šçš„ä½å±‚çº§çš„å‡½æ•°ä¸­å»ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBoxWithState</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  children,</span></span></span><br><span class="line"><span class="function"><span class="params">  stateMap,</span></span></span><br><span class="line"><span class="function"><span class="params">  updateState</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox(</span><br><span class="line">    children.map(<span class="function"><span class="params">child</span> =&gt;</span> child.continuation(</span><br><span class="line">      stateMap.get(child.key),</span><br><span class="line">      updateState</span><br><span class="line">    ))</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserList</span>(<span class="params">users</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> users.map(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">    continuation: FancyNameBox.bind(<span class="literal">null</span>, user),</span><br><span class="line">    key: user.id</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyUserList</span>(<span class="params">users</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBoxWithState.bind(<span class="literal">null</span>,</span><br><span class="line">    UserList(users)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> continuation = FancyUserList(data.users);</span><br><span class="line">continuation(likesPerUser, updateUserLikes);</span><br></pre></td></tr></table></figure><h2 id="Memoization-Map"><a href="#Memoization-Map" class="headerlink" title="Memoization Map"></a>Memoization Map</h2><p>ä¸€æ—¦æˆ‘ä»¬æƒ³åœ¨ä¸€ä¸ª memoization åˆ—è¡¨ä¸­ memoize å¤šä¸ª item å°±ä¼šå˜å¾—å¾ˆå›°éš¾ã€‚å› ä¸ºä½ éœ€è¦åˆ¶å®šå¤æ‚çš„ç¼“å­˜ç®—æ³•æ¥å¹³è¡¡è°ƒç”¨é¢‘ç‡å’Œå†…å­˜å æœ‰ç‡ã€‚</p><p>è¿˜å¥½ UI åœ¨åŒä¸€ä¸ªä½ç½®ä¼šç›¸å¯¹çš„ç¨³å®šã€‚ç›¸åŒçš„ä½ç½®ä¸€èˆ¬æ¯æ¬¡éƒ½ä¼šæ¥å—ç›¸åŒçš„å‚æ•°ã€‚è¿™æ ·ä»¥æ¥ï¼Œä½¿ç”¨ä¸€ä¸ªé›†åˆæ¥åš memoization æ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ç­–ç•¥ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨å¯¹å¾… state åŒæ ·çš„æ–¹å¼ï¼Œåœ¨ç»„åˆçš„å‡½æ•°ä¸­ä¼ é€’ä¸€ä¸ª memoization ç¼“å­˜ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">memoize</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">arg, memoizationCache</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (memoizationCache.arg === arg) &#123;</span><br><span class="line">      <span class="keyword">return</span> memoizationCache.result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> result = fn(arg);</span><br><span class="line">    memoizationCache.arg = arg;</span><br><span class="line">    memoizationCache.result = result;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBoxWithState</span>(<span class="params">children, stateMap, updateState, memoizationCache</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox(</span><br><span class="line">    children.map(<span class="function"><span class="params">child</span> =&gt;</span></span><br><span class="line">      child.continuation(</span><br><span class="line">        stateMap.get(child.key),</span><br><span class="line">        updateState,</span><br><span class="line">        memoizationCache.get(child.key)</span><br><span class="line">      )</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MemoizedFancyNameBox = memoize(FancyNameBox);</span><br></pre></td></tr></table></figure><h2 id="ä»£æ•°æ•ˆåº”ï¼ˆAlgebraic-Effectsï¼‰"><a href="#ä»£æ•°æ•ˆåº”ï¼ˆAlgebraic-Effectsï¼‰" class="headerlink" title="ä»£æ•°æ•ˆåº”ï¼ˆAlgebraic Effectsï¼‰"></a>ä»£æ•°æ•ˆåº”ï¼ˆAlgebraic Effectsï¼‰</h2><p>å¤šå±‚æŠ½è±¡éœ€è¦å…±äº«çç¢æ•°æ®æ—¶ï¼Œä¸€å±‚å±‚ä¼ é€’æ•°æ®éå¸¸éº»çƒ¦ã€‚å¦‚æœèƒ½æœ‰ä¸€ç§æ–¹å¼å¯ä»¥åœ¨å¤šå±‚æŠ½è±¡ä¸­å¿«æ·åœ°ä¼ é€’æ•°æ®ï¼ŒåŒæ—¶åˆä¸éœ€è¦ç‰µæ¶‰åˆ°ä¸­é—´å±‚çº§ï¼Œé‚£è¯¥æœ‰å¤šå¥½ã€‚React ä¸­æˆ‘ä»¬æŠŠå®ƒå«åšâ€œcontextâ€ã€‚</p><p>æœ‰æ—¶å€™æ•°æ®ä¾èµ–å¹¶ä¸æ˜¯ä¸¥æ ¼æŒ‰ç…§æŠ½è±¡æ ‘è‡ªä¸Šè€Œä¸‹è¿›è¡Œã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨å¸ƒå±€ç®—æ³•ä¸­ï¼Œä½ éœ€è¦åœ¨å®ç°ä»–ä»¬çš„ä½ç½®ä¹‹å‰äº†è§£å­èŠ‚ç‚¹çš„å¤§å°ã€‚</p><p>ç°åœ¨ï¼Œè¿™ä¸ªä¾‹å­æœ‰ä¸€ç‚¹è¶…çº²ã€‚æˆ‘ä¼šä½¿ç”¨ <a href="http://math.andrej.com/eff/" target="_blank" rel="noopener">ä»£æ•°æ•ˆåº”</a> è¿™ä¸ªç”±æˆ‘å‘èµ·çš„ <a href="https://esdiscuss.org/topic/one-shot-delimited-continuations-with-effect-handlers" target="_blank" rel="noopener">ECMAScript æ–°ç‰¹æ€§æè®®</a>ã€‚å¦‚æœä½ å¯¹å‡½æ•°å¼ç¼–ç¨‹å¾ˆç†Ÿæ‚‰ï¼Œå®ƒä»¬ åœ¨é¿å…ç”± monad å¼ºåˆ¶å¼•å…¥çš„ä»ªå¼ä¸€æ ·çš„ç¼–ç ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ThemeBorderColorRequest</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBox</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> color = raise <span class="keyword">new</span> ThemeBorderColorRequest();</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    borderWidth: <span class="string">'1px'</span>,</span><br><span class="line">    borderColor: color,</span><br><span class="line">    children: children</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BlueTheme</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">try</span> &#123;</span><br><span class="line">    children();</span><br><span class="line">  &#125; <span class="keyword">catch</span> effect ThemeBorderColorRequest -&gt; [, continuation] &#123;</span><br><span class="line">    continuation(<span class="string">'blue'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> BlueTheme(</span><br><span class="line">    FancyUserList.bind(<span class="literal">null</span>, data.users)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸæ–‡åœ°å€ï¼š<a href="https://github.com/react-guide/react-basic" target="_blank" rel="noopener">React è®¾è®¡æ€æƒ³</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;è¯‘è€…åºï¼šæœ¬æ–‡æ˜¯ React æ ¸å¿ƒå¼€å‘è€…ã€æœ‰ React API ç»ˆç»“è€…ä¹‹ç§°çš„ Sebastian MarkbÃ¥ge æ’°å†™ï¼Œé˜è¿°äº†ä»–è®¾è®¡ React çš„åˆè¡·ã€‚é˜…è¯»æ­¤æ–‡ï¼Œä½ èƒ½ç«™åœ¨æ›´é«˜çš„é«˜åº¦æ€è€ƒ React çš„è¿‡å»ã€ç°åœ¨å’Œæœªæ¥ã€‚&lt;br&gt;åŸæ–‡åœ°å€ï¼š&lt;a href=&quot;https://github.com/reactjs/react-basic&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/reactjs/react-basic&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="å‰ç«¯æ¡†æ¶" scheme="http://yangtao.site/categories/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="react" scheme="http://yangtao.site/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>Gulp è‡ªåŠ¨åŒ–æ„å»º</title>
    <link href="http://yangtao.site/2020/03/14/gulp-v4/"/>
    <id>http://yangtao.site/2020/03/14/gulp-v4/</id>
    <published>2020-03-14T04:18:36.000Z</published>
    <updated>2020-03-14T04:25:07.814Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Gulp è‡ªåŠ¨åŒ–æ„å»ºçš„ä¸€äº›è¿‡ç¨‹ï¼Œä»¥åŠå…¶ä»–æ’ä»¶çš„ç»“åˆä½¿ç”¨ç­‰</p></blockquote><a id="more"></a><h2 id="èµ·æ­¥"><a href="#èµ·æ­¥" class="headerlink" title="èµ·æ­¥"></a>èµ·æ­¥</h2><ul><li><a href="https://www.gulpjs.com.cn/docs/getting-started/quick-start/" target="_blank" rel="noopener">Gulp å¿«é€Ÿå…¥é—¨æŒ‡å—</a></li><li><a href="https://github.com/yangtao2o/gulp-project/tree/master/src/mygulp" target="_blank" rel="noopener">Github Demo</a></li></ul><h3 id="å¯¼å‡º"><a href="#å¯¼å‡º" class="headerlink" title="å¯¼å‡º"></a>å¯¼å‡º</h3><p>é¡¹ç›®æ ¹ç›®å½•åˆ›å»º<code>gulpfile.js</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defaultTask</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"success"</span>);</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = defaultTask;</span><br></pre></td></tr></table></figure><p>gulp å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">âœ  gulp-project git:(master) âœ— gulp</span><br><span class="line">[17:06:29] Using gulpfile ~/Documents/GitHub/gulp-project/gulpfile.js</span><br><span class="line">[17:06:29] Starting <span class="string">'default'</span>...</span><br><span class="line">success</span><br><span class="line">[17:06:29] Finished <span class="string">'default'</span> after 2.67 ms</span><br></pre></td></tr></table></figure><h3 id="Gulpfile-åˆ†å‰²"><a href="#Gulpfile-åˆ†å‰²" class="headerlink" title="Gulpfile åˆ†å‰²"></a>Gulpfile åˆ†å‰²</h3><blockquote><p>Node çš„æ¨¡å—è§£æåŠŸèƒ½å…è®¸ä½ å°† gulpfile.jsâ€™ æ–‡ä»¶æ›¿æ¢ä¸ºåŒæ ·å‘½åä¸º gulpfile.js çš„ç›®å½•ï¼Œè¯¥ç›®å½•ä¸­åŒ…å«äº†ä¸€ä¸ªåä¸º index.js çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è¢«å½“ä½œ gulpfile.js ä½¿ç”¨ã€‚å¹¶ä¸”ï¼Œè¯¥ç›®å½•ä¸­è¿˜å¯ä»¥åŒ…å«å„ä¸ªç‹¬ç«‹çš„ä»»åŠ¡ï¼ˆtaskï¼‰æ¨¡å—ã€‚ â€” å®˜æ–¹æ–‡æ¡£</p></blockquote><p>åˆ›å»º <code>gulpfile.js</code>ç›®å½•ï¼Œ<code>gulpfile.js</code>ç›®å½•ä¸‹æ–°å»º <code>index.js</code></p><h3 id="ç»„åˆä»»åŠ¡"><a href="#ç»„åˆä»»åŠ¡" class="headerlink" title="ç»„åˆä»»åŠ¡"></a>ç»„åˆä»»åŠ¡</h3><ul><li>series() å…è®¸å°†å¤šä¸ªç‹¬ç«‹çš„ä»»åŠ¡ç»„åˆä¸ºä¸€ä¸ªæ›´å¤§çš„æ“ä½œ</li><li>å¯¹äºå¸Œæœ›ä»¥æœ€å¤§å¹¶å‘æ¥è¿è¡Œçš„ä»»åŠ¡ï¼ˆtasksï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ parallel() æ–¹æ³•å°†å®ƒä»¬ç»„åˆèµ·æ¥</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; series, parallel &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clean</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cssTranspile</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cssMinify</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsTranspile</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsBundle</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsMinify</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">publish</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">build</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = series(</span><br><span class="line">  clean,</span><br><span class="line">  parallel(cssTranspile, series(jsTranspile, jsBundle)),</span><br><span class="line">  parallel(cssMinify, jsMinify),</span><br><span class="line">  publish</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[16:50:36] Starting <span class="string">'default'</span>...</span><br><span class="line">[16:50:36] Starting <span class="string">'clean'</span>...</span><br><span class="line">[16:50:36] Finished <span class="string">'clean'</span> after 606 Î¼s</span><br><span class="line">[16:50:36] Starting <span class="string">'cssTranspile'</span>...</span><br><span class="line">[16:50:36] Finished <span class="string">'cssTranspile'</span> after 199 Î¼s</span><br><span class="line">[16:50:36] Starting <span class="string">'jsTranspile'</span>...</span><br><span class="line">[16:50:36] Finished <span class="string">'jsTranspile'</span> after 131 Î¼s</span><br><span class="line">[16:50:36] Starting <span class="string">'jsBundle'</span>...</span><br><span class="line">[16:50:36] Finished <span class="string">'jsBundle'</span> after 125 Î¼s</span><br><span class="line">[16:50:36] Starting <span class="string">'cssMinify'</span>...</span><br><span class="line">[16:50:36] Starting <span class="string">'jsMinify'</span>...</span><br><span class="line">[16:50:36] Finished <span class="string">'cssMinify'</span> after 183 Î¼s</span><br><span class="line">[16:50:36] Finished <span class="string">'jsMinify'</span> after 218 Î¼s</span><br><span class="line">[16:50:36] Starting <span class="string">'publish'</span>...</span><br><span class="line">[16:50:36] Finished <span class="string">'publish'</span> after 115 Î¼s</span><br><span class="line">[16:50:36] Finished <span class="string">'default'</span> after 4.55 ms</span><br></pre></td></tr></table></figure><p>å½“ä¸€ä¸ªç»„åˆæ“ä½œæ‰§è¡Œæ—¶ï¼Œè¿™ä¸ªç»„åˆä¸­çš„æ¯ä¸€ä¸ªä»»åŠ¡æ¯æ¬¡è¢«è°ƒç”¨æ—¶éƒ½ä¼šè¢«æ‰§è¡Œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This is INCORRECT</span></span><br><span class="line"><span class="keyword">const</span> &#123; series, parallel &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clean = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> css = series(clean, <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> javascript = series(clean, <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">exports.default = parallel(css, javascript);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[17:02:45] Starting <span class="string">'default'</span>...</span><br><span class="line">[17:02:45] Starting <span class="string">'clean'</span>...</span><br><span class="line">[17:02:45] Starting <span class="string">'clean'</span>...</span><br><span class="line">[17:02:45] Finished <span class="string">'clean'</span> after 850 Î¼s</span><br><span class="line">[17:02:45] Starting <span class="string">'&lt;anonymous&gt;'</span>...</span><br><span class="line">[17:02:45] Finished <span class="string">'clean'</span> after 2.04 ms</span><br><span class="line">[17:02:45] Starting <span class="string">'&lt;anonymous&gt;'</span>...</span><br><span class="line">[17:02:45] Finished <span class="string">'&lt;anonymous&gt;'</span> after 563 Î¼s</span><br><span class="line">[17:02:45] Finished <span class="string">'&lt;anonymous&gt;'</span> after 438 Î¼s</span><br><span class="line">[17:02:45] Finished <span class="string">'default'</span> after 7.67 ms</span><br></pre></td></tr></table></figure><p>é‡æ„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This is INCORRECT</span></span><br><span class="line"><span class="keyword">const</span> &#123; series, parallel &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clean = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> css = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> javascript = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.default = series(clean, parallel(css, javascript));</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[17:04:48] Starting <span class="string">'default'</span>...</span><br><span class="line">[17:04:48] Starting <span class="string">'clean'</span>...</span><br><span class="line">[17:04:48] Finished <span class="string">'clean'</span> after 546 Î¼s</span><br><span class="line">[17:04:48] Starting <span class="string">'css'</span>...</span><br><span class="line">[17:04:48] Starting <span class="string">'javascript'</span>...</span><br><span class="line">[17:04:48] Finished <span class="string">'css'</span> after 242 Î¼s</span><br><span class="line">[17:04:48] Finished <span class="string">'javascript'</span> after 285 Î¼s</span><br><span class="line">[17:04:48] Finished <span class="string">'default'</span> after 3.4 ms</span><br></pre></td></tr></table></figure><h3 id="å¼‚æ­¥æ‰§è¡Œ"><a href="#å¼‚æ­¥æ‰§è¡Œ" class="headerlink" title="å¼‚æ­¥æ‰§è¡Œ"></a>å¼‚æ­¥æ‰§è¡Œ</h3><blockquote><p>Node åº“ä»¥å¤šç§æ–¹å¼å¤„ç†å¼‚æ­¥åŠŸèƒ½ã€‚æœ€å¸¸è§çš„æ¨¡å¼æ˜¯ error-first callbacksï¼Œä½†æ˜¯ä½ è¿˜å¯èƒ½ä¼šé‡åˆ° streamsã€promisesã€event emittersã€child processes, æˆ– observablesã€‚gulp ä»»åŠ¡ï¼ˆtaskï¼‰è§„èŒƒåŒ–äº†æ‰€æœ‰è¿™äº›ç±»å‹çš„å¼‚æ­¥åŠŸèƒ½ã€‚ â€” å®˜æ–¹æ–‡æ¡£</p></blockquote><ul><li>è¿”å› stream</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">streamTask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> src(<span class="string">"*.js"</span>).pipe(dest(<span class="string">"output"</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = streamTask;</span><br></pre></td></tr></table></figure><p>ç„¶åå‘ç°ï¼Œæ ¹ç›®å½•ä¸‹ä¼šçœ‹åˆ° output ç›®å½•ï¼ŒåŠæ ¹ç›®å½•ä¸‹æ‰€æœ‰ä»¥ <code>*js</code>ç»“å°¾çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬ç›®å½•ã€‚</p><ul><li>è¿”å› promise</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">promiseTask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(<span class="string">"the value is ignored"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = promiseTask;</span><br></pre></td></tr></table></figure><h3 id="è¿”å›-event-emitter"><a href="#è¿”å›-event-emitter" class="headerlink" title="è¿”å› event emitter"></a>è¿”å› event emitter</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; EventEmitter &#125; = <span class="built_in">require</span>(<span class="string">"events"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">eventEmitterTask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> emitter = <span class="keyword">new</span> EventEmitter();</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> emitter.emit(<span class="string">"finish"</span>), <span class="number">250</span>);</span><br><span class="line">  <span class="keyword">return</span> emitter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = eventEmitterTask;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-callback"><a href="#ä½¿ç”¨-callback" class="headerlink" title="ä½¿ç”¨ callback"></a>ä½¿ç”¨ callback</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callbackTask</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// `cb()` should be called by some async work</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = callbackTask;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-async-await"><a href="#ä½¿ç”¨-async-await" class="headerlink" title="ä½¿ç”¨ async/await"></a>ä½¿ç”¨ async/await</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncAwaitTask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; version &#125; = fs.readFileSync(<span class="string">"package.json"</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"version"</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">Promise</span>.resolve(<span class="string">"some result"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = asyncAwaitTask;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ’ä»¶"><a href="#ä½¿ç”¨æ’ä»¶" class="headerlink" title="ä½¿ç”¨æ’ä»¶"></a>ä½¿ç”¨æ’ä»¶</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"><span class="keyword">const</span> uglify = <span class="built_in">require</span>(<span class="string">"gulp-uglify"</span>);</span><br><span class="line"><span class="keyword">const</span> rename = <span class="built_in">require</span>(<span class="string">"gulp-rename"</span>);</span><br><span class="line"></span><br><span class="line">exports.default = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> src(<span class="string">"src/assets/**/*.js"</span>)</span><br><span class="line">    .pipe(uglify())</span><br><span class="line">    .pipe(rename(&#123; <span class="attr">extname</span>: <span class="string">".min.js"</span> &#125;))</span><br><span class="line">    .pipe(dest(<span class="string">"output/"</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="browsersync"><a href="#browsersync" class="headerlink" title="browsersync"></a>browsersync</h3><ul><li><a href="http://www.browsersync.cn/docs/gulp/#gulp-install" target="_blank" rel="noopener">Browsersync + Gulp.js</a></li></ul><p>ä¸‹è½½ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install browser-sync gulp --save-dev</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; task, watch &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"><span class="keyword">const</span> browserSync = <span class="built_in">require</span>(<span class="string">"browser-sync"</span>).create();</span><br><span class="line"><span class="keyword">const</span> reload = browserSync.reload;</span><br><span class="line"><span class="keyword">const</span> serve = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  browserSync.init(&#123;</span><br><span class="line">    server: &#123;</span><br><span class="line">      baseDir: <span class="string">"./src"</span>,</span><br><span class="line">      https: <span class="literal">true</span>,</span><br><span class="line">      directory: <span class="literal">true</span> <span class="comment">//ä»ä¸ç›®å½•åˆ—è¡¨çš„åº”ç”¨ç¨‹åºç›®å½•ä¸­çš„æ–‡ä»¶å³æˆ</span></span><br><span class="line">      <span class="comment">// index: "index.html"  //ä»åº”ç”¨ç¨‹åºç›®å½•ä¸­æä¾›æ–‡ä»¶ï¼ŒæŒ‡å®šç‰¹å®šæ–‡ä»¶åä¸ºç´¢å¼•</span></span><br><span class="line">    &#125;,</span><br><span class="line">    port: <span class="number">8080</span>,</span><br><span class="line">    notify: <span class="literal">false</span> <span class="comment">// å¼€å¯é™é»˜æ¨¡å¼</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  watch(<span class="string">"src/*.html"</span>).on(<span class="string">"change"</span>, reload);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">task(serve);</span><br></pre></td></tr></table></figure><p>æœ¬åœ°ä½¿ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest, watch, series, parallel &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"><span class="keyword">const</span> uglify = <span class="built_in">require</span>(<span class="string">"gulp-uglify"</span>);</span><br><span class="line"><span class="keyword">const</span> rename = <span class="built_in">require</span>(<span class="string">"gulp-rename"</span>);</span><br><span class="line"><span class="keyword">const</span> browserSync = <span class="built_in">require</span>(<span class="string">"browser-sync"</span>).create();</span><br><span class="line"><span class="keyword">const</span> reload = browserSync.reload;</span><br><span class="line"><span class="keyword">const</span> jsWatcher = watch(<span class="string">"src/**/*.js"</span>);</span><br><span class="line"><span class="keyword">const</span> cssWatcher = watch(<span class="string">"src/**/*.css"</span>);</span><br><span class="line"><span class="keyword">const</span> htmlWatcher = watch(<span class="string">"src/**/*.html"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clean = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> css = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> javascript = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// body omitted</span></span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serve = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  browserSync.init(&#123;</span><br><span class="line">    server: &#123;</span><br><span class="line">      baseDir: <span class="string">"./src"</span>,</span><br><span class="line">      <span class="comment">// https: true,</span></span><br><span class="line">      directory: <span class="literal">true</span> <span class="comment">//ä»ä¸ç›®å½•åˆ—è¡¨çš„åº”ç”¨ç¨‹åºç›®å½•ä¸­çš„æ–‡ä»¶å³æˆï¼Œå¦‚æœè¦æŒ‡å®šæ–‡ä»¶ï¼Œå¯æ³¨é‡Šæ‰</span></span><br><span class="line">      <span class="comment">// index: "index.html"  //ä»åº”ç”¨ç¨‹åºç›®å½•ä¸­æä¾›æ–‡ä»¶ï¼ŒæŒ‡å®šç‰¹å®šæ–‡ä»¶åä¸ºç´¢å¼•</span></span><br><span class="line">    &#125;,</span><br><span class="line">    port: <span class="number">8080</span>,</span><br><span class="line">    notify: <span class="literal">false</span> <span class="comment">// å¼€å¯é™é»˜æ¨¡å¼</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬ globs å¹¶åœ¨å‘ç”Ÿæ›´æ”¹æ—¶è¿è¡Œä»»åŠ¡</span></span><br><span class="line">jsWatcher.on(<span class="string">"change"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">path, stats</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`File <span class="subst">$&#123;path&#125;</span> was changed`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">cssWatcher.on(<span class="string">"change"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">path, stats</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`File <span class="subst">$&#123;path&#125;</span> was changed`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">htmlWatcher.on(<span class="string">"change"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">path, stats</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`File <span class="subst">$&#123;path&#125;</span> was changed`</span>);</span><br><span class="line">  reload(); <span class="comment">// Reloading Browsers</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">exports.build = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> src(<span class="string">"src/assets/**/*.js"</span>)</span><br><span class="line">    .pipe(uglify())</span><br><span class="line">    .pipe(rename(&#123; <span class="attr">extname</span>: <span class="string">".min.js"</span> &#125;))</span><br><span class="line">    .pipe(dest(<span class="string">"output/"</span>));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.serve = serve;</span><br><span class="line"></span><br><span class="line">exports.default = series(clean, parallel(css, javascript));</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨æ ¹ç›®å½•ä¸‹çš„<code>package.json</code>ï¼Œä¿®æ”¹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "dev": "gulp",</span><br><span class="line">  "build": "gulp build",</span><br><span class="line">  "serve": "gulp serve"</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure><h2 id="Gulp-SASS"><a href="#Gulp-SASS" class="headerlink" title="Gulp + SASS"></a>Gulp + SASS</h2><p>-<a href="https://www.sass.hk/install/" target="_blank" rel="noopener">å¦‚ä½•å®‰è£… Sass</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install node-sass gulp-sass --save-dev</span><br></pre></td></tr></table></figure><p><code>gulpfile.js</code> æ–‡ä»¶ä¸»è¦é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest, watch &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"><span class="keyword">const</span> sass = <span class="built_in">require</span>(<span class="string">"gulp-sass"</span>);</span><br><span class="line">sass.compiler = <span class="built_in">require</span>(<span class="string">"node-sass"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scss</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> src(scssGlobSrc)</span><br><span class="line">    .pipe(sass(&#123; <span class="attr">outputStyle</span>: <span class="string">"expanded"</span> &#125;).on(<span class="string">"error"</span>, sass.logError))</span><br><span class="line">    .pipe(dest(<span class="string">"dist/sass"</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.scss = scss;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ï¼š<code>gulp scss</code>ã€‚</p><h2 id="Gulp-Browsersync"><a href="#Gulp-Browsersync" class="headerlink" title="Gulp + Browsersync"></a>Gulp + Browsersync</h2><ul><li><a href="http://www.browsersync.cn/docs/gulp/" target="_blank" rel="noopener">Browsersync + Gulp.js</a></li></ul><p>ä¸‹è½½ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install browser-sync gulp --save-dev</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; task, watch &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"><span class="keyword">const</span> browserSync = <span class="built_in">require</span>(<span class="string">"browser-sync"</span>).create();</span><br><span class="line"><span class="keyword">const</span> reload = browserSync.reload;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serve = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  browserSync.init(&#123;</span><br><span class="line">    server: &#123;</span><br><span class="line">      baseDir: <span class="string">"./src"</span>,</span><br><span class="line">      https: <span class="literal">true</span>,</span><br><span class="line">      directory: <span class="literal">true</span> <span class="comment">//ä»ä¸ç›®å½•åˆ—è¡¨çš„åº”ç”¨ç¨‹åºç›®å½•ä¸­çš„æ–‡ä»¶å³æˆ</span></span><br><span class="line">      <span class="comment">// index: "index.html"  //ä»åº”ç”¨ç¨‹åºç›®å½•ä¸­æä¾›æ–‡ä»¶ï¼ŒæŒ‡å®šç‰¹å®šæ–‡ä»¶åä¸ºç´¢å¼•</span></span><br><span class="line">    &#125;,</span><br><span class="line">    port: <span class="number">8080</span>,</span><br><span class="line">    notify: <span class="literal">false</span> <span class="comment">// å¼€å¯é™é»˜æ¨¡å¼</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  watch(<span class="string">"src/*.html"</span>).on(<span class="string">"change"</span>, reload);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.serve = serve;</span><br></pre></td></tr></table></figure><p>è¿è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp serve</span><br></pre></td></tr></table></figure><h2 id="Gulp-TypeScript"><a href="#Gulp-TypeScript" class="headerlink" title="Gulp + TypeScript"></a>Gulp + TypeScript</h2><p>æ ¹ç›®å½•ä¸‹åˆå§‹åŒ–ï¼š<code>tsc --init</code>ã€‚</p><p>å®‰è£…ä¾èµ–ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D typescript gulp-typescript</span><br></pre></td></tr></table></figure><p>é…ç½®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ts = <span class="built_in">require</span>(<span class="string">"gulp-typescript"</span>);</span><br><span class="line"><span class="keyword">const</span> tsProject = ts.createProject(<span class="string">"tsconfig.json"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">typescript</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> tsProject</span><br><span class="line">    .src()</span><br><span class="line">    .pipe(tsProject())</span><br><span class="line">    .js.pipe(dest(<span class="string">"dist/ts"</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.typescript = typescript;</span><br></pre></td></tr></table></figure><p>src ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶ <code>main.ts</code>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Student &#123;</span><br><span class="line">  fullName: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">public</span> firstName: <span class="built_in">string</span>, <span class="keyword">public</span> lastName: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.fullName = <span class="string">`<span class="subst">$&#123;firstName&#125;</span> <span class="subst">$&#123;lastName&#125;</span> `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">  firstName: <span class="built_in">string</span>;</span><br><span class="line">  lastName: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greeter</span>(<span class="params">person: Person</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`hello, <span class="subst">$&#123;person.firstName&#125;</span> <span class="subst">$&#123;person.lastName&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = <span class="keyword">new</span> Student(<span class="string">"Yang"</span>, <span class="string">"Tao"</span>);</span><br><span class="line"></span><br><span class="line">greeter(user);</span><br><span class="line"><span class="built_in">console</span>.log(user.fullName);</span><br></pre></td></tr></table></figure><p>è¿è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp typescript</span><br></pre></td></tr></table></figure><h2 id="Riot"><a href="#Riot" class="headerlink" title="Riot"></a>Riot</h2><ul><li><a href="http://eux.baidu.com/blog/fe/riot-js-%E6%A1%86%E6%9E%B6%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90" target="_blank" rel="noopener">Riot.js æ¡†æ¶æ·±å…¥è§£æ</a></li><li><a href="https://cloud.tencent.com/developer/article/1019472" target="_blank" rel="noopener">riot.js æ•™ç¨‹ã€ä¸€ã€‘ç®€ä»‹</a></li><li><a href="https://riot.js.org/documentation/" target="_blank" rel="noopener">RIOT</a>æ–‡æ¡£</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Gulp è‡ªåŠ¨åŒ–æ„å»ºçš„ä¸€äº›è¿‡ç¨‹ï¼Œä»¥åŠå…¶ä»–æ’ä»¶çš„ç»“åˆä½¿ç”¨ç­‰&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="å¼€å‘å·¥å…·" scheme="http://yangtao.site/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="gulp" scheme="http://yangtao.site/tags/gulp/"/>
    
  </entry>
  
  <entry>
    <title>Zepto-core-1.1.6 æºç æ³¨é‡Šã€è½¬è½½ã€‘</title>
    <link href="http://yangtao.site/2020/03/13/zepto-v1.6.6/"/>
    <id>http://yangtao.site/2020/03/13/zepto-v1.6.6/</id>
    <published>2020-03-13T06:05:37.000Z</published>
    <updated>2020-03-16T04:05:11.179Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åŸæ–‡ï¼š<a href="https://www.kancloud.cn/wangfupeng/zepto-design-srouce/173692" target="_blank" rel="noopener">zepto-core-1.1.6 æºç æ³¨é‡Š</a></p></blockquote><a id="more"></a><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Zepto v1.1.6 - zepto event ajax form ie - zeptojs.com/license */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Zepto = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="literal">undefined</span>,</span><br><span class="line">    key,</span><br><span class="line">    $,</span><br><span class="line">    classList,</span><br><span class="line">    <span class="comment">// è·å–æ•°ç»„çš„slice å’Œ filterï¼ˆè¿”å›æ•°ç»„ä¸­çš„æ»¡è¶³å›è°ƒå‡½æ•°ä¸­æŒ‡å®šçš„æ¡ä»¶çš„å…ƒç´ ï¼‰æ–¹æ³•</span></span><br><span class="line">    emptyArray = [],</span><br><span class="line">    slice = emptyArray.slice,</span><br><span class="line">    filter = emptyArray.filter,</span><br><span class="line">    <span class="built_in">document</span> = <span class="built_in">window</span>.document,</span><br><span class="line">    elementDisplay = &#123;&#125;,</span><br><span class="line">    classCache = &#123;&#125;,</span><br><span class="line">    cssNumber = &#123;</span><br><span class="line">      <span class="string">"column-count"</span>: <span class="number">1</span>,</span><br><span class="line">      columns: <span class="number">1</span>,</span><br><span class="line">      <span class="string">"font-weight"</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">"line-height"</span>: <span class="number">1</span>,</span><br><span class="line">      opacity: <span class="number">1</span>,</span><br><span class="line">      <span class="string">"z-index"</span>: <span class="number">1</span>,</span><br><span class="line">      zoom: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å–å‡ºhtmlä»£ç ä¸­ç¬¬ä¸€ä¸ªhtmlæ ‡ç­¾ï¼ˆæˆ–æ³¨é‡Šï¼‰ï¼Œå¦‚å–å‡º &lt;p&gt;123&lt;/p&gt;&lt;h1&gt;345&lt;/h1&gt; ä¸­çš„ &lt;p&gt;</span></span><br><span class="line">    fragmentRE = <span class="regexp">/^\s*&lt;(\w+|!)[^&gt;]*&gt;/</span>,</span><br><span class="line">    <span class="comment">// åŒ¹é… &lt;img /&gt; &lt;p&gt;&lt;/p&gt;  ä¸åŒ¹é… &lt;img src=""/&gt; &lt;p&gt;123&lt;/p&gt;</span></span><br><span class="line">    singleTagRE = <span class="regexp">/^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/</span>,</span><br><span class="line">    <span class="comment">// å•æ ‡ç­¾</span></span><br><span class="line">    tagExpanderRE = <span class="regexp">/&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^&gt;]*)\/&gt;/gi</span>,</span><br><span class="line">    <span class="comment">// body html</span></span><br><span class="line">    rootNodeRE = <span class="regexp">/^(?:body|html)$/i</span>,</span><br><span class="line">    <span class="comment">// å¤§å†™å­—æ¯</span></span><br><span class="line">    capitalRE = <span class="regexp">/([A-Z])/g</span>,</span><br><span class="line">    <span class="comment">// special attributes that should be get/set via method calls</span></span><br><span class="line">    <span class="comment">// åº”è¯¥é€šè¿‡æ–¹æ³•è°ƒç”¨æ¥è®¾ç½®/è·å–çš„ç‰¹æ®Šå±æ€§</span></span><br><span class="line">    methodAttributes = [</span><br><span class="line">      <span class="string">"val"</span>,</span><br><span class="line">      <span class="string">"css"</span>,</span><br><span class="line">      <span class="string">"html"</span>,</span><br><span class="line">      <span class="string">"text"</span>,</span><br><span class="line">      <span class="string">"data"</span>,</span><br><span class="line">      <span class="string">"width"</span>,</span><br><span class="line">      <span class="string">"height"</span>,</span><br><span class="line">      <span class="string">"offset"</span></span><br><span class="line">    ],</span><br><span class="line">    adjacencyOperators = [<span class="string">"after"</span>, <span class="string">"prepend"</span>, <span class="string">"before"</span>, <span class="string">"append"</span>],</span><br><span class="line">    table = <span class="built_in">document</span>.createElement(<span class="string">"table"</span>),</span><br><span class="line">    tableRow = <span class="built_in">document</span>.createElement(<span class="string">"tr"</span>),</span><br><span class="line">    <span class="comment">// æŒ‡å®šç‰¹æ®Šå…ƒç´ çš„ å®¹å™¨</span></span><br><span class="line">    containers = &#123;</span><br><span class="line">      tr: <span class="built_in">document</span>.createElement(<span class="string">"tbody"</span>),</span><br><span class="line">      tbody: table,</span><br><span class="line">      thead: table,</span><br><span class="line">      tfoot: table,</span><br><span class="line">      td: tableRow,</span><br><span class="line">      th: tableRow,</span><br><span class="line">      <span class="comment">// é™¤äº†ä¸Šé¢æŒ‡å®šçš„ï¼Œå…¶ä»–æ‰€æœ‰å…ƒç´ çš„å®¹å™¨éƒ½æ˜¯ div</span></span><br><span class="line">      <span class="string">"*"</span>: <span class="built_in">document</span>.createElement(<span class="string">"div"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// interactive ï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line">    readyRE = <span class="regexp">/complete|loaded|interactive/</span>,</span><br><span class="line">    <span class="comment">// åŒ¹é…ä¸€ä¸ªåŒ…æ‹¬ï¼ˆå­—æ¯ã€æ•°ç»„ã€ä¸‹åˆ’çº¿ã€-ï¼‰çš„å­—ç¬¦ä¸²</span></span><br><span class="line">    simpleSelectorRE = <span class="regexp">/^[\w-]*$/</span>,</span><br><span class="line">    class2type = &#123;&#125;,</span><br><span class="line">    toString = class2type.toString,</span><br><span class="line">    zepto = &#123;&#125;,</span><br><span class="line">    camelize,</span><br><span class="line">    uniq,</span><br><span class="line">    tempParent = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>),</span><br><span class="line">    <span class="comment">// å±æ€§è½¬æ¢ä¸º camalCase æ ¼å¼ã€‚</span></span><br><span class="line">    <span class="comment">// $.fn.prop æ–¹æ³•ç”¨åˆ°äº†</span></span><br><span class="line">    propMap = &#123;</span><br><span class="line">      tabindex: <span class="string">"tabIndex"</span>,</span><br><span class="line">      readonly: <span class="string">"readOnly"</span>,</span><br><span class="line">      <span class="keyword">for</span>: <span class="string">"htmlFor"</span>,</span><br><span class="line">      class: "className",</span><br><span class="line">      maxlength: <span class="string">"maxLength"</span>,</span><br><span class="line">      cellspacing: <span class="string">"cellSpacing"</span>,</span><br><span class="line">      cellpadding: <span class="string">"cellPadding"</span>,</span><br><span class="line">      rowspan: <span class="string">"rowSpan"</span>,</span><br><span class="line">      colspan: <span class="string">"colSpan"</span>,</span><br><span class="line">      usemap: <span class="string">"useMap"</span>,</span><br><span class="line">      frameborder: <span class="string">"frameBorder"</span>,</span><br><span class="line">      contenteditable: <span class="string">"contentEditable"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯arrçš„å‡½æ•°</span></span><br><span class="line">    isArray =</span><br><span class="line">      <span class="built_in">Array</span>.isArray ||</span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> object <span class="keyword">instanceof</span> <span class="built_in">Array</span>;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸Šæ–‡å®šä¹‰ zepto = &#123;&#125;</span></span><br><span class="line">  <span class="comment">// åˆ¤æ–­ element æ˜¯å¦ç¬¦åˆ selector çš„é€‰æ‹©è¦æ±‚</span></span><br><span class="line">  zepto.matches = <span class="function"><span class="keyword">function</span>(<span class="params">element, selector</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// selectoræœ‰å€¼ï¼Œelementæœ‰å€¼ï¼Œelementæ˜¯æ™®é€šDOMèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (!selector || !element || element.nodeType !== <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// elem.matchesSelector('.item')</span></span><br><span class="line">    <span class="comment">// åˆ¤æ–­å½“å‰çš„ elem æ˜¯å¦ç¬¦åˆä¼ å…¥çš„ selector çš„è¦æ±‚</span></span><br><span class="line">    <span class="keyword">var</span> matchesSelector =</span><br><span class="line">      element.webkitMatchesSelector ||</span><br><span class="line">      element.mozMatchesSelector ||</span><br><span class="line">      element.oMatchesSelector ||</span><br><span class="line">      element.matchesSelector;</span><br><span class="line">    <span class="keyword">if</span> (matchesSelector) <span class="keyword">return</span> matchesSelector.call(element, selector);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµè§ˆå™¨ä¸æ”¯æŒ matchesSelector</span></span><br><span class="line">    <span class="comment">// fall back to performing a selector:</span></span><br><span class="line">    <span class="keyword">var</span> match,</span><br><span class="line">      parent = element.parentNode,</span><br><span class="line">      temp = !parent;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šæ–‡å®šä¹‰ tempParent = document.createElement('div'),</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰parentï¼Œparentèµ‹å€¼ä¸ºä¸€ä¸ªdivï¼Œç„¶åå°†å½“å‰å…ƒç´ åŠ å…¥åˆ°è¿™ä¸ªdivä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (temp) &#123;</span><br><span class="line">      parent = tempParent;</span><br><span class="line">      tempParent.appendChild(element);</span><br><span class="line">      <span class="comment">// (parent = tempParent).appendChild(element); è¿™ç§å†™æ³•ä¸æ˜“è¯»</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡ qsa è·å–åŒ¹é…çš„å…ƒç´ ï¼Œåˆ¤æ–­å…¶ä¸­æœ‰æ²¡æœ‰ element</span></span><br><span class="line">    match = ~zepto.qsa(parent, selector).indexOf(element);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (temp) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæ²¡æœ‰parentæ—¶ï¼Œä¹‹å‰æ‰§è¡Œè¿‡  tempParent.appendChild(element);</span></span><br><span class="line">      <span class="comment">// æ­¤æ—¶è¦ç§»é™¤å­å…ƒç´ </span></span><br><span class="line">      tempParent.removeChild(element);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// temp &amp;&amp; tempParent.removeChild(element)  // è¿™ç§å†™æ³•ä¸æ˜“è¯»</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›æœ€ç»ˆçš„åŒ¹é…ç»“æœï¼Œç»è¿‡ qsa åˆ¤æ–­çš„ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> match;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">type</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj == <span class="literal">null</span></span><br><span class="line">      ? <span class="built_in">String</span>(obj) <span class="comment">// null undefined</span></span><br><span class="line">      : class2type[toString.call(obj)] || <span class="string">"object"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹æ–‡å®šä¹‰ï¼š</span></span><br><span class="line">    <span class="comment">// // Populate the class2type map</span></span><br><span class="line">    <span class="comment">// $.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function(i, name) &#123;</span></span><br><span class="line">    <span class="comment">//   class2type[ "[object " + name + "]" ] = name.toLowerCase()</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isFunction</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> type(value) == <span class="string">"function"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// windowçš„ç‰¹ç‚¹ï¼šwindow.window === window</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isWindow</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj == obj.window;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// document.nodeType === 9</span></span><br><span class="line">  <span class="comment">// elem.DOCUMENT_NODE ä¹Ÿç­‰äº 9 ï¼ˆè¿™é‡Œç›´æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯9ä¹Ÿè¡Œï¼Ÿï¼Ÿï¼Ÿï¼‰</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isDocument</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj.nodeType == obj.DOCUMENT_NODE;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> type(obj) == <span class="string">"object"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯æœ€åŸºæœ¬çš„objectï¼šObject.getPrototypeOf(obj) == Object.prototype</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isPlainObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      isObject(obj) &amp;&amp;</span><br><span class="line">      !isWindow(obj) &amp;&amp;</span><br><span class="line">      <span class="built_in">Object</span>.getPrototypeOf(obj) == <span class="built_in">Object</span>.prototype</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ•°ç»„æˆ–è€…å¯¹è±¡æ•°ç»„</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">likeArray</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> obj.length == <span class="string">"number"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç­›é€‰æ•°ç»„ï¼Œè¸¢å‡º null undefined å…ƒç´ </span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">compact</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> filter.call(array, <span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> item != <span class="literal">null</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸‹æ–‡å®šä¹‰ï¼š</span></span><br><span class="line">  <span class="comment">// $.fn = &#123;</span></span><br><span class="line">  <span class="comment">//    concat: emptyArray.concat,</span></span><br><span class="line">  <span class="comment">// $.fn.concat.apply([], array) â€”â€” æ— è®º array æ˜¯ä¸æ˜¯æ•°ç»„ï¼Œéƒ½å°†è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œ</span></span><br><span class="line">  <span class="comment">// ä¾‹å¦‚ $.fn.concat.call([], 'abc') è¿”å›çš„æ˜¯ ['abc']</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">flatten</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> array.length &gt; <span class="number">0</span> ? $.fn.concat.apply([], array) : array;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// camelize å·²åœ¨ä¸Šæ–‡å®šä¹‰</span></span><br><span class="line">  <span class="comment">// ç”¨äº css çš„ camalCase è½¬æ¢ï¼Œä¾‹å¦‚ background-color è½¬æ¢ä¸º backgroundColor</span></span><br><span class="line">  camelize = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str.replace(<span class="regexp">/-+(.)?/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">match, chr</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> chr ? chr.toUpperCase() : <span class="string">""</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°† lineHeight è½¬æ¢ä¸º line-height æ ¼å¼</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">dasherize</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line">      .replace(<span class="regexp">/::/g</span>, <span class="string">"/"</span>)</span><br><span class="line">      .replace(<span class="regexp">/([A-Z]+)([A-Z][a-z])/g</span>, <span class="string">"$1_$2"</span>)</span><br><span class="line">      .replace(<span class="regexp">/([a-z\d])([A-Z])/g</span>, <span class="string">"$1_$2"</span>)</span><br><span class="line">      .replace(<span class="regexp">/_/g</span>, <span class="string">"-"</span>)</span><br><span class="line">      .toLowerCase();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// uniqå˜é‡å·²ç»åœ¨å‰é¢å®šä¹‰</span></span><br><span class="line">  <span class="comment">// ç”¨æ¥å°† [1,1,2,2,3,3] æ›¿æ¢ä¸º [1,2,3]</span></span><br><span class="line">  uniq = <span class="function"><span class="keyword">function</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> filter.call(array, <span class="function"><span class="keyword">function</span>(<span class="params">item, idx</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> array.indexOf(item) == idx;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸Šæ–‡å®šä¹‰ classCache = &#123;&#125;</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">classRE</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name <span class="keyword">in</span> classCache</span><br><span class="line">      ? classCache[name]</span><br><span class="line">      : (classCache[name] = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"(^|\\s)"</span> + name + <span class="string">"(\\s|$)"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// classCache å­˜å‚¨çš„æ•°æ®æ˜¯è¿™æ ·çš„ï¼š</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//   abc: /(^|\s)abc(\s|$)/,  // èƒ½åŒ¹é… 'abc' æˆ– ' abc ' æˆ– ' abc' æˆ– 'abc '</span></span><br><span class="line">    <span class="comment">//   xyz: /(^|\s)abc(\s|$)/,</span></span><br><span class="line">    <span class="comment">//   ...</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¼ å…¥ä¸€ä¸ª css çš„ name å’Œ valueï¼Œåˆ¤æ–­è¿™ä¸ª value æ˜¯å¦éœ€è¦å¢åŠ  'px'</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">maybeAddPx</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// dasherize(name) å°† lineHeight è½¬æ¢ä¸º line-height æ ¼å¼</span></span><br><span class="line">    <span class="comment">// \!cssNumber[dasherize(name)] åˆ¤æ–­è½¬æ¢å‡ºæ¥çš„ css name æ˜¯å¦å†è¿™ä¸ªæ•°ç»„ä¹‹å¤–</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> value == <span class="string">"number"</span> &amp;&amp; !cssNumber[dasherize(name)]</span><br><span class="line">      ? <span class="comment">// å¦‚æœ value æ˜¯æ•°å­—ï¼Œå¹¶ä¸” name ä¸åœ¨ cssNumber æ•°ç»„ä¹‹å†…ï¼Œå°±éœ€è¦åŠ  'px'ï¼Œå¦åˆ™ä¸éœ€è¦</span></span><br><span class="line">        <span class="comment">// ä¾‹å¦‚ 'width'ã€'font-size' å°±éœ€è¦åŠ  'px'ï¼Œ 'font-weight' å°±ä¸éœ€è¦åŠ </span></span><br><span class="line">        value + <span class="string">"px"</span></span><br><span class="line">      : value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰æ–‡å®šä¹‰----------------------</span></span><br><span class="line">    <span class="comment">// cssNumber = &#123;</span></span><br><span class="line">    <span class="comment">//   'column-count': 1,</span></span><br><span class="line">    <span class="comment">//   'columns': 1,</span></span><br><span class="line">    <span class="comment">//   'font-weight': 1,</span></span><br><span class="line">    <span class="comment">//   'line-height': 1,</span></span><br><span class="line">    <span class="comment">//   'opacity': 1,</span></span><br><span class="line">    <span class="comment">//   'z-index': 1,</span></span><br><span class="line">    <span class="comment">//   'zoom': 1</span></span><br><span class="line">    <span class="comment">// &#125;,</span></span><br><span class="line">    <span class="comment">// function dasherize(str) &#123;</span></span><br><span class="line">    <span class="comment">//   return str.replace(/::/g, '/')</span></span><br><span class="line">    <span class="comment">//             .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')</span></span><br><span class="line">    <span class="comment">//             .replace(/([a-z\d])([A-Z])/g, '$1_$2')</span></span><br><span class="line">    <span class="comment">//             .replace(/_/g, '-')</span></span><br><span class="line">    <span class="comment">//             .toLowerCase()</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–ä¸€ä¸ªå…ƒç´ çš„é»˜è®¤ display æ ·å¼å€¼ï¼Œå¯èƒ½çš„ç»“æœæ˜¯ï¼šinline block inline-block table .... ï¼ˆnone è½¬æ¢ä¸º blockï¼‰</span></span><br><span class="line">  <span class="comment">// $.fn.show æ–¹æ³•ä¸­ç”¨åˆ°äº†</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">defaultDisplay</span>(<span class="params">nodeName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> element, display;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰æ–‡å®šä¹‰ elementDisplay = &#123;&#125;</span></span><br><span class="line">    <span class="keyword">if</span> (!elementDisplay[nodeName]) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœ elementDisplay å¯¹è±¡ä¸­ï¼Œæ²¡æœ‰å­˜å‚¨ nodeName çš„ä¿¡æ¯</span></span><br><span class="line">      <span class="comment">// åˆ™æ–°å»ºä¸€ä¸ª nodeName å…ƒç´ ï¼Œæ·»åŠ åˆ° body ä¸­</span></span><br><span class="line">      element = <span class="built_in">document</span>.createElement(nodeName);</span><br><span class="line">      <span class="built_in">document</span>.body.appendChild(element);</span><br><span class="line">      <span class="comment">// è·å–å®ƒçš„é»˜è®¤çš„ display æ ·å¼ä¿¡æ¯ã€‚</span></span><br><span class="line">      display = getComputedStyle(element, <span class="string">""</span>).getPropertyValue(<span class="string">"display"</span>);</span><br><span class="line">      <span class="comment">// æ¥ç€é©¬ä¸Šç§»é™¤å…ƒç´ ï¼ï¼ï¼</span></span><br><span class="line">      element.parentNode.removeChild(element);</span><br><span class="line">      <span class="comment">// 'none' æ¢æˆ 'block'ï¼Œå¦å¤–è¿˜å¯èƒ½æ˜¯ 'inline' 'inline-block' 'table' ç­‰ç­‰...</span></span><br><span class="line">      display == <span class="string">"none"</span> &amp;&amp; (display = <span class="string">"block"</span>);</span><br><span class="line">      <span class="comment">// å­˜å‚¨ä¸‹æ¥</span></span><br><span class="line">      elementDisplay[nodeName] = display;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ä¸‹æ–‡å®šä¹‰</span></span><br><span class="line">      <span class="comment">// var nativeGetComputedStyle = getComputedStyle;</span></span><br><span class="line">      <span class="comment">// window.getComputedStyle = function(element)&#123;</span></span><br><span class="line">      <span class="comment">//   try &#123;</span></span><br><span class="line">      <span class="comment">//     return nativeGetComputedStyle(element)</span></span><br><span class="line">      <span class="comment">//   &#125; catch(e) &#123;</span></span><br><span class="line">      <span class="comment">//     return null</span></span><br><span class="line">      <span class="comment">//   &#125;</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">      <span class="comment">// è§£é‡Šï¼š</span></span><br><span class="line">      <span class="comment">// å¦‚æœæµè§ˆå™¨æ”¯æŒ getComputedStyle åˆ™ä½¿ç”¨ï¼Œå¦‚æœä¸æ”¯æŒï¼Œå°±è¿”å› null</span></span><br><span class="line">      <span class="comment">// getComputedStyle(elem, 'ä¼ªç±»ï¼Œå¦‚ :link') è¿”å›ä¸€ä¸ª CSSStyleDeclaration å¯¹è±¡ï¼Œé‡Œé¢å­˜å‚¨äº†å…ƒç´ çš„æ ·å¼ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ getPropertyValue('name') æ–¹æ³•è·å–</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ€ç»ˆè¿”å› display ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> elementDisplay[nodeName];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›ä¸€ä¸ªå…ƒç´ çš„å­å…ƒç´ ï¼Œæ•°ç»„å½¢å¼</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">children</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// æœ‰äº›æµè§ˆå™¨æ”¯æŒ elem.children è·å–å­å…ƒç´ ï¼Œæœ‰äº›ä¸æ”¯æŒ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"children"</span> <span class="keyword">in</span> element</span><br><span class="line">      ? <span class="comment">// ä¸Šæ–‡å®šä¹‰ slice = [].slice</span></span><br><span class="line">        <span class="comment">// slice.call(likeArr) å¯ä»¥å°†å¯¹è±¡æ•°ç»„è½¬æ¢ä¸ºçœŸæ­£çš„æ•°ç»„</span></span><br><span class="line">        slice.call(element.children)</span><br><span class="line">      : <span class="comment">// æµè§ˆå™¨ä¸æ”¯æŒ elem.children åªèƒ½é€šè¿‡ elem.childNodes è·å–å­å…ƒç´ </span></span><br><span class="line">        <span class="comment">// åªå» node.nodeType == 1 çš„å­å…ƒç´ ï¼Œé€šè¿‡ $.map æ‹¼æ¥æˆæ•°ç»„</span></span><br><span class="line">        <span class="comment">// $.map ä¸‹æ–‡å®šä¹‰çš„ï¼Œ $.map = function (elements, callback) &#123;....&#125;</span></span><br><span class="line">        <span class="comment">// $.map ä½œç”¨ï¼šé’ˆå¯¹ elementsï¼ˆå¯¹è±¡æ•°ç»„æˆ–æ•°ç»„ï¼‰ï¼Œå¯¹æ¯ä¸ªå…ƒç´ éƒ½ç»è¿‡ callback å‡½æ•°çš„è¿‡æ»¤ï¼Œå¹¶å°†è¿‡æ»¤é€šè¿‡çš„å…ƒç´ ï¼Œpushåˆ°ä¸€ä¸ªæ–°æ•°ç»„ä¸­ï¼Œè¿”å›æ–°æ•°ç»„</span></span><br><span class="line">        $.map(element.childNodes, <span class="function"><span class="keyword">function</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (node.nodeType == <span class="number">1</span>) <span class="keyword">return</span> node;</span><br><span class="line">        &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸Šæ–‡å®šä¹‰ zepto = &#123;&#125;</span></span><br><span class="line">  <span class="comment">// ä¸Šæ–‡å®šä¹‰ zepto.matches = function(element, selector) &#123; /* åˆ¤æ–­elemæ˜¯å¦ç¬¦åˆselectorçš„è¦æ±‚ */ &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.fragment` takes a html string and an optional tag name</span></span><br><span class="line">  <span class="comment">// to generate DOM nodes nodes from the given html string.</span></span><br><span class="line">  <span class="comment">// The generated DOM nodes are returned as an array.</span></span><br><span class="line">  <span class="comment">// This function can be overriden in plugins for example to make</span></span><br><span class="line">  <span class="comment">// it compatible with browsers that don't support the DOM fully.</span></span><br><span class="line">  zepto.fragment = <span class="function"><span class="keyword">function</span>(<span class="params">html, name, properties</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">      @html: å¾…å¤„ç†çš„htmlå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">      @name: é€šè¿‡ name å¯åœ¨ containers ä¸­æŸ¥æ‰¾å®¹å™¨èŠ‚ç‚¹ï¼Œå¦‚æœä¸ä¼ å…¥ï¼Œå–å¾—çš„å®¹å™¨é»˜è®¤ä¸º div</span></span><br><span class="line"><span class="comment">      @properties: èŠ‚ç‚¹å±æ€§å¯¹è±¡</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dom, nodes, container;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šæ–‡å®šä¹‰ï¼šsingleTagRE = /^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/,   // åŒ¹é… &lt;img /&gt; &lt;p&gt;&lt;/p&gt;  ä¸åŒ¹é… &lt;img src=""/&gt; &lt;p&gt;123&lt;/p&gt;</span></span><br><span class="line">    <span class="comment">// å¦‚æœ html æ˜¯å•æ ‡ç­¾ï¼Œåˆ™ç›´æ¥ç”¨è¯¥æ ‡ç­¾åˆ›å»ºå…ƒç´ </span></span><br><span class="line">    <span class="comment">// RegExp.$1 è¡¨ç¤ºæ­£åˆ™ä¸­çš„ç¬¬ä¸€ä¸ªæ‹¬å·åŒ¹é…çš„å†…å®¹ï¼Œåœ¨æ­¤å³ (\w+) åŒ¹é…çš„å†…å®¹ï¼Œ</span></span><br><span class="line">    <span class="comment">// A special case optimization for a single tag</span></span><br><span class="line">    <span class="keyword">if</span> (singleTagRE.test(html)) dom = $(<span class="built_in">document</span>.createElement(<span class="built_in">RegExp</span>.$<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!dom) &#123;</span><br><span class="line">      <span class="comment">// è¯´æ˜ html ä¸æ˜¯å•æ ‡ç­¾ï¼Œdomæœªè¢«èµ‹å€¼</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// ä¸Šæ–‡å®šä¹‰ tagExpanderRE = /&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^&gt;]*)\/&gt;/ig,   // å•æ ‡ç­¾</span></span><br><span class="line">      <span class="comment">// å°† &lt;p/&gt;æˆ–&lt;p /&gt;ï¼Œæ›¿æ¢ä¸º &lt;p&gt;&lt;/p&gt;ï¼Œå°†&lt;p abc/&gt;æ›¿æ¢ä¸º&lt;p&gt;abc&lt;/p&gt;</span></span><br><span class="line">      <span class="comment">// &lt;input/&gt; ï¼ˆåœ¨ tagExpanderRE ä¸­å®šä¹‰ï¼‰çš„ä¸æ›¿æ¢</span></span><br><span class="line">      <span class="keyword">if</span> (html.replace) html = html.replace(tagExpanderRE, <span class="string">"&lt;$1&gt;&lt;/$2&gt;"</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// fragmentRE = /^\s*&lt;(\w+|!)[^&gt;]*&gt;/,   // å–å‡ºhtmlä»£ç ä¸­ç¬¬ä¸€ä¸ªhtmlæ ‡ç­¾ï¼ˆæˆ–æ³¨é‡Šï¼‰ï¼Œå¦‚å–å‡º &lt;p&gt;123&lt;/p&gt;&lt;h1&gt;345&lt;/h1&gt; ä¸­çš„ &lt;p&gt;</span></span><br><span class="line">      <span class="comment">// å¦‚æœ name æœªä¼ å…¥ï¼Œåˆ™èµ‹å€¼ä¸º html çš„ç¬¬ä¸€ä¸ªæ ‡ç­¾</span></span><br><span class="line">      <span class="keyword">if</span> (name === <span class="literal">undefined</span>) name = fragmentRE.test(html) &amp;&amp; <span class="built_in">RegExp</span>.$<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ä¸Šæ–‡å®šä¹‰</span></span><br><span class="line">      <span class="comment">// æŒ‡å®šç‰¹æ®Šå…ƒç´ çš„ å®¹å™¨</span></span><br><span class="line">      <span class="comment">// containers = &#123;</span></span><br><span class="line">      <span class="comment">//   'tr': document.createElement('tbody'),</span></span><br><span class="line">      <span class="comment">//   'tbody': table,</span></span><br><span class="line">      <span class="comment">//   'thead': table,</span></span><br><span class="line">      <span class="comment">//   'tfoot': table,</span></span><br><span class="line">      <span class="comment">//   'td': tableRow,</span></span><br><span class="line">      <span class="comment">//   'th': tableRow,</span></span><br><span class="line">      <span class="comment">// é™¤äº†ä¸Šé¢æŒ‡å®šçš„ï¼Œå…¶ä»–æ‰€æœ‰å…ƒç´ çš„å®¹å™¨éƒ½æ˜¯ div</span></span><br><span class="line">      <span class="comment">//   '*': document.createElement('div')</span></span><br><span class="line">      <span class="comment">// &#125;,</span></span><br><span class="line">      <span class="keyword">if</span> (!(name <span class="keyword">in</span> containers)) name = <span class="string">"*"</span>;</span><br><span class="line"></span><br><span class="line">      container = containers[name];</span><br><span class="line">      container.innerHTML = <span class="string">""</span> + html; <span class="comment">// è½¬å˜ä¸ºå­—ç¬¦ä¸²çš„å¿«æ·æ–¹å¼</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// éå† container çš„å­å…ƒç´ ï¼ˆå…ˆè½¬æ¢ä¸ºæ•°ç»„å½¢å¼ï¼‰</span></span><br><span class="line">      <span class="comment">// è¿”å›çš„åŒæ—¶ï¼Œå°†æ¯ä¸ªå­å…ƒç´ ç§»é™¤ã€‚</span></span><br><span class="line">      <span class="comment">// $.each è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æ•°ç»„ slice.call(container.childNodes)</span></span><br><span class="line">      dom = $.each(slice.call(container.childNodes), <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        container.removeChild(<span class="keyword">this</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èµ‹å€¼å±æ€§</span></span><br><span class="line">    <span class="keyword">if</span> (isPlainObject(properties)) &#123;</span><br><span class="line">      <span class="comment">// å…ˆå°†domè½¬æ¢ä¸º zepto å¯¹è±¡</span></span><br><span class="line">      nodes = $(dom);</span><br><span class="line"></span><br><span class="line">      $.each(properties, <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸Šæ–‡å®šä¹‰ï¼š</span></span><br><span class="line">        <span class="comment">// åº”è¯¥é€šè¿‡æ–¹æ³•è°ƒç”¨æ¥è®¾ç½®/è·å–çš„ç‰¹æ®Šå±æ€§</span></span><br><span class="line">        <span class="comment">// methodAttributes = ['val', 'css', 'html', 'text', 'data', 'width', 'height', 'offset'],</span></span><br><span class="line">        <span class="keyword">if</span> (methodAttributes.indexOf(key) &gt; <span class="number">-1</span>) nodes[key](value);</span><br><span class="line">        <span class="comment">// æ»¡è¶³ methodAttributes çš„ï¼Œé€šè¿‡æ–¹æ³•èµ‹å€¼</span></span><br><span class="line">        <span class="keyword">else</span> nodes.attr(key, value); <span class="comment">// å¦åˆ™ï¼Œé€šè¿‡å±æ€§å¤åˆ¶</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ€ç»ˆè¿”å›çš„domå¯èƒ½æœ‰ä¸¤ç§å½¢å¼</span></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ï¼Œå¦‚æœ html æ˜¯å•æ ‡ç­¾ï¼Œåˆ™domè¢«å¤åˆ¶ä¸ºä¸€ä¸ªzeptoå¯¹è±¡ dom = $(document.createElement(RegExp.$1))</span></span><br><span class="line">    <span class="comment">// ç¬¬äºŒï¼Œå¦‚æœ html ä¸æ˜¯å•æ ‡ç­¾ï¼Œåˆ™domè¢«å¤åˆ¶ä¸ºä¸€ä¸ªDOMèŠ‚ç‚¹çš„æ•°ç»„</span></span><br><span class="line">    <span class="keyword">return</span> dom;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸Šæ–‡å®šä¹‰ zepto = &#123;&#125;</span></span><br><span class="line">  <span class="comment">// ä¸Šæ–‡å®šä¹‰ zepto.matches = function(element, selector) &#123; /* åˆ¤æ–­elemæ˜¯å¦ç¬¦åˆselectorçš„è¦æ±‚ */ &#125;</span></span><br><span class="line">  <span class="comment">// ä¸Šæ–‡å®šä¹‰ zepto.fragment = function(html, name, properties) &#123; /* é€šè¿‡htmlå­—ç¬¦ä¸²è·å–æ–‡æ¡£ç¢ç‰‡ */ &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.Z` swaps out the prototype of the given `dom` array</span></span><br><span class="line">  <span class="comment">// of nodes with `$.fn` and thus supplying all the Zepto functions</span></span><br><span class="line">  <span class="comment">// to the array. Note that `__proto__` is not supported on Internet</span></span><br><span class="line">  <span class="comment">// Explorer. This method can be overriden in plugins.</span></span><br><span class="line">  zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">    dom = dom || [];</span><br><span class="line">    <span class="comment">// å°† dom éšå¼åŸå‹å¼ºåˆ¶æ”¹ä¸º $.fn</span></span><br><span class="line">    <span class="comment">// ä¸‹æ–‡ zepto.Z.prototype = $.fn   å› æ­¤ï¼Œdom.__proto__ = $.fn å³ dom.__proto__ = zepto.Z.prototype  å¯ä»¥ä¸è¾ƒçœŸçš„è®¤ä¸º zepto.Z å°±æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼ˆä½†æ„Ÿè§‰è¿™ä¹ˆè®¾è®¡ï¼Œæœ‰äº›è¹©è„šï¼‰</span></span><br><span class="line">    dom.__proto__ = $.fn;</span><br><span class="line">    dom.selector = selector || <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">return</span> dom;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.isZ` should return `true` if the given object is a Zepto</span></span><br><span class="line">  <span class="comment">// collection. This method can be overriden in plugins.</span></span><br><span class="line">  zepto.isZ = <span class="function"><span class="keyword">function</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸Šæ–‡ dom.__proto__ = $.fn</span></span><br><span class="line">    <span class="comment">// ä¸‹æ–‡ zepto.Z.prototype = $.fn</span></span><br><span class="line">    <span class="comment">// å¯çŸ¥ï¼šdom.__proto__ === $.fn === zepto.Z.prototype</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å› æ­¤ï¼Œzeptoå¯¹è±¡éƒ½ç¬¦åˆ object instanceof zepto.Z</span></span><br><span class="line">    <span class="keyword">return</span> object <span class="keyword">instanceof</span> zepto.Z;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.init` is Zepto's counterpart to jQuery's `$.fn.init` and</span></span><br><span class="line">  <span class="comment">// takes a CSS selector and an optional context (and handles various</span></span><br><span class="line">  <span class="comment">// special cases).</span></span><br><span class="line">  <span class="comment">// This method can be overriden in plugins.</span></span><br><span class="line">  zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dom;</span><br><span class="line">    <span class="comment">// If nothing given, return an empty Zepto collection</span></span><br><span class="line">    <span class="keyword">if</span> (!selector) <span class="keyword">return</span> zepto.Z();</span><br><span class="line">    <span class="comment">// Optimize for string selectors</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">"string"</span>) &#123;</span><br><span class="line">      <span class="comment">// å­—ç¬¦ä¸²çš„æƒ…å†µï¼Œä¸€èˆ¬æœ‰ä¸¤ç§ï¼š</span></span><br><span class="line">      <span class="comment">// ç¬¬ä¸€ï¼Œä¸€æ®µ html ä»£ç ï¼Œæ—¨åœ¨é€šè¿‡zeptoç”Ÿæˆdomå¯¹è±¡</span></span><br><span class="line">      <span class="comment">// ç¬¬äºŒï¼Œä¸€æ®µæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œæ—¨åœ¨é€šè¿‡zeptoæŸ¥æ‰¾domå¯¹è±¡</span></span><br><span class="line">      <span class="comment">// å°†æŸ¥è¯¢ç»“æœå­˜å‚¨åˆ° dom å˜é‡ä¸­</span></span><br><span class="line"></span><br><span class="line">      selector = selector.trim();</span><br><span class="line">      <span class="comment">// If it's a html fragment, create nodes from it</span></span><br><span class="line">      <span class="comment">// Note: In both Chrome 21 and Firefox 15, DOM error 12</span></span><br><span class="line">      <span class="comment">// is thrown if the fragment doesn't begin with &lt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// ä¸Šæ–‡å®šä¹‰ï¼š</span></span><br><span class="line">      <span class="comment">// å–å‡ºhtmlä»£ç ä¸­ç¬¬ä¸€ä¸ªhtmlæ ‡ç­¾ï¼ˆæˆ–æ³¨é‡Šï¼‰ï¼Œå¦‚å–å‡º &lt;p&gt;123&lt;/p&gt;&lt;h1&gt;345&lt;/h1&gt; ä¸­çš„ &lt;p&gt;</span></span><br><span class="line">      <span class="comment">// fragmentRE = /^\s*&lt;(\w+|!)[^&gt;]*&gt;/,</span></span><br><span class="line">      <span class="keyword">if</span> (selector[<span class="number">0</span>] == <span class="string">"&lt;"</span> &amp;&amp; fragmentRE.test(selector))</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€ï¼ŒRegExp.$1å–å‡ºæ¥çš„å°±æ˜¯ç¬¬ä¸€ä¸ªæ ‡ç­¾åç§°ï¼Œå³æ­£åˆ™ä¸­ (\w+|!) å¯¹åº”çš„å†…å®¹</span></span><br><span class="line">        <span class="comment">// ç¬¬äºŒï¼Œæ­¤æ—¶çš„ context åº”è¯¥ä¼ å…¥çš„æ˜¯csså±æ€§å¯¹è±¡ï¼ˆè¿™é‡Œä¼šäº§ç”Ÿæ­§ä¹‰ï¼Œè€ç‰ˆçš„ä¸ä¼šä¼ å…¥ contextï¼‰</span></span><br><span class="line">        (dom = zepto.fragment(selector, <span class="built_in">RegExp</span>.$<span class="number">1</span>, context)), (selector = <span class="literal">null</span>);</span><br><span class="line">      <span class="comment">// If there's a context, create a collection on that context first, and select</span></span><br><span class="line">      <span class="comment">// nodes from there</span></span><br><span class="line">      <span class="comment">// å¦‚æœ selector ä¸æ˜¯htmlå­—ç¬¦ä¸²æ ‡ç­¾ï¼Œå¹¶ä¸” context æœ‰å€¼ï¼Œåˆ™ä»contextä¸­æŸ¥æ‰¾</span></span><br><span class="line">      <span class="comment">// find åº”è¯¥æ˜¯åœ¨ $.fn ä¸­å®šä¹‰çš„ï¼Œæœ‰å¾…è§£è¯»ï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector);</span><br><span class="line">      <span class="comment">// If it's a CSS selector, use it to select nodes.</span></span><br><span class="line">      <span class="comment">// é™¤äº†ä»¥ä¸Šæƒ…å†µï¼Œå°±ä»æ•´ä¸ª document æ‰§è¡Œ qsa çš„æŸ¥æ‰¾</span></span><br><span class="line">      <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If a function is given, call it when the DOM is ready</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯å‡½æ•°ï¼Œåˆ™dom readyæ—¶æ‰§è¡Œï¼Œ</span></span><br><span class="line">    <span class="comment">// readyæ–¹æ³•åº”è¯¥åœ¨ $.fn ä¸­å®šä¹‰ï¼Œæœ‰å¾…è§£æ¯’</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (isFunction(selector)) <span class="keyword">return</span> $(<span class="built_in">document</span>).ready(selector);</span><br><span class="line">    <span class="comment">// If a Zepto collection is given, just return it</span></span><br><span class="line">    <span class="comment">// ä¼ å…¥çš„å‚æ•°æœ¬èº«å°±å·²ç»æ˜¯ zepto å¯¹è±¡ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (zepto.isZ(selector)) <span class="keyword">return</span> selector;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// compactå‡½æ•°ï¼šè¸¢å‡ºæ•°ç»„ä¸­ == null çš„å…ƒç´ </span></span><br><span class="line">      <span class="comment">// normalize array if an array of nodes is given</span></span><br><span class="line">      <span class="keyword">if</span> (isArray(selector)) dom = compact(selector);</span><br><span class="line">      <span class="comment">// å¦‚æœä¼ å…¥çš„æ˜¯objectï¼Œç›´æ¥å¼ºåˆ¶å¡è¿›ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">      <span class="comment">// Wrap DOM nodes.</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (isObject(selector)) (dom = [selector]), (selector = <span class="literal">null</span>);</span><br><span class="line">      <span class="comment">// åŠæ—¶æ¸…ç©º selector ä¸å¦¨ç¢ä¸‹é¢çš„åˆ¤æ–­</span></span><br><span class="line">      <span class="comment">// ä»æ­¤å¾€ä¸‹ï¼Œæ„Ÿè§‰å’Œä¸Šæ–‡ selector æ˜¯å­—ç¬¦ä¸²çš„æƒ…å†µä¸‹ï¼Œé‡å¤äº†</span></span><br><span class="line">      <span class="comment">// ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line">      <span class="comment">// fragmentRE.test å³åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æ˜¯ html æ ‡ç­¾å¼€å¤´ï¼ˆå³æ˜¯å¦æ˜¯html fragementï¼‰</span></span><br><span class="line">      <span class="comment">// If it's a html fragment, create nodes from it</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (fragmentRE.test(selector))</span><br><span class="line">        <span class="comment">//æ­¤æ—¶ï¼Œcontext ä¹Ÿæ˜¯å±æ€§é›†åˆï¼Œä¸æ˜¯å®¹å™¨ï¼ï¼ï¼</span></span><br><span class="line">        <span class="comment">//ï¼ˆè¿™é‡Œä¼šäº§ç”Ÿæ­§ä¹‰ï¼Œè€ç‰ˆçš„ä¸ä¼šä¼ å…¥ contextï¼‰</span></span><br><span class="line">        (dom = zepto.fragment(selector.trim(), <span class="built_in">RegExp</span>.$<span class="number">1</span>, context)),</span><br><span class="line">          (selector = <span class="literal">null</span>);</span><br><span class="line">      <span class="comment">// åŠæ—¶æ¸…ç©º selector ä¸å¦¨ç¢ä¸‹é¢çš„åˆ¤æ–­</span></span><br><span class="line">      <span class="comment">// If there's a context, create a collection on that context first, and select</span></span><br><span class="line">      <span class="comment">// nodes from there</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector);</span><br><span class="line">      <span class="comment">// And last but no least, if it's a CSS selector, use it to select nodes.</span></span><br><span class="line">      <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ€ç»ˆï¼Œè¿˜æ˜¯é€šè¿‡ zepto.Z åˆ›å»ºäº†å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„ domï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">    <span class="comment">// create a new Zepto collection from the nodes found</span></span><br><span class="line">    <span class="keyword">return</span> zepto.Z(dom, selector);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$` will be the base `Zepto` object. When calling this</span></span><br><span class="line">  <span class="comment">// function just call `$.zepto.init, which makes the implementation</span></span><br><span class="line">  <span class="comment">// details of selecting nodes and creating Zepto collections</span></span><br><span class="line">  <span class="comment">// patchable in plugins.</span></span><br><span class="line">  $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> zepto.init(selector, context);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// $ æœ€ç»ˆè¢«è¿™ä¸ªåŒ¿åå‡½æ•°æ‰€è¿”å›ï¼Œå¹¶å¤åˆ¶ç»™äº†å…¨å±€çš„ Zepto å˜é‡</span></span><br><span class="line">  <span class="comment">// å…¨å±€çš„ zepto å˜é‡æš´éœ²ç»™äº† windowï¼Œå¹¶ä¸”å¯èƒ½æœ‰ä¸€ä¸ªåˆ«åâ€”â€” $</span></span><br><span class="line">  <span class="comment">// æ­¤ $ éå½¼ $</span></span><br><span class="line">  <span class="comment">// å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œè¿™é‡Œè‚¯å®šéå¸¸ç»•ï¼ˆè¿˜ä¸å¦‚æŠŠè¿™é‡Œçš„ $ æ”¹æ”¹åå­—ï¼‰</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">target, source, deep</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// key åœ¨ä¸Šæ–‡å·²ç»å®šä¹‰ï¼Œå¦åˆ™å°±æ±¡æŸ“å…¨å±€å˜é‡äº†</span></span><br><span class="line">    <span class="comment">// æ·±åº¦é€’å½’ï¼Œé¦–å…ˆå¿…é¡» deep å‚æ•°ä¸º true</span></span><br><span class="line">    <span class="comment">// å…¶æ¬¡ï¼Œsource[key] å¿…é¡»æ˜¯æ•°ç»„æˆ–è€…å¯¹è±¡ï¼Œæ‰æœ‰å¿…è¦æ·±åº¦é€’å½’ï¼ˆå¦åˆ™æ²¡å¿…è¦ï¼‰</span></span><br><span class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> source)</span><br><span class="line">      <span class="keyword">if</span> (deep &amp;&amp; (isPlainObject(source[key]) || isArray(source[key]))) &#123;</span><br><span class="line">        <span class="comment">// source[key] æ˜¯å¯¹è±¡ï¼Œè€Œ target[key] ä¸æ˜¯å¯¹è±¡</span></span><br><span class="line">        <span class="comment">// åˆ™ target[key] = &#123;&#125; åˆå§‹åŒ–ä¸€ä¸‹ï¼Œå¦åˆ™é€’å½’ä¼šå‡ºé”™çš„</span></span><br><span class="line">        <span class="keyword">if</span> (isPlainObject(source[key]) &amp;&amp; !isPlainObject(target[key]))</span><br><span class="line">          target[key] = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// source[key] æ˜¯æ•°ç»„ï¼Œè€Œ target[key] ä¸æ˜¯æ•°ç»„</span></span><br><span class="line">        <span class="comment">// åˆ™ target[key] = [] åˆå§‹åŒ–ä¸€ä¸‹ï¼Œå¦åˆ™é€’å½’ä¼šå‡ºé”™çš„</span></span><br><span class="line">        <span class="keyword">if</span> (isArray(source[key]) &amp;&amp; !isArray(target[key])) target[key] = [];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡Œé€’å½’</span></span><br><span class="line">        extend(target[key], source[key], deep);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œè¯´æ˜ source[key] æ˜¯ä¸€èˆ¬çš„å€¼ç±»å‹ï¼Œç›´æ¥èµ‹å€¼ç»™ target å°±æ˜¯äº†</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (source[key] !== <span class="literal">undefined</span>) target[key] = source[key];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Copy all but undefined properties from one or more</span></span><br><span class="line">  <span class="comment">// objects to the `target` object.</span></span><br><span class="line">  $.extend = <span class="function"><span class="keyword">function</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸€èˆ¬ä¼ å…¥çš„å‚æ•°ä¼šæ˜¯ï¼š</span></span><br><span class="line">    <span class="comment">// (targetObj, srcObj1, srcObj2, srcObj1...)</span></span><br><span class="line">    <span class="comment">// (true, targetObj, srcObj1, srcObj2, srcObj1...)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// arguments æ˜¯å¯¹è±¡æ•°ç»„ï¼Œslice.call ä¼šè¿”å›çœŸæ­£çš„æ•°ç»„ï¼ˆæ­¤å¤„è¿”å›ä»ç¬¬äºŒé¡¹å¼€å§‹ï¼‰</span></span><br><span class="line">    <span class="keyword">var</span> deep,</span><br><span class="line">      args = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯booleanï¼Œè¿™é‡Œä¼šæŠŠç¬¬äºŒä¸ªå‚æ•°å½“åš targetï¼Œå…¶ä»–çš„ä½œä¸º source</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> target == <span class="string">"boolean"</span>) &#123;</span><br><span class="line">      deep = target;</span><br><span class="line">      target = args.shift();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†æ‰€æœ‰çš„ source æ·»åŠ åˆ° target ä¸­</span></span><br><span class="line">    args.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">      extend(target, arg, deep);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„Ÿè§‰è¿™æ ·è®¾è®¡æ˜¯æ¯”è¾ƒå¥½ï¼Œå¾ˆå¥½çš„å°†ä¸šåŠ¡å’Œåº•å±‚è¿›è¡Œäº†åˆ†ç¦»ï¼ˆè™½ç„¶æ¯”è¾ƒç®€å•ï¼‰ï¼š</span></span><br><span class="line">    <span class="comment">// æ ¸å¿ƒæ–¹æ³•å† function extend(...)&#123;...&#125; ä¸­å®šä¹‰ï¼Œ</span></span><br><span class="line">    <span class="comment">// è€Œ $.extend æ–¹æ³•ä¸­åšä¸€äº›å¤–å›´çš„åˆ¤æ–­å’Œå¤„ç†ï¼Œæœ€ç»ˆè°ƒç”¨ extend å‡½æ•°å»æ‰§è¡Œ</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.qsa` is Zepto's CSS selector implementation which</span></span><br><span class="line">  <span class="comment">// uses `document.querySelectorAll` and optimizes for some special cases, like `#id`.</span></span><br><span class="line">  <span class="comment">// This method can be overriden in plugins.</span></span><br><span class="line">  zepto.qsa = <span class="function"><span class="keyword">function</span>(<span class="params">element, selector</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      @element: å®¹å™¨</span></span><br><span class="line"><span class="comment">      @selector: é€‰æ‹©å™¨</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> found,</span><br><span class="line">      maybeID = selector[<span class="number">0</span>] == <span class="string">"#"</span>,</span><br><span class="line">      maybeClass = !maybeID &amp;&amp; selector[<span class="number">0</span>] == <span class="string">"."</span>,</span><br><span class="line">      <span class="comment">// IDæˆ–classå½¢å¼ï¼šè¿”å› selector.slice(1) å³IDæˆ–è€…classçš„å€¼</span></span><br><span class="line">      <span class="comment">// å¦åˆ™ï¼šè¿”å› selectorï¼Œå¦‚é€šè¿‡ tagName æŸ¥è¯¢</span></span><br><span class="line">      nameOnly = maybeID || maybeClass ? selector.slice(<span class="number">1</span>) : selector, <span class="comment">// Ensure that a 1 char tag name still gets checked</span></span><br><span class="line">      <span class="comment">// æ˜¯å¦æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼ˆå¯èƒ½æ˜¯ä¸€ä¸ªå¤æ‚çš„é€‰æ‹©å™¨ï¼Œå¦‚ 'div#div1 .item[link] .red'ï¼‰</span></span><br><span class="line">      isSimple = simpleSelectorRE.test(nameOnly);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šæ–‡å®šä¹‰ï¼š</span></span><br><span class="line">    <span class="comment">// // åŒ¹é…ä¸€ä¸ªåŒ…æ‹¬ï¼ˆå­—æ¯ã€æ•°ç»„ã€ä¸‹åˆ’çº¿ã€-ï¼‰çš„å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="comment">// simpleSelectorRE = /^[\w-]*$/,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹ä»£ç çš„åŸºæœ¬æ€è·¯æ˜¯ï¼š</span></span><br><span class="line">    <span class="comment">// 1. ä¼˜å…ˆé€šè¿‡ ID è·å–å…ƒç´ ï¼›</span></span><br><span class="line">    <span class="comment">// 2. ç„¶åè¯•å›¾é€šè¿‡ className å’Œ tagName è·å–å…ƒç´ </span></span><br><span class="line">    <span class="comment">// 3. æœ€åé€šè¿‡ querySelectorAll æ¥è·å–</span></span><br><span class="line">    <span class="keyword">return</span> isDocument(element) &amp;&amp; isSimple &amp;&amp; maybeID</span><br><span class="line">      ? <span class="comment">// è¿™æ˜¯æœ€ç®€å•çš„å½¢å¼ï¼šå®¹å™¨æ˜¯documentã€é€‰æ‹©å™¨æ˜¯ä¸€ä¸ªid</span></span><br><span class="line">        <span class="comment">// å› ä¸º getElementById åªèƒ½åœ¨ document ä¸Šç”¨ï¼Œæ‰€ä»¥è¿™é‡Œå•ç‹¬æ‹¿å‡ºæ¥</span></span><br><span class="line">        (found = element.getElementById(nameOnly))</span><br><span class="line">        ? [found]</span><br><span class="line">        : []</span><br><span class="line">      : element.nodeType !== <span class="number">1</span> &amp;&amp; element.nodeType !== <span class="number">9</span></span><br><span class="line">      ? <span class="comment">// å®¹å™¨ä¸æ˜¯ä¸€èˆ¬å…ƒç´ ï¼Œä¹Ÿä¸æ˜¯documentï¼Œç›´æ¥è¿”å› []</span></span><br><span class="line">        []</span><br><span class="line">      : <span class="comment">// å°†è·å–çš„æ‰€æœ‰å…ƒç´ é›†åˆï¼Œéƒ½è½¬æ¢ä¸ºæ•°ç»„</span></span><br><span class="line">        slice.call(</span><br><span class="line">          isSimple &amp;&amp; !maybeID</span><br><span class="line">            ? <span class="comment">// isSimpleæƒ…å†µä¸‹ï¼ŒnameOnly åªå¯èƒ½æ˜¯ className æˆ–è€… tagName</span></span><br><span class="line">              <span class="comment">// getElementsByClassName å’Œ getElementsByTagName å¯ä»¥åœ¨ elem ä¸Šç”¨ï¼Œè€Œä¸”æ¯” querySelectorAll é€Ÿåº¦å¿«</span></span><br><span class="line">              <span class="comment">// æ‰€ä»¥ï¼Œåªè¦elemå®¹å™¨æœ‰å€¼ï¼Œå°½é‡å•ç‹¬æ‹¿å‡ºæ¥å¤„ç†</span></span><br><span class="line">              maybeClass</span><br><span class="line">              ? element.getElementsByClassName(nameOnly) <span class="comment">// If it's simple, it could be a class</span></span><br><span class="line">              : element.getElementsByTagName(selector) <span class="comment">// Or a tag</span></span><br><span class="line">            : <span class="comment">// æœ€åå…¶ä»–æƒ…å†µï¼Œåªèƒ½é€šè¿‡ querySelectorAll æ¥å¤„ç†</span></span><br><span class="line">              element.querySelectorAll(selector) <span class="comment">// Or it's not simple, and we need to query all</span></span><br><span class="line">        );</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ® selector ç­›é€‰ nodes</span></span><br><span class="line">  <span class="comment">// å¹¶å°† nodes å°è£…ä¸º zepto å¯¹è±¡</span></span><br><span class="line">  <span class="comment">// $.fn.filter ä¸‹æ–‡å®šä¹‰</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">filtered</span>(<span class="params">nodes, selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> selector == <span class="literal">null</span> ? $(nodes) : $(nodes).filter(selector);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­ parent æ˜¯å¦åŒ…å« node</span></span><br><span class="line">  $.contains = <span class="built_in">document</span>.documentElement.contains</span><br><span class="line">    ? <span class="comment">// æµè§ˆå™¨æ”¯æŒ contains æ–¹æ³•</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params">parent, node</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parent !== node &amp;&amp; parent.contains(node);</span><br><span class="line">      &#125;</span><br><span class="line">    : <span class="comment">// ä¸æ”¯æŒ contains æ–¹æ³•</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params">parent, node</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (node &amp;&amp; (node = node.parentNode))</span><br><span class="line">          <span class="keyword">if</span> (node === parent) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœ arg æ˜¯å‡½æ•°ï¼Œåˆ™æ”¹å˜å‡½æ•°çš„æ‰§è¡Œç¯å¢ƒå’Œå‚æ•°</span></span><br><span class="line">  <span class="comment">// å¦‚æœä¸æ˜¯ï¼Œç›´æ¥è¿”å› arg</span></span><br><span class="line">  <span class="comment">// $.fn.html æ–¹æ³•å°±ç”¨åˆ°äº†</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">funcArg</span>(<span class="params">context, arg, idx, payload</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isFunction(arg) ? arg.call(context, idx, payload) : arg;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®å±æ€§</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setAttribute</span>(<span class="params">node, name, value</span>) </span>&#123;</span><br><span class="line">    value == <span class="literal">null</span> ? node.removeAttribute(name) : node.setAttribute(name, value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®æˆ–è·å– node çš„ className</span></span><br><span class="line">  <span class="comment">// è€ƒè™‘ svg ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line">  <span class="comment">// access className property while respecting SVGAnimatedString</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">className</span>(<span class="params">node, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> klass = node.className || <span class="string">""</span>,</span><br><span class="line">      svg = klass &amp;&amp; klass.baseVal !== <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–</span></span><br><span class="line">    <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> svg ? klass.baseVal : klass;</span><br><span class="line">    <span class="comment">// è®¾ç½®</span></span><br><span class="line">    svg ? (klass.baseVal = value) : (node.className = value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å­—ç¬¦ä¸²å˜æˆå“åº”çš„å¯¹è±¡æˆ–è€…å€¼ï¼Œä¾‹å¦‚æºä»£ç çš„æ³¨é‡Šï¼š</span></span><br><span class="line">  <span class="comment">// "true"  =&gt; true</span></span><br><span class="line">  <span class="comment">// "false" =&gt; false</span></span><br><span class="line">  <span class="comment">// "null"  =&gt; null</span></span><br><span class="line">  <span class="comment">// "42"    =&gt; 42</span></span><br><span class="line">  <span class="comment">// "42.5"  =&gt; 42.5</span></span><br><span class="line">  <span class="comment">// "08"    =&gt; "08"</span></span><br><span class="line">  <span class="comment">// JSON    =&gt; parse if valid</span></span><br><span class="line">  <span class="comment">// String  =&gt; self</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">deserializeValue</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">        ? <span class="comment">// valueã€æœ‰å€¼ã€çš„æƒ…å†µï¼š</span></span><br><span class="line">          value == <span class="string">"true"</span> || <span class="comment">// å¦‚æœ value == 'true'ï¼Œé‚£ä¹ˆè¿™ä¸ªè¡¨è¾¾å¼æœ¬èº«å°±è¿”å› true ï¼Œå¯¼è‡´æ•´ä¸ªå‡½æ•°è¿”å›true</span></span><br><span class="line">            <span class="comment">// value !== 'true' çš„æƒ…å†µï¼š</span></span><br><span class="line">            (value == <span class="string">"false"</span></span><br><span class="line">              ? <span class="literal">false</span> <span class="comment">// "null"  =&gt; null</span></span><br><span class="line">              : value == <span class="string">"null"</span></span><br><span class="line">              ? <span class="literal">null</span> <span class="comment">// "null"  =&gt; null</span></span><br><span class="line">              : +value + <span class="string">""</span> == value</span><br><span class="line">              ? +value <span class="comment">// æ•°å­—ï¼š"42" =&gt; 42  "42.5" =&gt; 42.5  ï¼ˆ ä½†æ˜¯ '08' å´ä¸ç¬¦åˆè¿™ä¸ªæ¡ä»¶ ï¼‰</span></span><br><span class="line">              : <span class="regexp">/^[\[\&#123;]/</span>.test(value)</span><br><span class="line">              ? $.parseJSON(value) <span class="comment">// '[...]' æˆ–è€… '&#123;...&#125;'</span></span><br><span class="line">              : value) <span class="comment">// å…¶ä»–</span></span><br><span class="line">        : <span class="comment">// valueã€æ— å€¼ã€çš„æƒ…å†µï¼š undefined / '' / flase / 0 / null</span></span><br><span class="line">          value;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†ä¸Šæ–‡å®šä¹‰çš„å‡½æ•°ï¼Œæš´éœ²ç»™ $ å¯¹è±¡ï¼ˆå…¶å® $ æ˜¯ä¸€ä¸ª functionï¼‰</span></span><br><span class="line">  $.type = type;</span><br><span class="line">  $.isFunction = isFunction;</span><br><span class="line">  $.isWindow = isWindow;</span><br><span class="line">  $.isArray = isArray;</span><br><span class="line">  $.isPlainObject = isPlainObject;</span><br><span class="line"></span><br><span class="line">  $.isEmptyObject = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name;</span><br><span class="line">    <span class="keyword">for</span> (name <span class="keyword">in</span> obj) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $.inArray = <span class="function"><span class="keyword">function</span>(<span class="params">elem, array, i</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> emptyArray.indexOf.call(array, elem, i);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $.camelCase = camelize;</span><br><span class="line">  $.trim = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str == <span class="literal">null</span> ? <span class="string">""</span> : <span class="built_in">String</span>.prototype.trim.call(str);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// plugin compatibility</span></span><br><span class="line">  $.uuid = <span class="number">0</span>;</span><br><span class="line">  $.support = &#123;&#125;;</span><br><span class="line">  $.expr = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡æ–°ç»„ç»‡ elements å¯¹è±¡ï¼ˆæ•°ç»„ã€å¯¹è±¡æˆ–è€…å¯¹è±¡æ•°ç»„ï¼‰ï¼Œé’ˆå¯¹æ¯ä¸€ä¸ªå…ƒç´ ï¼Œéƒ½ç”¨ callback è¿›è¡Œæ£€éªŒ</span></span><br><span class="line">  <span class="comment">// æ£€éªŒé€šè¿‡åï¼Œå°†å…ƒç´ pushè¿›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå¹¶è¿”å›</span></span><br><span class="line">  $.map = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value,</span><br><span class="line">      values = [],</span><br><span class="line">      i,</span><br><span class="line">      key;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•°ç»„ï¼Œæˆ–è€…å¯¹è±¡æ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (likeArray(elements))</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.length; i++) &#123;</span><br><span class="line">        <span class="comment">// éå†ï¼Œç»è¿‡ callback éªŒè¯ï¼Œpushåˆ°ç»“æœä¸­</span></span><br><span class="line">        value = callback(elements[i], i);</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) values.push(value);</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="comment">// å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">for</span> (key <span class="keyword">in</span> elements) &#123;</span><br><span class="line">        <span class="comment">// éå†ï¼Œç»è¿‡ callback éªŒè¯ï¼Œpushåˆ°ç»“æœä¸­</span></span><br><span class="line">        value = callback(elements[key], key);</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) values.push(value);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›æ•°ç»„</span></span><br><span class="line">    <span class="comment">// flatten å‡½æ•°ä¸Šæ–‡å®šä¹‰çš„ï¼Œä½œç”¨ï¼šæ— è®º values æ˜¯å¦æ˜¯æ•°ç»„ï¼Œéƒ½å°†è¿”å›ä¸€ä¸ªæ­£ç¡®çš„æ•°ç»„ã€‚ä¾‹å¦‚ï¼Œä¼ å…¥ 'abc' ï¼Œè¿”å› ['abc']</span></span><br><span class="line">    <span class="keyword">return</span> flatten(values);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éå† elements æ‰€æœ‰å…ƒç´ ï¼ˆæ•°ç»„ã€å¯¹è±¡æ•°ç»„ã€å¯¹è±¡ï¼‰ï¼Œæ‰§è¡Œ callback æ–¹æ³•ï¼Œæœ€ç»ˆè¿˜æ˜¯è¿”å› elements</span></span><br><span class="line">  <span class="comment">// æ³¨æ„1ï¼šcallback.call(elements[i], i, elements[i]) å‡½æ•°æ‰§è¡Œçš„ç¯å¢ƒå’Œå‚æ•°</span></span><br><span class="line">  <span class="comment">// æ³¨æ„2ï¼š=== false) return elements ä¸€æ—¦æœ‰å‡½æ•°è¿”å› falseï¼Œå³è·³å‡ºå¾ªç¯ï¼Œç±»ä¼¼ break</span></span><br><span class="line">  <span class="comment">// æ³¨æ„3ï¼šæ— è®ºå“ªç§æƒ…å†µï¼Œæœ€ç»ˆè¿”å›çš„è¿˜æ˜¯ elements</span></span><br><span class="line">  $.each = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i, key;</span><br><span class="line">    <span class="keyword">if</span> (likeArray(elements)) &#123;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.length; i++)</span><br><span class="line">        <span class="keyword">if</span> (callback.call(elements[i], i, elements[i]) === <span class="literal">false</span>)</span><br><span class="line">          <span class="keyword">return</span> elements;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (key <span class="keyword">in</span> elements)</span><br><span class="line">        <span class="keyword">if</span> (callback.call(elements[key], key, elements[key]) === <span class="literal">false</span>)</span><br><span class="line">          <span class="keyword">return</span> elements;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> elements;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸Šæ–‡å®šä¹‰ï¼šfilter = emptyArray.filter</span></span><br><span class="line">  <span class="comment">// ç­›é€‰æ•°ç»„</span></span><br><span class="line">  $.grep = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> filter.call(elements, callback);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.JSON) $.parseJSON = <span class="built_in">JSON</span>.parse;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Populate the class2type map</span></span><br><span class="line">  $.each(</span><br><span class="line">    <span class="string">"Boolean Number String Function Array Date RegExp Object Error"</span>.split(<span class="string">" "</span>),</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">i, name</span>) </span>&#123;</span><br><span class="line">      class2type[<span class="string">"[object "</span> + name + <span class="string">"]"</span>] = name.toLowerCase();</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">      ä¸Šæ–‡å°† class2type èµ‹å€¼ä¸º &#123;&#125;</span></span><br><span class="line"><span class="comment">      æœ€ç»ˆå°† class2type èµ‹å€¼ä¸ºï¼š</span></span><br><span class="line"><span class="comment">      &#123;</span></span><br><span class="line"><span class="comment">        '[object boolean]': 'boolean',</span></span><br><span class="line"><span class="comment">        '[object number]': 'number',</span></span><br><span class="line"><span class="comment">        '[object string]': 'string',</span></span><br><span class="line"><span class="comment">        ...</span></span><br><span class="line"><span class="comment">      &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      å­˜å‚¨è¿™ä¸ªæ•°æ®æ˜¯ä¸ºäº†æ–¹ä¾¿çš„è·å–ä¸€äº›å¯¹è±¡çš„ç±»å‹ï¼Œ</span></span><br><span class="line"><span class="comment">      ä¾‹å¦‚ Object.prototype.toString.call([]) è¿”å›çš„æ˜¯ '[Object Array]'</span></span><br><span class="line"><span class="comment">      é‚£ä¹ˆå³å¯æ ¹æ®è¿™ä¸ªè·å– [] çš„ç±»å‹æ˜¯ 'array'</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Define methods that will be available on all</span></span><br><span class="line">  <span class="comment">// Zepto collections</span></span><br><span class="line">  $.fn = &#123;</span><br><span class="line">    <span class="comment">// ä¸ºä½•è¦è¿™ä¹ˆå¤šæ•°ç»„çš„æ–¹æ³•ï¼Ÿ</span></span><br><span class="line">    <span class="comment">// å› ä¸ºä¸€ä¸ª zepto å¯¹è±¡ï¼Œæœ¬èº«å°±æ˜¯ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Because a collection acts like an array</span></span><br><span class="line">    <span class="comment">// copy over these useful array functions.</span></span><br><span class="line">    forEach: emptyArray.forEach,</span><br><span class="line">    reduce: emptyArray.reduce, <span class="comment">// æ–¹æ³•ä½•ç”¨ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line">    push: emptyArray.push,</span><br><span class="line">    sort: emptyArray.sort,</span><br><span class="line">    indexOf: emptyArray.indexOf,</span><br><span class="line">    concat: emptyArray.concat,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// `map` and `slice` in the jQuery API work differently</span></span><br><span class="line">    <span class="comment">// from their array counterparts</span></span><br><span class="line">    map: <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// $.map ä¸Šæ–‡å®šä¹‰çš„ï¼Œ $.map = function (elements, callback) &#123;....&#125;</span></span><br><span class="line">      <span class="comment">// $.map ä½œç”¨ï¼šé’ˆå¯¹ elementsï¼ˆå¯¹è±¡ã€å¯¹è±¡æ•°ç»„æˆ–æ•°ç»„ï¼‰ï¼Œå¯¹æ¯ä¸ªå…ƒç´ éƒ½ç»è¿‡ callback å‡½æ•°çš„è¿‡æ»¤ï¼Œå¹¶å°†è¿‡æ»¤é€šè¿‡çš„å…ƒç´ ï¼Œpushåˆ°ä¸€ä¸ªæ–°æ•°ç»„ä¸­ï¼Œè¿”å›æ–°æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// æœ€åï¼Œç”¨ $ å°è£…è¿”å›</span></span><br><span class="line">      <span class="keyword">return</span> $(</span><br><span class="line">        <span class="comment">// $.map è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">        $.map(</span><br><span class="line">          <span class="keyword">this</span>,</span><br><span class="line">          <span class="comment">// é’ˆå¯¹æ¯ä¸€ä¸ªå…ƒç´ ï¼Œéƒ½æ‰§è¡Œä¼ å…¥çš„å‡½æ•°ï¼Œå¦‚æœå‡½æ•°è¿”å›çš„ !=null å°±å°†æ’å…¥åˆ°æ–°è¿”å›çš„æ•°ç»„</span></span><br><span class="line">          <span class="function"><span class="keyword">function</span>(<span class="params">el, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> fn.call(el, i, el);</span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        $('div').map(function(key, value)&#123;</span></span><br><span class="line"><span class="comment">          return value.id;</span></span><br><span class="line"><span class="comment">          // æˆ–è€… return this.id;</span></span><br><span class="line"><span class="comment">        &#125;)</span></span><br><span class="line"><span class="comment">        è¿™ä¸ªç»“æœå°±æ˜¯ $(['div1', 'div2' ...])</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    slice: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ç›´æ¥æ•°ç»„çš„sliceæ–¹æ³•ï¼Œå¹¶å°†ç»“æœç”¨ $ å°è£…è¿”å›</span></span><br><span class="line">      <span class="keyword">return</span> $(slice.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>));</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨ zepto.init å‡½æ•°ä¸­ï¼Œå½“ä¼ å…¥çš„å‡½æ•°æ˜¯å‡½æ•°æ—¶ï¼Œå°±ç”¨åˆ°äº† ready</span></span><br><span class="line">    <span class="comment">// else if (isFunction(selector)) return $(document).ready(selector)</span></span><br><span class="line">    ready: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// need to check if document.body exists for IE as that browser reports</span></span><br><span class="line">      <span class="comment">// document ready when it hasn't yet created the body element</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// ä¸‹æ–‡å®šä¹‰ï¼šreadyRE = /complete|loaded|interactive/,</span></span><br><span class="line">      <span class="keyword">if</span> (readyRE.test(<span class="built_in">document</span>.readyState) &amp;&amp; <span class="built_in">document</span>.body) callback($);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">document</span>.addEventListener(</span><br><span class="line">          <span class="string">"DOMContentLoaded"</span>,</span><br><span class="line">          <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            callback($);</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="literal">false</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è¿”å›å½“å‰å¯¹è±¡</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    get: <span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> idx === <span class="literal">undefined</span></span><br><span class="line">        ? slice.call(<span class="keyword">this</span>) <span class="comment">// æœªä¼ å‚æ•°ï¼Œç›´æ¥è¿”å›ä¸€æ•´ä¸ªæ•°ç»„</span></span><br><span class="line">        : <span class="comment">// æœ‰å‚æ•°ï¼Œåˆ™è¯•å›¾è¿”å›å•ä¸ªå…ƒç´ ï¼ˆå¤§äº0ï¼Œå°äº0 ä¸¤ç§æƒ…å†µï¼‰</span></span><br><span class="line">          <span class="keyword">this</span>[idx &gt;= <span class="number">0</span> ? idx : idx + <span class="keyword">this</span>.length];</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†zeptoé›†åˆå˜ä¸ºçº¯æ•°ç»„</span></span><br><span class="line">    toArray: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.get();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    size: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.length;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å…ƒç´ ä»è¿™ä¸ªDOMæ ‘ä¸­ç§»é™¤</span></span><br><span class="line">    remove: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.parentNode != <span class="literal">null</span>) <span class="keyword">this</span>.parentNode.removeChild(<span class="keyword">this</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    each: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// [].every ES5ä¸­Arrayçš„æ–°ç‰¹æ€§ã€‚å¾ªç¯æ•°ç»„æ¯ä¸ªå…ƒç´ ï¼Œè¿”å›æ˜¯å¦ç¬¦åˆcallbackå‡½æ•°çš„è¦æ±‚</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// every å‡½æ•°è¿”å›çš„æ˜¯ false æˆ–è€… trueï¼ˆä¸è¿‡è¿™é‡Œè¿”å›ä»€ä¹ˆæ— æ‰€è°“ï¼Œæ‰§è¡Œå°±å¯ä»¥äº†ï¼‰</span></span><br><span class="line">      emptyArray.every.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el, idx</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> callback.call(el, idx, el) !== <span class="literal">false</span>;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æœ€åè¿”å›æœ¬èº«å¯¹è±¡</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    filter: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// notå‡½æ•°ä¸‹æ–‡å®šä¹‰</span></span><br><span class="line">      <span class="comment">// å¦‚æœç»™notä¼ å…¥çš„å‚æ•°æ˜¯å‡½æ•°ï¼Œåˆ™è¿”å›ä¸ç¬¦åˆè¿™ä¸ªå‡½æ•°è§„åˆ™çš„å…ƒç´ çš„æ•°ç»„ï¼ˆç”¨ $ å°è£…ï¼‰</span></span><br><span class="line">      <span class="keyword">if</span> (isFunction(selector)) <span class="keyword">return</span> <span class="keyword">this</span>.not(<span class="keyword">this</span>.not(selector));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ä¸Šæ–‡å®šä¹‰ï¼šzepto.matches åˆ¤æ–­elementsæ˜¯å¦ç¬¦åˆ selector çš„è¦æ±‚</span></span><br><span class="line">      <span class="comment">// zepto.matches = function(element, selector) &#123;...&#125;</span></span><br><span class="line">      <span class="keyword">return</span> $(</span><br><span class="line">        filter.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// åˆ©ç”¨ [].filter æ–¹æ³•åšç­›é€‰ï¼Œåˆ©ç”¨ zepto.matches åšåˆ¤æ–­</span></span><br><span class="line">          <span class="keyword">return</span> zepto.matches(element, selector);</span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// $('div') å¯èƒ½åªæœ‰ä¸‰ä¸ª div èŠ‚ç‚¹ï¼Œé‚£ä¹ˆ $('div').add('p') å†ä¸‰ä¸ª div èŠ‚ç‚¹çš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸‰ä¸ª p èŠ‚ç‚¹</span></span><br><span class="line">    add: <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// uniqå‡½æ•°â€”â€”æ•°ç»„å»é‡ï¼Œä¾‹å¦‚ï¼šç”¨æ¥å°† [1,1,2,2,3,3] æ›¿æ¢ä¸º [1,2,3]</span></span><br><span class="line">      <span class="keyword">return</span> $(uniq(<span class="keyword">this</span>.concat($(selector, context))));</span><br><span class="line">    &#125;,</span><br><span class="line">    is: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// æ³¨æ„ï¼šè¿™é‡Œåªå¯¹ this[0] ç¬¬ä¸€ä¸ªå…ƒç´ åšåˆ¤æ–­äº†ï¼Œå…¶ä»–çš„å…ƒç´ ä¸ç®¡äº†</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.length &gt; <span class="number">0</span> &amp;&amp; zepto.matches(<span class="keyword">this</span>[<span class="number">0</span>], selector);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    not: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> nodes = []; <span class="comment">// å­˜å‚¨æœ€åè¿”å›çš„ç»“æœ</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœå‚æ•°æ˜¯å‡½æ•°</span></span><br><span class="line">      <span class="keyword">if</span> (isFunction(selector) &amp;&amp; selector.call !== <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// éå†å¯¹è±¡çš„æ‰€æœ‰å…ƒç´ ï¼Œå¯¹æ¯ä¸ªå…ƒç´ éƒ½æ‰§è¡Œä¼ å…¥çš„å‡½æ•°</span></span><br><span class="line">          <span class="comment">// å½“å‡½æ•°è¿”å› false æ—¶ï¼ˆå³ä¸ç¬¦åˆå‡½æ•°çš„è§„åˆ™ï¼‰ï¼Œåˆ™å°†å½“å‰å…ƒç´ pushåˆ°ç»“æœä¸­ï¼Œç­‰å¾…è¿”å›</span></span><br><span class="line">          <span class="keyword">if</span> (!selector.call(<span class="keyword">this</span>, idx)) nodes.push(<span class="keyword">this</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">      <span class="comment">// å¦‚æœå‚æ•°ä¸æ˜¯å‡½æ•°</span></span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸º excludes èµ‹å€¼</span></span><br><span class="line">        <span class="keyword">var</span> excludes =</span><br><span class="line">          <span class="comment">// å¦‚æœ selector æ˜¯å­—ç¬¦ä¸²ï¼ˆcssé€‰æ‹©å™¨ï¼‰ï¼Œåˆ™ç”¨filterè¿‡æ»¤ï¼Œå°†ç»“æœå­˜å‚¨åˆ° excludes ä¸­</span></span><br><span class="line">          <span class="keyword">typeof</span> selector == <span class="string">"string"</span></span><br><span class="line">            ? <span class="keyword">this</span>.filter(selector)</span><br><span class="line">            : <span class="comment">// å¦‚æœ selector ä¸æ˜¯å­—ç¬¦ä¸²</span></span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯æ•°ç»„æˆ–è€…å¯¹è±¡æ•°ç»„ï¼ˆå¹¶ä¸” selector.item æ˜¯å‡½æ•°ï¼Ÿï¼Ÿï¼Ÿï¼‰ï¼Œåˆ™ç”Ÿæˆæ•°ç»„ï¼Œèµ‹å€¼ç»™ excludes</span></span><br><span class="line">            likeArray(selector) &amp;&amp; isFunction(selector.item)</span><br><span class="line">            ? slice.call(selector)</span><br><span class="line">            : <span class="comment">// å¦åˆ™ç›´æ¥ç”Ÿæˆ zepto å¯¹è±¡ï¼Œèµ‹å€¼ç»™ excludes</span></span><br><span class="line">              $(selector);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è‡³æ­¤ï¼Œexcludes ä¸­å°±å­˜å‚¨äº†é€šè¿‡ selector æŸ¥æ‰¾å‡ºæ¥çš„å…ƒç´ </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// [].forEach æ˜¯ES5çš„æ–°ç‰¹æ€§</span></span><br><span class="line">        <span class="keyword">this</span>.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// å–å‡º excludes ä¸­ä¸åŒ…å«çš„å…ƒç´ ï¼Œpushåˆ°ç»“æœä¸­</span></span><br><span class="line">          <span class="keyword">if</span> (excludes.indexOf(el) &lt; <span class="number">0</span>) nodes.push(el);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è¿”å›æœ€åçš„ç»“æœï¼Œç”¨ $ å°è£…</span></span><br><span class="line">      <span class="keyword">return</span> $(nodes);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    has: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ç»è¿‡ filter å‡½æ•°å¤„ç†ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªå¤„ç†åçš„å€¼</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isObject(selector)</span><br><span class="line">          ? <span class="comment">// å¦‚æœ seletor æ˜¯ objectï¼ˆå¯èƒ½æ˜¯elemèŠ‚ç‚¹ï¼‰ï¼Œåˆ™ç”¨ $.contains åˆ¤æ–­</span></span><br><span class="line">            $.contains(<span class="keyword">this</span>, selector)</span><br><span class="line">          : <span class="comment">// å¦åˆ™ï¼ˆselectoræ˜¯cssé€‰æ‹©å­—ç¬¦ä¸²ï¼‰åˆ™è¿”å›findåçš„sizeï¼ˆå¦‚æœ size === 0 å³ç›¸å½“äºè¿”å› falseï¼‰</span></span><br><span class="line">            $(<span class="keyword">this</span>)</span><br><span class="line">              .find(selector)</span><br><span class="line">              .size();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// $.fn.find åœ¨ä¸‹æ–‡å®šä¹‰</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    eq: <span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// å–å‡ºæŒ‡å®šindexçš„å…ƒç´ </span></span><br><span class="line">      <span class="comment">// å¯æ”¯æŒ -1ã€0ã€1ã€2 â€¦â€¦</span></span><br><span class="line">      <span class="keyword">return</span> idx === <span class="number">-1</span> ? <span class="keyword">this</span>.slice(idx) : <span class="keyword">this</span>.slice(idx, +idx + <span class="number">1</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    first: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> el = <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line">      <span class="comment">// ä¸æ˜¯ object åˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">      <span class="comment">// æ˜¯ object ç±»å‹ï¼Œåˆ™ç”¨ $ å°è£… ï¼ˆå› ä¸ºæ—¶åˆ»éƒ½è¦æ”¯æŒé“¾å¼æ“ä½œï¼ï¼ï¼ï¼‰</span></span><br><span class="line">      <span class="keyword">return</span> el &amp;&amp; !isObject(el) ? el : $(el);</span><br><span class="line">    &#125;,</span><br><span class="line">    last: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> el = <span class="keyword">this</span>[<span class="keyword">this</span>.length - <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">return</span> el &amp;&amp; !isObject(el) ? el : $(el);</span><br><span class="line">    &#125;,</span><br><span class="line">    find: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// result å­˜å‚¨è¿”å›ç»“æœ</span></span><br><span class="line">      <span class="keyword">var</span> result,</span><br><span class="line">        $<span class="keyword">this</span> = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œå°±è¿”å›ä¸€ä¸ªç©ºçš„ zepto å¯¹è±¡</span></span><br><span class="line">      <span class="keyword">if</span> (!selector) result = $();</span><br><span class="line">      <span class="comment">// å¦‚æœselectoræ˜¯å¯¹è±¡</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">"object"</span>)</span><br><span class="line">        result = $(selector).filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> node = <span class="keyword">this</span>;</span><br><span class="line">          <span class="keyword">return</span> emptyArray.some.call($<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">parent</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> $.contains(parent, node);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      <span class="comment">// å¦‚æœ selector ä¸æ˜¯å¯¹è±¡ï¼ˆå³æ˜¯cssé€‰æ‹©å™¨ï¼‰ï¼š</span></span><br><span class="line">      <span class="comment">// å¦‚æœåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™ä½¿ç”¨ qsa åˆ¤æ–­ï¼Œç»“æœç»è¿‡ $ å°è£…åèµ‹å€¼ç»™ result</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.length == <span class="number">1</span>) result = $(zepto.qsa(<span class="keyword">this</span>[<span class="number">0</span>], selector));</span><br><span class="line">      <span class="comment">// å¦‚æœæœ‰å¤šä¸ªå…ƒç´ ï¼Œåˆ™ä½¿ç”¨ map éå†æ‰€æœ‰å…ƒç´ ï¼Œä½¿ç”¨ qsa é’ˆå¯¹æ¯ä¸ªå…ƒç´ åˆ¤æ–­ï¼Œç¬¦åˆæ¡ä»¶å³è¿”å›ï¼ˆmapå°†è¿”å›åŒ…å«ç¬¦åˆæ¡ä»¶çš„å…ƒç´ çš„æ–°æ•°ç»„ï¼Œå¹¶ $ å°è£…ï¼Œæ”¯æŒé“¾å¼æ“ä½œï¼ï¼ï¼‰</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        result = <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> zepto.qsa(<span class="keyword">this</span>, selector);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è¿”å›æœ€ç»ˆç»“æœ</span></span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»å…ƒç´ æœ¬èº«å¼€å§‹ï¼Œé€çº§å‘ä¸Šçº§å…ƒç´ åŒ¹é…ï¼Œå¹¶è¿”å›æœ€å…ˆåŒ¹é…selectorçš„å…ƒç´ </span></span><br><span class="line">    closest: <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> node = <span class="keyword">this</span>[<span class="number">0</span>],</span><br><span class="line">        collection = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœ selector æ˜¯å¯¹è±¡ï¼Œåˆ™ç”¨ $ å°è£…åï¼Œèµ‹å€¼ç»™ collection</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">"object"</span>) collection = $(selector);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">while</span> (</span><br><span class="line">        <span class="comment">// whileå¾ªç¯çš„åˆ¤æ–­æ¡ä»¶ï¼š</span></span><br><span class="line">        <span class="comment">// ç¬¬ä¸€ï¼Œnodeæœ‰å€¼ï¼ˆnodeä¸€å¼€å§‹è¢«èµ‹å€¼ä¸ºå¯¹è±¡çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰</span></span><br><span class="line">        <span class="comment">// ç¬¬äºŒï¼Œcollectionæœ‰å€¼ï¼ˆä¼ å…¥çš„selectoræ˜¯å¯¹è±¡ï¼‰åˆ™collectionåŒ…å«nodeï¼›collectionæ— å€¼ï¼ˆä¼ å…¥çš„selectoræ˜¯å­—ç¬¦ä¸²ï¼Œcssé€‰æ‹©ï¼‰ï¼Œåˆ™nodeæ»¡è¶³selectoræ¡ä»¶</span></span><br><span class="line">        <span class="comment">// æ»¡è¶³ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œä¸æ»¡è¶³ç¬¬äºŒæ¡ä»¶ï¼Œåˆ™å¾ªç¯ç»§ç»­ï¼ˆnodeè¯•å›¾èµ‹å€¼ä¸ºnode.parentNodeï¼‰ï¼›å¦åˆ™ï¼Œå¾ªç¯è·³å‡ºï¼ˆè¯´æ˜å·²ç»æ‰¾åˆ°äº†ç¬¦åˆæ¡ä»¶çš„çˆ¶èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">        node &amp;&amp;</span><br><span class="line">        !(collection</span><br><span class="line">          ? collection.indexOf(node) &gt;= <span class="number">0</span></span><br><span class="line">          : zepto.matches(node, selector))</span><br><span class="line">      )</span><br><span class="line">        <span class="comment">// nodeèµ‹å€¼æˆ node.parentNode</span></span><br><span class="line">        <span class="comment">// å‰ææ¡ä»¶æ˜¯ï¼šnode != context &amp;&amp; node ä¸æ˜¯ documentï¼Œå¦‚æœæ˜¯è¿™ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼Œé‚£å°±ä¸ç»§ç»­èµ‹å€¼</span></span><br><span class="line">        node = node !== context &amp;&amp; !isDocument(node) &amp;&amp; node.parentNode;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è¿”å›æœ€ç»ˆç»“æœ</span></span><br><span class="line">      <span class="keyword">return</span> $(node);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡é›†åˆæ¯ä¸ªå…ƒç´ æ‰€æœ‰çš„ç¥–å…ˆå…ƒç´ ã€‚ $('h1').parents() =&gt; [&lt;div#container&gt;, &lt;body&gt;, &lt;html&gt;]</span></span><br><span class="line">    parents: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> ancestors = [],</span><br><span class="line">        nodes = <span class="keyword">this</span>;</span><br><span class="line">      <span class="keyword">while</span> (nodes.length &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// å¯èƒ½éœ€è¦æ‰§è¡Œå¤šæ¬¡ while å¾ªç¯</span></span><br><span class="line">        <span class="comment">// æ¯æ¬¡æ‰§è¡Œ $.map å‡½æ•°éƒ½ä¼šå¯¹ nodes é‡æ–°èµ‹å€¼ï¼Œç„¶åå†åˆ¤æ–­æ˜¯å¦éœ€è¦ç»§ç»­å¾ªç¯</span></span><br><span class="line">        <span class="comment">// å› ä¸ºè¦è·å–æ¯ä¸ªå…ƒç´ çš„æ‰€æœ‰ç¥–å…ˆå…ƒç´ ï¼Œæ‰€ä»¥è¦å¤šæ¬¡å¾ªç¯</span></span><br><span class="line">        nodes = $.map(nodes, <span class="function"><span class="keyword">function</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// ä½¿ç”¨ $.mapï¼ˆè¿”å›ç¬¦åˆæ¡ä»¶çš„å…ƒç´ çš„æ–°æ•°ç»„ï¼Œå¹¶ç”¨ $ å°è£…ï¼‰éå†æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">          <span class="keyword">if</span> (</span><br><span class="line">            (node = node.parentNode) &amp;&amp;</span><br><span class="line">            !isDocument(node) &amp;&amp;</span><br><span class="line">            ancestors.indexOf(node) &lt; <span class="number">0</span></span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="comment">// å°†ç¬¦åˆæ¡ä»¶çš„å…ƒç´ pushåˆ°ç»“æœä¸­</span></span><br><span class="line">            <span class="comment">// æ¡ä»¶ï¼šä¸èƒ½æ˜¯ documentï¼Œç»“æœä¸­å…ƒç´ ä¸èƒ½é‡å¤ã€‚å¦åˆ™ä¸æ‰§è¡Œpush</span></span><br><span class="line">            ancestors.push(node);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¿”å›çš„ node ï¼Œå°†æ‹¼æ¥å‡ºæ–°æ•°ç»„ï¼Œé‡æ–°å¤åˆ¶ç»™ nodesï¼Œç„¶åè¯•å›¾ç»§ç»­æ‰§è¡Œ while å¾ªç¯</span></span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœcssé€‰æ‹©å™¨å‚æ•°ç»™å‡ºï¼Œè¿‡æ»¤å‡ºç¬¦åˆæ¡ä»¶çš„å…ƒç´ </span></span><br><span class="line">      <span class="keyword">return</span> filtered(ancestors, selector);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡é›†åˆä¸­æ¯ä¸ªå…ƒç´ çš„ç›´æ¥çˆ¶å…ƒç´ ã€‚å¦‚æœcssé€‰æ‹©å™¨å‚æ•°ç»™å‡ºã€‚è¿‡æ»¤å‡ºç¬¦åˆæ¡ä»¶çš„å…ƒç´ ã€‚</span></span><br><span class="line">    parent: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// pluck å‡½æ•°åœ¨ä¸‹æ–‡å®šä¹‰</span></span><br><span class="line">      <span class="comment">// parent å‡½æ•°ï¼Œåªè·å–ç¬¬ä¸€çº§çˆ¶èŠ‚ç‚¹å³å¯</span></span><br><span class="line">      <span class="keyword">return</span> filtered(uniq(<span class="keyword">this</span>.pluck(<span class="string">"parentNode"</span>)), selector);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å¾—æ¯ä¸ªåŒ¹é…å…ƒç´ é›†åˆå…ƒç´ çš„ç›´æ¥å­å…ƒç´ ï¼Œå¯é€šè¿‡ selector è¿‡æ»¤</span></span><br><span class="line">    children: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> filtered(</span><br><span class="line">        <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> children(<span class="keyword">this</span>);</span><br><span class="line">        &#125;),</span><br><span class="line">        selector</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å¾—æ¯ä¸ªåŒ¹é…å…ƒç´ é›†åˆå…ƒç´ çš„å­å…ƒç´ ï¼ŒåŒ…æ‹¬æ–‡å­—å’Œæ³¨é‡ŠèŠ‚ç‚¹</span></span><br><span class="line">    contents: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> slice.call(<span class="keyword">this</span>.childNodes);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡é›†åˆä¸­æ‰€æœ‰å…ƒç´ çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œå¯é€šè¿‡ selector è¿‡æ»¤</span></span><br><span class="line">    siblings: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> filtered(</span><br><span class="line">        <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params">i, el</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// è·å–å…„å¼ŸèŠ‚ç‚¹</span></span><br><span class="line">          <span class="keyword">return</span> filter.call(children(el.parentNode), <span class="function"><span class="keyword">function</span>(<span class="params">child</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> child !== el;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;),</span><br><span class="line">        selector</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    empty: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.innerHTML = <span class="string">""</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// `pluck` is borrowed from Prototype.js</span></span><br><span class="line">    pluck: <span class="function"><span class="keyword">function</span>(<span class="params">property</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// è·å–è‡ªå®šä¹‰å±æ€§ï¼Œè¿”å›å€¼ï¼Œæ‹¼æ¥æ•°ç»„</span></span><br><span class="line">      <span class="keyword">return</span> $.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> el[property];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    show: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// è¿”å›å½“å‰å¯¹è±¡ï¼Œä¿è¯å¯é“¾å¼æ“ä½œ</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€æ­¥ï¼Œé’ˆå¯¹å†…è”æ ·å¼ï¼Œå°† none æ”¹ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå¦‚ &lt;p id="p2" style="display:none;"&gt;p2&lt;/p&gt;</span></span><br><span class="line">        <span class="keyword">this</span>.style.display == <span class="string">"none"</span> &amp;&amp; (<span class="keyword">this</span>.style.display = <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¬¬äºŒæ­¥ï¼Œé’ˆå¯¹cssæ ·å¼ï¼Œå¦‚æœæ˜¯ none åˆ™ä¿®æ”¹ä¸ºé»˜è®¤çš„æ˜¾ç¤ºæ ·å¼</span></span><br><span class="line">        <span class="keyword">if</span> (getComputedStyle(<span class="keyword">this</span>, <span class="string">""</span>).getPropertyValue(<span class="string">"display"</span>) == <span class="string">"none"</span>)</span><br><span class="line">          <span class="keyword">this</span>.style.display = defaultDisplay(<span class="keyword">this</span>.nodeName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// show æ–¹æ³•æ˜¯ä¸ºäº†æ˜¾ç¤ºå¯¹è±¡ï¼Œè€Œå¯¹è±¡éšè—çš„æ–¹å¼æœ‰ä¸¤ç§ï¼šå†…è”æ ·å¼ æˆ– cssæ ·å¼</span></span><br><span class="line">        <span class="comment">// this.style.display åªèƒ½è·å–å†…è”æ ·å¼çš„å€¼ï¼ˆè·å–å±æ€§å€¼ï¼‰</span></span><br><span class="line">        <span class="comment">// getComputedStyle(this, '').getPropertyValue("display") å¯ä»¥è·å–å†…è”ã€cssæ ·å¼çš„å€¼ï¼ˆè·å– renderTree çš„å€¼ï¼‰</span></span><br><span class="line">        <span class="comment">// å› æ­¤ï¼Œè¿™ä¸¤æ­¥éƒ½è¦åšåˆ¤æ–­ï¼Œ</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    replaceWith: <span class="function"><span class="keyword">function</span>(<span class="params">newContent</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// å…ˆåœ¨å‰é¢æ’å…¥ï¼Œç„¶åå°†å½“å‰å¯¹è±¡ç§»é™¤</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.before(newContent).remove();</span><br><span class="line">    &#125;,</span><br><span class="line">    wrap: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// æ˜¯å¦æ˜¯å‡½æ•°</span></span><br><span class="line">      <span class="keyword">var</span> func = isFunction(structure);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; !func)</span><br><span class="line">        <span class="keyword">var</span> dom = $(structure).get(<span class="number">0</span>),</span><br><span class="line">          <span class="comment">// ä½•æ—¶ç”¨ clone ï¼Ÿ</span></span><br><span class="line">          <span class="comment">// ç¬¬ä¸€ï¼Œdom.parentNode è¯´æ˜ dom åœ¨æ–‡æ¡£ç»“æ„ä¸­ï¼Œä¸ clone å°±ä¼šè¢«ç§»åŠ¨</span></span><br><span class="line">          <span class="comment">// ç¬¬äºŒï¼Œthis.length &gt; 1 è¯´æ˜å½“å‰å¯¹è±¡æœ‰å¤šä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ éƒ½è¦æ·»åŠ ï¼Œæ‰€æœ‰è¦clone</span></span><br><span class="line">          clone = dom.parentNode || <span class="keyword">this</span>.length &gt; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// å€Ÿç”¨ wrapAll æ–¹æ³•æ¥åšåŒ…è£…</span></span><br><span class="line">        $(<span class="keyword">this</span>).wrapAll(</span><br><span class="line">          func ? structure.call(<span class="keyword">this</span>, index) : clone ? dom.cloneNode(<span class="literal">true</span>) : dom</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// åœ¨æ‰€æœ‰åŒ¹é…å…ƒç´ å¤–é¢åŒ…ä¸€ä¸ªå•ç‹¬çš„ç»“æ„</span></span><br><span class="line">    wrapAll: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">        <span class="comment">// å…ˆå°† structure æ’å…¥åˆ°æ–‡æ¡£ç»“æ„</span></span><br><span class="line">        $(<span class="keyword">this</span>[<span class="number">0</span>]).before((structure = $(structure)));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> children;</span><br><span class="line">        <span class="comment">// drill down to the inmost element</span></span><br><span class="line">        <span class="comment">// é€šè¿‡å¾ªç¯ï¼Œå°† structure é‡æ–°èµ‹å€¼ä¸ºå½“å‰ structure çš„æœ€æ·±å¤„çš„ä¸€ä¸ªå­å…ƒç´ </span></span><br><span class="line">        <span class="keyword">while</span> ((children = structure.children()).length)</span><br><span class="line">          structure = children.first();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†æ‰€æœ‰å­å…ƒç´ éƒ½åŒ…è£¹è¿› structure</span></span><br><span class="line">        $(structure).append(<span class="keyword">this</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è¿”å›å½“å‰å¯¹è±¡</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    wrapInner: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// æ˜¯å¦æ˜¯å‡½æ•°</span></span><br><span class="line">      <span class="keyword">var</span> func = isFunction(structure);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è¿”å›å¯¹è±¡è‡ªèº«ï¼Œä¿è¯é“¾å¼æ“ä½œ</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = $(<span class="keyword">this</span>),</span><br><span class="line">          contents = self.contents(),</span><br><span class="line">          <span class="comment">// æ˜¯å‡½æ•°ï¼Œå³è·å–å‡½æ•°æ‰§è¡Œçš„è¿”å›ç»“æœï¼›å¦åˆ™ç›´æ¥ç”¨ structure å‚æ•°</span></span><br><span class="line">          dom = func ? structure.call(<span class="keyword">this</span>, index) : structure;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰å…ƒç´ æœ‰å†…å®¹ï¼Œåˆ™é€šè¿‡å†…å®¹ wrapAllã€‚æ— å†…å®¹ï¼Œåˆ™ç›´æ¥ç”¨è‡ªèº«çš„ append å¢åŠ </span></span><br><span class="line">        contents.length ? contents.wrapAll(dom) : self.append(dom);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    unwrap: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// é€šè¿‡ this.parent() è·å–æ¯ä¸ªå…ƒç´ çš„çˆ¶èŠ‚ç‚¹ï¼ˆé›†åˆï¼‰</span></span><br><span class="line">      <span class="comment">// éå†è¿™ä¸ªçˆ¶èŠ‚ç‚¹çš„é›†åˆ</span></span><br><span class="line">      <span class="keyword">this</span>.parent().each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// å°†å½“å‰çˆ¶èŠ‚ç‚¹æ›¿æ¢ä¸ºå®ƒçš„å­èŠ‚ç‚¹</span></span><br><span class="line">        $(<span class="keyword">this</span>).replaceWith($(<span class="keyword">this</span>).children());</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è¿”å›å¯¹è±¡è‡ªèº«ï¼Œä¿è¯é“¾å¼æ“ä½œ</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    clone: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// é€šè¿‡ this.map å¾ªç¯å¯¹è±¡ï¼Œ</span></span><br><span class="line">      <span class="comment">// é’ˆå¯¹æ¯ä¸ªå…ƒç´ éƒ½è¿”å›å®ƒçš„clone         è¿™ä¸ª this å’Œå‰é¢çš„ this ä¸ä¸€æ ·</span></span><br><span class="line">      <span class="comment">// è¿”å›æ–°æ•°ç»„ï¼ˆç”¨ $ å°è£…ï¼‰</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.cloneNode(<span class="literal">true</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    hide: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.css(<span class="string">"display"</span>, <span class="string">"none"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// åˆ‡æ¢æ˜¾ç¤ºå’Œéšè—</span></span><br><span class="line">    toggle: <span class="function"><span class="keyword">function</span>(<span class="params">setting</span>) </span>&#123;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        @setting</span></span><br><span class="line"><span class="comment">        true : å¼ºåˆ¶åˆ‡æ¢ä¸º show</span></span><br><span class="line"><span class="comment">        false : å¼ºåˆ¶åˆ‡æ¢ä¸º hide</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> el = $(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¡ä»¶åˆ¤æ–­ï¼š</span></span><br><span class="line">        <span class="comment">// å¦‚æœ setting === undefined åˆ™çœ‹ el.css("display") == "none"</span></span><br><span class="line">        <span class="comment">// å¦‚æœ setting !== undefined åˆ™çœ‹ !!setting</span></span><br><span class="line">        (setting === <span class="literal">undefined</span></span><br><span class="line">        ? el.css(<span class="string">"display"</span>) == <span class="string">"none"</span></span><br><span class="line">        : setting)</span><br><span class="line">          ? el.show() <span class="comment">// å¦‚æœ true åˆ™æ˜¾ç¤º</span></span><br><span class="line">          : el.hide(); <span class="comment">// å¦‚æœ false åˆ™éšè—</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å€ŸåŠ© previousElementSibling å±æ€§</span></span><br><span class="line">    prev: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $(<span class="keyword">this</span>.pluck(<span class="string">"previousElementSibling"</span>)).filter(selector || <span class="string">"*"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å€ŸåŠ© nextElementSibling å±æ€§</span></span><br><span class="line">    next: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $(<span class="keyword">this</span>.pluck(<span class="string">"nextElementSibling"</span>)).filter(selector || <span class="string">"*"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    html: <span class="function"><span class="keyword">function</span>(<span class="params">html</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æƒ…å†µ1ï¼šæœ‰å‚æ•°ï¼Œèµ‹å€¼ï¼Œå¹¶è¿”å›è‡ªèº«</span></span><br><span class="line">      <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span></span><br><span class="line">        ? <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> originHtml = <span class="keyword">this</span>.innerHTML;</span><br><span class="line">            <span class="comment">// ä¼ å…¥çš„ html å‚æ•°å…è®¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå…è®¸æ˜¯ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">            <span class="comment">// é€šè¿‡ funcArg å‡½æ•°ï¼š</span></span><br><span class="line">            <span class="comment">//  1.å¦‚æœ html æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›html</span></span><br><span class="line">            <span class="comment">//  2.å¦‚æœ html æ˜¯å‡½æ•°ï¼Œåˆ™æ‰§è¡Œæ‰§è¡Œå‡½æ•°ï¼ˆä¼ å…¥ idxã€originHtmlï¼‰ï¼Œè¿”å›å‡½æ•°æ‰§è¡Œç»“æœ</span></span><br><span class="line">            $(<span class="keyword">this</span>)</span><br><span class="line">              .empty()</span><br><span class="line">              .append(funcArg(<span class="keyword">this</span>, html, idx, originHtml));</span><br><span class="line">          &#125;)</span><br><span class="line">        : <span class="comment">/*</span></span><br><span class="line"><span class="comment">          æ’æ’­ï¼š</span></span><br><span class="line"><span class="comment">          function funcArg(context, arg, idx, payload) &#123;</span></span><br><span class="line"><span class="comment">            return isFunction(arg) ? arg.call(context, idx, payload) : arg</span></span><br><span class="line"><span class="comment">          &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æƒ…å†µ2ï¼šæ— å‚æ•°ï¼Œå–å€¼</span></span><br><span class="line">        <span class="number">0</span> <span class="keyword">in</span> <span class="keyword">this</span></span><br><span class="line">        ? <span class="keyword">this</span>[<span class="number">0</span>].innerHTML <span class="comment">// ç›´æ¥å–ç¬¬ä¸€ä¸ªå…ƒç´ çš„ innerHTML</span></span><br><span class="line">        : <span class="literal">null</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    text: <span class="function"><span class="keyword">function</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æƒ…å†µ1ï¼šæœ‰å‚æ•°ï¼Œèµ‹å€¼ï¼Œå¹¶è¿”å›è‡ªèº«</span></span><br><span class="line">      <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span></span><br><span class="line">        ? <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// funcArgçš„åº”ç”¨ï¼Œå’Œhtmlæ–¹æ³•ä¸­ä¸€æ ·</span></span><br><span class="line">            <span class="keyword">var</span> newText = funcArg(<span class="keyword">this</span>, text, idx, <span class="keyword">this</span>.textContent);</span><br><span class="line">            <span class="keyword">this</span>.textContent = newText == <span class="literal">null</span> ? <span class="string">""</span> : <span class="string">""</span> + newText;</span><br><span class="line">          &#125;)</span><br><span class="line">        : <span class="comment">// æƒ…å†µ2ï¼šæ— å‚æ•°ï¼Œå–å€¼</span></span><br><span class="line">        <span class="number">0</span> <span class="keyword">in</span> <span class="keyword">this</span></span><br><span class="line">        ? <span class="keyword">this</span>[<span class="number">0</span>].textContent</span><br><span class="line">        : <span class="literal">null</span>; <span class="comment">// ç›´æ¥å€Ÿç”¨ textContent å±æ€§</span></span><br><span class="line">    &#125;,</span><br><span class="line">    attr: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> result;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æƒ…å†µ1ï¼šæ— ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¯»å–å€¼ï¼ˆè¯»å–å€¼åªèƒ½è¯»å–ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼ï¼‰</span></span><br><span class="line">      <span class="keyword">typeof</span> name == <span class="string">"string"</span> &amp;&amp; !(<span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span>)</span><br><span class="line">        ? !<span class="keyword">this</span>.length || <span class="keyword">this</span>[<span class="number">0</span>].nodeType !== <span class="number">1</span></span><br><span class="line">          ? <span class="literal">undefined</span></span><br><span class="line">          : <span class="comment">/*</span></span><br><span class="line"><span class="comment">            æ³¨é‡Šï¼š</span></span><br><span class="line"><span class="comment">            this[0]æ˜¯ä¸€ä¸ªDOMèŠ‚ç‚¹ï¼Œæœ‰ã€å±æ€§ã€ä¹Ÿæœ‰ã€ç‰¹æ€§ã€</span></span><br><span class="line"><span class="comment">              result = this[0].getAttribute(name) è¯•å›¾è·å– DOMèŠ‚ç‚¹å±æ€§</span></span><br><span class="line"><span class="comment">              name in this[0] åˆ¤æ–­æ˜¯ä¸æ˜¯jså¯¹è±¡çš„å±æ€§</span></span><br><span class="line"><span class="comment">            ç„¶åï¼Œè¯¥è¿”å›å“ªä¸€ä¸ªå°±è¿”å›å“ªä¸€ä¸ª</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">          !(result = <span class="keyword">this</span>[<span class="number">0</span>].getAttribute(name)) &amp;&amp; name <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>]</span><br><span class="line">          ? <span class="keyword">this</span>[<span class="number">0</span>][name]</span><br><span class="line">          : result</span><br><span class="line">        : <span class="comment">// æƒ…å†µ2ï¼šæœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œè®¾ç½®å€¼ï¼ˆé’ˆå¯¹æ¯ä¸ªå…ƒç´ è®¾ç½®å€¼ï¼‰</span></span><br><span class="line">          <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.nodeType !== <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä¼ å…¥çš„å‚æ•°å¯èƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡é›†åˆ</span></span><br><span class="line">            <span class="comment">// æ­¤æ—¶ï¼Œæ˜¯ä¸æ˜¯åº”è¯¥æ”¾åœ¨ã€æƒ…å†µ1ã€å½“ä¸­ï¼Ÿï¼Ÿï¼Ÿæ­¤æ—¶ï¼Œvalueæ ¹æœ¬æ²¡æœ‰ç”¨å•Šï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line">            <span class="keyword">if</span> (isObject(name))</span><br><span class="line">              <span class="keyword">for</span> (key <span class="keyword">in</span> name) setAttribute(<span class="keyword">this</span>, key, name[key]);</span><br><span class="line">            <span class="comment">// ä¼ å…¥çš„ä¸æ˜¯å¯¹è±¡ï¼Œå³è®¾ç½®ä¸€ä¸ªå•ä¸€çš„å±æ€§ã€‚</span></span><br><span class="line">            <span class="comment">// ä½†æ˜¯ï¼Œè¿™é‡Œçš„ value å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">            <span class="comment">// funcArg å³å¤„ç†äº† value æ˜¯å‡½æ•°å’Œéå‡½æ•°çš„ä¸¤ç§æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">              setAttribute(</span><br><span class="line">                <span class="keyword">this</span>,</span><br><span class="line">                name,</span><br><span class="line">                funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>.getAttribute(name))</span><br><span class="line">              );</span><br><span class="line">          &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    removeAttr: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nodeType === <span class="number">1</span> &amp;&amp;</span><br><span class="line">          name.split(<span class="string">" "</span>).forEach(</span><br><span class="line">            <span class="function"><span class="keyword">function</span>(<span class="params">attribute</span>) </span>&#123;</span><br><span class="line">              setAttribute(<span class="keyword">this</span>, attribute); <span class="comment">// å°†å±æ€§è®¾ç½®ä¸ºç©ºï¼ŒsetAttributeä¼šç§»é™¤å±æ€§</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">this</span> <span class="comment">// æ”¹å‚æ•°å°†æˆä¸º forEach ä¸­å‡½æ•°çš„this</span></span><br><span class="line">          );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–ã€è®¾ç½®å±æ€§ï¼ˆjså¯¹è±¡çš„å±æ€§ï¼‰</span></span><br><span class="line">    prop: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// propMap ä¸­å­˜å‚¨çš„ï¼škeyæ˜¯htmlä¸­çš„å±æ€§åç§°ï¼Œvalueæ˜¯jså¯¹è±¡ä¸­çš„å±æ€§åç§°</span></span><br><span class="line">      <span class="comment">// ä¾‹å¦‚ï¼Œhtmlä¸­çš„ "class" åœ¨DOMå¯¹è±¡ä¸­ï¼Œå°±éœ€è¦ä½¿ç”¨ "className" è¿™ä¸ªåå­—è¯»å–ï¼ŒåŒç†äºï¼šfor  maxlength  cellspacing ç­‰ç­‰</span></span><br><span class="line">      name = propMap[name] || name;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        ä¸Šæ–‡å®šä¹‰ï¼š</span></span><br><span class="line"><span class="comment">        propMap = &#123;</span></span><br><span class="line"><span class="comment">          'tabindex': 'tabIndex',</span></span><br><span class="line"><span class="comment">          'readonly': 'readOnly',</span></span><br><span class="line"><span class="comment">          'for': 'htmlFor',</span></span><br><span class="line"><span class="comment">          'class': 'className',</span></span><br><span class="line"><span class="comment">          'maxlength': 'maxLength',</span></span><br><span class="line"><span class="comment">          'cellspacing': 'cellSpacing',</span></span><br><span class="line"><span class="comment">          'cellpadding': 'cellPadding',</span></span><br><span class="line"><span class="comment">          'rowspan': 'rowSpan',</span></span><br><span class="line"><span class="comment">          'colspan': 'colSpan',</span></span><br><span class="line"><span class="comment">          'usemap': 'useMap',</span></span><br><span class="line"><span class="comment">          'frameborder': 'frameBorder',</span></span><br><span class="line"><span class="comment">          'contenteditable': 'contentEditable'</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œè®¾ç½®å±æ€§</span></span><br><span class="line">      <span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span></span><br><span class="line">        ? <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// è®¾ç½®å±æ€§å€¼ï¼ŒfuncArgå¤„ç†å‡½æ•°æˆ–è€…éå‡½æ•°</span></span><br><span class="line">            <span class="keyword">this</span>[name] = funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>[name]);</span><br><span class="line">          &#125;)</span><br><span class="line">        : <span class="comment">// æ— ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¯»å–å±æ€§ï¼ˆè¯»å–ç¬¬ä¸€ä¸ªå…ƒç´ çš„ï¼‰</span></span><br><span class="line">          <span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; <span class="keyword">this</span>[<span class="number">0</span>][name];</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰é¢åŠ ä¸Š 'data-' é€šè¿‡ attr è®¾ç½®æˆ–è€…è¯»å–</span></span><br><span class="line">    data: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        ä¸Šæ–‡å®šä¹‰ï¼š</span></span><br><span class="line"><span class="comment">        capitalRE = /([A-Z])/g,  //å¤§å†™å­—æ¯</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//      å‰é¢åŠ ä¸Š 'data-'               å°† 'A' æ›¿æ¢ä¸º '-a'</span></span><br><span class="line">      <span class="keyword">var</span> attrName = <span class="string">"data-"</span> + name.replace(capitalRE, <span class="string">"-$1"</span>).toLowerCase();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> data =</span><br><span class="line">        <span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span> ? <span class="keyword">this</span>.attr(attrName, value) : <span class="keyword">this</span>.attr(attrName);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> data !== <span class="literal">null</span> ? deserializeValue(data) : <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        ä¸Šæ–‡å®šä¹‰çš„ï¼ŒdeserializeValue å‡½æ•°çš„ä½œç”¨æ˜¯ï¼š</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // å°†å­—ç¬¦ä¸²å˜æˆå“åº”çš„å¯¹è±¡æˆ–è€…å€¼ï¼Œä¾‹å¦‚æºä»£ç çš„æ³¨é‡Šï¼š</span></span><br><span class="line"><span class="comment">        // "true"  =&gt; true</span></span><br><span class="line"><span class="comment">        // "false" =&gt; false</span></span><br><span class="line"><span class="comment">        // "null"  =&gt; null</span></span><br><span class="line"><span class="comment">        // "42"    =&gt; 42</span></span><br><span class="line"><span class="comment">        // "42.5"  =&gt; 42.5</span></span><br><span class="line"><span class="comment">        // "08"    =&gt; "08"</span></span><br><span class="line"><span class="comment">        // JSON    =&gt; parse if valid</span></span><br><span class="line"><span class="comment">        // String  =&gt; self</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    val: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æœ‰å‚æ•°ï¼Œè®¾ç½®å€¼</span></span><br><span class="line">      <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span></span><br><span class="line">        ? <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// éå†æ¯ä¸ªå…ƒç´ ï¼Œç›´æ¥å¯¹ value å±æ€§èµ‹å€¼</span></span><br><span class="line">            <span class="keyword">this</span>.value = funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>.value);</span><br><span class="line">          &#125;)</span><br><span class="line">        : <span class="comment">// æ— å‚æ•°ï¼Œè¯»å–å€¼</span></span><br><span class="line">          <span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp;</span><br><span class="line">          <span class="comment">// å¦‚æœå…ƒç´ æ˜¯ &lt;select multiple&gt; å¤šé€‰åˆ—è¡¨</span></span><br><span class="line">          (<span class="keyword">this</span>[<span class="number">0</span>].multiple</span><br><span class="line">            ? <span class="comment">// è¿”å›æ‰€æœ‰é€‰ä¸­çš„optionçš„å€¼çš„æ•°ç»„</span></span><br><span class="line">              $(<span class="keyword">this</span>[<span class="number">0</span>])</span><br><span class="line">                .find(<span class="string">"option"</span>)</span><br><span class="line">                .filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">this</span>.selected;</span><br><span class="line">                &#125;)</span><br><span class="line">                .pluck(<span class="string">"value"</span>)</span><br><span class="line">            : <span class="comment">/*</span></span><br><span class="line"><span class="comment">                      ä¸Šæ–‡å®šä¹‰ï¼š</span></span><br><span class="line"><span class="comment">                      pluck: function(property)&#123;</span></span><br><span class="line"><span class="comment">                        return $.map(this, function(el)&#123; return el[property] &#125;)</span></span><br><span class="line"><span class="comment">                      &#125;,</span></span><br><span class="line"><span class="comment">                   */</span></span><br><span class="line"></span><br><span class="line">              <span class="comment">// å¦‚æœä¸æ˜¯ï¼Œç›´æ¥è·å– value</span></span><br><span class="line">              <span class="keyword">this</span>[<span class="number">0</span>].value);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–ã€è®¾ç½®å…ƒç´ çš„ offset</span></span><br><span class="line">    offset: <span class="function"><span class="keyword">function</span>(<span class="params">coordinates</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæœ‰ coordinates å‚æ•°ï¼Œè®¾ç½®åæ ‡å€¼ï¼Œå¹¶è¿”å›å½“å‰å¯¹è±¡</span></span><br><span class="line">      <span class="keyword">if</span> (coordinates)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),</span><br><span class="line">            <span class="comment">// æ”¯æŒå‡½æ•°ï¼ˆä¼ å…¥ $this.offset() åšå‚æ•°ï¼‰å’Œéå‡½æ•°</span></span><br><span class="line">            coords = funcArg(<span class="keyword">this</span>, coordinates, index, $<span class="keyword">this</span>.offset()),</span><br><span class="line">            <span class="comment">// æ‰¾åˆ°æœ€è¿‘çš„ â€œrelativeâ€, â€œabsoluteâ€ or â€œfixedâ€ çš„ç¥–å…ˆå…ƒç´ ï¼Œå¹¶è·å–å®ƒçš„ offset()</span></span><br><span class="line">            parentOffset = $<span class="keyword">this</span>.offsetParent().offset(),</span><br><span class="line">            <span class="comment">// left å’Œ top éœ€è¦å»æ‰å®šä½çš„ç¥–å…ˆå…ƒç´ çš„ leftã€top å€¼</span></span><br><span class="line">            props = &#123;</span><br><span class="line">              top: coords.top - parentOffset.top,</span><br><span class="line">              left: coords.left - parentOffset.left</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// staticæ—¶ï¼Œè®¾ç½® topã€leftæ˜¯æ— æ•ˆçš„</span></span><br><span class="line">          <span class="keyword">if</span> ($<span class="keyword">this</span>.css(<span class="string">"position"</span>) == <span class="string">"static"</span>) props[<span class="string">"position"</span>] = <span class="string">"relative"</span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// é€šè¿‡ css èµ‹å€¼</span></span><br><span class="line">          $<span class="keyword">this</span>.css(props);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å½“å‰å¯¹è±¡æ˜¯ç©ºï¼Œåˆ™è¿”å› null</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœæ²¡æœ‰ coordinates å‚æ•°ï¼Œåˆ™è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ çš„åæ ‡å€¼</span></span><br><span class="line">      <span class="keyword">var</span> obj = <span class="keyword">this</span>[<span class="number">0</span>].getBoundingClientRect();</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        elem.getBoundingClientRect() è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œ</span></span><br><span class="line"><span class="comment">        åŒ…å«å…ƒç´ çš„ top bottom left right width height çš„å€¼</span></span><br><span class="line"><span class="comment">        ä½†æ˜¯è¿™ä¸ª topã€bottomã€leftã€right æ˜¯ç›¸å¯¹äºæµè§ˆå™¨çª—å£çš„è·ç¦»ï¼Œè€Œä¸æ˜¯é¡µé¢çš„è¾¹ç•Œ</span></span><br><span class="line"><span class="comment">        ï¼ˆæ³¨æ„ï¼Œelem.getBoundingClientRect()åœ¨IEä½ç‰ˆæœ¬æµè§ˆå™¨æœ‰2pxçš„å…¼å®¹é—®é¢˜ï¼‰</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        window.pageXOffset å’Œ window.pageYOffset å¯è·å–ç½‘é¡µæ»šåŠ¨çš„è·ç¦»ï¼Œ</span></span><br><span class="line"><span class="comment">        IEä½ç‰ˆæœ¬éœ€è¦ç”¨ document.body.scrollLeft å’Œ document.body.scrollTop å…¼å®¹</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        left: obj.left + <span class="built_in">window</span>.pageXOffset,</span><br><span class="line">        top: obj.top + <span class="built_in">window</span>.pageYOffset,</span><br><span class="line">        width: <span class="built_in">Math</span>.round(obj.width),</span><br><span class="line">        height: <span class="built_in">Math</span>.round(obj.height)</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®ã€è·å– css</span></span><br><span class="line">    css: <span class="function"><span class="keyword">function</span>(<span class="params">property, value</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œè·å–ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ ·å¼</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> computedStyle,</span><br><span class="line">          element = <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (!element) <span class="keyword">return</span>; <span class="comment">// å¦‚æœç¬¬ä¸€ä¸ªå…ƒç´ æ— å€¼ï¼Œç›´æ¥è¿”å›ã€‚å¦åˆ™ç»§ç»­</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å…ƒç´ çš„è®¡ç®—åçš„æ ·å¼</span></span><br><span class="line">        computedStyle = getComputedStyle(element, <span class="string">""</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> property == <span class="string">"string"</span>)</span><br><span class="line">          <span class="comment">// æƒ…å†µ1ï¼Œå‚æ•°ä¸ºå­—ç¬¦ä¸²å½¢å¼</span></span><br><span class="line">          <span class="comment">// å…ˆä»elemå†…è”æ ·å¼è·å–ï¼ˆelement.styleï¼‰ï¼Œæ­¤æ—¶éœ€è¦ camelize(property) è½¬æ¢ï¼Œå¦‚å°† background-color å˜ä¸º backgroundColor</span></span><br><span class="line">          <span class="comment">// å¦‚æœæœªæ‰¾åˆ°ï¼Œåˆ™ä»cssæ ·å¼è·å– computedStyle.getPropertyValue(property)</span></span><br><span class="line">          <span class="comment">// ï¼ˆé‡è¦ï¼‰æ³¨é‡Šï¼šelem.style åªèƒ½è·å–å…ƒç´ è®¾ç½®çš„å†…è”æ ·å¼ã€ä¸èƒ½è·å–cssæ ·å¼ï¼›è€Œ getComputedStyle å¯è·å–å†…è”ã€cssæ ·å¼ã€‚</span></span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">            element.style[camelize(property)] ||</span><br><span class="line">            computedStyle.getPropertyValue(property)</span><br><span class="line">          );</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (isArray(property)) &#123;</span><br><span class="line">          <span class="comment">// æƒ…å†µ2ï¼Œå‚æ•°ä¸ºæ•°ç»„å½¢å¼ï¼ˆæ³¨æ„ï¼Œæ­¤æ—¶ isObject æƒ…å†µå°šæœªåˆ¤æ–­ï¼‰</span></span><br><span class="line">          <span class="keyword">var</span> props = &#123;&#125;;</span><br><span class="line">          $.each(property, <span class="function"><span class="keyword">function</span>(<span class="params">_, prop</span>) </span>&#123;</span><br><span class="line">            props[prop] =</span><br><span class="line">              element.style[camelize(prop)] ||</span><br><span class="line">              computedStyle.getPropertyValue(prop);</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="keyword">return</span> props; <span class="comment">// è¿”å›ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å…¶ä»–æƒ…å†µï¼šæœ‰ä¸¤ä¸ªå‚æ•°ã€propertyæ˜¯å¯¹è±¡</span></span><br><span class="line">      <span class="keyword">var</span> css = <span class="string">""</span>;</span><br><span class="line">      <span class="keyword">if</span> (type(property) == <span class="string">"string"</span>) &#123;</span><br><span class="line">        <span class="comment">// æƒ…å†µ1ï¼Œproperty æ˜¯å­—ç¬¦ä¸²ï¼Œè®¾ç½®å•ä¸ªæ ·å¼</span></span><br><span class="line">        <span class="keyword">if</span> (!value &amp;&amp; value !== <span class="number">0</span>)</span><br><span class="line">          <span class="comment">// å¦‚æœvalueå‚æ•°æ˜¯ '' null undefined åˆ™ç§»é™¤è¿™ä¸ªcssæ ·å¼</span></span><br><span class="line">          <span class="comment">// æ³¨ï¼šæ­¤è®¡ç®—åªé€‚ç”¨äºå†…è”æ ·å¼çš„åˆ é™¤ï¼Œå¯¹ css æ ·å¼æ— æ•ˆï¼Œå› ä¸ºå®ƒåªé€šè¿‡ this.style.removeProperty è®¡ç®—ï¼Œè€Œ this.style è·å–ä¸åˆ°cssæ ·å¼</span></span><br><span class="line">          <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.style.removeProperty(dasherize(property));</span><br><span class="line">          &#125;);</span><br><span class="line">        <span class="comment">// valueæœ‰æ­£å¸¸å€¼ï¼Œå°† css ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå¦‚ 'font-size:20px'ï¼‰ç­‰å¾…èµ‹å€¼ç»™å†…è”æ ·å¼</span></span><br><span class="line">        <span class="comment">// maybeAddPx(property, value) éœ€è¦å¢åŠ  px çš„å¢åŠ ä¸Š</span></span><br><span class="line">        <span class="keyword">else</span> css = dasherize(property) + <span class="string">":"</span> + maybeAddPx(property, value);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// æƒ…å†µ2ï¼Œproperty æ˜¯å¯¹è±¡ï¼ˆæ­¤æ—¶å°±ä¸ç®¡ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä»€ä¹ˆäº†ï¼Œä¸ç”¨ç¬¬äºŒä¸ªå‚æ•°ï¼‰ï¼Œä¸€æ¬¡æ€§è®¾ç½®å¤šä¸ªæ ·å¼</span></span><br><span class="line">        <span class="keyword">for</span> (key <span class="keyword">in</span> property)</span><br><span class="line">          <span class="keyword">if</span> (!property[key] &amp;&amp; property[key] !== <span class="number">0</span>)</span><br><span class="line">            <span class="comment">// å¦‚æœå¯¹è±¡å±æ€§å€¼æ˜¯ '' null undefined åˆ™ç§»é™¤è¿™ä¸ªcssæ ·å¼ï¼ŒåŒç†ï¼Œåªé’ˆå¯¹å†…è”æ ·å¼</span></span><br><span class="line">            <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">this</span>.style.removeProperty(dasherize(key));</span><br><span class="line">            &#125;);</span><br><span class="line">          <span class="comment">// å¦åˆ™ï¼Œç»™ css èµ‹å€¼ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¤šæ ·å¼å±æ€§ç”¨ ; éš”å¼€</span></span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            css += dasherize(key) + <span class="string">":"</span> + maybeAddPx(key, property[key]) + <span class="string">";"</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// é’ˆå¯¹æ¯ä¸ªå…ƒç´ ï¼Œè®¾ç½®å†…è”æ ·å¼ï¼ˆthis.style.cssTextå¯è·å–ã€è®¾ç½®å†…è”æ ·å¼ï¼‰</span></span><br><span class="line">      <span class="comment">// æœ€åè¿”å›è‡ªèº«</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.style.cssText += <span class="string">";"</span> + css;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        ä¸Šæ–‡å®šä¹‰ï¼š</span></span><br><span class="line"><span class="comment">        // å°† lineHeight è½¬æ¢ä¸º line-height æ ¼å¼</span></span><br><span class="line"><span class="comment">        function dasherize(str) &#123;</span></span><br><span class="line"><span class="comment">          return str.replace(/::/g, '/')</span></span><br><span class="line"><span class="comment">                    .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')</span></span><br><span class="line"><span class="comment">                    .replace(/([a-z\d])([A-Z])/g, '$1_$2')</span></span><br><span class="line"><span class="comment">                    .replace(/_/g, '-')</span></span><br><span class="line"><span class="comment">                    .toLowerCase()</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// è·å–ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•å€¼ï¼ˆä»0å¼€å§‹è®¡æ•°ï¼‰ã€‚å½“elemenå‚æ•°æ²¡æœ‰ç»™å‡ºæ—¶ï¼Œè¿”å›å½“å‰å…ƒç´ åœ¨å…„å¼ŸèŠ‚ç‚¹ä¸­çš„ä½ç½®</span></span><br><span class="line">    index: <span class="function"><span class="keyword">function</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        ä¸Šæ–‡å®šä¹‰ï¼š</span></span><br><span class="line"><span class="comment">        $.fn.indexOf: emptyArray.indexOf</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// å…¶å® this æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„æœ¬èº«å°±æœ‰ indexOf ï¼Œä¸ºä½•è¿˜è¦ä¸Šæ–‡çš„è¿™ä¸ªèµ‹å€¼å‘¢ï¼Ÿ</span></span><br><span class="line">      <span class="comment">// å› ä¸ºä¸Šæ–‡ä¸­ï¼Œthis.__proto__ ä¿®æ”¹äº†ï¼Œä¸æ˜¯ Array.prototype äº†ï¼Œä¹Ÿå°±æ²¡æœ‰ indexOf æ–¹æ³•äº†</span></span><br><span class="line">      <span class="comment">// å› æ­¤è¦æ‰‹åŠ¨èµ‹å€¼ï¼Œéœ€è¦å°†æ•°ç»„å¸¸ç”¨çš„æ–¹æ³•åœ¨é‡æ–°èµ‹å€¼ç»™ $.fn.indexOf</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> element</span><br><span class="line">        ? <span class="keyword">this</span>.indexOf($(element)[<span class="number">0</span>])</span><br><span class="line">        : <span class="keyword">this</span>.parent()</span><br><span class="line">            .children()</span><br><span class="line">            .indexOf(<span class="keyword">this</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;,</span><br><span class="line">    hasClass: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">return</span> emptyArray.some.call(</span><br><span class="line">        <span class="keyword">this</span>,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// this å°±æ˜¯ classRE(name) çš„è¿”å›å€¼ï¼ˆè¿”å›ä¸€ä¸ªæ­£åˆ™ï¼‰</span></span><br><span class="line">          <span class="comment">// function className(node, value)&#123;...&#125; è·å–æˆ–è€…è®¾ç½®elemçš„className</span></span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">this</span>.test(className(el));</span><br><span class="line">        &#125;,</span><br><span class="line">        classRE(name)</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// array.some(callback,[ thisObject]); åªè¦æ•°ç»„ä¸­ä¸€é¡¹ç¬¦åˆcallbackè¦æ±‚ï¼Œå³è¿”å›true</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        // ä¸Šæ–‡å®šä¹‰ classCache = &#123;&#125;</span></span><br><span class="line"><span class="comment">        function classRE(name) &#123;</span></span><br><span class="line"><span class="comment">          return name in classCache ?</span></span><br><span class="line"><span class="comment">                 classCache[name] : </span></span><br><span class="line"><span class="comment">                 (classCache[name] = new RegExp('(^|\\s)' + name + '(\\s|$)'))</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">          // classCache å­˜å‚¨çš„æ•°æ®æ˜¯è¿™æ ·çš„ï¼š</span></span><br><span class="line"><span class="comment">          // &#123;</span></span><br><span class="line"><span class="comment">          //   abc: /(^|\s)abc(\s|$)/,  // èƒ½åŒ¹é… 'abc' æˆ– ' abc ' æˆ– ' abc' æˆ– 'abc '</span></span><br><span class="line"><span class="comment">          //   xyz: /(^|\s)abc(\s|$)/,</span></span><br><span class="line"><span class="comment">          //   ...</span></span><br><span class="line"><span class="comment">          // &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;,</span><br><span class="line">    addClass: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// é’ˆå¯¹æ‰€æœ‰å…ƒç´ éƒ½æ·»åŠ classNameï¼Œæœ€ç»ˆè¿”å›æœ¬èº«</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// è¯´æ˜å½“å‰å…ƒç´ ä¸æ˜¯ DOM node</span></span><br><span class="line">        <span class="keyword">if</span> (!(<span class="string">"className"</span> <span class="keyword">in</span> <span class="keyword">this</span>)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// classList æ˜¯ä¸€å¼€å§‹å°±å®šä¹‰çš„ç©ºå˜é‡</span></span><br><span class="line">        classList = [];</span><br><span class="line">        <span class="comment">// è·å–å…ƒç´ çš„ clasname      // æ”¯æŒä¼ å…¥å‡½æ•°</span></span><br><span class="line">        <span class="keyword">var</span> cls = className(<span class="keyword">this</span>),</span><br><span class="line">          newName = funcArg(<span class="keyword">this</span>, name, idx, cls);</span><br><span class="line">        <span class="comment">// æŠŠè¦èµ‹å€¼çš„å€¼ï¼ŒæŒ‰ç…§ç©ºç™½åˆ†ç»„ï¼Œéå†</span></span><br><span class="line">        newName.split(<span class="regexp">/\s+/g</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// æŠŠå½“å‰å…ƒç´ ä¸å­˜åœ¨çš„classï¼Œpushåˆ°classlistä¸­</span></span><br><span class="line">          <span class="keyword">if</span> (!$(<span class="keyword">this</span>).hasClass(klass)) classList.push(klass);</span><br><span class="line">        &#125;, <span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// å¦‚æœclasslistæœ‰æ•°æ®ï¼Œåˆ™ä¸ºå½“å‰å…ƒç´ èµ‹å€¼æœ€æ–°çš„classå€¼ï¼ˆç°æœ‰çš„classnameå’Œæ–°çš„classnameæ‹¼æ¥ï¼‰</span></span><br><span class="line">        classList.length &amp;&amp;</span><br><span class="line">          className(<span class="keyword">this</span>, cls + (cls ? <span class="string">" "</span> : <span class="string">""</span>) + classList.join(<span class="string">" "</span>));</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    removeClass: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// é’ˆå¯¹æ‰€æœ‰å…ƒç´ éƒ½ç§»é™¤classNameï¼Œæœ€ç»ˆè¿”å›æœ¬èº«</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// è¯´æ˜å½“å‰å…ƒç´ ä¸æ˜¯ DOM node</span></span><br><span class="line">        <span class="keyword">if</span> (!(<span class="string">"className"</span> <span class="keyword">in</span> <span class="keyword">this</span>)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœå‚æ•°ç©ºï¼Œåˆ™ç§»é™¤å…ƒç´ çš„æ‰€æœ‰class</span></span><br><span class="line">        <span class="keyword">if</span> (name === <span class="literal">undefined</span>) <span class="keyword">return</span> className(<span class="keyword">this</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–ç°æœ‰çš„classname</span></span><br><span class="line">        classList = className(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// ï¼ˆå¯ä»¥ä¼ å…¥å‡½æ•°ï¼‰éå†æ–°çš„classnameå­—ç¬¦ä¸²</span></span><br><span class="line">        funcArg(<span class="keyword">this</span>, name, idx, classList)</span><br><span class="line">          .split(<span class="regexp">/\s+/g</span>)</span><br><span class="line">          .forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// classRE(klass) è¿”å›ä¸€ä¸ªæ­£åˆ™ï¼ŒåŒ¹é… 'classname' æˆ– ' classname ' æˆ– ' classname' æˆ– 'classname '</span></span><br><span class="line">            <span class="comment">// é’ˆå¯¹ä¼ å…¥çš„classnameå­—ç¬¦ä¸²ï¼Œå¯¹æ¯ä¸ªç¬¦åˆæ¡ä»¶çš„classnameï¼Œéƒ½æ›¿æ¢ä¸º ' 'ï¼ˆå³åˆ é™¤äº†ï¼‰</span></span><br><span class="line">            classList = classList.replace(classRE(klass), <span class="string">" "</span>);</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹æ•´ç†å¥½çš„classnameï¼Œé‡æ–°èµ‹å€¼ç»™å½“å‰å…ƒç´ </span></span><br><span class="line">        className(<span class="keyword">this</span>, classList.trim());</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    toggleClass: <span class="function"><span class="keyword">function</span>(<span class="params">name, when</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// when å‚æ•°ç›¸å½“äºä¸€ä¸ªæ¡ä»¶ï¼š</span></span><br><span class="line">      <span class="comment">// å¦‚æœ when === true åˆ™å•çº¯æ‰§è¡Œ addClass</span></span><br><span class="line">      <span class="comment">// å¦‚æœ when === false åˆ™å•çº¯æ‰§è¡Œ removeClass</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//                   name å¯æ¥æ”¶å‡½æ•°ï¼Œå¯ä»¥æ˜¯ç©ºç™½åˆ†å‰²å¼€æ¥çš„å¤šä¸ªclassname</span></span><br><span class="line">        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),</span><br><span class="line">          names = funcArg(<span class="keyword">this</span>, name, idx, className(<span class="keyword">this</span>));</span><br><span class="line">        <span class="comment">// ç”¨ç©ºç™½åˆ†å‰²å¼€å¤šä¸ªclass</span></span><br><span class="line">        names.split(<span class="regexp">/\s+/g</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// å¦‚æœæœ‰ when å‚æ•°ï¼Œåˆ™åªé€šè¿‡whenå‚æ•°åˆ¤æ–­ï¼Œtrueåˆ™åªæ‰§è¡ŒaddClassï¼Œfalseåˆ™åªæ‰§è¡ŒremoveClass</span></span><br><span class="line">          <span class="comment">// å¦‚æœæ²¡æœ‰ when å‚æ•°ï¼Œåˆ™åˆ¤æ–­å…ƒç´ æœ‰æ²¡æœ‰è¯¥classï¼Œæœ‰åˆ™ç§»é™¤ï¼Œæ²¡æœ‰åˆ™æ·»åŠ </span></span><br><span class="line">          (when === <span class="literal">undefined</span></span><br><span class="line">          ? !$<span class="keyword">this</span>.hasClass(klass)</span><br><span class="line">          : when)</span><br><span class="line">            ? $<span class="keyword">this</span>.addClass(klass)</span><br><span class="line">            : $<span class="keyword">this</span>.removeClass(klass);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    scrollTop: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ™®é€šelemæœ‰ scrollTop å±æ€§ï¼Œå¯ä»¥è·å–æˆ–è€…è®¾ç½®topå€¼</span></span><br><span class="line">      <span class="comment">// windowå¯¹è±¡æ²¡æœ‰ scrollTop å±æ€§ï¼Œé€šè¿‡ pageYOffset è·å–ï¼Œé€šè¿‡ scrollTo() èµ‹å€¼</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> hasScrollTop = <span class="string">"scrollTop"</span> <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line">      <span class="comment">// value æ— å€¼ï¼Œè·å– top</span></span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">return</span> hasScrollTop ? <span class="keyword">this</span>[<span class="number">0</span>].scrollTop : <span class="keyword">this</span>[<span class="number">0</span>].pageYOffset;</span><br><span class="line">      <span class="comment">// value æœ‰å€¼ï¼Œè®¾ç½® top</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(</span><br><span class="line">        hasScrollTop</span><br><span class="line">          ? <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">this</span>.scrollTop = value;</span><br><span class="line">            &#125;</span><br><span class="line">          : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">this</span>.scrollTo(<span class="keyword">this</span>.scrollX, value);</span><br><span class="line">            &#125;</span><br><span class="line">      ); <span class="comment">// window.scrollX è·å–æ¨ªå‘æ»šåŠ¨å€¼</span></span><br><span class="line">    &#125;,</span><br><span class="line">    scrollLeft: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">var</span> hasScrollLeft = <span class="string">"scrollLeft"</span> <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">return</span> hasScrollLeft ? <span class="keyword">this</span>[<span class="number">0</span>].scrollLeft : <span class="keyword">this</span>[<span class="number">0</span>].pageXOffset;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(</span><br><span class="line">        hasScrollLeft</span><br><span class="line">          ? <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">this</span>.scrollLeft = value;</span><br><span class="line">            &#125;</span><br><span class="line">          : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="keyword">this</span>.scrollTo(value, <span class="keyword">this</span>.scrollY);</span><br><span class="line">            &#125;</span><br><span class="line">      ); <span class="comment">// window.scrollX è·å–çºµå‘æ»šåŠ¨å€¼</span></span><br><span class="line">    &#125;,</span><br><span class="line">    position: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> elem = <span class="keyword">this</span>[<span class="number">0</span>],</span><br><span class="line">        <span class="comment">// Get *real* offsetParent</span></span><br><span class="line">        offsetParent = <span class="keyword">this</span>.offsetParent(), <span class="comment">// æ‰¾åˆ°ç¬¬ä¸€ä¸ªå®šä½è¿‡çš„ç¥–å…ˆå…ƒç´  â€œrelativeâ€, â€œabsoluteâ€ or â€œfixedâ€</span></span><br><span class="line">        <span class="comment">// Get correct offsets</span></span><br><span class="line">        offset = <span class="keyword">this</span>.offset(), <span class="comment">// è·å–è‡ªèº«çš„offset</span></span><br><span class="line">        parentOffset = rootNodeRE.test(offsetParent[<span class="number">0</span>].nodeName)</span><br><span class="line">          ? &#123; <span class="attr">top</span>: <span class="number">0</span>, <span class="attr">left</span>: <span class="number">0</span> &#125;</span><br><span class="line">          : offsetParent.offset(); <span class="comment">// è·å–å®šä½ç¥–å…ˆå…ƒç´ çš„offsetï¼ˆ bodyã€htmlç›´æ¥è®¾ç½® top:0;left:0 ï¼‰</span></span><br><span class="line">      <span class="comment">// ä¸Šæ–‡å®šä¹‰ï¼š rootNodeRE = /^(?:body|html)$/i,</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// å»æ‰å½“å‰å…ƒç´ çš„ margin å®½åº¦</span></span><br><span class="line">      <span class="comment">// Subtract element margins</span></span><br><span class="line">      <span class="comment">// note: when an element has margin: auto the offsetLeft and marginLeft</span></span><br><span class="line">      <span class="comment">// are the same in Safari causing offset.left to incorrectly be 0</span></span><br><span class="line">      offset.top -= <span class="built_in">parseFloat</span>($(elem).css(<span class="string">"margin-top"</span>)) || <span class="number">0</span>;</span><br><span class="line">      offset.left -= <span class="built_in">parseFloat</span>($(elem).css(<span class="string">"margin-left"</span>)) || <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¢åŠ çˆ¶å…ƒç´ çš„ border å®½åº¦</span></span><br><span class="line">      <span class="comment">// Add offsetParent borders</span></span><br><span class="line">      parentOffset.top +=</span><br><span class="line">        <span class="built_in">parseFloat</span>($(offsetParent[<span class="number">0</span>]).css(<span class="string">"border-top-width"</span>)) || <span class="number">0</span>;</span><br><span class="line">      parentOffset.left +=</span><br><span class="line">        <span class="built_in">parseFloat</span>($(offsetParent[<span class="number">0</span>]).css(<span class="string">"border-left-width"</span>)) || <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Subtract the two offsets</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        top: offset.top - parentOffset.top,</span><br><span class="line">        left: offset.left - parentOffset.left</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    offsetParent: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// é€šè¿‡ this.map éå†å½“å‰å¯¹è±¡æ‰€æœ‰å…ƒç´ ï¼Œè¿›è¡Œè®¡ç®—ï¼Œç„¶åæ‹¼æ¥æ–°çš„æ•°ç»„ï¼Œå¹¶è¿”å›ã€‚ä¿è¯é“¾å¼æ“ä½œ</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> parent = <span class="keyword">this</span>.offsetParent || <span class="built_in">document</span>.body; <span class="comment">// elem.offsetParent å¯è¿”å›æœ€è¿‘çš„æ”¹å…ƒç´ æœ€è¿‘çš„å·²ç»å®šä½çš„çˆ¶å…ƒç´ </span></span><br><span class="line">        <span class="keyword">while</span> (</span><br><span class="line">          parent &amp;&amp;</span><br><span class="line">          !rootNodeRE.test(parent.nodeName) &amp;&amp;</span><br><span class="line">          $(parent).css(<span class="string">"position"</span>) == <span class="string">"static"</span></span><br><span class="line">        )</span><br><span class="line">          <span class="comment">// å¦‚æœè·å–çš„parentä¸æ˜¯nullã€ä¸æ˜¯bodyæˆ–htmlã€è€Œä¸”position==static</span></span><br><span class="line">          <span class="comment">// åˆ™ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ offsetParentã€å¤§ä¸äº†æ‰¾åˆ° body ä¸ºæ­¢</span></span><br><span class="line">          parent = parent.offsetParent;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœ€åè¿”å›æ”¹å…ƒç´ </span></span><br><span class="line">        <span class="keyword">return</span> parent;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for now</span></span><br><span class="line">  $.fn.detach = $.fn.remove;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate the `width` and `height` functions</span></span><br><span class="line">  [<span class="string">"width"</span>, <span class="string">"height"</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">dimension</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å°† width height å˜ä¸º  Width Height</span></span><br><span class="line">    <span class="keyword">var</span> dimensionProperty = dimension.replace(<span class="regexp">/./</span>, <span class="function"><span class="keyword">function</span>(<span class="params">m</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> m[<span class="number">0</span>].toUpperCase();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $.fn[dimension] = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> offset,</span><br><span class="line">        el = <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æƒ…å†µ1ï¼Œæ— å‚æ•°ï¼Œè·å–ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼</span></span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">return</span> isWindow(el)</span><br><span class="line">          ? el[<span class="string">"inner"</span> + dimensionProperty] <span class="comment">// window.innerHeight</span></span><br><span class="line">          : isDocument(el)</span><br><span class="line">          ? el.documentElement[<span class="string">"scroll"</span> + dimensionProperty] <span class="comment">// document.documentElement.scrollHeight</span></span><br><span class="line">          : (offset = <span class="keyword">this</span>.offset()) &amp;&amp; offset[dimension];</span><br><span class="line">      <span class="comment">// this.offset().width</span></span><br><span class="line">      <span class="comment">// æƒ…å†µ2ï¼Œæœ‰å‚æ•°ï¼Œè®¾ç½®æ‰€æœ‰å…ƒç´ çš„å€¼</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>) </span>&#123;</span><br><span class="line">          el = $(<span class="keyword">this</span>);</span><br><span class="line">          <span class="comment">// é€šè¿‡ css() æ–¹æ³•è®¾ç½®ï¼Œæ”¯æŒä¼ å…¥å‡½æ•°</span></span><br><span class="line">          el.css(dimension, funcArg(<span class="keyword">this</span>, value, idx, el[dimension]()));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é’ˆå¯¹å½“å‰å…ƒç´ ã€éå†å­å…ƒç´ ï¼Œéƒ½æ‰§è¡Œ fun å‡½æ•°</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">traverseNode</span>(<span class="params">node, fun</span>) </span>&#123;</span><br><span class="line">    fun(node);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = node.childNodes.length; i &lt; len; i++)</span><br><span class="line">      traverseNode(node.childNodes[i], fun);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸Šæ–‡å®šä¹‰ adjacencyOperators = [ 'after', 'prepend', 'before', 'append' ],</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate the `after`, `prepend`, `before`, `append`,</span></span><br><span class="line">  <span class="comment">// `insertAfter`, `insertBefore`, `appendTo`, and `prependTo` methods.</span></span><br><span class="line">  adjacencyOperators.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">operator, operatorIndex</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inside = operatorIndex % <span class="number">2</span>; <span class="comment">//=&gt; prepend, append</span></span><br><span class="line"></span><br><span class="line">    $.fn[operator] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// arguments can be nodes, arrays of nodes, Zepto objects and HTML strings</span></span><br><span class="line">      <span class="keyword">var</span> argType,</span><br><span class="line">        nodes = $.map(<span class="built_in">arguments</span>, <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">          argType = type(arg);</span><br><span class="line">          <span class="keyword">return</span> argType == <span class="string">"object"</span> || argType == <span class="string">"array"</span> || arg == <span class="literal">null</span></span><br><span class="line">            ? arg</span><br><span class="line">            : zepto.fragment(arg);</span><br><span class="line">        &#125;),</span><br><span class="line">        parent,</span><br><span class="line">        copyByClone = <span class="keyword">this</span>.length &gt; <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> (nodes.length &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">_, target</span>) </span>&#123;</span><br><span class="line">        parent = inside ? target : target.parentNode;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// convert all methods to a "before" operation</span></span><br><span class="line">        target =</span><br><span class="line">          operatorIndex == <span class="number">0</span></span><br><span class="line">            ? target.nextSibling</span><br><span class="line">            : operatorIndex == <span class="number">1</span></span><br><span class="line">            ? target.firstChild</span><br><span class="line">            : operatorIndex == <span class="number">2</span></span><br><span class="line">            ? target</span><br><span class="line">            : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> parentInDocument = $.contains(<span class="built_in">document</span>.documentElement, parent);</span><br><span class="line"></span><br><span class="line">        nodes.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (copyByClone) node = node.cloneNode(<span class="literal">true</span>);</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (!parent) <span class="keyword">return</span> $(node).remove();</span><br><span class="line"></span><br><span class="line">          parent.insertBefore(node, target);</span><br><span class="line">          <span class="keyword">if</span> (parentInDocument)</span><br><span class="line">            traverseNode(node, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">if</span> (</span><br><span class="line">                el.nodeName != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">                el.nodeName.toUpperCase() === <span class="string">"SCRIPT"</span> &amp;&amp;</span><br><span class="line">                (!el.type || el.type === <span class="string">"text/javascript"</span>) &amp;&amp;</span><br><span class="line">                !el.src</span><br><span class="line">              )</span><br><span class="line">                <span class="built_in">window</span>[<span class="string">"eval"</span>].call(<span class="built_in">window</span>, el.innerHTML);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// after    =&gt; insertAfter</span></span><br><span class="line">    <span class="comment">// prepend  =&gt; prependTo</span></span><br><span class="line">    <span class="comment">// before   =&gt; insertBefore</span></span><br><span class="line">    <span class="comment">// append   =&gt; appendTo</span></span><br><span class="line">    $.fn[</span><br><span class="line">      inside ? operator + <span class="string">"To"</span> : <span class="string">"insert"</span> + (operatorIndex ? <span class="string">"Before"</span> : <span class="string">"After"</span>)</span><br><span class="line">    ] = <span class="function"><span class="keyword">function</span>(<span class="params">html</span>) </span>&#123;</span><br><span class="line">      $(html)[operator](<span class="keyword">this</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  zepto.Z.prototype = $.fn;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Export internal API functions in the `$.zepto` namespace</span></span><br><span class="line">  zepto.uniq = uniq;</span><br><span class="line">  zepto.deserializeValue = deserializeValue;</span><br><span class="line">  $.zepto = zepto;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> $;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.Zepto = Zepto;</span><br><span class="line"><span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åŸæ–‡ï¼š&lt;a href=&quot;https://www.kancloud.cn/wangfupeng/zepto-design-srouce/173692&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;zepto-core-1.1.6 æºç æ³¨é‡Š&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="å‰ç«¯æ¡†æ¶" scheme="http://yangtao.site/categories/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="zepto" scheme="http://yangtao.site/tags/zepto/"/>
    
  </entry>
  
  <entry>
    <title>Zepto å¯¹è±¡æ€æƒ³ä¸æºç åˆ†æ</title>
    <link href="http://yangtao.site/2020/03/12/zepto/"/>
    <id>http://yangtao.site/2020/03/12/zepto/</id>
    <published>2020-03-12T09:56:32.000Z</published>
    <updated>2020-03-16T04:03:15.930Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="http://www.kancloud.cn/wangfupeng/zepto-design-srouce/173680" target="_blank" rel="noopener">zepto å¯¹è±¡æ€æƒ³ä¸æºç åˆ†æ</a></p></blockquote><a id="more"></a><h2 id="åŸå‹å¯¹è±¡"><a href="#åŸå‹å¯¹è±¡" class="headerlink" title="åŸå‹å¯¹è±¡"></a>åŸå‹å¯¹è±¡</h2><h3 id="Array-prototype"><a href="#Array-prototype" class="headerlink" title="Array.prototype"></a><code>Array.prototype</code></h3><p><strong>æ¯ä¸€ä¸ªå‡½æ•°ï¼Œéƒ½æœ‰ä¸€ä¸ª prototype å±æ€§</strong>ï¼Œä¸ç®¡æ˜¯ä½ è‡ªå®šä¹‰çš„ï¼Œè¿˜æ˜¯å‡½æ•°å†…ç½®çš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(fn.prototype); <span class="comment">// &#123;constructor: Æ’&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(fn.prototype.constructor === fn); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/19526072/53319611-f76d3c00-390d-11e9-8542-313fa56bffab.png" alt="image"></p><p>è¿™é‡Œçš„ <code>fn.prototype</code> æ‰“å°å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡é‡Œçš„ <code>constructor</code> å±æ€§åˆæŒ‡å›äº†è¯¥å‡½æ•°æœ¬èº« fnã€‚</p><p>å³<strong>æ¯ä¸€ä¸ªåŸå‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª consctructor å±æ€§æŒ‡å‘å…³è”çš„æ„é€ å‡½æ•°</strong>ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.constructor === <span class="built_in">Array</span>; <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/19526072/53319627-ff2ce080-390d-11e9-8dab-3659d53b1296.png" alt="image"></p><p>æˆ‘ä»¬æ¥ç€çœ‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.prototype); <span class="comment">// [constructor: Æ’, concat: Æ’, copyWithin: Æ’, fill: Æ’, find: Æ’, â€¦]</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œé™¤äº† constructor å±æ€§ï¼Œè¿˜æœ‰å…¶ä»–å†…ç½®çš„å±æ€§ï¼Œå³æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„æ“ä½œæ•°ç»„çš„æ–¹æ³•ã€‚</p><h3 id="proto-éšå¼åŸå‹"><a href="#proto-éšå¼åŸå‹" class="headerlink" title="__proto__(éšå¼åŸå‹)"></a><code>__proto__</code>(éšå¼åŸå‹)</h3><p>æ‰€æœ‰é€šè¿‡å‡½æ•° <code>new</code> ï¼ˆæ„é€ å‡½æ•°ï¼‰å‡ºæ¥çš„å®ä¾‹å¯¹è±¡ï¼Œéƒ½æœ‰ä¸€ä¸ª <code>__proto__</code>å±æ€§ï¼ŒæŒ‡å‘è¯¥å¯¹è±¡çš„ <code>prototype</code>ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">arr.__proto__ === <span class="built_in">Array</span>.prototype; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/19526072/53319688-2f747f00-390e-11e9-9555-af336e12b587.png" alt="image"></p><p>åŸå‹é“¾ï¼šç”±ç›¸äº’å…³è”çš„åŸå‹(<code>__proto__</code>)ç»„æˆçš„é“¾çŠ¶ç»“æ„å°±æ˜¯åŸå‹é“¾ã€‚</p><p>ä¸¾ä¸ªå…³äºç»§æ‰¿ extends çš„ä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.eat = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Animal eat"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.bark = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Dog bark"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç»‘å®šåŸå‹ï¼Œå®ç°ç»§æ‰¿</span></span><br><span class="line">Dog.prototype = <span class="keyword">new</span> Animal();</span><br><span class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> Dog();</span><br><span class="line"></span><br><span class="line">dog.eat(); <span class="comment">// Animal eat</span></span><br><span class="line">dog.bark(); <span class="comment">// Dog bark</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çœ‹æ˜ç™½äº†ï¼Œé‚£ä¹ˆ ES6 çš„ç»§æ‰¿æˆ‘ä»¬ä¹Ÿå°±å¯ä»¥æ˜ç™½åŸç†äº†ï¼Œå³ <code>class Dog extends Animal</code> ç›¸å½“äº <code>Dog.prototype = new Animal()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  eat() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Animal eat!"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name);</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  bark() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Dog bark!"</span> + <span class="keyword">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dog = <span class="keyword">new</span> Dog(<span class="string">"å“ˆå£«å¥‡"</span>);</span><br><span class="line">dog.eat();</span><br><span class="line">dog.bark();</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¸…æ¥šä¸ºä»€ä¹ˆèƒ½è¿™æ ·ï¼š</p><p><strong>å½“æˆ‘ä»¬è¦ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡ï¼ˆæ•°ç»„ï¼‰çš„æŸä¸ªåŠŸèƒ½æ—¶ï¼Œå¦‚æœè¯¥å¯¹è±¡æœ¬èº«å…·æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œç›´æ¥è°ƒç”¨ï¼Œæ²¡æœ‰çš„è¯ï¼Œé‚£å°±å»è‡ªèº«çš„<code>__proto__</code>å±æ€§ä¸­å»æ‰¾</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  myfn: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"myfn"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.myfn(); <span class="comment">// 'myfn'</span></span><br><span class="line">obj.hasOwnProperty(<span class="string">"myfn"</span>); <span class="comment">//true</span></span><br><span class="line">obj.toString(); <span class="comment">// "[object Object]"</span></span><br><span class="line">obj.hasOwnProperty(<span class="string">"toString"</span>); <span class="comment">// false</span></span><br><span class="line">obj.__proto__.hasOwnProperty(<span class="string">"toString"</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><code>hasOwnProperty()</code>å°±å¯ä»¥å¾—å‡ºè¿™ä¸ªå±æ€§æ˜¯å¦æ˜¯å±äºè¯¥å¯¹è±¡æœ¬èº«çš„å±æ€§:</p><ul><li>myfn æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ï¼Œ<code>obj.hasOwnProperty(&#39;myfn&#39;)</code>ä¸º true</li><li>toString() æˆ‘ä»¬ä¸æ˜¯è‡ªå®šä¹‰çš„ï¼Œå´å¯ä»¥ä½¿ç”¨ï¼ŒæŸ¥ä¸€ä¸‹æ˜¯å¦å±äºè‡ªå®šä¹‰å±æ€§ï¼Œ<code>obj.hasOwnProperty(&#39;toString&#39;)</code>ï¼Œç­”æ¡ˆä¸º false</li><li>æ—¢ç„¶ä¸å±äºè‡ªå®šä¹‰å±æ€§ï¼Œé‚£å°±å»è‡ªèº«çš„<code>__proto__</code>å»æ‰¾ï¼Œç„¶åå»åŸå‹å¯¹è±¡ä¸ŠæŸ¥ä¸€ä¸‹ï¼Œ<code>obj.__proto__.hasOwnProperty(&#39;toString&#39;)</code>ï¼Œå“¦ï¼ŒåŸæ¥åœ¨è¿™å„¿</li></ul><p>åœ¨æºç ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸çœ‹åˆ°<code>Array.prototype.concat</code>ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„<code>[].concat</code>ï¼Œ<code>[]</code>ï¼Œå› ä¸º<code>[].__proto__ === Array.prototype</code></p><h3 id="proto-æ˜¯å¯ä¿®æ”¹çš„"><a href="#proto-æ˜¯å¯ä¿®æ”¹çš„" class="headerlink" title="__proto__æ˜¯å¯ä¿®æ”¹çš„"></a><code>__proto__</code>æ˜¯å¯ä¿®æ”¹çš„</h3><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æ–°å¢ä¸€ä¸ª<code>addClass()</code>æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">arr.__proto__.addClass = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">123</span>);</span><br><span class="line">&#125;;</span><br><span class="line">arr.push(<span class="number">4</span>);</span><br><span class="line">arr.addClass(); <span class="comment">// 123</span></span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/19526072/53319708-44e9a900-390e-11e9-9899-6c303f5467aa.png" alt="image"></p><p>ä½†æ˜¯ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œå¦‚ä¸‹é‡å†™ä¹‹åï¼Œå°±æ²¡æœ‰äº†è¯¸å¦‚ pushã€concat ç­‰æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">arr.__proto__ = &#123;</span><br><span class="line">  addClass: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">123</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">arr.push(<span class="number">3</span>); <span class="comment">//Uncaught TypeError: arr.push is not a function</span></span><br></pre></td></tr></table></figure><h3 id="Object-prototypeçš„åŸå‹"><a href="#Object-prototypeçš„åŸå‹" class="headerlink" title="Object.prototypeçš„åŸå‹"></a><code>Object.prototype</code>çš„åŸå‹</h3><p>ä¸‡ç‰©çš†å¯¹è±¡ï¼Œåˆ°æœ€åä¾æ—§æ˜¯å¯¹è±¡ï¼Œæœ€åè¿™ä¸ªä¸œä¸œæ˜¯ä¸ªå•¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ„é€ å‡½æ•° Person</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ä¾‹å¯¹è±¡ myfnï¼Œå®ƒçš„ éšå¼åŸå‹ æŒ‡å‘äº†å…¶æ„é€ å‡½æ•°çš„ åŸå‹å¯¹è±¡</span></span><br><span class="line"><span class="keyword">var</span> myfn = <span class="keyword">new</span> Person();</span><br><span class="line">myfn.__proto__ === Person.prototype; <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é‚£æ„é€ å‡½æ•° Person çš„ éšå¼åŸå‹åˆæŒ‡å‘äº†è°å‘¢</span></span><br><span class="line">Person.prototype.__proto__ === <span class="built_in">Object</span>.prototype; <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Functionå‘</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.__proto__ === <span class="built_in">Object</span>.prototype; <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸ªå‘¢</span></span><br><span class="line"><span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">fn.prototype.__proto__ === <span class="built_in">Object</span>.prototype; <span class="comment">//true</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.__proto__ === <span class="literal">null</span>; <span class="comment">//true</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span>; <span class="comment">//"object"</span></span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p><ul><li><p>æ‰€æœ‰çš„å‡½æ•°éƒ½æœ‰ä¸€ä¸ª <code>prototype</code>å±æ€§ï¼Œè¯¥å±æ€§æŒ‡å‘äº†ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°±æ˜¯è°ƒç”¨è¯¥æ„é€ å‡½æ•°è€Œåˆ›å»ºå‡ºæ¥çš„å®ä¾‹ï¼ˆå¦‚ myfnï¼‰çš„åŸå‹ï¼ˆå¦‚<code>myfn.__proto__</code>ï¼‰,å³ï¼š<code>myfn.__proto__ === Person.prototype</code></p></li><li><p>æ‰€æœ‰çš„å¯¹è±¡ï¼ˆé™¤ nullï¼‰éƒ½å…·æœ‰ä¸€ä¸ª<code>__proto__</code>å±æ€§ï¼Œè¯¥å±æ€§æŒ‡å‘è¯¥å¯¹è±¡çš„åŸå‹ï¼Œæ¯”å¦‚ï¼š<code>myfn.__proto__ === Person.prototype</code></p></li><li><p>åŸå‹ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ ¹æ®ä¸Šæ¡ï¼Œé‚£åŸå‹çš„åŸå‹ï¼Œå°±æ˜¯<code>Object.prototype</code></p></li><li><p>æœ€åçš„ null å¯¹è±¡ï¼Œå¯ä»¥å½“åšæ˜¯ ä»€ä¹ˆéƒ½æ²¡æœ‰</p></li></ul><p>ç›—ä¸€å¼ å›¾ï¼Œæˆ‘ä»¬å°±æ›´åŠ æ¸…æ¥šäº†ï¼ˆè“è‰²è¿™æ¡è¡¨ç¤ºçš„æ˜¯åŸå‹é“¾ï¼‰<br><img src="https://user-images.githubusercontent.com/19526072/53319411-64340680-390d-11e9-80b9-4b86736291b2.png" alt="image"></p><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><a href="https://www.kancloud.cn/wangfupeng/zepto-design-srouce/173684" target="_blank" rel="noopener">js åŸå‹é“¾åŸºç¡€</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/2" target="_blank" rel="noopener">JavaScript æ·±å…¥ä¹‹ä»åŸå‹åˆ°åŸå‹é“¾ </a></li><li><a href="https://www.cnblogs.com/wangfupeng1988/p/3978131.html" target="_blank" rel="noopener">æ·±å…¥ç†è§£ javascript åŸå‹å’Œé—­åŒ…ï¼ˆ3ï¼‰â€”â€”prototype åŸå‹</a></li></ul><h2 id="Zepto-å¯¹è±¡è®¾è®¡"><a href="#Zepto-å¯¹è±¡è®¾è®¡" class="headerlink" title="Zepto å¯¹è±¡è®¾è®¡"></a>Zepto å¯¹è±¡è®¾è®¡</h2><h3 id="ä¸»ä½“è®¾è®¡"><a href="#ä¸»ä½“è®¾è®¡" class="headerlink" title="ä¸»ä½“è®¾è®¡"></a>ä¸»ä½“è®¾è®¡</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Zepto = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> $,</span><br><span class="line">    zepto = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...çœç•¥Nè¡Œä»£ç ...</span></span><br><span class="line"></span><br><span class="line">  zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">    dom = dom || [];</span><br><span class="line">    dom.__proto__ = $.fn; <span class="comment">// å…³é”®ä½ç½®</span></span><br><span class="line">    dom.selector = selector || <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">return</span> dom;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dom;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é’ˆå¯¹å‚æ•°æƒ…å†µï¼Œåˆ†åˆ«å¯¹domèµ‹å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ€ç»ˆè°ƒç”¨ zepto.Z è¿”å›çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> zepto.Z(dom, selector);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> zepto.init(selector, context);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡Œé¢æœ‰è‹¥å¹²ä¸ªå·¥å…·å‡½æ•°</span></span><br><span class="line">  $.fn = &#123;</span><br><span class="line">    forEach: emptyArray.forEach,</span><br><span class="line">    <span class="comment">// ...çœç•¥Nè¡Œä»£ç ...</span></span><br><span class="line">    concat: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// ...çœç•¥Nè¡Œä»£ç ...</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...çœç•¥Nè¡Œä»£ç ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> $;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.Zepto = Zepto;</span><br><span class="line"><span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto);</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰æ¨¡æ‹Ÿ"><a href="#è‡ªå®šä¹‰æ¨¡æ‹Ÿ" class="headerlink" title="è‡ªå®šä¹‰æ¨¡æ‹Ÿ"></a>è‡ªå®šä¹‰æ¨¡æ‹Ÿ</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> $,</span><br><span class="line">    zepto = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Z</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i,</span><br><span class="line">      len = dom.length ? dom.length : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; dom.length; i++) &#123;</span><br><span class="line">      <span class="keyword">this</span>[i] = dom[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.length = len;</span><br><span class="line">    <span class="keyword">this</span>.selector = selector || <span class="string">""</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Z(dom, selector);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> slice = <span class="built_in">Array</span>.prototype.slice;</span><br><span class="line">    <span class="keyword">var</span> dom = slice.call(<span class="built_in">document</span>.querySelectorAll(selector));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> zepto.Z(dom, selector);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> zepto.init(selector);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $.fn = &#123;</span><br><span class="line">    css: <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"css"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    html: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"html"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  Z.prototype = $.fn;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.$ = $;</span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure><p>æµç¨‹ï¼š<code>$() -&gt; zepto.init() -&gt; zepto.Z() -&gt; new Z() -&gt; Z.prototype = $.fn;</code></p><h3 id="æœ€æ–°ç‰ˆï¼ˆv1-2-0ï¼‰æ¨¡æ‹Ÿ"><a href="#æœ€æ–°ç‰ˆï¼ˆv1-2-0ï¼‰æ¨¡æ‹Ÿ" class="headerlink" title="æœ€æ–°ç‰ˆï¼ˆv1.2.0ï¼‰æ¨¡æ‹Ÿ"></a>æœ€æ–°ç‰ˆï¼ˆv1.2.0ï¼‰æ¨¡æ‹Ÿ</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‡ªæ‰§è¡ŒåŒ¿åå‡½æ•°(IIFEï¼Œç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼)</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">global, factory</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// amd è§„èŒƒ</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">"function"</span> &amp;&amp; define.amd) &#123;</span><br><span class="line">    define(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> factory(global);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    factory(global);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">window</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> Zepto = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $;</span><br><span class="line">    <span class="keyword">var</span> zepto = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤§Zæ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Z</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> i,</span><br><span class="line">        len = dom ? dom.length : <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) <span class="keyword">this</span>[i] = dom[i];</span><br><span class="line">      <span class="keyword">this</span>.length = len;</span><br><span class="line">      <span class="keyword">this</span>.selector = selector || <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// zepto.Z() è¿”å›å¤§Zæ„é€ å‡½æ•°çš„å®ä¾‹ï¼Œæ–¹ä¾¿å®ä¾‹å¯¹è±¡çš„ __proto å°±ä¼šæŒ‡å‘ Z.prototype</span></span><br><span class="line">    zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Z(dom, selector);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æ DOMï¼Œå¹¶è°ƒç”¨ zepto.Z()</span></span><br><span class="line">    zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// è‡ªå®šä¹‰æ¨¡æ‹Ÿæ–¹æ³•ï¼Œæºç å¹¶éè¿™æ ·ç®€å•</span></span><br><span class="line">      <span class="keyword">var</span> slice = <span class="built_in">Array</span>.prototype.slice;</span><br><span class="line">      <span class="keyword">var</span> dom = slice.call(<span class="built_in">document</span>.querySelectorAll(selector));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// create a new Zepto collection from the nodes found</span></span><br><span class="line">      <span class="keyword">return</span> zepto.Z(dom, selector);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ­¥åˆå§‹åŒ–</span></span><br><span class="line">    $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> zepto.init(selector, context);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–¹æ³•å±æ€§</span></span><br><span class="line">    $.fn = &#123;</span><br><span class="line">      <span class="keyword">constructor</span>: zepto.Z, // æ‰‹åŠ¨ç»‘å®š <span class="keyword">constructor</span> å±æ€§</span><br><span class="line">      length: 0,</span><br><span class="line">      push: "push method",</span><br><span class="line">      css: function() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"css"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;  <span class="comment">// è¿”å› thisï¼Œå¯ä»¥é“¾å¼è°ƒç”¨</span></span><br><span class="line">      &#125;,</span><br><span class="line">      html: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"html"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    $.fn.on = <span class="function"><span class="keyword">function</span>(<span class="params">event, data, callback</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"on method"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    $.fn.off = <span class="function"><span class="keyword">function</span>(<span class="params">event, data, callback</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"off method"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    $.fn.bind = <span class="function"><span class="keyword">function</span>(<span class="params">event, data, callback</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.on(event, data, callback);</span><br><span class="line">    &#125;;</span><br><span class="line">    $.fn.unbind = <span class="function"><span class="keyword">function</span>(<span class="params">event, callback</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.off(event, callback);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ€ç»ˆçš„æ–¹æ³•å±æ€§ç­‰éƒ½æŒ‡å‘äº† $.fnï¼Œè¿™é‡Œå°±æ˜¯åŸå‹çš„å…³é”®ä½¿ç”¨</span></span><br><span class="line">    zepto.Z.prototype = Z.prototype = $.fn;</span><br><span class="line"></span><br><span class="line">    $.zepto = zepto;</span><br><span class="line">    <span class="keyword">return</span> $;</span><br><span class="line">  &#125;)();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.Zepto = Zepto;</span><br><span class="line">  <span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>amd è§„èŒƒï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">global, factory</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">"function"</span> &amp;&amp; define.amd) &#123;</span><br><span class="line">    define(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> factory(global);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    factory(global);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">window</span>) </span>&#123;&#125;)</span><br></pre></td></tr></table></figure><h3 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h3><ul><li><a href="https://www.imooc.com/learn/745" target="_blank" rel="noopener">zepto è®¾è®¡å’Œæºç åˆ†æ</a> - è§†é¢‘</li><li><a href="http://www.kancloud.cn/wangfupeng/zepto-design-srouce/173680" target="_blank" rel="noopener">zepto å¯¹è±¡æ€æƒ³ä¸æºç åˆ†æ</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://www.kancloud.cn/wangfupeng/zepto-design-srouce/173680&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;zepto å¯¹è±¡æ€æƒ³ä¸æºç åˆ†æ&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="å‰ç«¯æ¡†æ¶" scheme="http://yangtao.site/categories/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="zepto" scheme="http://yangtao.site/tags/zepto/"/>
    
  </entry>
  
  <entry>
    <title>AJAX è¯·æ±‚</title>
    <link href="http://yangtao.site/2020/01/07/ajax/"/>
    <id>http://yangtao.site/2020/01/07/ajax/</id>
    <published>2020-01-07T07:06:16.000Z</published>
    <updated>2020-01-07T09:51:42.474Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å…³äº http è¯·æ±‚çš„å‡ ç§æ–¹å¼</p></blockquote><a id="more"></a><h2 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h2><p>å…·ä½“æ¥è¯´ï¼ŒAJAX åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li>åˆ›å»º XMLHttpRequest å®ä¾‹</li><li>å‘å‡º HTTP è¯·æ±‚</li><li>æ¥æ”¶æœåŠ¡å™¨ä¼ å›çš„æ•°æ®</li><li>æ›´æ–°ç½‘é¡µæ•°æ®</li></ul><h2 id="èµ·æ­¥"><a href="#èµ·æ­¥" class="headerlink" title="èµ·æ­¥"></a>èµ·æ­¥</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MYTHOD = <span class="string">"GET"</span>;</span><br><span class="line"><span class="keyword">const</span> URL =</span><br><span class="line">  <span class="string">"https://api.github.com/search/repositories?q=javascript&amp;sort=stars"</span>;</span><br><span class="line"><span class="keyword">let</span> xhr = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¤„ç†ä½ç‰ˆæœ¬IEä¸å…¼å®¹é—®é¢˜</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;</span><br><span class="line">  xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šå›è°ƒå‡½æ•°ï¼Œç›‘å¬é€šä¿¡çŠ¶æ€ï¼ˆreadyStateå±æ€§ï¼‰çš„å˜åŒ–</span></span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span> &amp;&amp; xhr.status === <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(xhr.responseText);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•è·é”™è¯¯</span></span><br><span class="line">xhr.onerror = <span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.error(<span class="string">"Error: "</span>, xhr.statusText);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘å‡º HTTP è¯·æ±‚</span></span><br><span class="line">xhr.open(MYTHOD, URL, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">xhr.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®å¤´ä¿¡æ¯"><a href="#è®¾ç½®å¤´ä¿¡æ¯" class="headerlink" title="è®¾ç½®å¤´ä¿¡æ¯"></a>è®¾ç½®å¤´ä¿¡æ¯</h2><p>è¯¥æ–¹æ³•å¿…é¡»åœ¨ open()ä¹‹åã€send()ä¹‹å‰è°ƒç”¨ã€‚å¦‚æœè¯¥æ–¹æ³•å¤šæ¬¡è°ƒç”¨ï¼Œè®¾å®šåŒä¸€ä¸ªå­—æ®µï¼Œåˆ™æ¯ä¸€æ¬¡è°ƒç”¨çš„å€¼ä¼šè¢«åˆå¹¶æˆä¸€ä¸ªå•ä¸€çš„å€¼å‘é€ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xhr.setRequestHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/json"</span>);</span><br><span class="line">xhr.setRequestHeader(<span class="string">"Content-Length"</span>, <span class="built_in">JSON</span>.stringify(data).length);</span><br><span class="line">xhr.send(<span class="built_in">JSON</span>.stringify(data));</span><br></pre></td></tr></table></figure><h2 id="Ajax-Promise"><a href="#Ajax-Promise" class="headerlink" title="Ajax+Promise"></a>Ajax+Promise</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ajax = <span class="function">(<span class="params">&#123; method = <span class="string">"GET"</span>, path, body, headers &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//è¿›è¡ŒPromiseå°è£…</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">    request.open(method, path, <span class="literal">true</span>); <span class="comment">//é…ç½®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method == <span class="string">"GET"</span>) &#123;</span><br><span class="line">      request.send(<span class="literal">null</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> headers) &#123;</span><br><span class="line">        <span class="comment">//éå†header,è®¾ç½®å“åº”å¤´</span></span><br><span class="line">        <span class="keyword">let</span> value = headers[key];</span><br><span class="line">        request.setRequestHeader(key, value);</span><br><span class="line">      &#125;</span><br><span class="line">      request.send(body);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    request.onreadystatechange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (request.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (request.status &gt;= <span class="number">200</span> &amp;&amp; request.status &lt; <span class="number">400</span>) &#123;</span><br><span class="line">          resolve.call(<span class="literal">undefined</span>, request.responseText);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (request.status &gt;= <span class="number">400</span>) &#123;</span><br><span class="line">          reject.call(<span class="literal">undefined</span>, request);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨ajax</span></span><br><span class="line">ajax(&#123;</span><br><span class="line">  method: <span class="string">"get"</span>,</span><br><span class="line">  path: <span class="string">"https://api.github.com/search/repositories?q=javascript&amp;sort=stars"</span>,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    <span class="string">"content-type"</span>: <span class="string">"application/json"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(</span><br><span class="line">  responseText =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(responseText);</span><br><span class="line">  &#125;,</span><br><span class="line">  request =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(request);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="jQuery-ä½¿ç”¨"><a href="#jQuery-ä½¿ç”¨" class="headerlink" title="jQuery ä½¿ç”¨"></a>jQuery ä½¿ç”¨</h2><p>get æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª deferred å¯¹è±¡ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> URL =</span><br><span class="line">  <span class="string">"https://api.github.com/search/repositories?q=javascript&amp;sort=stars"</span>;</span><br><span class="line"><span class="keyword">let</span> request = $.get(URL);</span><br><span class="line">request</span><br><span class="line">  .done(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;)</span><br><span class="line">  .fail(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–è€…</span></span><br><span class="line"><span class="keyword">let</span> request = $.ajax(&#123;</span><br><span class="line">  url: URL,</span><br><span class="line">  type: <span class="string">"GET"</span></span><br><span class="line">&#125;);</span><br><span class="line">request.done(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(data)).fail(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err));</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ promiseï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">      url: <span class="string">"https://api.github.com/search/repositories?q=javascript&amp;sort=stars"</span>,</span><br><span class="line">      type: <span class="string">"GET"</span>,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        resolve(data);</span><br><span class="line">      &#125;,</span><br><span class="line">      error: <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">        resolve(err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getData()</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><h2 id="Fetch-å‡½æ•°"><a href="#Fetch-å‡½æ•°" class="headerlink" title="Fetch å‡½æ•°"></a>Fetch å‡½æ•°</h2><p>Fetch æä¾›äº† Request å’Œ Response å¯¹è±¡ï¼ˆä»¥åŠä¸ç½‘ç»œè¯·æ±‚æœ‰å…³çš„å…¶ä»–å†…å®¹ï¼‰çš„ä¸€èˆ¬å®šä¹‰ã€‚</p><p>Fetch API æä¾›äº† fetch() æ–¹æ³•ï¼Œå®ƒè¢«å®šä¹‰åœ¨ BOM çš„ window å¯¹è±¡ä¸­ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥å‘èµ·å¯¹è¿œç¨‹èµ„æºçš„è¯·æ±‚ã€‚</p><p>fetch() æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè®©ä½ èƒ½å¤Ÿå¯¹è¯·æ±‚çš„è¿”å›ç»“æœè¿›è¡Œæ£€ç´¢ã€‚</p><p>fetch çš„é…ç½®ï¼š</p><ul><li><code>Promise fetch(String url [, Object options])</code>;</li><li><code>Promise fetch(Request req [, Object options])</code>;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> URL = <span class="string">'https://api.github.com/search/repositories?q=javascript&amp;sort=stars'</span>;</span><br><span class="line"><span class="keyword">let</span> req = <span class="keyword">new</span> Request(URL, &#123; <span class="attr">method</span>: <span class="string">"GET"</span>, <span class="attr">cache</span>: <span class="string">"reload"</span> &#125;);</span><br><span class="line">fetch(req)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> response.json();</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(json);</span><br><span class="line">  &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>fetch å’Œ ajax çš„ä¸»è¦åŒºåˆ«ï¼š</p><ul><li>fetch()è¿”å›çš„ promise å°†ä¸ä¼šæ‹’ç» http çš„é”™è¯¯çŠ¶æ€ï¼Œå³ä½¿å“åº”æ˜¯ä¸€ä¸ª HTTP 404 æˆ–è€… 500</li><li>åœ¨é»˜è®¤æƒ…å†µä¸‹ fetch ä¸ä¼šæ¥å—æˆ–è€…å‘é€ cookies</li></ul><h2 id="Axios"><a href="#Axios" class="headerlink" title="Axios"></a>Axios</h2><p>åŸºæœ¬ä½¿ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> URL =</span><br><span class="line">  <span class="string">"https://api.github.com/search/repositories?q=javascript&amp;sort=stars"</span>;</span><br><span class="line">axios</span><br><span class="line">  .get(URL)</span><br><span class="line">  .then(<span class="function"><span class="params">response</span> =&gt;</span> <span class="built_in">console</span>.log(response))</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err));</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä½¿ç”¨ <code>async/await</code>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> axios.get(URL);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">getData().then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(data));</span><br></pre></td></tr></table></figure><h2 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h2><ul><li><a href="http://javascript.ruanyifeng.com/bom/ajax.html" target="_blank" rel="noopener">AJAX â€“ JavaScript æ ‡å‡†å‚è€ƒæ•™ç¨‹(alpha)</a></li><li><a href="https://segmentfault.com/a/1190000018935873?utm_source=tag-newest" target="_blank" rel="noopener">åŸç”Ÿ javaScript å®ç° Ajax å’Œ jQuery å®ç° Ajax</a></li><li><a href="https://segmentfault.com/a/1190000015938472" target="_blank" rel="noopener">å›è°ƒã€ä½¿ç”¨ Promise å°è£… ajax()ã€Promise å…¥é—¨</a></li><li><a href="https://www.jianshu.com/p/7762515f8d1a" target="_blank" rel="noopener">Fetch</a></li><li><a href="http://www.axios-js.com/" target="_blank" rel="noopener">axios-æ˜“ç”¨ã€ç®€æ´ä¸”é«˜æ•ˆçš„ http åº“</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;å…³äº http è¯·æ±‚çš„å‡ ç§æ–¹å¼&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://yangtao.site/categories/JavaScript/"/>
    
    
      <category term="é¢è¯•" scheme="http://yangtao.site/tags/%E9%9D%A2%E8%AF%95/"/>
    
      <category term="JavaScript" scheme="http://yangtao.site/tags/JavaScript/"/>
    
      <category term="Ajax" scheme="http://yangtao.site/tags/Ajax/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript ç±»å‹åˆ¤æ–­</title>
    <link href="http://yangtao.site/2020/01/07/code-typeof/"/>
    <id>http://yangtao.site/2020/01/07/code-typeof/</id>
    <published>2020-01-07T06:42:25.000Z</published>
    <updated>2020-01-07T07:00:58.458Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å­¦ä¹ <a href="https://github.com/mqyqingfeng/Blog/issues/28" target="_blank" rel="noopener">JavaScript ä¸“é¢˜ä¹‹ç±»å‹åˆ¤æ–­(ä¸Š)</a>çš„æ–‡ç« æ€»ç»“ï¼Œå…¶å®å°±æ˜¯ç…§æŠ„ï¼Œå“ˆå“ˆå“ˆå“ˆâ€¦é¡ºä¾¿å‡ ä¸€å¥æ–‡ç« é‡Œçš„è¯ï¼šæ‰€æœ‰è¿™äº›ç‚¹ï¼Œéƒ½å¿…é¡»è„šè¸å®åœ°åœ¨å…·ä½“åº”ç”¨åœºæ™¯ä¸‹å»åˆ†æã€å»é€‰æ‹©ï¼Œè¦è®©åœºæ™¯è¯´è¯ã€‚</p></blockquote><a id="more"></a><h2 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a>typeof</h2><p>æœ€æ–°çš„ ECMAScript æ ‡å‡†å®šä¹‰äº† 8 ç§æ•°æ®ç±»å‹ï¼š</p><p>7 ç§åŸå§‹ç±»å‹:</p><ul><li>Boolean</li><li>Null</li><li>Undefined</li><li>Number</li><li>String</li><li>Symbol</li><li>BigInt</li></ul><p>å’Œ Object</p><p>ä½¿ç”¨ typeof æ£€æµ‹ç±»å‹å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Number"</span>; <span class="comment">// number</span></span><br><span class="line"><span class="string">"String"</span>; <span class="comment">// string</span></span><br><span class="line"><span class="string">"Boolean"</span>; <span class="comment">// boolean</span></span><br><span class="line"><span class="string">"Undefined"</span>; <span class="comment">// undefined</span></span><br><span class="line"><span class="string">"Null"</span>; <span class="comment">// object</span></span><br><span class="line"><span class="string">"Symbol"</span>; <span class="comment">// symbol</span></span><br><span class="line"><span class="string">"BigInt"</span>; <span class="comment">// bigint</span></span><br><span class="line"><span class="string">"Object"</span>; <span class="comment">// object</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ typeof èƒ½æ£€æµ‹å‡ºä¸ƒç§åŸºæœ¬ç±»å‹çš„å€¼ï¼Œä½†æ˜¯ï¼Œé™¤æ­¤ä¹‹å¤– Object ä¸‹è¿˜æœ‰å¾ˆå¤šç»†åˆ†çš„ç±»å‹å‘ï¼Œå¦‚ Arrayã€Functionã€Dateã€RegExpã€Error ç­‰ã€‚</p><p>å¦‚æœç”¨ typeof å»æ£€æµ‹è¿™äº›ç±»å‹ï¼Œè¿”å›çš„éƒ½æ˜¯ objectï¼Œé™¤äº† Functionï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="keyword">var</span> error = <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line"><span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> date); <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> error); <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> fn); <span class="comment">// function</span></span><br></pre></td></tr></table></figure><h2 id="Object-prototype-toString"><a href="#Object-prototype-toString" class="headerlink" title="Object.prototype.toString"></a>Object.prototype.toString</h2><p>æ‰€æœ‰ï¼Œè¯¥å¦‚ä½•åŒºåˆ† object å‘¢ï¼Ÿæˆ‘ä»¬ç”¨<code>Object.prototype.toString</code>ã€‚</p><p>è§„èŒƒï¼šå½“ toString æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¸‹é¢çš„æ­¥éª¤ä¼šè¢«æ‰§è¡Œï¼š</p><ul><li>å¦‚æœ this å€¼æ˜¯ undefinedï¼Œå°±è¿”å› <code>[object Undefined]</code></li><li>å¦‚æœ this çš„å€¼æ˜¯ nullï¼Œå°±è¿”å› <code>[object Null]</code></li><li>è®© O æˆä¸º <code>ToObject(this)</code> çš„ç»“æœ</li><li>è®© class æˆä¸º O çš„å†…éƒ¨å±æ€§ <code>[[Class]]</code> çš„å€¼</li><li>æœ€åè¿”å›ç”± <code>&quot;[object &quot;</code> å’Œ <code>class</code> å’Œ <code>&quot;]&quot;</code> ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆçš„å­—ç¬¦ä¸²</li></ul><p>é€šè¿‡è§„èŒƒï¼Œæˆ‘ä»¬è‡³å°‘çŸ¥é“äº†è°ƒç”¨ <code>Object.prototype.toString</code> ä¼šè¿”å›ä¸€ä¸ªç”± <code>&quot;[object &quot; å’Œ class å’Œ &quot;]&quot;</code> ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œè€Œ class æ˜¯è¦åˆ¤æ–­çš„å¯¹è±¡çš„å†…éƒ¨å±æ€§ã€‚</p><p>æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°è¿™ä¸ª class å€¼å°±æ˜¯è¯†åˆ«å¯¹è±¡ç±»å‹çš„å…³é”®ï¼</p><p>æ­£æ˜¯å› ä¸ºè¿™ç§ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>Object.prototype.toString</code> æ–¹æ³•è¯†åˆ«å‡ºæ›´å¤šç±»å‹ï¼</p><p>å…ˆçœ‹ä¸‹å¸¸è§çš„ 15 ç§ï¼ˆES6 æ–°å¢ï¼šSymbol Set Mapï¼Œè¿˜æœ‰ BigIntï¼‰ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> number = <span class="number">1</span>; <span class="comment">// [object Number]</span></span><br><span class="line"><span class="keyword">var</span> string = <span class="string">"123"</span>; <span class="comment">// [object String]</span></span><br><span class="line"><span class="keyword">var</span> boolean = <span class="literal">true</span>; <span class="comment">// [object Boolean]</span></span><br><span class="line"><span class="keyword">var</span> und = <span class="literal">undefined</span>; <span class="comment">// [object Undefined]</span></span><br><span class="line"><span class="keyword">var</span> nul = <span class="literal">null</span>; <span class="comment">// [object Null]</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;; <span class="comment">// [object Object]</span></span><br><span class="line"><span class="keyword">var</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]; <span class="comment">// [object Array]</span></span><br><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">// [object Date]</span></span><br><span class="line"><span class="keyword">var</span> error = <span class="keyword">new</span> <span class="built_in">Error</span>(); <span class="comment">// [object Error]</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/a/g</span>; <span class="comment">// [object RegExp]</span></span><br><span class="line"><span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;&#125;; <span class="comment">// [object Function]</span></span><br><span class="line"><span class="keyword">var</span> symb = <span class="built_in">Symbol</span>(<span class="string">"test"</span>); <span class="comment">// [object Symbol]</span></span><br><span class="line"><span class="keyword">var</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>(); <span class="comment">// [object Set]</span></span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>(); <span class="comment">// [object Map]</span></span><br><span class="line"><span class="keyword">var</span> bigI = BigInt(<span class="number">1</span>); <span class="comment">// [object BigInt]</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = <span class="built_in">arguments</span>.length; i &lt; l; i++) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="built_in">arguments</span>[i]));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">checkType(</span><br><span class="line">  number,</span><br><span class="line">  string,</span><br><span class="line">  boolean,</span><br><span class="line">  und,</span><br><span class="line">  nul,</span><br><span class="line">  obj,</span><br><span class="line">  array,</span><br><span class="line">  date,</span><br><span class="line">  error,</span><br><span class="line">  reg,</span><br><span class="line">  func,</span><br><span class="line">  symb,</span><br><span class="line">  set,</span><br><span class="line">  map,</span><br><span class="line">  bigI</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>é™¤äº†ä»¥ä¸Š 15 ç§ï¼Œè¿˜æœ‰ä»¥ä¸‹ 3 ç§ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="built_in">Math</span>)); <span class="comment">// [object Math]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="built_in">JSON</span>)); <span class="comment">// [object JSON]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="built_in">arguments</span>)); <span class="comment">// [object Arguments]</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">fn();</span><br></pre></td></tr></table></figure><h2 id="type-API"><a href="#type-API" class="headerlink" title="type API"></a>type API</h2><p>å†™ä¸€ä¸ª type å‡½æ•°èƒ½æ£€æµ‹å„ç§ç±»å‹çš„å€¼ï¼Œå¦‚æœæ˜¯åŸºæœ¬ç±»å‹ï¼Œå°±ä½¿ç”¨ typeofï¼Œå¼•ç”¨ç±»å‹å°±ä½¿ç”¨ toStringã€‚</p><p>æ­¤å¤–é‰´äº typeof çš„ç»“æœæ˜¯å°å†™ï¼Œæˆ‘ä¹Ÿå¸Œæœ›æ‰€æœ‰çš„ç»“æœéƒ½æ˜¯å°å†™ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> class2type = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="string">"Boolean Number String Function Array Date RegExp Object Error Null Undefined"</span></span><br><span class="line">  .split(<span class="string">" "</span>)</span><br><span class="line">  .map(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">    class2type[<span class="string">"[object "</span> + item + <span class="string">"]"</span>] = item.toLowerCase(); <span class="comment">// e.g. '[object Boolean]': 'boolean'</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">type</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj + <span class="string">""</span>; <span class="comment">// IE6</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> obj === <span class="string">"object"</span> || <span class="keyword">typeof</span> obj === <span class="string">"function"</span></span><br><span class="line">    ? class2type[<span class="built_in">Object</span>.prototype.toString.call(obj)] || <span class="string">"object"</span></span><br><span class="line">    : <span class="keyword">typeof</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>class2type[Object.prototype.toString.call(obj)] || &quot;object&quot;</code>çš„ objectï¼Œä¸ºäº† ES6 æ–°å¢çš„ Symbolã€Mapã€Set ç­‰ç±»å‹è¿”å› objectã€‚</p><p>å½“ç„¶ä¹Ÿå¯ä»¥æ·»åŠ è¿›å»ï¼Œè¿”å›çš„å°±æ˜¯å¯¹åº”çš„ç±»å‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> class2type = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="string">"Boolean Number String Function Array Date RegExp Object Error Null Undefined Symbol Set Map BigInt"</span></span><br><span class="line">  .split(<span class="string">" "</span>)</span><br><span class="line">  .map(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">    class2type[<span class="string">"[object "</span> + item + <span class="string">"]"</span>] = item.toLowerCase();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">type</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj + <span class="string">""</span>; <span class="comment">// IE6</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> obj === <span class="string">"object"</span> || <span class="keyword">typeof</span> obj === <span class="string">"function"</span></span><br><span class="line">    ? class2type[<span class="built_in">Object</span>.prototype.toString.call(obj)]</span><br><span class="line">    : <span class="keyword">typeof</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isFunction"><a href="#isFunction" class="headerlink" title="isFunction"></a>isFunction</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFunction</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> type(obj) === <span class="string">"function"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isArray"><a href="#isArray" class="headerlink" title="isArray"></a>isArray</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isArray =</span><br><span class="line">  <span class="built_in">Array</span>.isArray ||</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> type(obj) === <span class="string">"array"</span>;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><h2 id="plainObject"><a href="#plainObject" class="headerlink" title="plainObject"></a>plainObject</h2><p><code>plainObject</code> æ¥è‡ªäº jQueryï¼Œå¯ä»¥ç¿»è¯‘æˆçº¯ç²¹çš„å¯¹è±¡ï¼Œæ‰€è°“â€çº¯ç²¹çš„å¯¹è±¡â€ï¼Œå°±æ˜¯è¯¥å¯¹è±¡æ˜¯é€šè¿‡ â€œ{}â€ æˆ– â€œnew Objectâ€ åˆ›å»ºçš„ï¼Œè¯¥å¯¹è±¡å«æœ‰é›¶ä¸ªæˆ–è€…å¤šä¸ªé”®å€¼å¯¹ã€‚</p><p>ä¹‹æ‰€ä»¥è¦åˆ¤æ–­æ˜¯ä¸æ˜¯ <code>plainObject</code>ï¼Œæ˜¯ä¸ºäº†è·Ÿå…¶ä»–çš„ JavaScript å¯¹è±¡å¦‚ nullï¼Œæ•°ç»„ï¼Œå®¿ä¸»å¯¹è±¡ï¼ˆdocumentsï¼‰ç­‰ä½œåŒºåˆ†ï¼Œå› ä¸ºè¿™äº›ç”¨ typeof éƒ½ä¼šè¿”å› objectã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ŠèŠ‚ä¸­å†™ type å‡½æ•°æ—¶ï¼Œç”¨æ¥å­˜æ”¾ toString æ˜ å°„ç»“æœçš„å¯¹è±¡</span></span><br><span class="line"><span class="keyword">var</span> class2type = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›¸å½“äº Object.prototype.toString</span></span><br><span class="line"><span class="keyword">var</span> toString = class2type.toString;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›¸å½“äº Object.prototype.hasOwnProperty</span></span><br><span class="line"><span class="keyword">var</span> hasOwn = class2type.hasOwnProperty;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPlainObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> proto, Ctor;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ’é™¤æ‰æ˜æ˜¾ä¸æ˜¯objçš„ä»¥åŠä¸€äº›å®¿ä¸»å¯¹è±¡å¦‚Window</span></span><br><span class="line">  <span class="keyword">if</span> (!obj || toString.call(obj) !== <span class="string">"[object Object]"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * getPrototypeOf es5 æ–¹æ³•ï¼Œè·å– obj çš„åŸå‹</span></span><br><span class="line"><span class="comment">   * ä»¥ new Object åˆ›å»ºçš„å¯¹è±¡ä¸ºä¾‹çš„è¯</span></span><br><span class="line"><span class="comment">   * obj.__proto__ === Object.prototype</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  proto = <span class="built_in">Object</span>.getPrototypeOf(obj);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ²¡æœ‰åŸå‹çš„å¯¹è±¡æ˜¯çº¯ç²¹çš„ï¼ŒObject.create(null) å°±åœ¨è¿™é‡Œè¿”å› true</span></span><br><span class="line">  <span class="keyword">if</span> (!proto) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ä»¥ä¸‹åˆ¤æ–­é€šè¿‡ new Object æ–¹å¼åˆ›å»ºçš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">   * åˆ¤æ–­ proto æ˜¯å¦æœ‰ constructor å±æ€§ï¼Œå¦‚æœæœ‰å°±è®© Ctor çš„å€¼ä¸º proto.constructor</span></span><br><span class="line"><span class="comment">   * å¦‚æœæ˜¯ Object å‡½æ•°åˆ›å»ºçš„å¯¹è±¡ï¼ŒCtor åœ¨è¿™é‡Œå°±ç­‰äº Object æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  Ctor = hasOwn.call(proto, <span class="string">"constructor"</span>) &amp;&amp; proto.constructor;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨è¿™é‡Œåˆ¤æ–­ Ctor æ„é€ å‡½æ•°æ˜¯ä¸æ˜¯ Object æ„é€ å‡½æ•°ï¼Œç”¨äºåŒºåˆ†è‡ªå®šä¹‰æ„é€ å‡½æ•°å’Œ Object æ„é€ å‡½æ•°</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="keyword">typeof</span> Ctor === <span class="string">"function"</span> &amp;&amp;</span><br><span class="line">    hasOwn.toString.call(Ctor) === hasOwn.toString.call(<span class="built_in">Object</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="EmptyObject"><a href="#EmptyObject" class="headerlink" title="EmptyObject"></a>EmptyObject</h2><p>jQuery æä¾›äº† <code>isEmptyObject</code> æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦æ˜¯ç©ºå¯¹è±¡ï¼Œä»£ç ç®€å•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isEmptyObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰å±æ€§ï¼Œfor å¾ªç¯ä¸€æ—¦æ‰§è¡Œï¼Œå°±è¯´æ˜æœ‰å±æ€§ï¼Œæœ‰å±æ€§å°±ä¼šè¿”å› false</span></span><br><span class="line">  <span class="keyword">for</span> (name <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(isEmptyObject(&#123;&#125;)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isEmptyObject([])); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isEmptyObject(<span class="literal">null</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isEmptyObject(<span class="literal">undefined</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isEmptyObject(<span class="number">1</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isEmptyObject(<span class="string">""</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isEmptyObject(<span class="literal">true</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2 id="Window-å¯¹è±¡"><a href="#Window-å¯¹è±¡" class="headerlink" title="Window å¯¹è±¡"></a>Window å¯¹è±¡</h2><p>Window å¯¹è±¡ä½œä¸ºå®¢æˆ·ç«¯ JavaScript çš„å…¨å±€å¯¹è±¡ï¼Œå®ƒæœ‰ä¸€ä¸ª window å±æ€§æŒ‡å‘è‡ªèº«ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§åˆ¤æ–­æ˜¯å¦æ˜¯ Window å¯¹è±¡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isWindow</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> obj !== <span class="literal">null</span> &amp;&amp; obj === obj.window;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isArrayLike"><a href="#isArrayLike" class="headerlink" title="isArrayLike"></a>isArrayLike</h2><p>å¦‚æœ isArrayLike è¿”å› trueï¼Œè‡³å°‘è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼š</p><ul><li>æ˜¯æ•°ç»„</li><li>é•¿åº¦ä¸º 0</li><li>lengths å±æ€§æ˜¯å¤§äº 0 çš„æ•°å­—ç±»å‹ï¼Œå¹¶ä¸” <code>obj[length - 1]</code>å¿…é¡»å­˜åœ¨</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isArrayLike</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// obj å¿…é¡»æœ‰ lengthå±æ€§</span></span><br><span class="line">  <span class="keyword">var</span> length = !!obj &amp;&amp; <span class="string">"length"</span> <span class="keyword">in</span> obj &amp;&amp; obj.length;</span><br><span class="line">  <span class="keyword">var</span> typeRes = type(obj);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ’é™¤æ‰å‡½æ•°å’Œ Window å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">if</span> (typeRes === <span class="string">"function"</span> || isWindow(obj)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    typeRes === <span class="string">"array"</span> ||</span><br><span class="line">    length === <span class="number">0</span> ||</span><br><span class="line">    (<span class="keyword">typeof</span> length === <span class="string">"number"</span> &amp;&amp; length &gt; <span class="number">0</span> &amp;&amp; length - <span class="number">1</span> <span class="keyword">in</span> obj)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isElement"><a href="#isElement" class="headerlink" title="isElement"></a>isElement</h2><p>åˆ¤æ–­æ˜¯ä¸æ˜¯ DOM å…ƒç´ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isElement</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!(obj &amp;&amp; obj.nodeType === <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(isElement(div)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(isElement(<span class="string">""</span>)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="åŸæ–‡åœ°å€"><a href="#åŸæ–‡åœ°å€" class="headerlink" title="åŸæ–‡åœ°å€"></a>åŸæ–‡åœ°å€</h2><ul><li><a href="https://github.com/mqyqingfeng/Blog/issues/28" target="_blank" rel="noopener">JavaScript ä¸“é¢˜ä¹‹ç±»å‹åˆ¤æ–­(ä¸Š)</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/30" target="_blank" rel="noopener">JavaScript ä¸“é¢˜ä¹‹ç±»å‹åˆ¤æ–­(ä¸‹)</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;å­¦ä¹ &lt;a href=&quot;https://github.com/mqyqingfeng/Blog/issues/28&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;JavaScript ä¸“é¢˜ä¹‹ç±»å‹åˆ¤æ–­(ä¸Š)&lt;/a&gt;çš„æ–‡ç« æ€»ç»“ï¼Œå…¶å®å°±æ˜¯ç…§æŠ„ï¼Œå“ˆå“ˆå“ˆå“ˆâ€¦é¡ºä¾¿å‡ ä¸€å¥æ–‡ç« é‡Œçš„è¯ï¼šæ‰€æœ‰è¿™äº›ç‚¹ï¼Œéƒ½å¿…é¡»è„šè¸å®åœ°åœ¨å…·ä½“åº”ç”¨åœºæ™¯ä¸‹å»åˆ†æã€å»é€‰æ‹©ï¼Œè¦è®©åœºæ™¯è¯´è¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://yangtao.site/categories/JavaScript/"/>
    
    
      <category term="é¢è¯•" scheme="http://yangtao.site/tags/%E9%9D%A2%E8%AF%95/"/>
    
      <category term="JavaScript" scheme="http://yangtao.site/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript æ•°ç»„å»é‡çš„å‡ ç§æ–¹å¼</title>
    <link href="http://yangtao.site/2020/01/07/code-unique/"/>
    <id>http://yangtao.site/2020/01/07/code-unique/</id>
    <published>2020-01-07T05:14:42.000Z</published>
    <updated>2020-01-07T06:37:17.108Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ•°ç»„å»é‡ï¼Œè€ç”Ÿå¸¸è°ˆï¼ŒæŠŠå­¦ä¹ åˆ°çš„å¤šç§æ–¹å¼è¿›è¡Œå½’çº³æ€»ç»“</p></blockquote><a id="more"></a><h2 id="åŒå±‚å¾ªç¯"><a href="#åŒå±‚å¾ªç¯" class="headerlink" title="åŒå±‚å¾ªç¯"></a>åŒå±‚å¾ªç¯</h2><p>ç¬¬ä¸€ç§ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, arrLen = arr.length; i &lt; arrLen; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>, resLen = result.length; j &lt; resLen; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (arr[i] === result[j]) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (j === result.length) &#123;</span><br><span class="line">      result.push(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> arrary = [].concat(arr); <span class="comment">// é¿å…ä¿®æ”¹åŸæ•°ç»„ï¼Œå­˜ä¸ªå‰¯æœ¬</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arrary.length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = i + <span class="number">1</span>; j &lt; len; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (arrary[i] === arrary[j]) &#123;</span><br><span class="line">        arrary.splice(j, <span class="number">1</span>); <span class="comment">// splice() ä¿®æ”¹åŸæ•°ç»„ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨ä¿®æ”¹é•¿åº¦</span></span><br><span class="line">        len--;</span><br><span class="line">        j--;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arrary;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="indexOf-æ–¹æ³•"><a href="#indexOf-æ–¹æ³•" class="headerlink" title="indexOf æ–¹æ³•"></a>indexOf æ–¹æ³•</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.length; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> current = arr[i];</span><br><span class="line">    <span class="keyword">if</span> (result.indexOf(current) === <span class="number">-1</span>) &#123;</span><br><span class="line">      result.push(current);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="filter-indexOf-æ–¹æ³•"><a href="#filter-indexOf-æ–¹æ³•" class="headerlink" title="filter + indexOf æ–¹æ³•"></a>filter + indexOf æ–¹æ³•</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = arr.filter(<span class="function"><span class="keyword">function</span>(<span class="params">item, index, arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> arr.indexOf(item) === index;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">let</span> unique = <span class="function"><span class="params">arr</span> =&gt;</span></span><br><span class="line">  arr.filter(<span class="function">(<span class="params">item, index, arr</span>) =&gt;</span> arr.indexOf(item) === index);</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬å¯¹ä¸€ä¸ªå·²ç»æ’å¥½åºçš„æ•°ç»„å»é‡ï¼Œè¿™ç§æ–¹æ³•æ•ˆç‡è‚¯å®šé«˜äºä½¿ç”¨ indexOfï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> unique = <span class="function"><span class="params">arr</span> =&gt;</span></span><br><span class="line">  arr</span><br><span class="line">    .concat()</span><br><span class="line">    .sort()</span><br><span class="line">    .filter(<span class="function">(<span class="params">item, index, arr</span>) =&gt;</span> !index || item !== arr[index - <span class="number">1</span>]);</span><br></pre></td></tr></table></figure><p>ä¸è¿‡å¯¹äºä¸‹é¢è¿™ç§å°±ä¼šå¤±æ•ˆï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="string">"1"</span>, <span class="number">1</span>, <span class="string">"1"</span>];</span><br><span class="line"><span class="comment">//è¾“å‡º [ 1, '1', 1, '1', 2, 3 ]</span></span><br></pre></td></tr></table></figure><h2 id="Object-é”®å€¼å¯¹"><a href="#Object-é”®å€¼å¯¹" class="headerlink" title="Object é”®å€¼å¯¹"></a>Object é”®å€¼å¯¹</h2><p>åˆ©ç”¨ä¸€ä¸ªç©ºçš„ Object å¯¹è±¡ï¼Œæˆ‘ä»¬æŠŠæ•°ç»„çš„å€¼å­˜æˆ Object çš„ key å€¼ï¼Œæ¯”å¦‚ <code>Object[value1] = true</code>ï¼Œåœ¨åˆ¤æ–­å¦ä¸€ä¸ªå€¼çš„æ—¶å€™ï¼Œå¦‚æœ <code>Object[value2]</code>å­˜åœ¨çš„è¯ï¼Œå°±è¯´æ˜è¯¥å€¼æ˜¯é‡å¤çš„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> unique = <span class="function"><span class="params">arr</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> arr.filter(<span class="function"><span class="params">item</span> =&gt;</span></span><br><span class="line">    obj.hasOwnProperty(<span class="keyword">typeof</span> item + <span class="built_in">JSON</span>.stringify(item))</span><br><span class="line">      ? <span class="literal">false</span></span><br><span class="line">      : (obj[<span class="keyword">typeof</span> item + <span class="built_in">JSON</span>.stringify(item)] = <span class="literal">true</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ol><li><code>typeof item + item</code> æ˜¯ä¸ºäº†åŒºåˆ† 1 è¿˜æ˜¯ â€˜1â€™</li><li><code>typeof item + JSON.stringify(item)</code> æ˜¯ä¸ºäº†åŒºåˆ† <code>{value: 1}, {value: 1}</code></li></ol><p>å¦‚ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="string">"1"</span>, &#123; <span class="attr">value</span>: <span class="number">1</span> &#125;, &#123; <span class="attr">value</span>: <span class="number">1</span> &#125;];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> getObjType = <span class="function"><span class="params">arr</span> =&gt;</span> arr.map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="keyword">typeof</span> item + <span class="built_in">JSON</span>.stringify(item));</span><br><span class="line"></span><br><span class="line">getObjType(arr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ["number1", "string"1"", "object&#123;"value":1&#125;", "object&#123;"value":1&#125;"]</span></span><br></pre></td></tr></table></figure><h2 id="Set-é›†åˆ-å’Œ-Map-é›†åˆ"><a href="#Set-é›†åˆ-å’Œ-Map-é›†åˆ" class="headerlink" title="Set é›†åˆ å’Œ Map é›†åˆ"></a>Set é›†åˆ å’Œ Map é›†åˆ</h2><p>ES6 å»é‡æ–¹å¼å·²ç»æ˜¯éå¸¸çš„ç²¾ç®€ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Set</span></span><br><span class="line"><span class="keyword">let</span> unique = <span class="function"><span class="params">arr</span> =&gt;</span> <span class="built_in">Array</span>.from(<span class="keyword">new</span> <span class="built_in">Set</span>(arr))</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> unique = <span class="function"><span class="params">arr</span> =&gt;</span> [...new <span class="built_in">Set</span>(arr)]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Map</span></span><br><span class="line"><span class="keyword">let</span> unique = <span class="function"><span class="params">arr</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> seen = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">  <span class="keyword">return</span> arr.filter(<span class="function"><span class="params">item</span> =&gt;</span> !seen.has(item) &amp;&amp; seen.set(item, <span class="literal">true</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h2><ul><li><a href="https://github.com/mqyqingfeng/Blog/issues/27" target="_blank" rel="noopener">JavaScript ä¸“é¢˜ä¹‹æ•°ç»„å»é‡</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æ•°ç»„å»é‡ï¼Œè€ç”Ÿå¸¸è°ˆï¼ŒæŠŠå­¦ä¹ åˆ°çš„å¤šç§æ–¹å¼è¿›è¡Œå½’çº³æ€»ç»“&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://yangtao.site/categories/JavaScript/"/>
    
    
      <category term="é¢è¯•" scheme="http://yangtao.site/tags/%E9%9D%A2%E8%AF%95/"/>
    
      <category term="JavaScript" scheme="http://yangtao.site/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Sass æ—¥å¸¸ä½¿ç”¨æ€»ç»“</title>
    <link href="http://yangtao.site/2019/12/31/css-sass/"/>
    <id>http://yangtao.site/2019/12/31/css-sass/</id>
    <published>2019-12-31T04:37:40.000Z</published>
    <updated>2020-01-02T12:35:28.598Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸–ç•Œä¸Šæœ€æˆç†Ÿã€æœ€ç¨³å®šã€æœ€å¼ºå¤§çš„ä¸“ä¸šçº§CSSæ‰©å±•è¯­è¨€ï¼ - Sass å®˜ç½‘<br>ç®€å•æ±‡æ€»ä¸€ä¸‹ sass çš„æ—¥å¸¸ä½¿ç”¨ï¼Œåˆç®€å•åœ°çœ‹äº†ä¸€ä¸‹ Bootstrap@4 é‡Œåº”ç”¨çš„ä¸€ä¸ª Demoã€‚</p></blockquote><a id="more"></a><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>æˆ‘æœ¬åœ°ç»“åˆ gulp+sass è‡ªåŠ¨åŒ–å·¥å…·ä½¿ç”¨ï¼Œä¸»è¦å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install node-sass gulp-sass --save-dev</span><br></pre></td></tr></table></figure><p><code>gulpfile.js</code> æ–‡ä»¶ä¸»è¦é…ç½®å¦‚ä¸‹ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ<a href="https://github.com/yangtao2o/gulp-project/tree/master/src/mygulp" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest, watch &#125; = <span class="built_in">require</span>(<span class="string">"gulp"</span>);</span><br><span class="line"><span class="keyword">const</span> sass = <span class="built_in">require</span>(<span class="string">"gulp-sass"</span>);</span><br><span class="line">sass.compiler = <span class="built_in">require</span>(<span class="string">"node-sass"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scss</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> src(scssGlobSrc)</span><br><span class="line">    .pipe(sass(&#123; <span class="attr">outputStyle</span>: <span class="string">"expanded"</span> &#125;).on(<span class="string">"error"</span>, sass.logError))</span><br><span class="line">    .pipe(dest(<span class="string">"dist/sass"</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.scss = scss;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ï¼š<code>gulp scss</code>ã€‚</p><ul><li><a href="https://www.sass.hk/install/" target="_blank" rel="noopener">å¦‚ä½•å®‰è£… Sass</a></li></ul><h2 id="å››ç§ç¼–è¯‘æ’ç‰ˆ"><a href="#å››ç§ç¼–è¯‘æ’ç‰ˆ" class="headerlink" title="å››ç§ç¼–è¯‘æ’ç‰ˆ"></a>å››ç§ç¼–è¯‘æ’ç‰ˆ</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*æœªç¼–è¯‘æ ·å¼*/</span></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  &amp;-title &#123;</span><br><span class="line">    <span class="selector-tag">height</span>: 30<span class="selector-tag">px</span>;</span><br><span class="line">    <span class="selector-tag">line-height</span>: 30<span class="selector-tag">px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>nested ç¼–è¯‘æ’ç‰ˆæ ¼å¼</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*å‘½ä»¤è¡Œå†…å®¹*/</span></span><br><span class="line"><span class="selector-tag">sass</span> <span class="selector-tag">style</span><span class="selector-class">.scss</span><span class="selector-pseudo">:style.css</span> <span class="selector-tag">--style</span> <span class="selector-tag">nested</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*ç¼–è¯‘è¿‡åæ ·å¼*/</span></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box-title</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>expanded ç¼–è¯‘æ’ç‰ˆæ ¼å¼</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*å‘½ä»¤è¡Œå†…å®¹*/</span></span><br><span class="line"><span class="selector-tag">sass</span> <span class="selector-tag">style</span><span class="selector-class">.scss</span><span class="selector-pseudo">:style.css</span> <span class="selector-tag">--style</span> <span class="selector-tag">expanded</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*ç¼–è¯‘è¿‡åæ ·å¼*/</span></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box-title</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>compact ç¼–è¯‘æ’ç‰ˆæ ¼å¼</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*å‘½ä»¤è¡Œå†…å®¹*/</span></span><br><span class="line"><span class="selector-tag">sass</span> <span class="selector-tag">style</span><span class="selector-class">.scss</span><span class="selector-pseudo">:style.css</span> <span class="selector-tag">--style</span> <span class="selector-tag">compact</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*ç¼–è¯‘è¿‡åæ ·å¼*/</span></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box-title</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>compressed ç¼–è¯‘æ’ç‰ˆæ ¼å¼</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*å‘½ä»¤è¡Œå†…å®¹*/</span></span><br><span class="line"><span class="selector-tag">sass</span> <span class="selector-tag">style</span><span class="selector-class">.scss</span><span class="selector-pseudo">:style.css</span> <span class="selector-tag">--style</span> <span class="selector-tag">compressed</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*ç¼–è¯‘è¿‡åæ ·å¼*/</span></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box-title</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é™é»˜æ³¨é‡Š"><a href="#é™é»˜æ³¨é‡Š" class="headerlink" title="é™é»˜æ³¨é‡Š"></a>é™é»˜æ³¨é‡Š</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="comment">// è¿™ç§æ³¨é‡Šå†…å®¹ä¸ä¼šå‡ºç°åœ¨ç”Ÿæˆçš„cssæ–‡ä»¶ä¸­</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">  <span class="comment">/* è¿™ç§æ³¨é‡Šå†…å®¹ä¼šå‡ºç°åœ¨ç”Ÿæˆçš„cssæ–‡ä»¶ä¸­ */</span></span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">  <span class="comment">/* è¿™ç§æ³¨é‡Šå†…å®¹ä¼šå‡ºç°åœ¨ç”Ÿæˆçš„cssæ–‡ä»¶ä¸­ */</span></span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å˜é‡"><a href="#ä½¿ç”¨å˜é‡" class="headerlink" title="ä½¿ç”¨å˜é‡"></a>ä½¿ç”¨å˜é‡</h2><p>éå¸¸ç®€å•æ˜äº†ï¼Œå˜é‡ç”³æ˜ï¼š<code>$color: #4a4a4a;</code>ï¼Œå˜é‡å¼•ç”¨ï¼š<code>color: $color;</code>ï¼Œå…·ä½“ä¾‹å­æ¼”ç¤ºå¦‚ä¸‹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$bg-color</span>: <span class="number">#f90</span>;</span><br><span class="line"><span class="variable">$font-color</span>: <span class="number">#444</span>;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="variable">$bg-color</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="variable">$font-color</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.selected</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="variable">$font-color</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#f90</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.selected</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#444</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åµŒå¥—-CSS-è§„åˆ™"><a href="#åµŒå¥—-CSS-è§„åˆ™" class="headerlink" title="åµŒå¥— CSS è§„åˆ™"></a>åµŒå¥— CSS è§„åˆ™</h2><p>æ–‡æ¡£ï¼šåœ¨ Sass ä¸­ï¼Œä½ å¯ä»¥åƒä¿„ç½—æ–¯å¥—å¨ƒé‚£æ ·åœ¨è§„åˆ™å—ä¸­åµŒå¥—è§„åˆ™å—ã€‚sass åœ¨è¾“å‡º css æ—¶ä¼šå¸®ä½ æŠŠè¿™äº›åµŒå¥—è§„åˆ™å¤„ç†å¥½ï¼Œé¿å…ä½ çš„é‡å¤ä¹¦å†™ã€‚</p><p>çœ‹ä¸ªä¾‹å­ï¼ŒåŸºæœ¬å°±çŸ¥é“ä»€ä¹ˆæ„æ€ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ul</span> &#123;</span><br><span class="line">  <span class="selector-tag">li</span> &#123;</span><br><span class="line">    <span class="selector-tag">a</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="variable">$font-color</span>;</span><br><span class="line">      &amp;:hover &#123;</span><br><span class="line">        <span class="attribute">color</span>: red;</span><br><span class="line">      &#125;</span><br><span class="line">      &amp;::after &#123;</span><br><span class="line">        <span class="attribute">content</span>: <span class="string">"..."</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ul</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ul</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ul</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">"..."</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤Ÿç®€æ´ï¼Œä¸è¿‡æœ‰ä¸€äº›åµŒå¥—è§„åˆ™ï¼Œéœ€è¦ç¨ç¨ç•™æ„ï¼Œæ¯”å¦‚ï¼š</p><ul><li>çˆ¶é€‰æ‹©å™¨çš„æ ‡è¯†ç¬¦<code>&amp;</code></li><li>ç¾¤ç»„é€‰æ‹©å™¨çš„åµŒå¥—</li><li>å­ç»„åˆé€‰æ‹©å™¨å’ŒåŒå±‚ç»„åˆé€‰æ‹©å™¨ï¼š<code>&gt;ã€+ å’Œ ~</code></li><li>å±æ€§åµŒå¥—</li></ul><h3 id="çˆ¶é€‰æ‹©å™¨çš„æ ‡è¯†ç¬¦"><a href="#çˆ¶é€‰æ‹©å™¨çš„æ ‡è¯†ç¬¦" class="headerlink" title="çˆ¶é€‰æ‹©å™¨çš„æ ‡è¯†ç¬¦"></a>çˆ¶é€‰æ‹©å™¨çš„æ ‡è¯†ç¬¦</h3><p>çˆ¶é€‰æ‹©å™¨çš„æ ‡è¯†ç¬¦<code>&amp;</code>ï¼Œè®°ä½<code>&amp;</code>æ˜¯çˆ¸çˆ¸ï¼Œä½ å¯ä»¥åœ¨çˆ¸çˆ¸çš„åè¾¹ï¼Œä¹Ÿå¯ä»¥åœ¨çˆ¸çˆ¸çš„å‰è¾¹ï¼Œéšä½ ï¼Œå“ˆå“ˆå“ˆå“ˆï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nav</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="variable">$font-color</span>;</span><br><span class="line">  <span class="comment">/* Dad after */</span></span><br><span class="line">  &amp;:hover &#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* Dad before */</span></span><br><span class="line">  <span class="selector-class">.header</span> &amp; &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nav</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Dad after */</span></span><br><span class="line"><span class="selector-tag">nav</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Dad before */</span></span><br><span class="line"><span class="selector-class">.header</span> <span class="selector-tag">nav</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Dad æ˜¯çˆ¸çˆ¸ä»¬ï¼š<code>nav a</code>ï¼Œä»€ä¹ˆåœºæ™¯èƒ½ç”¨åˆ°<code>Dad before</code>ï¼Ÿæƒ³æƒ³<code>nav a</code>æ˜¯é€šç”¨æ ·å¼ï¼Œæˆ‘æƒ³ç»™ header ç»„ä»¶å•ç‹¬<code>nav a</code>çš„æ ·å¼ï¼Œå³<code>.header nav a</code>ï¼Œå³<code>.header &amp;</code>ã€‚</p><p>å½“ç„¶ï¼Œè¿˜å¯ä»¥è¿™æ ·ç”¨ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.main</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: black;</span><br><span class="line">  &amp;-sidebar &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// css</span></span><br><span class="line"><span class="selector-class">.main</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.main-sidebar</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¾¤ç»„é€‰æ‹©å™¨çš„åµŒå¥—"><a href="#ç¾¤ç»„é€‰æ‹©å™¨çš„åµŒå¥—" class="headerlink" title="ç¾¤ç»„é€‰æ‹©å™¨çš„åµŒå¥—"></a>ç¾¤ç»„é€‰æ‹©å™¨çš„åµŒå¥—</h3><p>æ–‡æ¡£ä¾‹å­ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="selector-tag">h1</span>,</span><br><span class="line">  <span class="selector-tag">h2</span>,</span><br><span class="line">  <span class="selector-tag">h3</span> &#123;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">0.8em</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">nav</span>,</span><br><span class="line"><span class="selector-tag">aside</span> &#123;</span><br><span class="line">  <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: blue;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> <span class="selector-tag">h1</span>,</span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-tag">h2</span>,</span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-tag">h3</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">0.8em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">nav</span> <span class="selector-tag">a</span>,</span><br><span class="line"><span class="selector-tag">aside</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åå­—å°±å·²ç»å‘Šè¯‰å’±ä»¬è¿™ä¸ªè§„åˆ™çš„è¦ç‚¹æ˜¯ï¼šç¾¤ç»„ã€‚å¤§æ‹¬å·<code>{</code>å‰ç«¯çš„éƒ½å¯ä»¥æ˜¯ä¸€ä¸ªç¾¤ç»„ï¼Œæ¯”å¦‚<code>.container</code>ï¼Œæ¯”å¦‚<code>nav, aside</code>ï¼Œä¸è®ºå¤šå°‘ã€‚</p><p>åšä¸ºç¾¤ç»„çš„ä»»ä½•ä¸€å‘˜ï¼Œæœ‰æƒåˆ©è·å–å­å—£ï¼Œè€Œä¸”è¿˜å¾—è·Ÿå…¶ä»–ç¾¤ç»„æˆå‘˜ä¸€æ¨¡ä¸€æ ·ï¼Œè‹¥ Ta æœ‰ ä¸‰ä¸ªï¼ˆ<code>h1, h2, h3</code>ï¼‰å­å—£ï¼Œé‚£ç¾¤ç»„çš„ä»»ä½•ä¸€å‘˜ä¹Ÿå¾—å„è‡ªæœ‰ä¸‰ä¸ªå­å—£ï¼›Ta å¦‚æœåªæœ‰ä¸€ä¸ªï¼ˆ<code>a</code>ï¼‰å­å—£ï¼Œå³ä½¿ç¾¤ç»„äººå¾ˆå¤šï¼Œä¹Ÿå¾—æ¯ä¸ªæˆå‘˜ä¸€äººä¸€ä¸ªã€‚</p><p>æ¼”ç»ƒï¼šæœ‰ä¸‰ä¸ªç»„ä»¶<code>header article footer</code>ï¼Œæˆ‘å¸Œæœ›å­—ä½“é¢œè‰²æœ‰é»˜è®¤å€¼ï¼Œé“¾æ¥ä¾‹å¤–ï¼Œå¹¶ä¸”æœ‰ hover å˜åŒ–ã€‚</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.header</span>,</span><br><span class="line"><span class="selector-class">.acticle</span>,</span><br><span class="line"><span class="selector-class">.footer</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="variable">$font-color</span>;</span><br><span class="line">  <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">    &amp;:hover &#123;</span><br><span class="line">      <span class="attribute">color</span>: red;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.header</span>,</span><br><span class="line"><span class="selector-class">.acticle</span>,</span><br><span class="line"><span class="selector-class">.footer</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.header</span> <span class="selector-tag">a</span>,</span><br><span class="line"><span class="selector-class">.acticle</span> <span class="selector-tag">a</span>,</span><br><span class="line"><span class="selector-class">.footer</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.header</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-class">.acticle</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-class">.footer</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­ç»„åˆå’ŒåŒå±‚ç»„åˆ"><a href="#å­ç»„åˆå’ŒåŒå±‚ç»„åˆ" class="headerlink" title="å­ç»„åˆå’ŒåŒå±‚ç»„åˆ"></a>å­ç»„åˆå’ŒåŒå±‚ç»„åˆ</h3><p>å­ç»„åˆé€‰æ‹©å™¨ <code>&gt;</code> å’ŒåŒå±‚ç»„åˆé€‰æ‹©å™¨ <code>+ã€~</code>ï¼Œå’Œ CSS çš„è§„åˆ™ä¸€è‡´ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* é€‰æ‹©article åçš„åŒå±‚æ‰€æœ‰ article å…ƒç´  */</span></span><br><span class="line"><span class="selector-tag">article</span> ~ <span class="selector-tag">article</span> &#123;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1px</span> dashed <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* é€‰æ‹©navå…ƒç´ åç´§è·Ÿçš„articleå…ƒç´  */</span></span><br><span class="line"><span class="selector-tag">nav</span> + <span class="selector-tag">article</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* é€‰æ‹©articleä¸‹çš„æ‰€æœ‰å‘½ä¸­sectioné€‰æ‹©å™¨çš„å…ƒç´  */</span></span><br><span class="line"><span class="selector-tag">article</span> &gt; <span class="selector-tag">section</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–‡æ¡£ä¾‹å­ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">article</span> &#123;</span><br><span class="line">  ~ article &#123;</span><br><span class="line">    <span class="selector-tag">border-top</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">dashed</span> <span class="selector-id">#ccc</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  &gt; <span class="selector-tag">section</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#eee</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">dl</span> &gt; &#123;</span><br><span class="line">    dt &#123;</span><br><span class="line">      <span class="selector-tag">color</span>: <span class="selector-id">#333</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">dd</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">nav</span> + &amp; &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">article</span> ~ <span class="selector-tag">article</span> &#123;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1px</span> dashed <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">article</span> &gt; <span class="selector-tag">section</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">article</span> <span class="selector-tag">dl</span> &gt; <span class="selector-tag">dt</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">article</span> <span class="selector-tag">dl</span> &gt; <span class="selector-tag">dd</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">nav</span> + <span class="selector-tag">article</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åµŒå¥—å±æ€§"><a href="#åµŒå¥—å±æ€§" class="headerlink" title="åµŒå¥—å±æ€§"></a>åµŒå¥—å±æ€§</h3><blockquote><p>è§„åˆ™ï¼šæŠŠå±æ€§åä»ä¸­åˆ’çº¿-çš„åœ°æ–¹æ–­å¼€ï¼Œåœ¨æ ¹å±æ€§åè¾¹æ·»åŠ ä¸€ä¸ªå†’å·<code>:</code>ï¼Œç´§è·Ÿä¸€ä¸ª<code>{ }</code>å—ï¼ŒæŠŠå­å±æ€§éƒ¨åˆ†å†™åœ¨è¿™ä¸ª<code>{ }</code>å—ä¸­ã€‚å°±åƒ css é€‰æ‹©å™¨åµŒå¥—ä¸€æ ·ï¼Œsass ä¼šæŠŠä½ çš„å­å±æ€§ä¸€ä¸€è§£å¼€ï¼ŒæŠŠæ ¹å±æ€§å’Œå­å±æ€§éƒ¨åˆ†é€šè¿‡ä¸­åˆ’çº¿<code>-</code>è¿æ¥èµ·æ¥ï¼Œæœ€åç”Ÿæˆçš„æ•ˆæœä¸ä½ æ‰‹åŠ¨ä¸€ééå†™çš„ css æ ·å¼ä¸€æ ·ï¼š</p></blockquote><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nav</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: &#123;</span><br><span class="line">    style: solid;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#ccc</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">nav</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span> &#123;</span><br><span class="line">    left: <span class="number">0px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// css</span></span><br><span class="line"><span class="selector-tag">nav</span> &#123;</span><br><span class="line">  <span class="attribute">border-style</span>: solid;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">nav</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€å¥è¯ï¼šæˆ‘è¦æŠŠ<code>border-style</code>é‡Œçš„<code>-</code>æ‰“æ–­ï¼Œæ‹†æ•£å·¦å³ï¼Œå¹¶æ›¿æ¢æˆ<code>:</code>ï¼Œé‡æ–°ä½¿ç”¨<code>{}</code>åµŒå¥—ä½¿ç”¨ï¼Œå®—æ—¨å°±æ˜¯ä¸ç ´ä¸ç«‹ï¼Œæœ‰ç ´æ‰æœ‰ç«‹ï¼ŒæŠŠæ‰€æœ‰é‡å¤çš„ä¸œè¥¿ç»Ÿç»Ÿå½’å¹¶ï¼Œåªå†™å…³é”®éƒ¨ä½ã€‚</p><h2 id="Rules"><a href="#Rules" class="headerlink" title="@-Rules"></a>@-Rules</h2><h3 id="import-å¯¼å…¥"><a href="#import-å¯¼å…¥" class="headerlink" title="@import å¯¼å…¥"></a>@import å¯¼å…¥</h3><p>åœ¨å•ç‹¬ä½¿ç”¨ css çš„ <code>@import</code> è§„åˆ™å¯¼å…¥æ–‡ä»¶ï¼Œæ˜¯ä¸åŠ <code>link</code> çš„æ•ˆç‡ï¼Œæ¯”å¦‚åŠ è½½å­—ä½“åº“ï¼Œæœ‰æ¬¡åœ¨é¡¹ç›®ä¸­å°±åƒè¿‡è¿™ä¸ªäºï¼Œé‚£ä¼šå‘èª“æ‰“æ­»æˆ‘ä¹Ÿä¸ç”¨è¿™ä¸ªè§„åˆ™ã€‚</p><p>sass çš„<code>@import</code> è§„åˆ™æ˜¯åœ¨ç”Ÿæˆ css æ–‡ä»¶æ—¶å°±æŠŠç›¸å…³æ–‡ä»¶å¯¼å…¥è¿›æ¥ï¼Œæ‰€ä»¥ï¼Œå’Œ css çš„<code>@import</code>æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œæ”¾å¿ƒé£Ÿç”¨ã€‚</p><p>ä½†æ˜¯ç”±äº sass å…¼å®¹åŸç”Ÿçš„ cssï¼Œæ‰€ä»¥å®ƒä¹Ÿæ”¯æŒåŸç”Ÿçš„ CSS<code>@import</code>ï¼Œæ¯”å¦‚å¯¼å…¥æ–‡ä»¶æˆ–è€… url æ˜¯ä»¥ <code>.css</code>ç»“å°¾çš„ã€‚</p><p>ä½¿ç”¨ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¸¸ç”¨æ–¹æ³•</span></span><br><span class="line">@<span class="keyword">import</span> <span class="string">"header"</span>;</span><br><span class="line">@<span class="keyword">import</span> <span class="string">"footer"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šä¸ªå¯¼å…¥</span></span><br><span class="line">@<span class="keyword">import</span> <span class="string">"rounded-corners"</span>, <span class="string">"text-shadow"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åµŒå¥—å¯¼å…¥</span></span><br><span class="line"><span class="selector-class">.blue-theme</span> &#123;</span><br><span class="line">  @<span class="keyword">import</span> <span class="string">"blue-theme"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå°†æ–‡ä»¶å‘½åä¸º <code>_colors.scss</code>ï¼Œä¾¿ä¸ä¼šç¼–è¯‘<code>_colours.css</code> æ–‡ä»¶ï¼Œä½†æ˜¯å¯¼å…¥æ—¶ä¾ç„¶æ˜¯<code>@import &quot;colors&quot;;</code>ã€‚</p><h3 id="media-åª’ä½“æŸ¥è¯¢"><a href="#media-åª’ä½“æŸ¥è¯¢" class="headerlink" title="@media åª’ä½“æŸ¥è¯¢"></a>@media åª’ä½“æŸ¥è¯¢</h3><p>Sass ä¸­ @media æŒ‡ä»¤ä¸ CSS ä¸­ç”¨æ³•ä¸€æ ·ï¼Œä¸è¿‡è¿˜å…è®¸å…¶åœ¨ CSS è§„åˆ™ä¸­åµŒå¥—ï¼Œç¼–è¯‘æ—¶ï¼Œ@media å°†è¢«ç¼–è¯‘åˆ°æ–‡ä»¶çš„æœ€å¤–å±‚ï¼ŒåŒ…å«åµŒå¥—çš„çˆ¶é€‰æ‹©å™¨ã€‚</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  @<span class="keyword">media</span> screen and (orientation: landscape) &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ‹¼æ¥ and */</span></span><br><span class="line">@<span class="keyword">media</span> screen &#123;</span><br><span class="line">  <span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">    @<span class="keyword">media</span> (max-width: 1140px) &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">960px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.other</span> &#123;</span><br><span class="line">    @<span class="keyword">media</span> (max-width: 640px) &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (orientation: landscape) &#123;</span><br><span class="line">  <span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ‹¼æ¥ and */</span></span><br><span class="line">@<span class="keyword">media</span> screen and (max-width: <span class="number">1140px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">960px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> screen and (max-width: <span class="number">640px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.other</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="extend"><a href="#extend" class="headerlink" title="@extend"></a>@extend</h3><p>å’Œå…¶ä»–è¯­è¨€ä¸€æ ·ï¼Œå°±æ˜¯ç»§æ‰¿ã€‚æ¯”å¦‚ä»£ç ä¸­çš„<code>.error</code>ï¼Œä»¥åŠåŒçº§<code>.intrusion</code>ï¼Œéƒ½ä¼šè¢«ç»§æ‰¿ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.error</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#f00</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fdd</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.error</span><span class="selector-class">.intrusion</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: url(<span class="string">"/image/hacked.png"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.seriousError</span> &#123;</span><br><span class="line">  @<span class="keyword">extend</span> .error;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.error</span>,</span><br><span class="line"><span class="selector-class">.seriousError</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#f00</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fdd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.error</span><span class="selector-class">.intrusion</span>,</span><br><span class="line"><span class="selector-class">.intrusion</span><span class="selector-class">.seriousError</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">"/image/hacked.png"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.seriousError</span> &#123;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ§åˆ¶æŒ‡ä»¤"><a href="#æ§åˆ¶æŒ‡ä»¤" class="headerlink" title="æ§åˆ¶æŒ‡ä»¤"></a>æ§åˆ¶æŒ‡ä»¤</h2><h3 id="if"><a href="#if" class="headerlink" title="@if"></a>@if</h3><p>å’Œ JavaScript çš„ if ä¸€æ ·ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$type</span>: monster;</span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  @<span class="keyword">if</span> <span class="variable">$type</span> == ocean &#123;</span><br><span class="line">    <span class="attribute">color</span>: blue;</span><br><span class="line">  &#125; @<span class="keyword">else</span> if <span class="variable">$type</span> == monster &#123;</span><br><span class="line">    <span class="attribute">color</span>: green;</span><br><span class="line">  &#125; @<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: black;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="for"><a href="#for" class="headerlink" title="@for"></a>@for</h3><p>åŒºåˆ«åœ¨äº through ä¸ to çš„å«ä¹‰ï¼šthrough åŒ…å«æœ€åä¸€ä½ï¼Œè€Œ to ä¸åŒ…å«ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">for</span> <span class="variable">$i</span> from 1 to 3 &#123;</span><br><span class="line">  <span class="selector-class">.list-</span>#&#123;<span class="variable">$i</span>&#125; &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1em</span> * <span class="variable">$i</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">for</span> <span class="variable">$i</span> from 1 through 3 &#123;</span><br><span class="line">  <span class="selector-class">.item-</span>#&#123;<span class="variable">$i</span>&#125; &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">2rem</span> * <span class="variable">$i</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.list-1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.list-2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">2em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item-1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">2rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item-2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">4rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item-3</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">6rem</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="each"><a href="#each" class="headerlink" title="@each"></a>@each</h3><p>ç±»ä¼¼äº JavaScript çš„ <code>for...in</code>ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">each</span> <span class="variable">$kind</span> in small, middle, large &#123;</span><br><span class="line">  .#&#123;<span class="variable">$kind</span>&#125;-<span class="attribute">icon</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: url(<span class="string">"/images/#&#123;$kind&#125;-icon.png"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.small-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">"/images/small-icon.png"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.middle-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">"/images/middle-icon.png"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.large-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">"/images/large-icon.png"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ··åˆå™¨"><a href="#æ··åˆå™¨" class="headerlink" title="æ··åˆå™¨"></a>æ··åˆå™¨</h2><p>æ··åˆå™¨ä½¿ç”¨<code>@mixin</code>æ ‡è¯†ç¬¦å®šä¹‰ï¼Œé€šè¿‡<code>@include</code>æ¥ä½¿ç”¨è¿™ä¸ªæ··åˆå™¨ï¼Œç”¨æ¥è§£å†³å¤§æ®µé‡ç”¨çš„ä»£ç ã€‚</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">mixin</span> clearfix &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  &amp;:after &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">"."</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">    <span class="attribute">visibility</span>: hidden;</span><br><span class="line">  &#125;</span><br><span class="line">  * <span class="selector-tag">html</span> &amp; &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.clearfix</span> &#123;</span><br><span class="line">  @<span class="keyword">include</span> clearfix;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">"."</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">clear</span>: both;</span><br><span class="line">  <span class="attribute">visibility</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">* <span class="selector-tag">html</span> <span class="selector-class">.clearfix</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€å¼ºå¤§çš„ä¸€ç‚¹å°±æ˜¯å¦‚åŒå‡½æ•°ä¸€èˆ¬ï¼Œå¯ä»¥ä¼ å‚ï¼Œä¸ä»…å¯ä»¥æŒ‡å®šé»˜è®¤å€¼ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨å…³é”®è¯å‚æ•°ï¼Œè¿™æ ·å°±ä¸ç”¨ç®¡å‚æ•°å‰åé¡ºåºäº†ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">mixin</span> border-value(<span class="variable">$width</span>: 1px, <span class="variable">$color</span>: <span class="number">#333</span>, <span class="variable">$style</span>: solid) &#123;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="variable">$width</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="variable">$color</span>;</span><br><span class="line">  <span class="attribute">border-style</span>: <span class="variable">$style</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*ä¸ä¼ å‚*/</span></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  @<span class="keyword">include</span> border-value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*ä¼ å‚*/</span></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">  @<span class="keyword">include</span> border-value(<span class="number">2px</span>, <span class="number">#666</span>, dashed);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*å…³é”®è¯ä¼ å‚*/</span></span><br><span class="line"><span class="selector-tag">h3</span> &#123;</span><br><span class="line">  @<span class="keyword">include</span> border-value(<span class="variable">$style</span>: dashed, <span class="variable">$width</span>: 3px, <span class="variable">$color</span>: <span class="number">#999</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*ä¸ä¼ å‚*/</span></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#333</span>;</span><br><span class="line">  <span class="attribute">border-style</span>: solid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*ä¼ å‚*/</span></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#666</span>;</span><br><span class="line">  <span class="attribute">border-style</span>: dashed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*å…³é”®è¯ä¼ å‚*/</span></span><br><span class="line"><span class="selector-tag">h3</span> &#123;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#999</span>;</span><br><span class="line">  <span class="attribute">border-style</span>: dashed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°æŒ‡ä»¤"><a href="#å‡½æ•°æŒ‡ä»¤" class="headerlink" title="å‡½æ•°æŒ‡ä»¤"></a>å‡½æ•°æŒ‡ä»¤</h2><p>ä¸ mixin ç›¸åŒï¼Œä¹Ÿå¯ä»¥ä¼ é€’è‹¥å¹²ä¸ªå…¨å±€å˜é‡ç»™å‡½æ•°ä½œä¸ºå‚æ•°ã€‚ä¸€ä¸ªå‡½æ•°å¯ä»¥å«æœ‰å¤šæ¡è¯­å¥ï¼Œéœ€è¦è°ƒç”¨ <code>@return</code> è¾“å‡ºç»“æœã€‚</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid-width</span>: <span class="number">40px</span>;</span><br><span class="line"><span class="variable">$gutter-width</span>: <span class="number">10px</span>;</span><br><span class="line"></span><br><span class="line">@function grid-width(<span class="variable">$n</span>) &#123;</span><br><span class="line">  @return <span class="variable">$n</span> * <span class="variable">$grid-width</span> + (<span class="variable">$n</span> - 1) * <span class="variable">$gutter-width</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sidebar1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: grid-width(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sidebar2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: grid-width(<span class="variable">$n</span>: <span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sidebar1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">240px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sidebar2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">490px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SassScript"><a href="#SassScript" class="headerlink" title="SassScript"></a>SassScript</h2><h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><p>SassScript æ”¯æŒ 6 ç§ä¸»è¦çš„æ•°æ®ç±»å‹ï¼š</p><ul><li>æ•°å­—ï¼Œ<code>1, 2, 13, 10px</code></li><li>å­—ç¬¦ä¸²ï¼Œæœ‰å¼•å·å­—ç¬¦ä¸²ä¸æ— å¼•å·å­—ç¬¦ä¸²ï¼Œ<code>&quot;foo&quot;, &#39;bar&#39;, baz</code></li><li>é¢œè‰²ï¼Œ<code>blue, #04a3f9, rgba(255,0,0,0.5)</code></li><li>å¸ƒå°”å‹ï¼Œ<code>true, false</code></li><li>ç©ºå€¼ï¼Œ<code>null</code></li><li>æ•°ç»„ (list)ï¼Œç”¨ç©ºæ ¼æˆ–é€—å·ä½œåˆ†éš”ç¬¦ï¼Œ<code>1.5em 1em 0 2em, Helvetica, Arial, sans-serif</code></li><li>maps, ç›¸å½“äº JavaScript çš„ objectï¼Œ<code>(key1: value1, key2: value2)</code></li></ul><h3 id="è¿ç®—"><a href="#è¿ç®—" class="headerlink" title="è¿ç®—"></a>è¿ç®—</h3><p>SassScript æ”¯æŒæ•°å­—çš„åŠ å‡ä¹˜é™¤ã€å–æ•´ç­‰è¿ç®— <code>(+, -, *, /, %)</code>ï¼Œå…³ç³»è¿ç®— <code>&lt;, &gt;, &lt;=, &gt;=</code> ä¹Ÿå¯ç”¨äºæ•°å­—è¿ç®—ï¼Œç›¸ç­‰è¿ç®— <code>==</code>, <code>!=</code> å¯ç”¨äºæ‰€æœ‰æ•°æ®ç±»å‹ã€‚</p><h3 id="æ’å€¼è¯­å¥"><a href="#æ’å€¼è¯­å¥" class="headerlink" title="æ’å€¼è¯­å¥ #{}"></a>æ’å€¼è¯­å¥ #{}</h3><p>é€šè¿‡ <code>#{}</code> æ’å€¼è¯­å¥å¯ä»¥åœ¨é€‰æ‹©å™¨æˆ–å±æ€§åä¸­ä½¿ç”¨å˜é‡ï¼Œé¿å… Sass è¿è¡Œè¿ç®—è¡¨è¾¾å¼ã€‚</p><h2 id="Bootstrap-4"><a href="#Bootstrap-4" class="headerlink" title="Bootstrap@4"></a>Bootstrap@4</h2><ul><li><a href="https://getbootstrap.com/" target="_blank" rel="noopener">Bootstrap v4.4.1</a></li></ul><p>å…¥å£æ–‡ä»¶ <code>bootstrap.scss</code>çš„å¼•å…¥ç»„ä»¶å¾ˆå¤šï¼Œæˆ‘ä»¬å°±æŒ‘ä¸€ä¸ªçœ‹çœ‹ï¼Œæ¯”å¦‚ä¸‹é¢æ˜¯æˆ‘ä»¬æœ€ç»ˆçš„ float å†…å®¹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.float-left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.float-right</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: right <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.float-none</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> (min-width: <span class="number">576px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.float-sm-left</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-sm-right</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: right <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-sm-none</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: none <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> (min-width: <span class="number">768px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.float-md-left</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-md-right</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: right <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-md-none</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: none <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> (min-width: <span class="number">992px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.float-lg-left</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-lg-right</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: right <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-lg-none</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: none <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> (min-width: <span class="number">1200px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.float-xl-left</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-xl-right</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: right <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.float-xl-none</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: none <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬å»çœ‹çœ‹ bootstrap æ˜¯å¦‚ä½•å®ç°çš„ï¼š</p><h3 id="ç¬¬ä¸€æ­¥ï¼šæ‰¾è·¯"><a href="#ç¬¬ä¸€æ­¥ï¼šæ‰¾è·¯" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šæ‰¾è·¯"></a>ç¬¬ä¸€æ­¥ï¼šæ‰¾è·¯</h3><p>æ ¹æ® <code>bootstrap.scss</code>é‡Œçš„å†…å®¹<code>@import &quot;mixins&quot;;</code>ï¼Œè¿›å…¥å½“å‰ç›®å½•ä¸‹çš„<code>_mixins.scss</code>ï¼Œçœ‹åˆ°<code>@import &quot;mixins/float&quot;;</code>ï¼Œæ‰€ä»¥ç»§ç»­æ‰“å¼€<code>mixins</code> ç›®å½•ä¸‹çš„ <code>_float.scss</code>ã€‚</p><h3 id="ç¬¬äºŒæ­¥ï¼šå†…å®¹"><a href="#ç¬¬äºŒæ­¥ï¼šå†…å®¹" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šå†…å®¹"></a>ç¬¬äºŒæ­¥ï¼šå†…å®¹</h3><p><code>_float.scss</code>æ‰€æœ‰å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stylelint-disable declaration-no-important</span></span><br><span class="line"></span><br><span class="line">@<span class="keyword">each</span> <span class="variable">$breakpoint</span> in map-keys(<span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  @<span class="keyword">include</span> media-breakpoint-up(<span class="variable">$breakpoint</span>) &#123;</span><br><span class="line">    <span class="variable">$infix</span>: breakpoint-infix(<span class="variable">$breakpoint</span>, <span class="variable">$grid-breakpoints</span>);</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.float</span>#&#123;<span class="variable">$infix</span>&#125;-<span class="attribute">left</span> &#123;</span><br><span class="line">      <span class="attribute">float</span>: left <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.float</span>#&#123;<span class="variable">$infix</span>&#125;-<span class="attribute">right</span> &#123;</span><br><span class="line">      <span class="attribute">float</span>: right <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.float</span>#&#123;<span class="variable">$infix</span>&#125;-<span class="attribute">none</span> &#123;</span><br><span class="line">      <span class="attribute">float</span>: none <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€ï¼Œæœ‰ä¸‰ä¸ªåœ°æ–¹ï¼Œæˆ‘ä¸çŸ¥é“æ˜¯ä»€ä¹ˆï¼Œå¦‚<code>map-keys()</code>ï¼Œ<code>media-breakpoint-up()</code>ï¼Œ<code>breakpoint-infix()</code>ã€‚</p><h3 id="ç¬¬ä¸‰æ­¥ï¼šè§£æƒ‘"><a href="#ç¬¬ä¸‰æ­¥ï¼šè§£æƒ‘" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šè§£æƒ‘"></a>ç¬¬ä¸‰æ­¥ï¼šè§£æƒ‘</h3><ul><li><code>map-keys()</code> è¿”å› map é‡Œé¢æ‰€æœ‰çš„ keyï¼š</li></ul><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid-breakpoints</span>: (</span><br><span class="line">  xs: <span class="number">0</span>,</span><br><span class="line">  sm: <span class="number">576px</span>,</span><br><span class="line">  md: <span class="number">768px</span>,</span><br><span class="line">  lg: <span class="number">992px</span>,</span><br><span class="line">  xl: <span class="number">1200px</span></span><br><span class="line">) !default;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">each</span> <span class="variable">$breakpoint</span> in map-keys(<span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  .#&#123;<span class="variable">$breakpoint</span>&#125; &#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// css</span></span><br><span class="line"><span class="selector-class">.xs</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sm</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.md</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.lg</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.xl</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>èµ„æ–™ï¼š<a href="https://www.cnblogs.com/whqet/p/Sassmap.html" target="_blank" rel="noopener">Sass map è¯¦è§£</a></p><ul><li><code>media-breakpoint-up()</code>ï¼Œè‡ªå®šä¹‰å‡½æ•°ï¼Œä¸»è¦æ˜¯æ ¹æ®åª’ä½“æŸ¥è¯¢ç»™å‡ºä¸åŒçš„ç»“æœ</li></ul><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Media of at least the minimum breakpoint width. No query for the smallest breakpoint.</span></span><br><span class="line"><span class="comment">// Makes the @content apply to the given breakpoint and wider.</span></span><br><span class="line">@<span class="keyword">mixin</span> media-breakpoint-up(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>: <span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  <span class="variable">$min</span>: breakpoint-min(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>);</span><br><span class="line">  @<span class="keyword">if</span> <span class="variable">$min</span> &#123;</span><br><span class="line">    @<span class="keyword">media</span> (min-width: <span class="variable">$min</span>) &#123;</span><br><span class="line">      @<span class="keyword">content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; @<span class="keyword">else</span> &#123;</span><br><span class="line">    @<span class="keyword">content</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>breakpoint-min()</code>ä¹Ÿæ˜¯ä¸ªå‡½æ•°ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Minimum breakpoint width. Null for the smallest (first) breakpoint.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    &gt;&gt; breakpoint-min(sm, (xs: 0, sm: 576px, md: 768px, lg: 992px, xl: 1200px))</span></span><br><span class="line"><span class="comment">//    576px</span></span><br><span class="line">@function breakpoint-min(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>: <span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  <span class="variable">$min</span>: map-get(<span class="variable">$breakpoints</span>, <span class="variable">$name</span>);</span><br><span class="line">  @return if(<span class="variable">$min</span> != 0, <span class="variable">$min</span>, null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>map-get</code>åŒ <code>map-keys</code>ç”¨æ³•ï¼Œè¿”å› map é‡Œé¢æŒ‡å®šå¯ä»¥çš„ <code>value</code>ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$min-num</span>: breakpoint-min(sm, <span class="variable">$grid-breakpoints</span>);</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> (min-width: <span class="variable">$min-num</span>) &#123;</span><br><span class="line">  <span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// css</span></span><br><span class="line">@<span class="keyword">media</span> (min-width: 576px) &#123;</span><br><span class="line">  <span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#444</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@content</code>ç”¨åœ¨<code>mixin</code>é‡Œé¢çš„ï¼Œå½“å®šä¹‰ä¸€ä¸ª<code>mixin</code>åï¼Œå¹¶ä¸”è®¾ç½®äº†<code>@content</code>ä¹‹åï¼Œã€<code>@include</code>çš„æ—¶å€™å¯ä»¥ä¼ å…¥ç›¸åº”çš„å†…å®¹åˆ°<code>mixin</code>é‡Œé¢ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$color</span>: white;</span><br><span class="line">@<span class="keyword">mixin</span> colors(<span class="variable">$color</span>: blue) &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="variable">$color</span>;</span><br><span class="line">  @<span class="keyword">content</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="variable">$color</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.colors</span> &#123;</span><br><span class="line">  @<span class="keyword">include</span> colors &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="variable">$color</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// css</span></span><br><span class="line"><span class="selector-class">.colors</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: blue;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">border-color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>èµ„æ–™ï¼š<a href="https://segmentfault.com/q/1010000004119350" target="_blank" rel="noopener">sass è¯­æ³•ä¸­çš„@content</a></p><ul><li><code>breakpoint-infix()</code>ï¼Œè‡ªå®šä¹‰å‡½æ•°ï¼š</li></ul><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Returns a blank string if smallest breakpoint, otherwise returns the name with a dash in front.</span></span><br><span class="line"><span class="comment">// Useful for making responsive utilities.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    &gt;&gt; breakpoint-infix(xs, (xs: 0, sm: 576px, md: 768px, lg: 992px, xl: 1200px))</span></span><br><span class="line"><span class="comment">//    ""  (Returns a blank string)</span></span><br><span class="line"><span class="comment">//    &gt;&gt; breakpoint-infix(sm, (xs: 0, sm: 576px, md: 768px, lg: 992px, xl: 1200px))</span></span><br><span class="line"><span class="comment">//    "-sm"</span></span><br><span class="line">@function breakpoint-infix(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>: <span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  @return if(breakpoint-min(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>) == null, <span class="string">""</span>, <span class="string">"-#&#123;$name&#125;"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®æ³¨é‡Šæˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$min-value-sm</span>: breakpoint-infix(sm, <span class="variable">$grid-breakpoints</span>);</span><br><span class="line"><span class="variable">$min-value-xs</span>: breakpoint-infix(xs, <span class="variable">$grid-breakpoints</span>);</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.float</span>#&#123;<span class="variable">$min-value-sm</span>&#125;-<span class="attribute">left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.float</span>#&#123;<span class="variable">$min-value-xs</span>&#125;-<span class="attribute">left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// css</span></span><br><span class="line"><span class="selector-class">.float-sm-left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.float-left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•´åˆ"><a href="#æ•´åˆ" class="headerlink" title="æ•´åˆ"></a>æ•´åˆ</h3><p>æœ€åï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰å…³äº float çš„å†…å®¹ç»„åˆåœ¨ä¸€èµ·ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$grid-breakpoints</span>: (</span><br><span class="line">  xs: <span class="number">0</span>,</span><br><span class="line">  sm: <span class="number">576px</span>,</span><br><span class="line">  md: <span class="number">768px</span>,</span><br><span class="line">  lg: <span class="number">992px</span>,</span><br><span class="line">  xl: <span class="number">1200px</span></span><br><span class="line">) !default;</span><br><span class="line"></span><br><span class="line">@function breakpoint-min(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>: <span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  <span class="variable">$min</span>: map-get(<span class="variable">$breakpoints</span>, <span class="variable">$name</span>);</span><br><span class="line">  @return if(<span class="variable">$min</span> != 0, <span class="variable">$min</span>, null);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@function breakpoint-infix(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>: <span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  @return if(breakpoint-min(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>) == null, <span class="string">""</span>, <span class="string">"-#&#123;$name&#125;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">mixin</span> media-breakpoint-up(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>: <span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  <span class="variable">$min</span>: breakpoint-min(<span class="variable">$name</span>, <span class="variable">$breakpoints</span>);</span><br><span class="line">  @<span class="keyword">if</span> <span class="variable">$min</span> &#123;</span><br><span class="line">    @<span class="keyword">media</span> (min-width: <span class="variable">$min</span>) &#123;</span><br><span class="line">      @<span class="keyword">content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; @<span class="keyword">else</span> &#123;</span><br><span class="line">    @<span class="keyword">content</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">each</span> <span class="variable">$breakpoint</span> in map-keys(<span class="variable">$grid-breakpoints</span>) &#123;</span><br><span class="line">  @<span class="keyword">include</span> media-breakpoint-up(<span class="variable">$breakpoint</span>) &#123;</span><br><span class="line">    <span class="variable">$infix</span>: breakpoint-infix(<span class="variable">$breakpoint</span>, <span class="variable">$grid-breakpoints</span>);</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.float</span>#&#123;<span class="variable">$infix</span>&#125;-<span class="attribute">left</span> &#123;</span><br><span class="line">      <span class="attribute">float</span>: left <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.float</span>#&#123;<span class="variable">$infix</span>&#125;-<span class="attribute">right</span> &#123;</span><br><span class="line">      <span class="attribute">float</span>: right <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.float</span>#&#123;<span class="variable">$infix</span>&#125;-<span class="attribute">none</span> &#123;</span><br><span class="line">      <span class="attribute">float</span>: none <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ç›´æ¥å°±å¯ä»¥åœ¨ç¯å¢ƒé‡Œè·‘èµ·æ¥äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä¸–ç•Œä¸Šæœ€æˆç†Ÿã€æœ€ç¨³å®šã€æœ€å¼ºå¤§çš„ä¸“ä¸šçº§CSSæ‰©å±•è¯­è¨€ï¼ - Sass å®˜ç½‘&lt;br&gt;ç®€å•æ±‡æ€»ä¸€ä¸‹ sass çš„æ—¥å¸¸ä½¿ç”¨ï¼Œåˆç®€å•åœ°çœ‹äº†ä¸€ä¸‹ Bootstrap@4 é‡Œåº”ç”¨çš„ä¸€ä¸ª Demoã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="CSS" scheme="http://yangtao.site/categories/CSS/"/>
    
    
      <category term="CSS" scheme="http://yangtao.site/tags/CSS/"/>
    
      <category term="SASS" scheme="http://yangtao.site/tags/SASS/"/>
    
  </entry>
  
  <entry>
    <title>å…³äº React çŠ¶æ€ç®¡ç†é‚£äº›äº‹</title>
    <link href="http://yangtao.site/2019/12/29/react-state/"/>
    <id>http://yangtao.site/2019/12/29/react-state/</id>
    <published>2019-12-29T07:56:21.000Z</published>
    <updated>2020-01-02T12:39:35.162Z</updated>
    
    <content type="html"><![CDATA[<p>ç›®çš„ï¼šé‡‡ç”¨çŠ¶æ€ç®¡ç†çš„å¤šç§æ–¹å¼ï¼šå®ç°ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¯ä»¥åŠ ä¸€ï¼Œå‡ä¸€ï¼Œ ç½®é›¶ã€‚<br><a id="more"></a></p><h2 id="React-state"><a href="#React-state" class="headerlink" title="React state"></a>React state</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      value: <span class="number">0</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClick(actions) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (actions) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"INCREASE"</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.setState(<span class="function">(<span class="params">state, props</span>) =&gt;</span> (&#123;</span><br><span class="line">          value: ++state.value</span><br><span class="line">        &#125;));</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"DECREASE"</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.setState(<span class="function">(<span class="params">state, props</span>) =&gt;</span> (&#123;</span><br><span class="line">          value: --state.value</span><br><span class="line">        &#125;));</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">          value: <span class="number">0</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;&#123;<span class="keyword">this</span>.state.value&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; this.handleClick("INCREASE")&#125;&gt;+1&lt;/</span>button&gt;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; <span class="keyword">this</span>.handleClick(<span class="string">"DECREASE"</span>)&#125;&gt;<span class="number">-1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; this.handleClick("RESET")&#125;&gt;0&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="Flux"><a href="#Flux" class="headerlink" title="Flux"></a>Flux</h2><h2 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h2><p>ç¬¬ä¸€æ­¥ï¼šåˆ›å»º reducer</p><ul><li>å¯ä»¥ä½¿ç”¨å•ç‹¬çš„ä¸€ä¸ª reducer,ä¹Ÿå¯ä»¥å°†å¤šä¸ª reducer åˆå¹¶ä¸ºä¸€ä¸ª reducerï¼Œå³ï¼šcombineReducers()</li><li>action å‘å‡ºå‘½ä»¤åå°† state æ”¾å…¥ reucer åŠ å·¥å‡½æ•°ä¸­ï¼Œè¿”å›æ–°çš„ state,å¯¹ state è¿›è¡ŒåŠ å·¥å¤„ç†</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state = &#123; counter: <span class="number">0</span> &#125;, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"INCREASE"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: state.counter + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"DECREASE"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: state.counter - <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼šåˆ›å»º action</p><ul><li>ç”¨æˆ·æ˜¯æ¥è§¦ä¸åˆ° state çš„ï¼Œåªèƒ½æœ‰ view è§¦å‘ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ª action å¯ä»¥ç†è§£ä¸ºæŒ‡ä»¤ï¼Œéœ€è¦å‘å‡ºå¤šå°‘åŠ¨ä½œå°±æœ‰å¤šå°‘æŒ‡ä»¤</li><li>action æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªå« type çš„å‚æ•°ï¼Œå®šä¹‰ action ç±»å‹</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  increase: <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">"INCREASE"</span> &#125;),</span><br><span class="line">  decrease: <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">"DECREASE"</span> &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºçš„ storeï¼Œä½¿ç”¨ createStore æ–¹æ³•</p><ul><li>store å¯ä»¥ç†è§£ä¸ºæœ‰å¤šä¸ªåŠ å·¥æœºå™¨çš„æ€»å·¥å‚</li><li>æä¾› subscribeï¼Œdispatchï¼ŒgetState è¿™äº›æ–¹æ³•ã€‚</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"></span><br><span class="line">store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(store.getState()));</span><br><span class="line"></span><br><span class="line">store.dispatch(actions.increase()); <span class="comment">// &#123;counter: 1&#125;</span></span><br><span class="line">store.dispatch(actions.increase()); <span class="comment">// &#123;counter: 2&#125;</span></span><br><span class="line">store.dispatch(actions.increase()); <span class="comment">// &#123;counter: 3&#125;</span></span><br><span class="line">store.dispatch(actions.decrease()); <span class="comment">// &#123;counter: 2&#125;</span></span><br></pre></td></tr></table></figure><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state = &#123; counter: <span class="number">0</span> &#125;, action = &#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; type &#125; = action;</span><br><span class="line">  <span class="keyword">const</span> &#123; counter &#125; = state;</span><br><span class="line">  <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"INCREASE"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: counter + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"DECREASE"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: counter - <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: <span class="number">0</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">CounterRedux</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      counter: <span class="number">0</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.unsubscribe = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.unsubscribe = store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        counter: store.getState().counter</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    <span class="comment">// å–æ¶ˆè®¢é˜…</span></span><br><span class="line">    <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;&#123;<span class="keyword">this</span>.state.counter&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; store.dispatch(&#123; type: "INCREASE" &#125;)&#125;&gt;+1&lt;/</span>button&gt;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; store.dispatch(&#123; <span class="attr">type</span>: <span class="string">"DECREASE"</span> &#125;)&#125;&gt;<span class="number">-1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; store.dispatch(&#123; type: "RESET" &#125;)&#125;&gt;0&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>action å¯ä»¥å•ç‹¬å‡ºæ¥ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  increase: <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">"INCREASE"</span> &#125;),</span><br><span class="line">  decrease: <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">"DECREASE"</span> &#125;),</span><br><span class="line">  reset: <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">type</span>: <span class="string">"RESET"</span> &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// è§¦å‘</span></span><br><span class="line">&lt;button onClick=&#123;() =&gt; store.dispatch(actions.increase())&#125;&gt;+<span class="number">1</span>&lt;<span class="regexp">/button&gt;;</span></span><br></pre></td></tr></table></figure><p>ä¸»è¦æ˜¯ä¸ºäº†å±•ç¤º redux çš„ä¸€ä¸ªå·¥ä½œæµç¨‹ï¼Œå¹¶æ²¡æœ‰æŠŠçŠ¶æ€æŒ‚è½½åœ¨æœ€é¡¶å±‚ï¼Œè¯¦ç»†å®Œæ•´ç‰ˆå¯ä»¥å‚è€ƒé˜®ä¸€å³°è€å¸ˆçš„ä»£ç ï¼š<a href="https://github.com/reduxjs/redux/tree/master/examples/counter" target="_blank" rel="noopener">Redux Counter Example</a>ã€‚</p><p>Redux çš„å·¥ä½œæµç¨‹å›¾ï¼Œ<a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" target="_blank" rel="noopener">é˜®ä¸€å³°åšå®¢æ–‡ç« </a>æ‘˜å½•:</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/2016/bg2016091802.jpg" alt="Redux-Flow"></p><h2 id="React-Redux"><a href="#React-Redux" class="headerlink" title="React-Redux"></a>React-Redux</h2><p>Redux æ˜¯ä¸€æ¬¾çŠ¶æ€ç®¡ç†åº“ï¼Œå¹¶ä¸”æä¾›äº† react-redux åº“æ¥ä¸ React äº²å¯†é…åˆï¼Œè¿™ä¸¤è€…çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2018/10/24/166a3e1533df9e8d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="react-reduxæµç¨‹å›¾"></p><p>ç»§ç»­å®ç°è®¡æ•°å™¨ï¼Œå®Œæ•´ Demo å¯ä»¥çœ‹<a href="https://github.com/yangtao2o/myreact/tree/master/myredux/react-redux-counter" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p><p>src ç›®å½•ä¸‹å¤§ä½“ç»“æ„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ actions</span><br><span class="line">â”‚   â””â”€â”€ counter.jsx</span><br><span class="line">â”œâ”€â”€ components</span><br><span class="line">â”‚   â””â”€â”€ app.jsx</span><br><span class="line">â”œâ”€â”€ reducers</span><br><span class="line">â”‚   â””â”€â”€ counter.jsx</span><br><span class="line">â””â”€â”€ store</span><br><span class="line">    â””â”€â”€ app.jsx</span><br><span class="line">â”œâ”€â”€ index.jsx</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œçœ‹å…¥å£æ–‡ä»¶ <code>index.js</code>:</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">"./reducers/counter.jsx"</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./store/app.jsx"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Provider&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById("root")</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p>Provider ç»„ä»¶ï¼Œå…¶å®å°±æ˜¯ Context å®ç°çš„ï¼Œæä¾›ä¸€ä¸ªçŠ¶æ€ä¾›è·¨ç»„ä»¶ä½¿ç”¨ï¼Œåªéœ€è¦æŠŠ store ç»™ä»–ä¼ è¿‡å»ï¼Œæ‰€æœ‰çš„å­ç»„ä»¶å°±å¯ä»¥é€šè¿‡ props å±æ€§æ‹¿åˆ°çŠ¶æ€å€¼ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Context = React.createContext();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// å°†React-reduxä¸­çš„ProvideåŒ…è£…äº†reactæä¾›çš„APIç”Ÿæˆçš„Context.Provider</span></span><br><span class="line">  <span class="comment">//&lt;Provider store=&#123;xxxx&#125;&gt;&lt;/Provider&gt;ï¼Œå°†storeæŒ‚è½½åœ¨contexä¸Š</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Context.Provider value=&#123;&#123; <span class="attr">store</span>: <span class="keyword">this</span>.props.store &#125;&#125;&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.props.children&#125; <span class="comment">//å­ç»„ä»¶</span></span><br><span class="line">      &lt;<span class="regexp">/Context.Provider&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>Reducer å‡½æ•°ï¼Œå®ƒæ¥å— Action å’Œå½“å‰ State ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Stateï¼Œå†…å®¹å’Œä¹‹å‰çš„å‡ ä¹å·®ä¸å¤šï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">"./reducers/counter.jsx"</span>;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./reducers/counter.jsx</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state = &#123; counter: <span class="number">0</span> &#125;, action = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; counter &#125; = state;</span><br><span class="line">  <span class="keyword">const</span> &#123; type &#125; = action;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"INCREASE"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: counter + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"DECREASE"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: counter - <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: <span class="number">0</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React-Redux çš„æ ¸å¿ƒä¹‹ä¸€ connect æ–¹æ³•ï¼Œç”¨äºä» UI ç»„ä»¶ç”Ÿæˆå®¹å™¨ç»„ä»¶ã€‚connect æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š<code>mapStateToProps</code> å’Œ <code>mapDispatchToProps</code>ã€‚å®ƒä»¬å®šä¹‰äº† UI ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘ã€‚å‰è€…è´Ÿè´£è¾“å…¥é€»è¾‘ï¼Œå³å°† state æ˜ å°„åˆ° UI ç»„ä»¶çš„å‚æ•°ï¼ˆpropsï¼‰ï¼Œåè€…è´Ÿè´£è¾“å‡ºé€»è¾‘ï¼Œå³å°†ç”¨æˆ·å¯¹ UI ç»„ä»¶çš„æ“ä½œæ˜ å°„æˆ Actionã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./store/app.jsx"</span>;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./store/app.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./../components/app.jsx"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  increaseAction,</span><br><span class="line">  decreaseAction,</span><br><span class="line">  resetAction</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"./../actions/counter.jsx"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mapStateToPropsç”¨æˆ·è‡ªå·±å®šä¹‰éœ€è¦çš„çŠ¶æ€</span></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function"><span class="params">state</span> =&gt;</span> (&#123; <span class="attr">counter</span>: state.counter &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function"><span class="params">dispatch</span> =&gt;</span> (&#123;</span><br><span class="line">  onIncreaseHandle: <span class="function"><span class="params">()</span> =&gt;</span> dispatch(increaseAction),</span><br><span class="line">  onDecreaseHandle: <span class="function"><span class="params">()</span> =&gt;</span> dispatch(decreaseAction),</span><br><span class="line">  onResetHandle: <span class="function"><span class="params">()</span> =&gt;</span> dispatch(resetAction)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(App);</span><br></pre></td></tr></table></figure><p>Action çš„ type å±æ€§ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./../actions/counter.jsx</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> increaseAction = &#123; <span class="attr">type</span>: <span class="string">"INCREASE"</span> &#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> decreaseAction = &#123; <span class="attr">type</span>: <span class="string">"DECREASE"</span> &#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> resetAction = &#123; <span class="attr">type</span>: <span class="string">"RESET"</span> &#125;;</span><br></pre></td></tr></table></figure><p>æ¥ç€ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ç†Ÿæ‚‰çš„ App ç»„ä»¶åº”è¯¥æ€ä¹ˆå†™ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import App from "./../components/app.jsx";</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;</span><br><span class="line">      counter,</span><br><span class="line">      onIncreaseHandle,</span><br><span class="line">      onDecreaseHandle,</span><br><span class="line">      onResetHandle</span><br><span class="line">    &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;&#123;counter&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;onIncreaseHandle&#125;&gt;+1&lt;/</span>button&gt;</span><br><span class="line">        &lt;button onClick=&#123;onDecreaseHandle&#125;&gt;<span class="number">-1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;onResetHandle&#125;&gt;0&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure><p>å‰æœŸåšäº†è®¸å¤šå·¥ä½œï¼Œè¿™é‡Œå¦‚åŒä»çˆ¶ç»„ä»¶é‡Œè·å– props å±æ€§èˆ¬è·å–ã€è§¦å‘ç­‰è¡Œä¸ºï¼Œæ‰€æœ‰ store é‡Œçš„ state éƒ½é€šè¿‡ connect æ–¹æ³•ç»™å¤„ç†äº†ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connect(mapStateToProps, mapDispatchToProps)(App);</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œè®¡æ•°å™¨åŸºæœ¬çš„åŠŸèƒ½éƒ½å¥½äº†ï¼Œæˆ‘çš„ <a href="https://github.com/yangtao2o/myreact/tree/master/myredux/react-redux-counter" target="_blank" rel="noopener">Demo</a>ï¼Œé˜®ä¸€å³°è€å¸ˆçš„ <a href="https://github.com/jackielii/simplest-redux-example/blob/master/index.js" target="_blank" rel="noopener">Demo</a>ï¼Œä»¥åŠè®²è§£çš„æ–‡ç« ï¼Œ<a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html" target="_blank" rel="noopener">Redux å…¥é—¨æ•™ç¨‹ï¼ˆä¸‰ï¼‰ï¼šReact-Redux çš„ç”¨æ³•</a>ï¼Œ<a href="https://juejin.im/post/5bcfce9ff265da0aa5294a25" target="_blank" rel="noopener">è®© react ç”¨èµ·æ¥æ›´å¾—å¿ƒåº”æ‰‹â€”â€”ï¼ˆreact-reduxï¼‰</a>ã€‚</p><h2 id="React-Hooks"><a href="#React-Hooks" class="headerlink" title="React Hooks"></a>React Hooks</h2><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" target="_blank" rel="noopener">Redux å…¥é—¨æ•™ç¨‹ï¼ˆä¸€ï¼‰ï¼šåŸºæœ¬ç”¨æ³•</a></li><li><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html" target="_blank" rel="noopener">Redux å…¥é—¨æ•™ç¨‹ï¼ˆä¸‰ï¼‰ï¼šReact-Redux çš„ç”¨æ³•</a></li><li><a href="https://juejin.im/post/5bcfce9ff265da0aa5294a25" target="_blank" rel="noopener">è®© react ç”¨èµ·æ¥æ›´å¾—å¿ƒåº”æ‰‹â€”â€”ï¼ˆreact-reduxï¼‰</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç›®çš„ï¼šé‡‡ç”¨çŠ¶æ€ç®¡ç†çš„å¤šç§æ–¹å¼ï¼šå®ç°ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¯ä»¥åŠ ä¸€ï¼Œå‡ä¸€ï¼Œ ç½®é›¶ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="å‰ç«¯æ¡†æ¶" scheme="http://yangtao.site/categories/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="é¢è¯•" scheme="http://yangtao.site/tags/%E9%9D%A2%E8%AF%95/"/>
    
      <category term="react" scheme="http://yangtao.site/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>JS å¼‚æ­¥å¤„ç†çš„å‡ ç§æ–¹å¼Â·è¯·æ±‚ç¯‡</title>
    <link href="http://yangtao.site/2019/12/29/async-method-2/"/>
    <id>http://yangtao.site/2019/12/29/async-method-2/</id>
    <published>2019-12-29T07:49:41.000Z</published>
    <updated>2020-01-02T12:37:46.797Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h2><ul><li><a href="https://github.com/mqyqingfeng/Blog/issues/98" target="_blank" rel="noopener">ES6 ç³»åˆ—ä¹‹æˆ‘ä»¬æ¥èŠèŠ Promise</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/101" target="_blank" rel="noopener">ES6 ç³»åˆ—ä¹‹å¼‚æ­¥å¤„ç†å®æˆ˜</a></li><li><a href="https://github.com/mqyqingfeng/Blog#es6-%E7%B3%BB%E5%88%97%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener">ES6 ç³»åˆ— - å†´ç¾½çš„åšå®¢</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å­¦ä¹ èµ„æ–™&quot;&gt;&lt;a href=&quot;#å­¦ä¹ èµ„æ–™&quot; class=&quot;headerlink&quot; title=&quot;å­¦ä¹ èµ„æ–™&quot;&gt;&lt;/a&gt;å­¦ä¹ èµ„æ–™&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/mqyqingfeng/Blog/issues/98&quot; 
      
    
    </summary>
    
      <category term="JavaScript" scheme="http://yangtao.site/categories/JavaScript/"/>
    
    
      <category term="é¢è¯•" scheme="http://yangtao.site/tags/%E9%9D%A2%E8%AF%95/"/>
    
      <category term="ES6" scheme="http://yangtao.site/tags/ES6/"/>
    
  </entry>
  
  <entry>
    <title>JS å¼‚æ­¥å¤„ç†çš„å‡ ç§æ–¹å¼Â·çº¢ç¯ç¯‡</title>
    <link href="http://yangtao.site/2019/12/29/async-method-1/"/>
    <id>http://yangtao.site/2019/12/29/async-method-1/</id>
    <published>2019-12-29T07:44:22.000Z</published>
    <updated>2020-01-02T12:36:53.975Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>é¢˜ç›®ï¼šçº¢ç¯ä¸‰ç§’äº®ä¸€æ¬¡ï¼Œç»¿ç¯ä¸€ç§’äº®ä¸€æ¬¡ï¼Œé»„ç¯ä¸¤ç§’äº®ä¸€æ¬¡ï¼Œä¸æ–­äº¤æ›¿å¾ªç¯</p></blockquote><a id="more"></a><p>å…ˆå®šä¹‰ä¸‹çº¢ç»¿ç¯ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">red</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"red"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">green</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"green"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">yellow</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"yellow"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼‚æ­¥ç¼–ç¨‹çš„è¯­æ³•ç›®æ ‡ï¼Œå°±æ˜¯æ€æ ·è®©å®ƒæ›´åƒåŒæ­¥ç¼–ç¨‹,æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>å›è°ƒå‡½æ•°å®ç°</li><li>äº‹ä»¶ç›‘å¬ event</li><li>å‘å¸ƒè®¢é˜… Publish/Subscribe</li><li>Promise å’Œ Generator</li><li>Async/await</li></ul><h2 id="ä¸€ã€å›è°ƒå‡½æ•°"><a href="#ä¸€ã€å›è°ƒå‡½æ•°" class="headerlink" title="ä¸€ã€å›è°ƒå‡½æ•°"></a>ä¸€ã€å›è°ƒå‡½æ•°</h2><p>è¿™æ˜¯æœ€å¸¸è§çš„ä¸€ç§æ–¹å¼ï¼ŒæŠŠå‡½æ•°ä½œä¸ºå‚æ•°é€å…¥ï¼Œç„¶åå›è°ƒã€‚</p><p>ç¬¬ä¸€ç‰ˆï¼šç®€å•æ˜äº†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"wait for about 3 seconds..."</span>);</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    red();</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      green();</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        yellow();</span><br><span class="line">        step();</span><br><span class="line">      &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">step();</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç‰ˆï¼šå°è£…å®šæ—¶å™¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> light = <span class="function">(<span class="params">timmer, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, timmer);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  light(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">    red();</span><br><span class="line">    light(<span class="number">1000</span>, () =&gt; &#123;</span><br><span class="line">      green();</span><br><span class="line">      light(<span class="number">2000</span>, () =&gt; &#123;</span><br><span class="line">        yellow();</span><br><span class="line">        step();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">typeof</span> cb === <span class="string">"function"</span> &amp;&amp; cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">step(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"wait for about 3 seconds..."</span>));</span><br></pre></td></tr></table></figure><h2 id="äºŒã€äº‹ä»¶ç›‘å¬"><a href="#äºŒã€äº‹ä»¶ç›‘å¬" class="headerlink" title="äºŒã€äº‹ä»¶ç›‘å¬"></a>äºŒã€äº‹ä»¶ç›‘å¬</h2><p>é‡‡ç”¨äº‹ä»¶é©±åŠ¨æ¨¡å¼ã€‚ä»»åŠ¡çš„æ‰§è¡Œä¸å–å†³äºä»£ç çš„é¡ºåºï¼Œè€Œå–å†³äºæŸä¸ªäº‹ä»¶æ˜¯å¦å‘ç”Ÿã€‚</p><p>ç¬¬ä¸€ç‰ˆï¼šç›‘å¬ä¸€ä¸ªäº‹ä»¶ï¼Œç„¶åè§¦å‘è¿™ä¸ªäº‹ä»¶ï¼Œå¹¶ä¸”æ‰§è¡Œäº‹ä»¶é‡Œçš„å›è°ƒå‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ Node events æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> events = <span class="built_in">require</span>(<span class="string">"events"</span>);</span><br><span class="line"><span class="keyword">const</span> emitter = <span class="keyword">new</span> events.EventEmitter();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬</span></span><br><span class="line">emitter.on(<span class="string">"lightEvent"</span>, str =&gt; <span class="built_in">console</span>.log(str));</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§¦å‘</span></span><br><span class="line">emitter.emit(<span class="string">"lightEvent"</span>, <span class="string">"red"</span>);</span><br><span class="line">emitter.emit(<span class="string">"lightEvent"</span>, <span class="string">"green"</span>);</span><br><span class="line">emitter.emit(<span class="string">"lightEvent"</span>, <span class="string">"yellow"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// red</span></span><br><span class="line"><span class="comment">// green</span></span><br><span class="line"><span class="comment">// yellow</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç‰ˆï¼šåŠ ä¸ªé¡ºåºæ‰§è¡Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ Node events æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> events = <span class="built_in">require</span>(<span class="string">"events"</span>);</span><br><span class="line"><span class="keyword">const</span> emitter = <span class="keyword">new</span> events.EventEmitter();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> lightHandler = <span class="function">(<span class="params">timmer, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, timmer);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬</span></span><br><span class="line">emitter.on(<span class="string">"lightEvent"</span>, str =&gt; <span class="built_in">console</span>.log(str));</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§¦å‘</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  lightHandler(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">    emitter.emit(<span class="string">"lightEvent"</span>, <span class="string">"red"</span>);</span><br><span class="line">    lightHandler(<span class="number">1000</span>, () =&gt; &#123;</span><br><span class="line">      emitter.emit(<span class="string">"lightEvent"</span>, <span class="string">"green"</span>);</span><br><span class="line">      lightHandler(<span class="number">2000</span>, () =&gt; &#123;</span><br><span class="line">        emitter.emit(<span class="string">"lightEvent"</span>, <span class="string">"yellow"</span>);</span><br><span class="line">        step();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">step();</span><br></pre></td></tr></table></figure><p>ä¾æ—§æ˜¯å›è°ƒæ‰§è¡Œï¼Œæˆ‘ä»¬ç»§ç»­è¿œå¾å§ã€‚</p><h2 id="ä¸‰ã€å‘å¸ƒ-è®¢é˜…"><a href="#ä¸‰ã€å‘å¸ƒ-è®¢é˜…" class="headerlink" title="ä¸‰ã€å‘å¸ƒ/è®¢é˜…"></a>ä¸‰ã€å‘å¸ƒ/è®¢é˜…</h2><blockquote><p>â€œäº‹ä»¶â€ï¼Œå®Œå…¨å¯ä»¥ç†è§£æˆâ€ä¿¡å·â€ã€‚</p><p>æˆ‘ä»¬å‡å®šï¼Œå­˜åœ¨ä¸€ä¸ªâ€ä¿¡å·ä¸­å¿ƒâ€ï¼ŒæŸä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œå°±å‘ä¿¡å·ä¸­å¿ƒâ€å‘å¸ƒâ€ï¼ˆpublishï¼‰ä¸€ä¸ªä¿¡å·ï¼Œå…¶ä»–ä»»åŠ¡å¯ä»¥å‘ä¿¡å·ä¸­å¿ƒâ€è®¢é˜…â€ï¼ˆsubscribeï¼‰è¿™ä¸ªä¿¡å·ï¼Œä»è€ŒçŸ¥é“ä»€ä¹ˆæ—¶å€™è‡ªå·±å¯ä»¥å¼€å§‹æ‰§è¡Œã€‚è¿™å°±å«åšâ€å‘å¸ƒ/è®¢é˜…æ¨¡å¼â€ï¼ˆpublish-subscribe patternï¼‰ï¼Œåˆç§°â€è§‚å¯Ÿè€…æ¨¡å¼â€ï¼ˆobserver patternï¼‰ã€‚ - é˜®ä¸€å³°</p></blockquote><p>è®¢é˜…è€…ï¼ˆSubscriberï¼‰æŠŠè‡ªå·±æƒ³è®¢é˜…çš„äº‹ä»¶æ³¨å†Œï¼ˆSubscribeï¼‰åˆ°è°ƒåº¦ä¸­å¿ƒï¼ˆEvent Channelï¼‰ï¼Œå½“å‘å¸ƒè€…ï¼ˆPublisherï¼‰å‘å¸ƒè¯¥äº‹ä»¶ï¼ˆPublish Eventï¼‰åˆ°è°ƒåº¦ä¸­å¿ƒï¼Œä¹Ÿå°±æ˜¯è¯¥äº‹ä»¶è§¦å‘æ—¶ï¼Œç”±è°ƒåº¦ä¸­å¿ƒç»Ÿä¸€è°ƒåº¦ï¼ˆFire Eventï¼‰è®¢é˜…è€…æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒçš„å¤„ç†ä»£ç ã€‚</p><p>ç¬¬ä¸€ç‰ˆï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> publisher = &#123;</span><br><span class="line">  <span class="comment">// ç¼“å­˜åˆ—è¡¨</span></span><br><span class="line">  lists: &#123;&#125;,</span><br><span class="line">  <span class="comment">// è®¢é˜…</span></span><br><span class="line">  subscribe: <span class="function"><span class="keyword">function</span>(<span class="params">event, handler</span>) </span>&#123;</span><br><span class="line">    (<span class="keyword">this</span>.lists[event] || (<span class="keyword">this</span>.lists[event] = [])).push(handler);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å‘å¸ƒ</span></span><br><span class="line">  publish: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> event = [].shift.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">const</span> events = <span class="keyword">this</span>.lists[event];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!events || events.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    events.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      item.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¢é˜…</span></span><br><span class="line">publisher.subscribe(<span class="string">"lightEvent"</span>, red);</span><br><span class="line">publisher.subscribe(<span class="string">"lightEvent"</span>, green);</span><br><span class="line">publisher.subscribe(<span class="string">"lightEvent"</span>, yellow);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘å¸ƒ</span></span><br><span class="line">publisher.publish(<span class="string">"lightEvent"</span>);</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç‰ˆï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> publisher = &#123;</span><br><span class="line">  <span class="comment">// ç¼“å­˜åˆ—è¡¨</span></span><br><span class="line">  lists: &#123;&#125;,</span><br><span class="line">  <span class="comment">// è®¢é˜…</span></span><br><span class="line">  subscribe: <span class="function"><span class="keyword">function</span>(<span class="params">event, handler</span>) </span>&#123;</span><br><span class="line">    (<span class="keyword">this</span>.lists[event] || (<span class="keyword">this</span>.lists[event] = [])).push(handler);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å–æ¶ˆè®¢é˜…</span></span><br><span class="line">  unsubscribe: <span class="function"><span class="keyword">function</span>(<span class="params">event, handler</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> events = <span class="keyword">this</span>.lists[event];</span><br><span class="line">    <span class="keyword">if</span> (!events) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!handler) &#123;</span><br><span class="line">      events &amp;&amp; (events.length = <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      events.forEach(<span class="function">(<span class="params">item, i</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (item === handler) &#123;</span><br><span class="line">          events.splice(i, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å‘å¸ƒ</span></span><br><span class="line">  publish: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> event = [].shift.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">const</span> events = <span class="keyword">this</span>.lists[event];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!events || events.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    events.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      item.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> lightHandler = <span class="function">(<span class="params">timmer, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, timmer);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> colorHandler = <span class="function"><span class="params">color</span> =&gt;</span> <span class="built_in">console</span>.log(color);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¢é˜…</span></span><br><span class="line">publisher.subscribe(<span class="string">"redEvent"</span>, colorHandler);</span><br><span class="line">publisher.subscribe(<span class="string">"greenEvent"</span>, colorHandler);</span><br><span class="line">publisher.subscribe(<span class="string">"yellowEvent"</span>, colorHandler);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  lightHandler(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">    publisher.publish(<span class="string">"redEvent"</span>, <span class="string">"red"</span>);</span><br><span class="line">    lightHandler(<span class="number">1000</span>, () =&gt; &#123;</span><br><span class="line">      publisher.publish(<span class="string">"greenEvent"</span>, <span class="string">"green"</span>);</span><br><span class="line">      lightHandler(<span class="number">2000</span>, () =&gt; &#123;</span><br><span class="line">        publisher.publish(<span class="string">"yellowEvent"</span>, <span class="string">"yellow"</span>);</span><br><span class="line">        step();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">step();</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€Promise"><a href="#ä¸‰ã€Promise" class="headerlink" title="ä¸‰ã€Promise"></a>ä¸‰ã€Promise</h2><p>ç›´æ¥ä¸Šä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> light = <span class="function">(<span class="params">timmer, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      cb();</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, timmer);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> step = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">Promise</span>.resolve()</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> light(<span class="number">3000</span>, red);</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> light(<span class="number">1000</span>, green);</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> light(<span class="number">2000</span>, yellow);</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      step();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">step();</span><br></pre></td></tr></table></figure><h2 id="å››ã€Generator"><a href="#å››ã€Generator" class="headerlink" title="å››ã€Generator"></a>å››ã€Generator</h2><p>Promise çš„å†™æ³•å‡å°‘äº†å¥½å¤šå›è°ƒï¼Œä½†æ˜¯ä»æœ‰å›è°ƒçš„å­˜åœ¨ï¼Œè¿™æ¬¡å°è¯•ä½¿ç”¨ Generatorï¼Œçœ‹æ˜¯å¦èƒ½å¤Ÿé¿å…å›è°ƒã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> light = <span class="function">(<span class="params">timmer, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      cb();</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, timmer);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> light(<span class="number">3000</span>, red);</span><br><span class="line">  <span class="keyword">yield</span> light(<span class="number">1000</span>, green);</span><br><span class="line">  <span class="keyword">yield</span> light(<span class="number">3000</span>, yellow);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> iterator = gen();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> step = <span class="function">(<span class="params">gen, iterator</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> s = iterator.next();</span><br><span class="line">  <span class="comment">// è¿”å› &#123; value: Promise &#123; &lt;pending&gt; &#125;, done: false &#125;</span></span><br><span class="line">  <span class="keyword">if</span> (s.done) &#123;</span><br><span class="line">    step(gen, gen());</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// value è¿”å› Promise å¯¹è±¡</span></span><br><span class="line">    s.value.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      step(gen, iterator);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">step(gen, iterator);</span><br></pre></td></tr></table></figure><h2 id="äº”ã€Async-await"><a href="#äº”ã€Async-await" class="headerlink" title="äº”ã€Async/await"></a>äº”ã€Async/await</h2><p>æœ‰äº† Generator åšé“ºå«ï¼Œ<code>async/await</code> å°±æ¯”è¾ƒå®¹æ˜“ç†è§£äº†ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> light = <span class="function">(<span class="params">timmer, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      cb();</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, timmer);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">await</span> light(<span class="number">3000</span>, red);</span><br><span class="line">  <span class="keyword">await</span> light(<span class="number">1000</span>, green);</span><br><span class="line">  <span class="keyword">await</span> light(<span class="number">2000</span>, yellow);</span><br><span class="line">  step();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">step();</span><br></pre></td></tr></table></figure><p>åŒæ­¥å†™æ³•ï¼Œå®¹æ˜“ç†è§£ï¼Œå’Œæˆ‘ä»¬çš„çº¿æ€§æ€è€ƒæ–¹å¼ä¸€è‡´ï¼Œ<code>async/await</code>æ˜¯ <code>ES2017</code> çš„æ–¹æ¡ˆã€‚</p><h2 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h2><ul><li><a href="https://www.cnblogs.com/dojo-lzz/p/5495671.html" target="_blank" rel="noopener">ä¸€é“å…³äº Promise åº”ç”¨çš„é¢è¯•é¢˜</a></li><li><a href="https://github.com/mqyqingfeng/Blog/issues/98" target="_blank" rel="noopener">ES6 ç³»åˆ—ä¹‹æˆ‘ä»¬æ¥èŠèŠ Promise</a></li><li><a href="http://www.ruanyifeng.com/blog/2012/12/asynchronous%EF%BC%BFjavascript.html" target="_blank" rel="noopener">Javascript å¼‚æ­¥ç¼–ç¨‹çš„ 4 ç§æ–¹æ³•</a></li><li><a href="https://juejin.im/post/5cd97d75e51d453a69177ecc" target="_blank" rel="noopener">JavaScript | å¼‚æ­¥å¤„ç†</a></li><li><a href="https://www.cnblogs.com/pingfan1990/p/4661841.html" target="_blank" rel="noopener">nodejs äº‹ä»¶çš„ç›‘å¬ä¸äº‹ä»¶çš„è§¦å‘</a></li><li><a href="https://www.codercto.com/a/81223.html" target="_blank" rel="noopener">JavaScript å‘å¸ƒ-è®¢é˜…æ¨¡å¼</a></li><li><a href="https://www.jb51.net/article/154921.htm" target="_blank" rel="noopener">JavaScript å®ç°ä¸ä½¿ç”¨å‘å¸ƒ/è®¢é˜…æ¨¡å¼è¯¦è§£</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;é¢˜ç›®ï¼šçº¢ç¯ä¸‰ç§’äº®ä¸€æ¬¡ï¼Œç»¿ç¯ä¸€ç§’äº®ä¸€æ¬¡ï¼Œé»„ç¯ä¸¤ç§’äº®ä¸€æ¬¡ï¼Œä¸æ–­äº¤æ›¿å¾ªç¯&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://yangtao.site/categories/JavaScript/"/>
    
    
      <category term="é¢è¯•" scheme="http://yangtao.site/tags/%E9%9D%A2%E8%AF%95/"/>
    
      <category term="ES6" scheme="http://yangtao.site/tags/ES6/"/>
    
  </entry>
  
  <entry>
    <title>æ¢ä¸€ä¸‹ NodeList å’Œ HTMLCollection</title>
    <link href="http://yangtao.site/2019/12/03/html-nodelist/"/>
    <id>http://yangtao.site/2019/12/03/html-nodelist/</id>
    <published>2019-12-03T10:09:36.000Z</published>
    <updated>2019-12-03T10:13:32.294Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸»è¦åŒºåˆ«æ˜¯ï¼ŒNodeList å¯ä»¥åŒ…å«å„ç§ç±»å‹çš„èŠ‚ç‚¹ï¼ŒHTMLCollection åªèƒ½åŒ…å« HTML å…ƒç´ èŠ‚ç‚¹ã€‚</p></blockquote><a id="more"></a><h2 id="NodeList-æ¥å£"><a href="#NodeList-æ¥å£" class="headerlink" title="NodeList æ¥å£"></a>NodeList æ¥å£</h2><p>NodeList å®ä¾‹æ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œå®ƒçš„æˆå‘˜æ˜¯èŠ‚ç‚¹å¯¹è±¡ã€‚é€šè¿‡ä»¥ä¸‹æ–¹æ³•å¯ä»¥å¾—åˆ° NodeList å®ä¾‹ã€‚</p><ul><li>Node.childNodes</li><li>document.querySelectorAll() ç­‰èŠ‚ç‚¹æœç´¢æ–¹æ³•</li></ul><p>NodeList å®ä¾‹å¾ˆåƒæ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨ length å±æ€§å’Œ forEach æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå®ƒä¸æ˜¯æ•°ç»„ï¼Œä¸èƒ½ä½¿ç”¨ pop æˆ– push ä¹‹ç±»æ•°ç»„ç‰¹æœ‰çš„æ–¹æ³•ã€‚</p><p>å¦‚æœ NodeList å®ä¾‹è¦ä½¿ç”¨æ•°ç»„æ–¹æ³•ï¼Œå¯ä»¥å°†å…¶è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚</p><p>é™¤äº†ä½¿ç”¨ forEach æ–¹æ³•éå† NodeList å®ä¾‹ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ for å¾ªç¯ã€‚</p><ul><li>NodeList.prototype.lengthï¼Œlength å±æ€§è¿”å› NodeList å®ä¾‹åŒ…å«çš„èŠ‚ç‚¹æ•°é‡</li><li>NodeList.prototype.forEach()ï¼Œéå† NodeList çš„æ‰€æœ‰æˆå‘˜</li><li>NodeList.prototype.item()ï¼Œitem æ–¹æ³•æ¥å—ä¸€ä¸ªæ•´æ•°å€¼ä½œä¸ºå‚æ•°ï¼Œè¡¨ç¤ºæˆå‘˜çš„ä½ç½®ï¼Œè¿”å›è¯¥ä½ç½®ä¸Šçš„æˆå‘˜ã€‚</li></ul><p>ä¸‹é¢ä¸‰ä¸ªæ–¹æ³•ï¼Œéƒ½è¿”å›ä¸€ä¸ª ES6 çš„éå†å™¨å¯¹è±¡ï¼Œ<code>for...of</code> å¯è·å–æ¯ä¸€ä¸ªæˆå‘˜ä¿¡æ¯ï¼š</p><ul><li>NodeList.prototype.keys()ï¼Œè¿”å›é”®åçš„éå†å™¨</li><li>NodeList.prototype.values()ï¼Œè¿”å›é”®å€¼çš„éå†å™¨</li><li>NodeList.prototype.entries()ï¼Œè¿”å›çš„éå†å™¨</li></ul><h2 id="HTMLCollection-æ¥å£"><a href="#HTMLCollection-æ¥å£" class="headerlink" title="HTMLCollection æ¥å£"></a>HTMLCollection æ¥å£</h2><p>HTMLCollection æ˜¯ä¸€ä¸ªèŠ‚ç‚¹å¯¹è±¡çš„é›†åˆï¼Œåªèƒ½åŒ…å«å…ƒç´ èŠ‚ç‚¹ï¼ˆelementï¼‰ï¼Œä¸èƒ½åŒ…å«å…¶ä»–ç±»å‹çš„èŠ‚ç‚¹ã€‚</p><p>å®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œä½†æ˜¯ä¸ NodeList æ¥å£ä¸åŒï¼ŒHTMLCollection æ²¡æœ‰ forEach æ–¹æ³•ï¼Œåªèƒ½ä½¿ç”¨ for å¾ªç¯éå†ã€‚</p><p>è¿”å› HTMLCollection å®ä¾‹çš„ï¼Œä¸»è¦æ˜¯ä¸€äº› Document å¯¹è±¡çš„é›†åˆå±æ€§ï¼Œæ¯”å¦‚ document.linksã€document.formsã€document.images ç­‰ã€‚</p><ul><li>HTMLCollection.prototype.length</li><li>HTMLCollection.prototype.item()</li><li>HTMLCollection.prototype.namedItem()ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤º id å±æ€§æˆ– name å±æ€§çš„å€¼ï¼Œè¿”å›å¯¹åº”çš„å…ƒç´ èŠ‚ç‚¹ã€‚å¦‚æœæ²¡æœ‰å¯¹åº”çš„èŠ‚ç‚¹ï¼Œåˆ™è¿”å› nullã€‚</li></ul><h2 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h2><p>å…±åŒç‚¹ï¼š</p><ul><li>ç±»æ•°ç»„å¯¹è±¡ï¼Œæœ‰ length å±æ€§</li><li>å…±åŒçš„æ–¹æ³•ï¼šitemï¼Œå¯ä»¥é€šè¿‡ item(index) æˆ–è€… item(id) æ¥è®¿é—®è¿”å›ç»“æœä¸­çš„å…ƒç´ </li><li>å®æ—¶å˜åŠ¨çš„ï¼ˆliveï¼‰ï¼Œdocument ä¸Šçš„æ›´æ”¹ä¼šåæ˜ åˆ°ç›¸å…³å¯¹è±¡ä¸Šï¼ˆä¾‹å¤–ï¼šdocument.querySelectorAll è¿”å›çš„ NodeList ä¸æ˜¯å®æ—¶çš„ï¼‰</li></ul><p>åŒºåˆ«ï¼š</p><ul><li>NodeList å¯ä»¥åŒ…å«ä»»ä½•èŠ‚ç‚¹ç±»å‹ï¼ŒHTMLCollection åªåŒ…å«å…ƒç´ èŠ‚ç‚¹ï¼ˆelementNodeï¼‰ï¼ŒelementNode å°±æ˜¯ HTML ä¸­çš„æ ‡ç­¾</li><li>HTMLCollection æ¯” NodeList å¤šä¸€é¡¹æ–¹æ³•ï¼šnamedItemï¼Œå¯ä»¥é€šè¿‡ä¼ é€’ id æˆ– name å±æ€§æ¥è·å–èŠ‚ç‚¹ä¿¡æ¯</li></ul><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><a href="http://wangdoc.com/javascript/dom/nodelist.html" target="_blank" rel="noopener">NodeList æ¥å£ï¼ŒHTMLCollection æ¥å£</a></li><li><a href="https://www.jianshu.com/p/f6ff5ebe45fd" target="_blank" rel="noopener">HTMLCollection vs. NodeList</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä¸»è¦åŒºåˆ«æ˜¯ï¼ŒNodeList å¯ä»¥åŒ…å«å„ç§ç±»å‹çš„èŠ‚ç‚¹ï¼ŒHTMLCollection åªèƒ½åŒ…å« HTML å…ƒç´ èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Html" scheme="http://yangtao.site/categories/Html/"/>
    
    
      <category term="Html" scheme="http://yangtao.site/tags/Html/"/>
    
  </entry>
  
</feed>
